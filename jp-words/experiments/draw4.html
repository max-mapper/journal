<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TheShodo Kanji Drawing Demo</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      body {
        background-color: #f0f0f0;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      h1 {
        margin-bottom: 10px;
        color: #333;
      }

      #canvas-container {
        position: relative;
        width: 415px;
        height: 498px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        background-color: #fff;
        /* Japanese paper texture simulation */
        background-image: radial-gradient(#fff 0%, #f4f1ea 100%);
        cursor: crosshair;
        user-select: none;
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
        touch-action: none;
      }

      #layered-canvas {
        z-index: 1;
      }
      #write-canvas {
        z-index: 2;
        opacity: 1;
      }
      #hand-canvas {
        z-index: 3;
      }

      #hand-image {
        position: absolute;
        width: 20px;
        height: 20px;
        background: rgba(200, 0, 0, 0.5);
        border-radius: 50%;
        pointer-events: none;
        z-index: 10;
        display: none;
        margin-top: -10px;
        margin-left: -10px;
      }

      .controls {
        margin-top: 15px;
        display: flex;
        gap: 10px;
      }

      button {
        padding: 8px 16px;
        background: #333;
        color: #fff;
        border: none;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background: #555;
      }
    </style>
  </head>
  <body>
    <h1>Shodo Canvas Demo</h1>

    <div id="canvas-container">
      <div id="hand-image"></div>
      <canvas id="layered-canvas" width="415" height="498"></canvas>
      <canvas id="write-canvas" width="415" height="498"></canvas>
      <canvas id="hand-canvas" width="415" height="498"></canvas>
    </div>

    <div class="controls">
      <button onclick="clearCanvas()">Clear Paper</button>
      <button onclick="setBrush('Large')">Large Brush</button>
      <button onclick="setBrush('Medium')">Medium Brush</button>
      <button onclick="setBrush('Small')">Small Brush</button>
    </div>

    <script>
      // --- 1. Polyfill for jQuery .live() ---
      jQuery.fn.live = function (types, data, fn) {
        jQuery(this.context).on(types, this.selector, data, fn);
        return this;
      };

      // Ensure Namespace Exists
      window.TheShodo = window.TheShodo || {};
      if (!TheShodo.Shodo) TheShodo.Shodo = {};
      // Placeholder for baseUrl referenced in Paper code
      TheShodo.baseUrl = "";
    </script>

    <script>
      TheShodo.Shodo.Brush = function (brushName, opt) {
        this.name = brushName;
        this.width = opt.width;
        this.height = opt.height;
        this.maxSize = opt.maxSize || opt.width;
        this.minSize = opt.minSize || 0;
        this.brushImageName = opt.brushImageName || brushName;
        this.image = opt.image;
        this.kasureImage = opt.kasureImage;
      };
      TheShodo.Shodo.Brush.prototype.draw = function (ctx, pos, size) {
        ctx.drawImage(
          this.image,
          pos.x - size / 2,
          pos.y - size / 2,
          size,
          size,
        );
      };
      TheShodo.Shodo.Brush.prototype.clone = function () {
        return new TheShodo.Shodo.Brush(this.name, {
          width: this.width,
          height: this.height,
          maxSize: this.maxSize,
          minSize: this.minSize,
          brushImageName: this.brushImageName,
          image: this.image,
          kasureImage: this.kasureImage,
        });
      };

      TheShodo.Shodo.Brushes = {
        Small: new TheShodo.Shodo.Brush("Small", {
          width: 90,
          height: 90,
          maxSize: 15,
          minSize: 3,
          brushImageName: "Medium",
        }),
        Middle: new TheShodo.Shodo.Brush("Middle", {
          width: 90,
          height: 90,
          maxSize: 40,
          minSize: 3,
          brushImageName: "Medium",
        }),
        Medium: new TheShodo.Shodo.Brush("Medium", {
          width: 90,
          height: 90,
          maxSize: 40,
          minSize: 3,
        }),
        Large: new TheShodo.Shodo.Brush("Large", {
          width: 90,
          height: 90,
          maxSize: 60,
          minSize: 3,
          brushImageName: "Medium",
        }),
        getBrush: function (brushName) {
          // Note: The provided code uses 'brushName' to fetch the image,
          // ignoring 'brushImageName' in the config above.
          if (!this[brushName].image) {
            this[brushName].image = TheShodo.Shodo.Resources.getImage(
              "Brushes",
              brushName,
            );
            this[brushName].kasureImage = TheShodo.Shodo.Resources.getImage(
              "KasureBrushes",
              brushName,
            );
          }
          return this[brushName].clone();
        },
      };

      TheShodo.Shodo.Paper = {};
      TheShodo.Shodo.Paper.createClippedImageCanvas = function (
        image,
        x,
        y,
        width,
        height,
      ) {
        var canvas = document.createElement("canvas");
        canvas.width = width;
        canvas.height = height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(image, x, y, width, height);
        return canvas;
      };
      TheShodo.Shodo.Paper.createPaperFromName = function (
        nameOrDataUrl,
        mode,
      ) {
        var canvas = document.createElement("canvas");
        var image = document.createElement("img");
        if (nameOrDataUrl.match(/^data:image/)) {
          image.src = nameOrDataUrl;
        } else {
          image.src =
            TheShodo.baseUrl +
            "/img/" +
            (mode ? mode + "/" : "") +
            nameOrDataUrl +
            ".png";
        }
        return image;
      };

      TheShodo.Shodo.Resources = {
        createImage: function (url) {
          var image = document.createElement("img");
          image.src = url;
          return image;
        },
        getImage: function (category, name) {
          // Safety check for demo purposes
          if (!this[category] || !this[category][name]) {
            console.warn(
              "Missing resource:",
              category,
              name,
              "Using fallback.",
            );
            // Fallback to Medium if specific size missing
            if (this[category] && this[category]["Medium"])
              return this[category]["Medium"];
          }
          return this[category][name];
        },
      };
    </script>

    <script>
      // --- 3. Resource Generation (Mocking) ---
      // Since we don't have the actual .png files, we generate them programmatically
      // and inject them into TheShodo.Shodo.Resources.

      (function () {
        // function createBrushTip(size, isKasure) {
        //   const c = document.createElement("canvas");
        //   c.width = size;
        //   c.height = size;
        //   const ctx = c.getContext("2d");
        //   const grad = ctx.createRadialGradient(
        //     size / 2,
        //     size / 2,
        //     0,
        //     size / 2,
        //     size / 2,
        //     size / 2,
        //   );

        //   if (isKasure) {
        //     grad.addColorStop(0, "rgba(0,0,0,1)");
        //     grad.addColorStop(0.4, "rgba(0,0,0,0.8)");
        //     grad.addColorStop(1, "rgba(0,0,0,0)");
        //     ctx.fillStyle = grad;
        //     for (let i = 0; i < 150; i++) {
        //       ctx.beginPath();
        //       ctx.arc(
        //         Math.random() * size,
        //         Math.random() * size,
        //         Math.random() * 1.5,
        //         0,
        //         Math.PI * 2,
        //       );
        //       ctx.fill();
        //     }
        //   } else {
        //     grad.addColorStop(0, "rgba(0,0,0,1)");
        //     grad.addColorStop(0.5, "rgba(0,0,0,0.2)");
        //     grad.addColorStop(1, "rgba(0,0,0,0)");
        //     ctx.fillStyle = grad;
        //     ctx.fillRect(0, 0, size, size);
        //   }
        //   const img = document.createElement("img");
        //   img.src = c.toDataURL();
        //   return img;
        // }

        // const standardBrush = createBrushTip(90, false);
        // const kasureBrush = createBrushTip(90, true);

        TheShodo.Shodo.Resources.Brushes = {
          Small: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAOOSURBVHja7JxfhFRRHMfPNAzLsAzDEvu0REQZNjHEUC89xRI9TeplX3uKEkv0usxTbCKWlrVPPSR6SL1sdm12FWvZlNKIsllapUy/0/yuPffOnZlz555zu+fe75eP/Wt29nPPnPs7/6bQ6XQEYj9HoACiIRqBaIiGaASiIRqBaIiGaASiIRqBaIjOeeR8tIqSElEjJmDJgNcBomfl7yvsEgvERWIcKs2ILhI7AdEqP4lF4hyUxhNdHyA5yA63/jHojS66FUG0x1dijqhAs77ojRFEe+wT88RRiB4susR9cCcm8jHuEccgOlz0lAHJQR4RDYj2i65ZEK2WiLfz0K3oiK5bFK3ylJjJ6oAo6LUQ3KlUKBRO0IfNhJ/XB+KVwjbRdl20z2uIaPmy/piS5yuFfyde89dviQP+/JNyMQ74Z06JFlyilR1uUN4F+UVs8ffafHG2+RX0Lg2i1/immPVssfCXxBPlohgX3W/AMp/QDTFtyNHtCtGMO6WgOzK8kFPRKl94SqFqU7S8mj8g2zfCLdsQLfMQkn1sRmndUUTXIbeHFzwXZFR03Fm8rDJnQ/QMxIb22cdNiy6iVfftQoomRaOv7s+sadGCyxvI7R3cVEyLrvADQ7Cfu6ZFy1yF2NAb45Rp0RjE9F+mMy5aDkPfQG4PddOiBdeQ+5DrYyNY7pkQLXMJcgeXe6ZEy1yH3J5yb8KGaMHlDSQf8sCWaJlFCPaVe9Uw0SZ2/F8hlgUieAq1qTeCGS1FftmgVfOeGBtdh5oWRP9j3LZomTsQLRo2+uhgbhHXePNKXtOzidPW8bf7xHnh+P65GBlLSrTMc+K0yd0/DqVtq+oYdnXzNus3mcTNcND8yF4OJO/aGrDoZok4JbobCrOcJZsDlqiDm5vCzIGkNLbmchIDliiRp7WeZa1+tjmpFDfNjCz8tmzNR5uMXGWXWxp+O7zCUnJBtLpMtuKY5D0Rcmg17aK9TIvutisXVlWmtYqMlIr2cpZ4nFLJq6LPng4XRatdykJKSsLPxOVhT9hV0V7kMtEN8f/2lrSE5hEL10WrqfE/nkRp+F503+JIO1kSrabBCw6rFsq2kd5dR+csuOtzDVW+iZ7hiuCk0D9R9UccnkdfjjMvo3tyNmuR8ie5ZYYdi5CnZ78R66b+4FDRiJ3gnRwhGqIRiIZoiIYCiIZoBKIhGqIRiIZoBKIhGqIRiM5Q/gowAMsRJLrK/gy+AAAAAElFTkSuQmCC",
          ),
          Medium: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAOOSURBVHja7JxfhFRRHMfPNAzLsAzDEvu0REQZNjHEUC89xRI9TeplX3uKEkv0usxTbCKWlrVPPSR6SL1sdm12FWvZlNKIsllapUy/0/yuPffOnZlz555zu+fe75eP/Wt29nPPnPs7/6bQ6XQEYj9HoACiIRqBaIiGaASiIRqBaIiGaASiIRqBaIjOeeR8tIqSElEjJmDJgNcBomfl7yvsEgvERWIcKs2ILhI7AdEqP4lF4hyUxhNdHyA5yA63/jHojS66FUG0x1dijqhAs77ojRFEe+wT88RRiB4susR9cCcm8jHuEccgOlz0lAHJQR4RDYj2i65ZEK2WiLfz0K3oiK5bFK3ylJjJ6oAo6LUQ3KlUKBRO0IfNhJ/XB+KVwjbRdl20z2uIaPmy/piS5yuFfyde89dviQP+/JNyMQ74Z06JFlyilR1uUN4F+UVs8ffafHG2+RX0Lg2i1/immPVssfCXxBPlohgX3W/AMp/QDTFtyNHtCtGMO6WgOzK8kFPRKl94SqFqU7S8mj8g2zfCLdsQLfMQkn1sRmndUUTXIbeHFzwXZFR03Fm8rDJnQ/QMxIb22cdNiy6iVfftQoomRaOv7s+sadGCyxvI7R3cVEyLrvADQ7Cfu6ZFy1yF2NAb45Rp0RjE9F+mMy5aDkPfQG4PddOiBdeQ+5DrYyNY7pkQLXMJcgeXe6ZEy1yH3J5yb8KGaMHlDSQf8sCWaJlFCPaVe9Uw0SZ2/F8hlgUieAq1qTeCGS1FftmgVfOeGBtdh5oWRP9j3LZomTsQLRo2+uhgbhHXePNKXtOzidPW8bf7xHnh+P65GBlLSrTMc+K0yd0/DqVtq+oYdnXzNus3mcTNcND8yF4OJO/aGrDoZok4JbobCrOcJZsDlqiDm5vCzIGkNLbmchIDliiRp7WeZa1+tjmpFDfNjCz8tmzNR5uMXGWXWxp+O7zCUnJBtLpMtuKY5D0Rcmg17aK9TIvutisXVlWmtYqMlIr2cpZ4nFLJq6LPng4XRatdykJKSsLPxOVhT9hV0V7kMtEN8f/2lrSE5hEL10WrqfE/nkRp+F503+JIO1kSrabBCw6rFsq2kd5dR+csuOtzDVW+iZ7hiuCk0D9R9UccnkdfjjMvo3tyNmuR8ie5ZYYdi5CnZ78R66b+4FDRiJ3gnRwhGqIRiIZoiIYCiIZoBKIhGqIRiIZoBKIhGqIRiM5Q/gowAMsRJLrK/gy+AAAAAElFTkSuQmCC",
          ),
          Large: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAOOSURBVHja7JxfhFRRHMfPNAzLsAzDEvu0REQZNjHEUC89xRI9TeplX3uKEkv0usxTbCKWlrVPPSR6SL1sdm12FWvZlNKIsllapUy/0/yuPffOnZlz555zu+fe75eP/Wt29nPPnPs7/6bQ6XQEYj9HoACiIRqBaIiGaASiIRqBaIiGaASiIRqBaIjOeeR8tIqSElEjJmDJgNcBomfl7yvsEgvERWIcKs2ILhI7AdEqP4lF4hyUxhNdHyA5yA63/jHojS66FUG0x1dijqhAs77ojRFEe+wT88RRiB4susR9cCcm8jHuEccgOlz0lAHJQR4RDYj2i65ZEK2WiLfz0K3oiK5bFK3ylJjJ6oAo6LUQ3KlUKBRO0IfNhJ/XB+KVwjbRdl20z2uIaPmy/piS5yuFfyde89dviQP+/JNyMQ74Z06JFlyilR1uUN4F+UVs8ffafHG2+RX0Lg2i1/immPVssfCXxBPlohgX3W/AMp/QDTFtyNHtCtGMO6WgOzK8kFPRKl94SqFqU7S8mj8g2zfCLdsQLfMQkn1sRmndUUTXIbeHFzwXZFR03Fm8rDJnQ/QMxIb22cdNiy6iVfftQoomRaOv7s+sadGCyxvI7R3cVEyLrvADQ7Cfu6ZFy1yF2NAb45Rp0RjE9F+mMy5aDkPfQG4PddOiBdeQ+5DrYyNY7pkQLXMJcgeXe6ZEy1yH3J5yb8KGaMHlDSQf8sCWaJlFCPaVe9Uw0SZ2/F8hlgUieAq1qTeCGS1FftmgVfOeGBtdh5oWRP9j3LZomTsQLRo2+uhgbhHXePNKXtOzidPW8bf7xHnh+P65GBlLSrTMc+K0yd0/DqVtq+oYdnXzNus3mcTNcND8yF4OJO/aGrDoZok4JbobCrOcJZsDlqiDm5vCzIGkNLbmchIDliiRp7WeZa1+tjmpFDfNjCz8tmzNR5uMXGWXWxp+O7zCUnJBtLpMtuKY5D0Rcmg17aK9TIvutisXVlWmtYqMlIr2cpZ4nFLJq6LPng4XRatdykJKSsLPxOVhT9hV0V7kMtEN8f/2lrSE5hEL10WrqfE/nkRp+F503+JIO1kSrabBCw6rFsq2kd5dR+csuOtzDVW+iZ7hiuCk0D9R9UccnkdfjjMvo3tyNmuR8ie5ZYYdi5CnZ78R66b+4FDRiJ3gnRwhGqIRiIZoiIYCiIZoBKIhGqIRiIZoBKIhGqIRiM5Q/gowAMsRJLrK/gy+AAAAAElFTkSuQmCC",
          ),
        };

        TheShodo.Shodo.Resources.KasureBrushes = {
          Small: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,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",
          ),
          Medium: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,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",
          ),
          Large: TheShodo.Shodo.Resources.createImage(
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABaCAYAAAA4qEECAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAD8hJREFUeNrsXGtsZVUV3uec++jTdqadmXZgeAmKqCCgxmiMBp+J0WgMGvUHEVRAY/QPKshTjRjjDxMDgwghMT5+GSI+Eo1EFB+IICovHR7CMFNmaDvTebS3vefec1yr/Zb9ZnE6007bcRjOSVbu7Xndfb699re+tfY+jfI8D+W2+ltcQlACXQJdbiXQJdAl0OVWAl0CXW4l0CXQJdDlVgJdAl1uJdBH6VbhP6Io8p2gx9uwclvkVlR6rixwbiK2TuxlYnvFHhWbKSFcIY+23hDP7pWv54t9Qmy32DfEmmLvFPud2H1y3qicF89dUs4eLBlobF1i54qdIjYuVhPbBpD/JbZfQO6QzxPFpuX7hO4TvEuKWSLQShe3ir1FbEjs/WJXgKvHwN967MM4/06xewXw5/RaAbxVQrs4oOvqoWJPAPRxUMcz6sHw5PPEXin2pNh6sXfhmr8J4I8I2CWnLwLoC+C9VykHg0J0mxLrBa2cC89+WOw3CJ4fAI9fLmBvE7CbJcQL6GgB6PMA7HR48QTAbIhV4c1vFXupWI9YHzxabYPYJnRgS+7VJVYtYS726Ich7/4Mb3652B/FUnjzq8SOQwfo8dfCm7sgB0fQQTkkYS5gJ7h2H85T+mm9mNSKB1ozlgfByT2ggTvE9gB8DXIdkHsT8OIvwrtjgHwdPjn7UdXyErqn6vIHAPiLYovYqcTzNAi+Cdys+vk2sV8DXKWI58gzc4A5BEqJ4MnP4lgLHWne/iXc73MAWFXMDo0F0obM0Vfs9x1rHp3DMxXUv8K7TxPbKDYKKpjE8QSA7YPH18lDe8DpCvKlYr/E/p1il6FjKvgt5fIIHaX3VIA7ZdcUjvfr6HmhS0YfDDOAtg1Dex8AfgzfZ0AX6uEniZ2A4HcKOqMGENWDOzEqNov9Q+wasa0wBe1KsWFHW2YNdLr+1mf1U3lerOY+Yw22yFBfUEBbQnK/ZYAAKwaIpwGwDoCvgHxL7Bdit4idjftMgGIy0M200QSNHAa4jg6qwWx/FUqmSnSUO2sh4OpWgUXoBO2MuuugOHLVsyNWaTLDpl70drE1AHgN1MSbxe4SewSAV7D/MTyw8vOfxN6I47fC6+sAay2+W6dtQmeo9w9gBHTiWIJz9fqTsS/CtQl+O6EREOOzQvsq6KAeSNIe/FZMNGXXaqA+ARjEdh5js1wrGnJT4Ob9aKxSwsegNF4Nz0zRSPWmp2EBUu96PJhZAB3th0dH8PSd6Bzj/RRmXLwORa02QInRoRn2WRnXOsc6YSMF5zbiySfxOUNBPHOjqq2jASCfjvuuXsKCYb4LD1wHj/ZCTfxc7AsAuxvnXgxARvCAG3EfBe0iANbEQ+fkcQG/kQGANj18htiwGdTTJm8N9GnUkRKnX4rfNJrR+9xEur+K2HIivgc4wRhGnl63RdsEGqqthryzMqmB0QH5NohTGuDsMTz4SeRht8MbHsfDpujIHeiQhEA0j8pp+MYUJzICtJv2tej6Cu2z9tZAQ2Po3ECe30Ox4Cocu5rk6Ea0ezPanBEGOWRoc0WBtu8Ax4Zhih/vwt/6eTwaoR5/CTxnGxpvwz/C3xElPQaYAZxRgIwIoDZ+vwrgWnSOXZe5TszdPao4rjHiUwjadnwHzjc+H4B3T+IzEKfP3kfw2b/SQCfozQQP2SRP60fDM6iOQSQg99ND1+AlfeD8Fvb1kSZPiHcHEB/0mnfjnjciS42cl8cUI3K0M3XnGJhV6oRB3C+loFqjkgF3Vuo4PAZvd+ikx0pV76yBZwFUDVxPIai10TBL0yehIMbJM6YBQgN8bxw9AE7fTF6u+09FbVuvf4/YmeDU2bKr1rpxT/a+pvPcOkCbcYBnNBJ2AeA2ATtN98rc86+DU6QkTbuxb8WAzuF9HwdgD6C4tIVUQjdKpA3y+gbduwMg7KbAtBkcGqjxmgz9W+xC1LhrCGzXAui78T0jFcI0Yd6cUucx/eT0exGKYpapZgUjJqKs9rti24nrMxntPUulkIMBnQLUCIWgN4i9RuxnYvcAtFHUQp7BsI9cJ12OBn8G5xjYmVM+U6CdFJ5+HsDohn6/kyggcl5bITA9zwfabx2wjoLhNeBp5mLbzCn2YbQEjMhZGapga7sXXZPxCYv7WwPeh5CUpNDL3xP7IOjCUu5+eOAgJRM9KFB9H0mHJSqdLt02RWCq4BWQhXcA0KehzxOnmc3Del0SU6ekxyc1FRw/mZIpO68DndCDDu6gUdmLfSfgbz3n9bpvsQlL5RD90ABdqH7+KLzyNnDnWfDCPfTwVcq+6giCV0AL56Q2fNrfIK/aAi97EgpmGNfWnRavUm07oqAWEUUkJA1zCrxbiTJ4BE+SLG1RTX0G+0w2psiQm8tWHbSvihqGyrebMTGQkSfFALJFD2eSqkG8aZldQhE9cpGdE5o2Jh3ei+Gr9/oJPq0+YkAEeFpG8pG1eeT0ua/B+78TCqC5o1qWmMrVe1cEaOyvYahZ4lFDIOkFd98L7wtEB4F6vEIg110ykTpNnLvEZhAqZDuUzwypgkHi/E5K4dvEuRl1QtOBF+NY0wXFuCCocjYb8HsqRYcFs7sPJwUv4vGm2BaAtBaAT2Eo3YMGDRGgOTXSGtwGEPvxYOb5Q0QrnGRYzVpl3m8pTkSUDFm6HZMnc4XQqGYaHRQ5zk7CgUve6nR/25eg6FRzz1Sf98PZqmC0bKDtbghMCu5eKgI1sW+SHoI9JHIcGdHD9yBbG3TDuOU8q0YPbe0eh/QapyGd09D3UjUUpPxcJwlO4rFEbbqkJkLsML4/81BFqEUDjYnUlLK6CkXxFOBn5KkZPTQrjhrVl5+DhNqFqF4nEHLnwV7rtqlOERfUuK3c2edkbOYyQC412Aiwurjp9mlHR0aZddhHVIUdbAJiSTMT+dw2hYDUQi/vooftcnxWpyDURgc1nUc9S8WbjM7NC+rNEbU5c4HTTwYYJ09S+zhA5gUzO/ybAzh3huRfnRKk++Aour0OGW3/igDtvJuVggExSelq5O7fJiBTpwAyKItmQTIT0XU1qo8E8vqUhnpC1zFPx6T5K3T/mNRLRNVK4/+cgu16Go3/gZNlOE9LCGcstI7lsOfaAPYQ1MggZWgxeWgfJRN1+kyKpqPcTImNkOA8PSH6qbqMMLiEJXfeGpPkDARicAE2gNJG6d416oTjUbvuJArV2abzF/LqSljGJlhvlx4cJZ6rUfCoOzCt5NlBCQpzqiUfGTmABasqvs8UqAamqbxg9HBwmybQcxcsEwTWmxHc25QoDQPUpyh5qUGBbUL7elEu6CsqOi0LaAKDszHjxE58b7kacYv2BeqkhCjFpN5MKH7bICmQkKxW8gIOLgqYRTXsKcyTNnBsLaqLj6E41gTNWSJ3LfR0QvOSYcWB1qIKateBasSB+DovWNLgy5B5wbnMz20HRijwxpar1IUFpr58Jpq7GZuU5jKtPDBFIAfqgEvwDMEVvFaOox3YbSxC76dgxJo3celwTny4AcOTJ05rbpqqTlzYSYlRuyDoBVdcsmMtV/GrUNKRU5sy4mFre1cB1aiDXIc84D6eKMAk78oDTYCPUuSvUOHHKnvcYCtDjhM3cw2ZaxPduLab5vBy+q3gPD5zNYlQkDxlLrkxpaEz4F9GMWwdaORCmparEk3twfqXywhsC5pLr3UseX5srjZSgZdWSVq1aEhGrqYQFXhNVKB9czfkqzTsO3D/1NVOkoJ5ydxJwRhgT+Azx8y+qZHdVkgK86tiz0ZJ4VFUM69C7X1EcNy3ah7NtRF4qTV+PQ2tYZrwTcLzVy95gNnD2+SNOUk2mwPsJ9mX0PUJqaKNtCDHlwnGMWp2ILU2jb4Tbeuh803SToP+AjpmJhSskl21NWuYedDs6tOYaRmgOcP1bgI1LwhMieNTnyHyEoOchng3KYbglI7Rw4CrQ+ek3XeFA1c6mYyrAkSLH1qt/DsC5bdx3+8g060eEepwQWEDGr2DAs4oeWEgz6wDqBma4F1DgbLlPNoyNttvZdMWJRmDSJVTUjpjroI4iFrNALWpBdDbqN7th0a2yWWbzNC14TeIfQ21em3rOYLjXSutow/m1S3UkYO9k0hrPrw8s8DZcms4WpRopE53d+A6q0PvdJ48AAm2GcPaFnG2CHT91JVWP8W5J4JeRgDqViqIjeFeE/jb2jmCNui+AQ/yqnv0AqXWhHiXZyy6YeMuyYkJvJw0uNFIJxWsKsSPmZscaDlvtZVJtwCkPTj3VOzT7QLU27toZidDO4dAH/r3Gah1/EA7RjAcP2IcfZD6CE+S1ok2bN0FZ41MPZFTH02qBhqNcDnTruGOY8k4inT7WRplu1AsehzcexHAt8kKWwOyF+m4TbHp+T8Mc68Adhz2VNYqe3fbRf6IkhQLnjcBjIy4l2nE6uC2wHIH1UFSAtrW8TWpI1IqgllSM4zftzJuf5hfKpbTrPhEmF92vMdiUdHbCf83oB3gfpTZuukJBMNxN+vSCY9jxaIgfwX7roZ3DlAg5CJUy8UpUx1r6fxeGnGn4FqbSToHUm877qdvqv1BsPvnitajV4FO6q5eUAXI0/AoS6f7APwaRyMRqOCrsLGCWgSvqePKnunzNXR+JzrJptyeAKgmHsaQpGzF96fC/EKccFRRxwLeHbtskTshpSQncfOSNTeZkJO0G6daB0u+MdLQ5u0bwLtWyp2kQH02aOwGSmb+N8GrJeMVmTM8Qt6dgd/aJPsSAsT4teHS9mY4cAGkUc8UvJMTiPVu9pynw8wrh8L8SqXjAfLXxd4n9s0wt9LpOAB/SJCPOo8u8PCEvDWmOnRMHpy7glLiZl4SCog14t4xKq1ynSVGMNyDzrgZks9e2ZhERqhvFusKrr8IZod8MbUSjuINpdcG5uFqAKgBMDYB6BHy+IhoJqPJA66F2/vtbSctOT50k4qwd3EyBFjN/n4c5hZ3bg+L/M88RzXQBLit4DSlsRG14BQVsxHy+Bp5Ohd7UpKCTJt+CUQfOjGmOkoTycntAFl1876lvN37ggDaFaqUUtSzbsTwt0WW5vG2REDXWV8PgC+GbOtBshGoZj5M2WY3TVXtBhfrb+nizh+J/WohnXxMAU1bA4X22f+QIMD3wzO7oDI0mF0Jffsgpd27w4Gv4HEFcYYyP3uP/W1hbtnx78PcKq3Jw31H/agOhocZQBVsXdDyDmhhrVs8RJrZskAr4g+CaxuUFFWgKizdXvb/izoWgbbMsTPMLyGoIoEZA8Wcg9MfomrhbFao8QDZ6mxVcKX+p8jzgD5Gt4gqhbaGJEBnZ+74soE95D8YPIb/IQy/zpaH+XcIi46vylb+b9IjtJVAl0CXQJdbCXQJdAl0CUEJdAl0uZVAl0CXQJdbCXQJdLmVQJdAv8i3/wowAB67shmMoEzNAAAAAElFTkSuQmCC",
          ),
        };
      })();
    </script>

    <script>
      // --- 4. PREVIOUS CODE: StrokeManager & StrokeEngine ---

      TheShodo.Shodo.StrokeManager = function (
        eventCaptureTarget,
        strokeEngine,
      ) {
        this.eventCaptureTarget = eventCaptureTarget;
        this.strokeEngine = strokeEngine;
        this.handElementSelector = "#hand-image";
        this.strokeHistory = [];
        this.isHandVisible = false;
        this.isInStroke = false;
        this.strokeBeginTime = null;
        this.isLocked = false;
      };

      TheShodo.Shodo.StrokeManager.StrokeOperation = {
        Stroke: 0,
        SetOpacity: 1,
        SetBrush: 2,
        SetColor: 3,
      };

      TheShodo.Shodo.StrokeManager.prototype.lock = function () {
        this.isLocked = true;
      };
      TheShodo.Shodo.StrokeManager.prototype.unlock = function () {
        this.isLocked = false;
      };

      TheShodo.Shodo.StrokeManager.prototype.selectBrush = function (
        brushName,
      ) {
        if (this.isLocked) return;
        this.endStroke();
        this.strokeHistory.push({
          O: TheShodo.Shodo.StrokeManager.StrokeOperation.SetBrush,
          D: brushName,
        });
        return this.strokeEngine.selectBrush(brushName);
      };

      TheShodo.Shodo.StrokeManager.prototype.getCurrentBrush = function () {
        return this.strokeEngine.getCurrentBrush().name;
      };

      TheShodo.Shodo.StrokeManager.prototype.setBrushOpacity = function (
        value,
      ) {
        if (this.isLocked) return;
        this.endStroke();
        this.strokeHistory.push({
          O: TheShodo.Shodo.StrokeManager.StrokeOperation.SetOpacity,
          D: value,
        });
        return this.strokeEngine.setBrushOpacity(value);
      };

      TheShodo.Shodo.StrokeManager.prototype.getBrushOpacity = function () {
        return this.strokeEngine.getBrushOpacity();
      };

      TheShodo.Shodo.StrokeManager.prototype.setBrushColor = function (value) {
        if (this.isLocked) return;
        this.endStroke();
        this.strokeHistory.push({
          O: TheShodo.Shodo.StrokeManager.StrokeOperation.SetColor,
          D: value,
        });
        return this.strokeEngine.setBrushColor(value);
      };

      TheShodo.Shodo.StrokeManager.prototype.getBrushColor = function () {
        return this.strokeEngine.getBrushColor();
      };

      TheShodo.Shodo.StrokeManager.prototype.toDataURL = function (type) {
        return this.strokeEngine.toDataURL(type);
      };

      TheShodo.Shodo.StrokeManager.prototype.clearHistory = function () {
        if (this.isLocked) return;
        this.endStroke();
        this.strokeHistory = [];
        this.strokeEngine.clear();
        this.setBrushOpacity(this.getBrushOpacity());
        this.setBrushColor(this.getBrushColor());
        this.selectBrush(this.getCurrentBrush());
        return this;
      };

      TheShodo.Shodo.StrokeManager.prototype.beginStroke = function () {
        if (this.isLocked) return;
        this.endStroke();
        this.isInStroke = true;
        this.strokeBeginTime = new Date().valueOf();
        this.currentStroke = [];
        this.strokeEngine.beginStroke();
        return this;
      };

      TheShodo.Shodo.StrokeManager.prototype.addStrokePosition = function (
        x,
        y,
        pressure,
      ) {
        if (this.isLocked) return;
        var pos = {
          x: x,
          y: y,
          t: new Date().valueOf() - this.strokeBeginTime,
          p: pressure,
        };
        this.currentStroke.push(pos);
        this.strokeEngine.addStrokePosition(pos);
        this.strokeEngine.draw();
        return this;
      };

      TheShodo.Shodo.StrokeManager.prototype.endStroke = function () {
        if (this.isLocked) return;
        if (!this.isInStroke) return;
        this.strokeHistory.push({
          O: TheShodo.Shodo.StrokeManager.StrokeOperation.Stroke,
          D: this.currentStroke.map(function (e) {
            return { X: e.x, Y: e.y, T: e.t, P: e.p };
          }),
        });
        this.isInStroke = false;
        this.currentStroke = null;
        this.strokeEngine.endStroke();
        return this;
      };

      TheShodo.Shodo.StrokeManager.prototype.start = function () {
        var handCanvasObject = $(this.eventCaptureTarget);
        $(document).on("mousemove", "body .content", function (e) {
          handCanvasObject.trigger("mouseup", e);
        });

        var self = this;
        var isMouseDown = false;
        var handE = $(this.handElementSelector);
        var offset = handCanvasObject.offset();

        $(window).on("resize scroll", function () {
          offset = handCanvasObject.offset();
        });

        // Standard Mouse/Touch events
        function onStart(e) {
          e.preventDefault();
          isMouseDown = true;
          var pageX = e.pageX;
          var pageY = e.pageY;
          if (e.touches && e.touches.length > 0) {
            pageX = e.touches[0].pageX;
            pageY = e.touches[0].pageY;
          }
          var x = pageX - offset.left;
          var y = pageY - offset.top;
          handE.css("top", y).css("left", x);
          if (self.isHandVisible) handE.fadeIn("fast");
          self.beginStroke();
        }
        function onDraw(e) {
          e.preventDefault();
          e.stopPropagation();
          if (!isMouseDown) return;
          var pageX = e.pageX;
          var pageY = e.pageY;
          if (e.touches && e.touches.length > 0) {
            pageX = e.touches[0].pageX;
            pageY = e.touches[0].pageY;
          } else if (e.changedTouches) {
            pageX = e.changedTouches[0].pageX;
            pageY = e.changedTouches[0].pageY;
          }
          var x = pageX - offset.left;
          var y = pageY - offset.top;
          self.addStrokePosition(x, y);
          handE.css("top", y).css("left", x);
        }
        function onEnd(e) {
          e.preventDefault();
          if (!isMouseDown) return;
          isMouseDown = false;
          self.endStroke();
          if (self.isHandVisible) handE.fadeOut("fast");
        }

        function isSupportTouch() {
          const isTouchCapable =
            "ontouchstart" in window || navigator.maxTouchPoints > 0;
          return isTouchCapable;
        }

        handCanvasObject
          .on("mousedown", onStart)
          .on("mousemove", onDraw)
          .on("mouseup", onEnd)
          .on("mouseleave", onEnd);
        console.log("support touch?");

        if (isSupportTouch()) {
          console.log("support touch");
          handCanvasObject[0].addEventListener("touchstart", onStart, {
            passive: false,
          });
          handCanvasObject[0].addEventListener("touchmove", onDraw, {
            passive: false,
          });
          handCanvasObject[0].addEventListener("touchend", onEnd, {
            passive: false,
          });
        }
      };

      // --- Stroke Engine ---
      TheShodo.Shodo.StrokeEngine = function (
        width,
        height,
        canvas,
        compositedCanvas,
      ) {
        this.velocityPressureCoff = 5;
        this.canvas = $(canvas);
        this.width = width;
        this.height = height;
        this.canvasContext = this.canvas.get(0).getContext("2d");
        this.backgroundImage = null;
        this.brushOpacity = 1;
        this.brushColor = 0x000000;

        // Initial Brush Selection
        this.selectBrush("Medium");

        this.bufferingSize = 4;
        this.strokeBuffer = [];
        this.splineBuffer = [];
        this.previousPosition = null;
        this.previousBrushSize = null;
        this.previousVelocity = 0;
        this.previousDistance = 0;
        this.expectedNextPosition = null;
        this.accelerate = 0;

        this.compositedCanvas = compositedCanvas;
        this.compositedCanvasContext = this.compositedCanvas.getContext("2d");
        this.onImageCreated = function (canvas) {};
        this.clear();
      };

      TheShodo.Shodo.StrokeEngine.prototype.toDataURL = function (type) {
        this.compositeCanvas();
        return this.getImage().toDataURL(type || "image/png");
      };

      TheShodo.Shodo.StrokeEngine.prototype.clear = function () {
        this.canvasContext.clearRect(0, 0, this.width, this.height);
        this.compositedCanvasContext.save();
        this.compositedCanvasContext.clearRect(0, 0, this.width, this.height);
        this.compositedCanvasContext.restore();
      };

      TheShodo.Shodo.StrokeEngine.prototype.createColoredBrushImage = function (
        originalBrushImage,
        brushColor,
        width,
        height,
      ) {
        if (brushColor === 0x000000) return originalBrushImage;
        var tmpCanvas = document.createElement("canvas");
        tmpCanvas.width = width;
        tmpCanvas.height = height;
        var ctx = tmpCanvas.getContext("2d");
        ctx.drawImage(originalBrushImage, 0, 0);
        var imageData = ctx.getImageData(
          0,
          0,
          tmpCanvas.width,
          tmpCanvas.height,
        );
        for (var i = 0, n = imageData.data.length / 4; i < n; i++) {
          imageData.data[i * 4] = (brushColor & 0xff0000) >> 16;
          imageData.data[i * 4 + 1] = (brushColor & 0x00ff00) >> 8;
          imageData.data[i * 4 + 2] = brushColor & 0x0000ff;
        }
        ctx.putImageData(imageData, 0, 0);
        var img = document.createElement("img");
        img.src = tmpCanvas.toDataURL();
        return img;
      };

      TheShodo.Shodo.StrokeEngine.prototype.refreshBrush = function () {
        var newBrush = TheShodo.Shodo.Brushes.getBrush(this.brushName);
        newBrush.image = this.createColoredBrushImage(
          newBrush.image,
          this.brushColor,
          newBrush.width,
          newBrush.height,
        );
        newBrush.kasureImage = this.createColoredBrushImage(
          newBrush.kasureImage,
          this.brushColor,
          newBrush.width,
          newBrush.height,
        );
        this.currentBrush = newBrush;
      };

      TheShodo.Shodo.StrokeEngine.prototype.getImage = function (
        withoutBackground,
      ) {
        if (withoutBackground) return this.compositedCanvas;
        var tmpCanvas = document.createElement("canvas");
        tmpCanvas.width = this.width;
        tmpCanvas.height = this.height;
        var ctx = tmpCanvas.getContext("2d");
        if (this.backgroundImage) {
          ctx.drawImage(
            this.backgroundImage,
            0,
            0,
            this.backgroundImage.width,
            this.backgroundImage.height,
          );
        } else {
          ctx.fillStyle = "rgba(255,255,255,1)";
          ctx.fillRect(0, 0, tmpCanvas.width, tmpCanvas.height);
        }
        ctx.drawImage(
          this.compositedCanvas,
          0,
          0,
          tmpCanvas.width,
          tmpCanvas.height,
        );
        if (this.onImageCreated) {
          this.onImageCreated(tmpCanvas);
        }
        return tmpCanvas;
      };

      TheShodo.Shodo.StrokeEngine.prototype.compositeCanvas = function () {
        var tmpCanvas = document.createElement("canvas");
        tmpCanvas.width = this.width;
        tmpCanvas.height = this.height;
        var tmpCtx = tmpCanvas.getContext("2d");
        tmpCtx.globalAlpha = this.brushOpacity;
        tmpCtx.drawImage(this.canvas.get(0), 0, 0);
        this.compositedCanvasContext.drawImage(tmpCanvas, 0, 0);
        this.canvasContext.clearRect(0, 0, this.width, this.height);
      };

      TheShodo.Shodo.StrokeEngine.prototype.setBrushOpacity = function (
        brushOpacity,
      ) {
        this.brushOpacity = brushOpacity;
        this.canvas.css("opacity", this.brushOpacity);
      };
      TheShodo.Shodo.StrokeEngine.prototype.getBrushOpacity = function () {
        return this.brushOpacity;
      };
      TheShodo.Shodo.StrokeEngine.prototype.setBrushColor = function (
        brushColor,
      ) {
        this.brushColor = brushColor;
        this.refreshBrush();
      };
      TheShodo.Shodo.StrokeEngine.prototype.getBrushColor = function () {
        return this.brushColor;
      };
      TheShodo.Shodo.StrokeEngine.prototype.selectBrush = function (brushName) {
        this.brushName = brushName;
        this.refreshBrush();
      };
      TheShodo.Shodo.StrokeEngine.prototype.getCurrentBrush = function () {
        return this.currentBrush;
      };
      TheShodo.Shodo.StrokeEngine.prototype.beginStroke = function () {
        this.strokeBuffer = [];
        this.splineBuffer = [];
        this.previousPosition = null;
        this.previousBrushSize = null;
        this.previousVelocity = 0;
        this.previousDistance = 0;
        this.expectedNextPosition = null;
        this.accelerate = 0;
      };
      TheShodo.Shodo.StrokeEngine.prototype.addStrokePosition = function (pos) {
        this.strokeBuffer.push(pos);
      };

      TheShodo.Shodo.StrokeEngine.prototype.endStroke = function () {
        if (this.accelerate > 1) {
          var pos = {
            x: this.expectedNextPosition.x,
            y: this.expectedNextPosition.y,
            t:
              this.accelerate /
                (this.previousDistance * this.previousVelocity) +
              this.previousPosition.t,
            p:
              this.previousPosition.p *
              Math.min(
                this.accelerate /
                  (this.previousDistance * this.previousVelocity),
                1,
              ),
          };
          for (var i = 0, n = this.bufferingSize; i < n; i++) {
            this.strokeBuffer.push(pos);
          }
          this.draw(true);
        }
        this.compositeCanvas();
      };

      TheShodo.Shodo.StrokeEngine.prototype.getInterlatePos = function (
        p0,
        p1,
        moveLen,
      ) {
        var x = p0.x + (p1.x - p0.x) * moveLen;
        var y = p0.y + (p1.y - p0.y) * moveLen;
        return { x: x, y: y };
      };
      TheShodo.Shodo.StrokeEngine.prototype.getDistance = function (p0, p1) {
        var distance =
          (p1.x - p0.x) * (p1.x - p0.x) + (p1.y - p0.y) * (p1.y - p0.y);
        return distance == 0 ? distance : Math.sqrt(distance);
      };
      TheShodo.Shodo.StrokeEngine.prototype.getBufferedCurrentPosition =
        function () {
          var pos = { x: 0, y: 0, t: 0, p: 0 };
          var bufferingSize = Math.min(
            this.bufferingSize,
            this.strokeBuffer.length,
          );
          if (bufferingSize == 0) return null;
          for (var i = 1; i < bufferingSize + 1; i++) {
            var p = this.strokeBuffer[this.strokeBuffer.length - i];
            pos.x += p.x;
            pos.y += p.y;
            pos.t += p.t;
            pos.p += p.p;
          }
          pos.x /= bufferingSize;
          pos.y /= bufferingSize;
          pos.t /= bufferingSize;
          pos.p /= bufferingSize;
          return pos;
        };

      TheShodo.Shodo.StrokeEngine.prototype.draw = function (isEnding) {
        var pos = this.getBufferedCurrentPosition();
        if (pos == null) return;
        if (this.previousPosition == null) this.previousPosition = pos;

        var t = pos.t - this.previousPosition.t;
        var distance = this.getDistance(pos, this.previousPosition);
        var velocity = distance / Math.max(1, t);
        var accelerate =
          this.previousVelocity == 0 ? 0 : velocity / this.previousVelocity;

        var curve = function (t, b, c, d) {
          return (c * t) / d + b;
        };
        var brushSize = Math.max(
          this.currentBrush.minSize,
          curve(
            velocity,
            this.currentBrush.maxSize,
            -this.currentBrush.maxSize - this.currentBrush.minSize,
            this.velocityPressureCoff,
          ),
        );
        if (pos.p > 0) {
          brushSize = Math.max(
            this.currentBrush.minSize,
            this.currentBrush.maxSize * pos.p,
          );
        }
        pos.s = brushSize;

        var ctx = this.canvasContext;
        ctx.save();
        this.drawStroke(
          ctx,
          this.previousPosition,
          pos,
          brushSize,
          distance,
          velocity,
        );
        this.drawStrokeSpline(
          ctx,
          this.previousPosition,
          pos,
          brushSize,
          distance,
          velocity,
        );

        ctx.restore();

        this.accelerate = accelerate;
        this.expectedNextPosition = this.getInterlatePos(
          this.previousPosition,
          pos,
          1 + this.accelerate,
        );
        this.previousPosition = pos;
        this.previousBrushSize = brushSize;
        this.previousVelocity = velocity;
        this.previousDistance = distance;
      };

      TheShodo.Shodo.StrokeEngine.prototype.drawStroke = function (
        ctx,
        startPos,
        endPos,
        brushSize,
        distance,
      ) {
        var t = 0;
        var brushDelta = brushSize - this.previousBrushSize;
        while (t < 1) {
          var brushSizeCur = Math.min(
            this.previousBrushSize + brushDelta * t,
            this.currentBrush.maxSize,
          );
          var pos = this.getInterlatePos(startPos, endPos, t);
          if (Math.random() > 0.1) {
            var jitter =
              (Math.random() > 0.5 ? 1 : -1) *
              parseInt(Math.random() * 1.2, 10);
            var px = pos.x - brushSizeCur / 2 + jitter;
            var py = pos.y - brushSizeCur / 2 + jitter;
            try {
              ctx.drawImage(
                this.currentBrush.kasureImage,
                px,
                py,
                brushSizeCur,
                brushSizeCur,
              );
            } catch (e) {}
          }
          t += 1 / Math.max(distance, 1);
        }
      };

      TheShodo.Shodo.StrokeEngine.prototype.drawStrokeSpline = function (
        ctx,
        startPos,
        endPos,
        brushSize,
        distance,
        velocity,
      ) {
        /// <summary>Draw stroke line (Spline).</summary>
        this.splineBuffer.push(endPos);

        // Draw Stroke part (Spline)
        if (this.splineBuffer.length > 3) {
          var segCount = 40; // spline
          var buffLen = this.splineBuffer.length;
          var points = Array.apply(null, this.splineBuffer);
          points = points.slice(points.length - 4);

          points.unshift(points[0]);
          points.push(points[points.length - 1]);
          //console.log(points.map(function(e){ return e.x+"," +e.y;}).join('; '));

          for (var j = 0, m = points.length - 3; j < m; j++) {
            var p0 = points[j];
            var p1 = points[j + 1];
            var p2 = points[j + 2];
            var p3 = points[j + 3];
            var v0 = {
              x: (p2.x - p0.x) / 2,
              y: (p2.y - p0.y) / 2,
              s: p2.s - p0.s,
            };
            var v1 = {
              x: (p3.x - p1.x) / 2,
              y: (p3.y - p1.y) / 2,
              s: p3.s - p1.s,
            };

            var tmp1 = 2 * p1.x - 2 * p2.x + v0.x + v1.x;
            var tmp2 = -3 * p1.x + 3 * p2.x - 2 * v0.x - v1.x;
            var tmp3 = 2 * p1.y - 2 * p2.y + v0.y + v1.y;
            var tmp4 = -3 * p1.y + 3 * p2.y - 2 * v0.y - v1.y;

            for (var i = 1, n = segCount + 1; i <= n; i++) {
              var seg = i / segCount;

              // Method Inlining --
              // function spline() {
              //     return ((2*x0 - 2*x1 + v0 + v1) * Math.pow(t, 3)) + ((-3*x0 + 3*x1 - 2*v0 - v1) * Math.pow(t, 2)) + v0*t + x0;
              // }
              // var tX = this.spline(p1.x, p2.x, v0.x, v1.x, seg);
              // var tY = this.spline(p1.y, p2.y, v0.y, v1.y, seg);
              var tX =
                tmp1 * Math.pow(seg, 3) +
                tmp2 * Math.pow(seg, 2) +
                v0.x * seg +
                p1.x;
              var tY =
                tmp3 * Math.pow(seg, 3) +
                tmp4 * Math.pow(seg, 2) +
                v0.y * seg +
                p1.y;

              //var tS = this.spline(p1.s, p2.s, v0.s, v1.s, seg);
              var tS =
                this.previousBrushSize +
                ((brushSize - this.previousBrushSize) / segCount) * i;

              if (this.previousBrushSize == brushSize && Math.random() < 0.3)
                continue;

              ctx.drawImage(
                this.currentBrush.image,
                tX - tS / 2,
                tY - tS / 2,
                tS,
                tS,
              );

              //            if (Math.random() > 0.6) {
              //                ctx.drawImage(this.currentBrush.image,
              //                      tX + (Math.random() * 0) - (brushSize/2),
              //                      tY + (Math.random() * 0) - (brushSize/2),
              //                      brushSize,
              //                      brushSize);
              //            }
            }
          }
        }
      };

      TheShodo.Shodo.Shared = { StrokeEngine: null, StrokeManager: null };
    </script>

    <script>
      // --- 5. INITIALIZATION ---

      $(document).ready(function () {
        var canvas = $("#write-canvas");
        var canvasE = canvas.get(0);
        var layeredCanvas = $("#layered-canvas");
        var layeredCanvasE = layeredCanvas.get(0);
        var handCanvas = $("#hand-canvas");

        TheShodo.Shodo.Shared.StrokeEngine = new TheShodo.Shodo.StrokeEngine(
          canvasE.width,
          canvasE.height,
          canvas,
          layeredCanvasE,
        );

        TheShodo.Shodo.Shared.StrokeManager = new TheShodo.Shodo.StrokeManager(
          handCanvas,
          TheShodo.Shodo.Shared.StrokeEngine,
        );

        TheShodo.Shodo.Shared.StrokeManager.isHandVisible = true;
        TheShodo.Shodo.Shared.StrokeManager.start();
      });

      function clearCanvas() {
        TheShodo.Shodo.Shared.StrokeManager.clearHistory();
      }

      function setBrush(name) {
        TheShodo.Shodo.Shared.StrokeManager.selectBrush(name);
      }
    </script>
  </body>
</html>
