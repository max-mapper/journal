(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var wd=Object.defineProperty,Cd=(i,t,e)=>t in i?wd(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Ci=(i,t,e)=>(Cd(i,typeof t!="symbol"?t+"":t,e),e),tc=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)},ln=(i,t,e)=>(tc(i,t,"read from private field"),e?e.call(i):t.get(i)),Zs=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},Me=(i,t,e,n)=>(tc(i,t,"write to private field"),t.set(i,e),e),ml=(i,t,e,n)=>({set _(r){Me(i,t,r)},get _(){return ln(i,t,n)}});function bd(){return Math.min(Math.max(navigator?.hardwareConcurrency||4,4),8)}let Id=class{constructor(i){Ci(this,"value"),Ci(this,"next"),this.value=i}};var me,Fn,Un;let Pd=class{constructor(){Zs(this,me,void 0),Zs(this,Fn,void 0),Zs(this,Un,void 0),this.clear()}enqueue(i){const t=new Id(i);ln(this,me)?(ln(this,Fn).next=t,Me(this,Fn,t)):(Me(this,me,t),Me(this,Fn,t)),ml(this,Un)._++}dequeue(){const i=ln(this,me);if(i)return Me(this,me,ln(this,me).next),ml(this,Un)._--,i.value}clear(){Me(this,me,void 0),Me(this,Fn,void 0),Me(this,Un,0)}get size(){return ln(this,Un)}*[Symbol.iterator](){let i=ln(this,me);for(;i;)yield i.value,i=i.next}};me=new WeakMap,Fn=new WeakMap,Un=new WeakMap;const Sd={bind(i,t,e){return i.bind(e)}};function Ld(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new Pd;let e=0;const n=()=>{e--,t.size>0&&t.dequeue()()},r=async(a,l,h)=>{e++;const c=(async()=>a(...h))();l(c);try{await c}catch{}n()},s=(a,l,h)=>{t.enqueue(Sd.bind(r.bind(void 0,a,l,h))),(async()=>(await Promise.resolve(),e<i&&t.size>0&&t.dequeue()()))()},o=(a,...l)=>new Promise(h=>{s(a,h,l)});return Object.defineProperties(o,{activeCount:{get:()=>e},pendingCount:{get:()=>t.size},clearQueue:{value(){t.clear()}}}),o}let Ad=class{constructor(i){Ci(this,"_api"),Ci(this,"_threadPoolSize"),Ci(this,"_limit"),this._api=i,this._threadPoolSize=bd(),this._limit=Ld(this._threadPoolSize)}runLimited(i){return this._limit(i)}renderImage(i,t,e,n,r=window?.devicePixelRatio||1){return this.runLimited(()=>new Promise(s=>{this._api.renderImage(i,t,e,n,r,o=>{const a=new Uint8ClampedArray(o),l=new ImageData(a,e,n);s(l)})}))}renderXYZTile(i,t,e,n=256,r=window?.devicePixelRatio||1,s=0){return this.runLimited(()=>new Promise(o=>{this._api.renderXYZTile(i,t,e,n,r,s,a=>{const l=new Uint8ClampedArray(a),h=new ImageData(l,n,n);o(h)})}))}mapLayers(){const i=this._api.mapLayers(),t=new Array(i.size());for(let e=0;e<i.size();e++)t[e]=i.get(e);return t}mapThemes(){const i=this._api.mapThemes(),t=new Array(i.size());for(let e=0;e<i.size();e++)t[e]=i.get(e);return t}};function Md(i){const t=new Ad(i);return new Proxy({},{has(e,n){return n in t||n in i},get(e,n){if(n in t)return t[n];if(n in i)return i[n]}})}function Od(i){return new Promise(async(t,e)=>{try{const n=(await new Function(`return import("${i}")`)()).default;t({createQtAppInstance:n})}catch(n){e(n)}})}async function Dd(i={}){return new Promise(async(t,e)=>{let n;if(i.prefix)n=i.prefix;else{const l=import.meta.url;/.*\/src\/loader\.[ts|js]\?*[^/]*$/.test(l)?(console.warn(['qgis-js loader is running in development mode and no "prefix" seems to be configured.'," - Consider adding the QgisRuntimePlugin when bundling with Vite."," - For more information see: https://github.com/qgis/qgis-js/blob/main/docs/bundling.md"].join(`
`)),typeof window<"u"&&(n=new URL("assets/wasm",window.location.href).pathname)):n=new URL("assets/wasm",import.meta.url).href}n?n=n.replace(/\/$/,""):n="assets/wasm";let r;try{const l=`${n}/qgis-js.js`;r=await Od(l)}catch(l){e(new Error("Unable to load the qgis-js.js script",{cause:l}));return}const{createQtAppInstance:s}=r;let o;typeof document<"u"&&(o=document?.querySelector("#screen"));const a=s({locateFile:l=>`${n}/`+l,preRun:[function(l){l.qtContainerElements=o?[o]:[],l.qtFontDpi=96}],postRun:[async function(){const l=await a;t({api:Md(l),module:l,fs:l.FS})}],...i.onStatus?{setStatus:i.onStatus}:{}})})}const Nd="0.0.3";var Fd=Object.defineProperty,Ud=(i,t,e)=>t in i?Fd(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Zt=(i,t,e)=>(Ud(i,typeof t!="symbol"?t+"":t,e),e);const fn="/upload/projects";let ra=class{constructor(i,t){Zt(this,"FS"),Zt(this,"type"),Zt(this,"name"),this.FS=i,this.type=t}isValid(){return this.getFiles().length>0&&this.getProjectFile()!==void 0}getProjectFile(){const i=this.getFiles().filter(t=>t.endsWith(".qgs")||t.endsWith(".qgz"));return i.length==1?i[0]:i.length>1?(console.warn("Found multiple project file candiates"),i[0]):void 0}getDirectoriesToCreate(){const i=new Set;for(const t of this.getDirectories()){let e=t.split("/");for(let n=0;n<e.length;n++){const r=e.slice(0,n+1).join("/");i.add(r)}}return Array.from(i).sort()}ensureDirectories(){for(const i of this.getDirectoriesToCreate()){const t=fn+"/"+i,e=this.FS.analyzePath(t,!1);(!e||!e.exists)&&this.FS.mkdir(t)}}isProjectUploaded(){return this.FS.readdir(fn).includes(this.name)}};const sa=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();sa?Promise.resolve().then(function(){return zd}):Promise.resolve().then(function(){return Wd});const Gd=sa?Promise.resolve().then(function(){return Bd}):Promise.resolve().then(function(){return Yd});async function jd(...i){return(await Gd).default(...i)}sa?Promise.resolve().then(function(){return Zd}):Promise.resolve().then(function(){return Qd});const kd=async i=>{const t=await i.getFile();return t.handle=i,t};var Xd=async(i=[{}])=>{Array.isArray(i)||(i=[i]);const t=[];i.forEach((r,s)=>{t[s]={description:r.description||"Files",accept:{}},r.mimeTypes?r.mimeTypes.map(o=>{t[s].accept[o]=r.extensions||[]}):t[s].accept["*/*"]=r.extensions||[]});const e=await window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:t,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await Promise.all(e.map(kd));return i[0].multiple?n:n[0]},zd={__proto__:null,default:Xd};function Ir(i){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var n=e.done;return Promise.resolve(e.value).then(function(r){return{value:r,done:n}})}return Ir=function(e){this.s=e,this.n=e.next},Ir.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return n===void 0?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return n===void 0?Promise.reject(e):t(n.apply(this.s,arguments))}},new Ir(i)}const ec=async(i,t,e=i.name,n)=>{const r=[],s=[];var o,a=!1,l=!1;try{for(var h,c=function(u){var d,g,f,_=2;for(typeof Symbol<"u"&&(g=Symbol.asyncIterator,f=Symbol.iterator);_--;){if(g&&(d=u[g])!=null)return d.call(u);if(f&&(d=u[f])!=null)return new Ir(d.call(u));g="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());a=!(h=await c.next()).done;a=!1){const u=h.value,d=`${e}/${u.name}`;u.kind==="file"?s.push(u.getFile().then(g=>(g.directoryHandle=i,g.handle=u,Object.defineProperty(g,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):u.kind!=="directory"||!t||n&&n(u)||r.push(ec(u,t,d,n))}}catch(u){l=!0,o=u}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]};var $d=async(i={})=>{i.recursive=i.recursive||!1,i.mode=i.mode||"read";const t=await window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return(await(await t.values()).next()).done?[t]:ec(t,i.recursive,void 0,i.skipDirectory)},Bd={__proto__:null,default:$d},Kd=async(i,t=[{}],e=null,n=!1,r=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const s=[];let o=null;if(i instanceof Blob&&i.type?o=i.type:i.headers&&i.headers.get("content-type")&&(o=i.headers.get("content-type")),t.forEach((h,c)=>{s[c]={description:h.description||"Files",accept:{}},h.mimeTypes?(c===0&&o&&h.mimeTypes.push(o),h.mimeTypes.map(u=>{s[c].accept[u]=h.extensions||[]})):o?s[c].accept[o]=h.extensions||[]:s[c].accept["*/*"]=h.extensions||[]}),e)try{await e.getFile()}catch(h){if(e=null,n)throw h}const a=e||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!e&&r&&r(a);const l=await a.createWritable();return"stream"in i?(await i.stream().pipeTo(l),a):"body"in i?(await i.body.pipeTo(l),a):(await l.write(await i),await l.close(),a)},Zd={__proto__:null,default:Kd},Vd=async(i=[{}])=>(Array.isArray(i)||(i=[i]),new Promise((t,e)=>{const n=document.createElement("input");n.type="file";const r=[...i.map(l=>l.mimeTypes||[]),...i.map(l=>l.extensions||[])].join();n.multiple=i[0].multiple||!1,n.accept=r||"",n.style.display="none",document.body.append(n);const s=l=>{typeof o=="function"&&o(),t(l)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(e),n),a=()=>{window.removeEventListener("focus",a),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",a)}),n.addEventListener("change",()=>{window.removeEventListener("focus",a),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),Wd={__proto__:null,default:Vd},Hd=async(i=[{}])=>(Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((t,e)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=o=>{typeof s=="function"&&s(),t(o)},s=i[0].legacySetup&&i[0].legacySetup(r,()=>s(e),n);n.addEventListener("change",()=>{let o=Array.from(n.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!i[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),r(o)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),Yd={__proto__:null,default:Hd},qd=async(i,t={})=>{Array.isArray(t)&&(t=t[0]);const e=document.createElement("a");let n=i;"body"in i&&(n=await async function(o,a){const l=o.getReader(),h=new ReadableStream({start:d=>async function g(){return l.read().then(({done:f,value:_})=>{if(!f)return d.enqueue(_),g();d.close()})}()}),c=new Response(h),u=await c.blob();return l.releaseLock(),new Blob([u],{type:a})}(i.body,i.headers.get("content-type"))),e.download=t.fileName||"Untitled",e.href=URL.createObjectURL(await n);const r=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(r,()=>s(),e);return e.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(e.href),3e4),r()}),e.click(),null},Qd={__proto__:null,default:qd};class Jd extends ra{constructor(t,e){super(t,"Local"),Zt(this,"entries"),this.entries=e;const n=e.map(r=>r.webkitRelativePath).filter(r=>r&&r.length>0&&r.includes("/")).map(r=>r.split("/",1)[0]);if(n.length<1)throw new Error("Could not determine project name");this.name=n[0]}getDirectories(){const t=new Set;t.add(this.name);for(const e of this.entries){const n=e.webkitRelativePath;t.add(n.substring(0,n.lastIndexOf("/")))}return Array.from(t)}getFiles(){return this.entries.map(t=>t.webkitRelativePath)}async uploadProject(){this.ensureDirectories();for(const t of this.entries)this.FS.writeFile(fn+"/"+t.webkitRelativePath,new Uint8Array(await t.arrayBuffer()))}}function oa(i,t){return i.reduce((e,n)=>n.type==="Folder"?e.concat([t+"/"+n.name,...oa(n.entries,t+"/"+n.name)]):e,[])}function aa(i,t){return i.reduce((e,n)=>n.type==="Folder"?e.concat(aa(n.entries,t+"/"+n.name)):e.concat(t+"/"+n.name),[])}class tg extends ra{constructor(t,e,n){super(t,"Remote"),Zt(this,"folder"),Zt(this,"path"),Zt(this,"baseUrl"),this.baseUrl=new URL(e),this.folder=n;const r=this.baseUrl.pathname.split("/").pop();this.name=n.name,this.path=n.path.replace(new RegExp(`^${r}/`),"")}getDirectories(){return[this.path,...oa(this.folder.entries,this.path)]}getFiles(){return aa(this.folder.entries,this.path)}async uploadProject(){const t=Object.fromEntries(this.getFiles().map(e=>[e,new Promise((n,r)=>{const s=new URL(`${this.baseUrl.href}/${e}`);fetch(s).then(o=>o.arrayBuffer().then(a=>{n(a)}))})]));await Promise.all([Object.values(t)]),this.ensureDirectories();for(const e of this.getFiles()){const n=new Uint8Array(await t[e]);this.FS.writeFile(fn+"/"+e,n)}}}const nc="main";async function eg(i,t,e="/",n=nc){const r=`https://api.github.com/repos/${i}/${t}/contents${e}?ref=${n}`;return await(await fetch(r)).json()}async function ng(i,t,e){const n=`https://api.github.com/repos/${i}/${t}/git/trees/${e}?recursive=1`;return(await(await fetch(n)).json()).tree.filter(r=>r.type==="blob").map(r=>r.path)}function ig(i,t,e){const n={name:i,path:t,type:"Folder",entries:[]};return e.sort().forEach(r=>{const s=r.split("/");let o=n;for(let a=0;a<s.length-1;a++){const l=s[a],h=o.entries.find(c=>c.name===l);if(h)o=h;else{const c={name:l,path:o.path+"/"+l,type:"Folder",entries:[]};o.entries.push(c),o=c}}o.entries.push({name:s[s.length-1],path:r,type:"File"})}),n}class rg extends ra{constructor(t,e,n,r,s=nc){super(t,"Github"),Zt(this,"folder"),Zt(this,"path"),Zt(this,"owner"),Zt(this,"repo"),Zt(this,"branch"),this.folder=e,this.name=e.name,this.path=e.path,this.owner=n,this.repo=r,this.branch=s}getDirectories(){return[this.path,...oa(this.folder.entries,this.path)]}getFiles(){return aa(this.folder.entries,this.path)}async uploadProject(){const t=Object.fromEntries(this.getFiles().map(e=>[e,new Promise(async(n,r)=>{const s=`https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${e}`,o=await fetch(s);n(o.arrayBuffer())})]));await Promise.all([Object.values(t)]),this.ensureDirectories();for(const e of this.getFiles()){const n=new Uint8Array(await t[e]);this.FS.writeFile(fn+"/"+e,n)}}}function sg(i,t){let e=fn.split("/");for(let s=1;s<e.length;s++)i.mkdir(e.slice(0,s+1).join("/"));const n=async s=>{if(s){if(s instanceof Promise&&(s=await s),!s.isValid())throw new Error(`Project "${s.name}" is not valid`);s.isProjectUploaded()||await s.uploadProject(),r(s)}else return},r=s=>{const o=fn+"/"+s.getProjectFile();t(o)};return{openProject:n,loadLocalProject:()=>new Promise(async(s,o)=>{try{const a=await jd({recursive:!0,mode:"read"}),l=new Jd(i,a);s(l)}catch(a){o(a)}}),loadRemoteProjects:(s="./projects/directory-listing.json")=>new Promise(async(o,a)=>{try{const l=new URL(s,window.location.href).href.split("/").slice(0,-1).join("/"),h=await(await fetch(s)).json();if(!h.type||h.type!=="Folder"){a(new Error("Remote projects response seems not a folder"));return}o(h.entries.filter(c=>c.type==="Folder").map(c=>new tg(i,l,c)))}catch(l){a(l)}}),loadGithubProjects:(s,o,a="/",l="main")=>new Promise(async(h,c)=>{try{const u=await eg(s,o,a,l);if(u instanceof Array)h(Object.fromEntries(u.filter(d=>d.type==="dir").map(d=>[d.name,()=>new Promise(async g=>{const f=await ng(s,o,d.sha);g(new rg(i,ig(d.name,d.path,f),s,o,l))})])));else{console.warn(u),h({});return}}catch(u){c(u)}})}}const pl=1.5,ar=.1;function og(i,t){let e=null;new ResizeObserver(s=>{const o=s.find(a=>a.target===i);o&&(i.width=o.devicePixelContentBoxSize[0].inlineSize,i.height=o.devicePixelContentBoxSize[0].blockSize),n()}).observe(i,{box:"device-pixel-content-box"});async function n(){var s=window.devicePixelRatio||1,o=i.getBoundingClientRect();const a=o.width*s,l=o.height*s;if(a&&l){const h=await t.renderImage(t.srid(),e,a,l,window.devicePixelRatio),c=i.getContext("2d");i.width=a,i.height=l,c.scale(s,s),c.putImageData(h,0,0)}}document.getElementById("zoomin").onclick=function(){e.scale(1/pl),n()},document.getElementById("zoomout").onclick=function(){e.scale(pl),n()},document.getElementById("panleft").onclick=function(){e.move((e.xMaximum-e.xMinimum)*ar,0),n()},document.getElementById("panright").onclick=function(){e.move(-(e.xMaximum-e.xMinimum)*ar,0),n()},document.getElementById("panup").onclick=function(){e.move(0,-(e.yMaximum-e.yMinimum)*ar),n()},document.getElementById("pandown").onclick=function(){e.move(0,(e.yMaximum-e.yMinimum)*ar),n()};function r(){e=t.fullExtent(),n()}return r(),{update:()=>{r()},render:()=>{n()}}}const ag="modulepreload",lg=function(i){return"/"+i},El={},hg=function(i,t,e){let n=Promise.resolve();return t&&t.length>0&&(document.getElementsByTagName("link"),n=Promise.all(t.map(r=>{if(r=lg(r),r in El)return;El[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":ag,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,h)=>{a.addEventListener("load",l),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})}))),n.then(()=>i()).catch(r=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r})},D={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class _s{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}class we{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function la(i,t){return i>t?1:i<t?-1:0}function cg(i,t){return i<t?1:i>t?-1:0}function ms(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===t)return r;if(s<t)return e(t,i[r-1],s)>0?r-1:r}return n-1}if(e>0){for(let r=1;r<n;++r)if(i[r]<t)return r-1;return n-1}if(e<0){for(let r=1;r<n;++r)if(i[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==t)return r;if(i[r]<t)return i[r-1]-t<t-i[r]?r-1:r}return n-1}function ug(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function ps(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function dg(i,t,e){const n=t||la;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||o===0)})}function Fr(){return!0}function Es(){return!1}function Ur(){}function gg(i){let t=!1,e,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==r||!ps(s,n))&&(t=!0,r=this,n=s,e=i.apply(this,arguments)),e}}function fg(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Xi(i){for(const t in i)delete i[t]}function _g(i){let t;for(t in i)return!1;return!t}class zi extends _s{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new we(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,Ur);delete o[n]}return l}disposeInternal(){this.listeners_&&Xi(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Ur,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}const P={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ht(){throw new Error("Unimplemented abstract method.")}let mg=0;function wt(i){return i.ol_uid||(i.ol_uid=String(++mg))}function ic(i){return Math.pow(i,3)}function ri(i){return 1-ic(1-i)}function pg(i){return 3*i*i-2*i*i*i}function Eg(i){return i}class ha extends zi{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(D.CHANGE)}release(){this.state===P.ERROR&&this.setState(P.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==P.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==P.LOADED){t.interimTile=null;break}t.getState()==P.LOADING?e=t:t.getState()==P.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==P.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ht()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const r=e-n+1e3/60;return r>=this.transition_?1:ic(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const Ye=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",yg=Ye.includes("firefox"),Tg=Ye.includes("safari")&&!Ye.includes("chrom"),vg=Tg&&(Ye.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ye)),Rg=Ye.includes("webkit")&&!Ye.includes("edge"),rc=Ye.includes("macintosh"),sc=typeof devicePixelRatio<"u"?devicePixelRatio:1,oc=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,xg=typeof Image<"u"&&Image.prototype.decode,ac=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();function fe(i,t,e,n){let r;return e&&e.length?r=e.shift():oc?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}function Si(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Gr(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function Io(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function wg(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function Cg(i,t){const e=i.childNodes;for(let n=0;;++n){const r=e[n],s=t[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}const rt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function K(i,t,e,n,r){if(n&&n!==i&&(e=e.bind(n)),r){const o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function jr(i,t,e,n){return K(i,t,e,n,!0)}function ot(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Xi(i))}class bg extends zi{constructor(t,e,n,r){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof r=="function"?rt.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(D.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==rt.IDLE&&this.loader){this.state=rt.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;fg(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=rt.LOADED}).catch(n=>{this.state=rt.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Ig(i,t,e){const n=i;let r=!0,s=!1,o=!1;const a=[jr(n,D.LOAD,function(){o=!0,s||t()})];return n.src&&xg?(s=!0,n.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(jr(n,D.ERROR,e)),function(){r=!1,a.forEach(ot)}}const lc=bg;class ys extends ha{constructor(t,e,n,r,s,o){super(t,e,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=P.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=P.ERROR,this.unlistenImage_(),this.image_=Pg(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=P.LOADED:this.state=P.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==P.ERROR&&(this.state=P.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==P.IDLE&&(this.state=P.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ig(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Pg(){const i=fe(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const ca=.5,Rt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Po(i){const t=si();for(let e=0,n=i.length;e<n;++e)Pr(t,i[e]);return t}function Sg(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function hc(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function Li(i,t){return cc(i,t[0],t[1])}function kr(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function cc(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function yl(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1];let l=Rt.UNKNOWN;return o<e?l=l|Rt.LEFT:o>r&&(l=l|Rt.RIGHT),a<n?l=l|Rt.BELOW:a>s&&(l=l|Rt.ABOVE),l===Rt.UNKNOWN&&(l=Rt.INTERSECTING),l}function si(){return[1/0,1/0,-1/0,-1/0]}function $i(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function Ts(i){return $i(1/0,1/0,-1/0,-1/0,i)}function Lg(i,t){const e=i[0],n=i[1];return $i(e,n,e,n,t)}function Ag(i,t,e,n,r){const s=Ts(r);return uc(s,i,t,e,n)}function So(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function Mg(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function Pr(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function uc(i,t,e,n,r){for(;e<n;e+=r)Og(i,t[e],t[e+1]);return i}function Og(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function dc(i,t){let e;return e=t(vs(i)),e||(e=t(Rs(i)),e)||(e=t(xs(i)),e)||(e=t(oi(i)),e)?e:!1}function Ai(i){let t=0;return Tn(i)||(t=ut(i)*Ot(i)),t}function vs(i){return[i[0],i[1]]}function Rs(i){return[i[2],i[1]]}function _n(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Dg(i,t){let e;if(t==="bottom-left")e=vs(i);else if(t==="bottom-right")e=Rs(i);else if(t==="top-left")e=oi(i);else if(t==="top-right")e=xs(i);else throw new Error("Invalid corner");return e}function Xr(i,t,e,n,r){const[s,o,a,l,h,c,u,d]=Ng(i,t,e,n);return $i(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function Ng(i,t,e,n){const r=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,c=s*o,u=s*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function Ot(i){return i[3]-i[1]}function Wt(i,t,e){const n=e||si();return Bi(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):Ts(n),n}function oi(i){return[i[0],i[3]]}function xs(i){return[i[2],i[3]]}function ut(i){return i[2]-i[0]}function Bi(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Tn(i){return i[2]<i[0]||i[3]<i[1]}function Fg(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function Ug(i,t,e){let n=!1;const r=yl(i,t),s=yl(i,e);if(r===Rt.INTERSECTING||s===Rt.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],d=e[0],g=e[1],f=(g-u)/(d-c);let _,m;s&Rt.ABOVE&&!(r&Rt.ABOVE)&&(_=d-(g-h)/f,n=_>=o&&_<=l),!n&&s&Rt.RIGHT&&!(r&Rt.RIGHT)&&(m=g-(d-l)*f,n=m>=a&&m<=h),!n&&s&Rt.BELOW&&!(r&Rt.BELOW)&&(_=d-(g-a)/f,n=_>=o&&_<=l),!n&&s&Rt.LEFT&&!(r&Rt.LEFT)&&(m=g-(d-o)*f,n=m>=a&&m<=h)}return n}const ti={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class zr{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ti[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Ki=6378137,Zn=Math.PI*Ki,Gg=[-Zn,-Zn,Zn,Zn],jg=[-180,-85,180,85],lr=Ki*Math.log(Math.tan(Math.PI/2));class wn extends zr{constructor(t){super({code:t,units:"m",extent:Gg,global:!0,worldExtent:jg,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Ki)}})}}const Tl=[new wn("EPSG:3857"),new wn("EPSG:102100"),new wn("EPSG:102113"),new wn("EPSG:900913"),new wn("http://www.opengis.net/def/crs/EPSG/0/3857"),new wn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function kg(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e){t[r]=Zn*i[r]/180;let s=Ki*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>lr?s=lr:s<-lr&&(s=-lr),t[r+1]=s}return t}function Xg(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e)t[r]=180*i[r]/Zn,t[r+1]=360*Math.atan(Math.exp(i[r+1]/Ki))/Math.PI-90;return t}const zg=6378137,vl=[-180,-90,180,90],$g=Math.PI*zg/180;class en extends zr{constructor(t,e){super({code:t,units:"degrees",extent:vl,axisOrientation:e,global:!0,metersPerUnit:$g,worldExtent:vl})}}const Rl=[new en("CRS:84"),new en("EPSG:4326","neu"),new en("urn:ogc:def:crs:OGC:1.3:CRS84"),new en("urn:ogc:def:crs:OGC:2:84"),new en("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new en("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new en("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Lo={};function Bg(i){return Lo[i]||Lo[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Kg(i,t){Lo[i]=t}let Wn={};function $r(i,t,e){const n=i.getCode(),r=t.getCode();n in Wn||(Wn[n]={}),Wn[n][r]=e}function Zg(i,t){let e;return i in Wn&&t in Wn[i]&&(e=Wn[i][t]),e}function pt(i,t,e){return Math.min(Math.max(i,t),e)}function Vg(i,t,e,n,r,s){const o=r-e,a=s-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=r,n=s):l>0&&(e+=o*l,n+=a*l)}return Hn(i,t,e,n)}function Hn(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function Wg(i){const t=i.length;for(let n=0;n<t;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<t;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<t+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let r=n-1;r>=0;r--)i[r][t]-=i[r][n]*e[n]}return e}function Sr(i){return i*Math.PI/180}function Yn(i,t){const e=i%t;return e*t<0?e+t:e}function Hg(i,t,e){return i+e*(t-i)}function gc(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function hr(i,t){return Math.floor(gc(i,t))}function Be(i,t){return Math.ceil(gc(i,t))}function Yg(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function Br(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function ua(i,t){const e=Math.cos(t),n=Math.sin(t),r=i[0]*e-i[1]*n,s=i[1]*e+i[0]*n;return i[0]=r,i[1]=s,i}function qg(i,t){return i[0]*=t,i[1]*=t,i}function Qg(i,t){if(t.canWrapX()){const e=ut(t.getExtent()),n=Jg(i,t,e);n&&(i[0]-=n*e)}return i}function Jg(i,t,e){const n=t.getExtent();let r=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||ut(n),r=Math.floor((i[0]-n[0])/e)),r}const tf=63710088e-1;function xl(i,t,e){e=e||tf;const n=Sr(i[1]),r=Sr(t[1]),s=(r-n)/2,o=Sr(t[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function fc(...i){console.warn(...i)}let Ao=!0;function ef(i){Ao=!1}function da(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function _c(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function nf(i){Kg(i.getCode(),i),$r(i,i,da)}function rf(i){i.forEach(nf)}function ae(i){return typeof i=="string"?Bg(i):i||null}function Kr(i,t,e,n){i=ae(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(t,e),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/ti[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=t;else{const a=fa(i,ae("EPSG:4326"));if(a===_c&&o!=="degrees")r=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=xl(h.slice(0,2),h.slice(2,4)),u=xl(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?ti[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function wl(i){rf(i),i.forEach(function(t){i.forEach(function(e){t!==e&&$r(t,e,da)})})}function sf(i,t,e,n){i.forEach(function(r){t.forEach(function(s){$r(r,s,e),$r(s,r,n)})})}function ga(i,t){return i?typeof i=="string"?ae(i):i:ae(t)}function ke(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||fa(i,t)===da)&&e}function fa(i,t){const e=i.getCode(),n=t.getCode();let r=Zg(e,n);return r||(r=_c),r}function Zr(i,t){const e=ae(i),n=ae(t);return fa(e,n)}function of(i,t,e){return Zr(t,e)(i,void 0,i.length)}function Mo(i,t){return i}function pe(i,t){return Ao&&!Br(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Ao=!1,fc("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function af(i,t){return i}function Ke(i,t){return i}function lf(){wl(Tl),wl(Rl),sf(Rl,Tl,kg,Xg)}lf();const hf=10,Cl=.25;class _a{constructor(t,e,n,r,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=Zr(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const v=p[0]+"/"+p[1];return a[v]||(a[v]=l(p)),a[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ut(r)>=ut(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ut(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ut(this.targetProj_.getExtent()):null;const h=oi(n),c=xs(n),u=Rs(n),d=vs(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),E=hf+(o?Math.max(0,Math.ceil(Math.log2(Ai(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,m,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(v,y,R){p=Math.min(p,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-p>this.sourceWorldWidth_/2){const y=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];y[0][0]-p>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-p>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-p>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const R=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-R<this.sourceWorldWidth_/2&&(v.source=y)}})}a={}}addTriangle_(t,e,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,n]})}addQuad_(t,e,n,r,s,o,a,l,h){const c=Po([s,o,a,l]),u=this.sourceWorldWidth_?ut(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=Po([t,e,n,r]);f=ut(m)/this.targetWorldWidth_>Cl||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Cl||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Bi(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(m);let p;g?p=(Yn(s[0],d)+Yn(a[0],d))/2-Yn(E[0],d):p=(s[0]+a[0])/2-E[0];const v=(s[1]+a[1])/2-E[1];f=p*p+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(m),p=[(r[0]+t[0])/2,(r[1]+t[1])/2],v=this.transformInv_(p);this.addQuad_(t,e,m,p,s,o,E,v,h-1),this.addQuad_(p,m,n,r,v,E,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(m),p=[(n[0]+r[0])/2,(n[1]+r[1])/2],v=this.transformInv_(p);this.addQuad_(t,m,p,r,s,E,v,l,h-1),this.addQuad_(m,e,n,p,E,o,a,v,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,r,s,a,l),_&14||this.addTriangle_(t,n,e,s,a,o),_&&(_&13||this.addTriangle_(e,r,t,o,l,s),_&7||this.addTriangle_(e,r,n,o,l,a))}calculateSourceExtent(){const t=si();return this.triangles_.forEach(function(e,n,r){const s=e.source;Pr(t,s[0]),Pr(t,s[1]),Pr(t,s[2])}),t}getTriangles(){return this.triangles_}}let Vs;const Re=[];function bl(i,t,e,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,r)),i.restore()}function Ws(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function cf(){if(Vs===void 0){const i=fe(6,6,Re);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",bl(i,4,5,4,0),bl(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Vs=Ws(t,0)||Ws(t,4)||Ws(t,8),Si(i),Re.push(i.canvas)}return Vs}function Oo(i,t,e,n){const r=of(e,t,i);let s=Kr(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||Li(l,r)){const h=Kr(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function mc(i,t,e,n){const r=_n(e);let s=Oo(i,t,r,n);return(!isFinite(s)||s<=0)&&dc(e,function(o){return s=Oo(i,t,o,n),isFinite(s)&&s>0}),s}function ma(i,t,e,n,r,s,o,a,l,h,c,u,d){const g=fe(Math.round(e*i),Math.round(e*t),Re);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function f(p){return Math.round(p*e)/e}g.globalCompositeOperation="lighter";const _=si();l.forEach(function(p,v,y){Mg(_,p.extent)});let m;if(!d||l.length!==1||h!==0){const p=ut(_),v=Ot(_);m=fe(Math.round(e*p/n),Math.round(e*v/n),Re),u||(m.imageSmoothingEnabled=!1);const y=e/n;l.forEach(function(R,x,T){const w=R.extent[0]-_[0],C=-(R.extent[3]-_[3]),L=ut(R.extent),O=Ot(R.extent);R.image.width>0&&R.image.height>0&&m.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,w*y,C*y,L*y,O*y)})}const E=oi(o);return a.getTriangles().forEach(function(p,v,y){const R=p.source,x=p.target;let T=R[0][0],w=R[0][1],C=R[1][0],L=R[1][1],O=R[2][0],lt=R[2][1];const tt=f((x[0][0]-E[0])/s),z=f(-(x[0][1]-E[1])/s),V=f((x[1][0]-E[0])/s),it=f(-(x[1][1]-E[1])/s),Xt=f((x[2][0]-E[0])/s),Qe=f(-(x[2][1]-E[1])/s),Je=T,tn=w;T=0,w=0,C-=Je,L-=tn,O-=Je,lt-=tn;const Ks=[[C,L,0,0,V-tt],[O,lt,0,0,Xt-tt],[0,0,C,L,it-z],[0,0,O,lt,Qe-z]],Yt=Wg(Ks);if(!Yt)return;if(g.save(),g.beginPath(),cf()||!u){g.moveTo(V,it);const yt=4,Qt=tt-V,mi=z-it;for(let Lt=0;Lt<yt;Lt++)g.lineTo(V+f((Lt+1)*Qt/yt),it+f(Lt*mi/(yt-1))),Lt!=yt-1&&g.lineTo(V+f((Lt+1)*Qt/yt),it+f((Lt+1)*mi/(yt-1)));g.lineTo(Xt,Qe)}else g.moveTo(V,it),g.lineTo(tt,z),g.lineTo(Xt,Qe);g.clip(),g.transform(Yt[0],Yt[2],Yt[1],Yt[3],tt,z),g.translate(_[0]-Je,_[3]-tn);let qt;if(m)qt=m.canvas,g.scale(n/e,-n/e);else{const yt=l[0],Qt=yt.extent;qt=yt.image,g.scale(ut(Qt)/qt.width,-Ot(Qt)/qt.height)}g.drawImage(qt,0,0),g.restore()}),m&&(Si(m),Re.push(m.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(p,v,y){const R=p.target,x=(R[0][0]-E[0])/s,T=-(R[0][1]-E[1])/s,w=(R[1][0]-E[0])/s,C=-(R[1][1]-E[1])/s,L=(R[2][0]-E[0])/s,O=-(R[2][1]-E[1])/s;g.beginPath(),g.moveTo(w,C),g.lineTo(x,T),g.lineTo(L,O),g.closePath(),g.stroke()}),g.restore()),g.canvas}class ws extends ha{constructor(t,e,n,r,s,o,a,l,h,c,u,d){super(s,P.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=f?Wt(g,f):g;if(Ai(m)===0){this.state=P.EMPTY;return}const E=t.getExtent();E&&(_?_=Wt(_,E):_=E);const p=r.getResolution(this.wrappedTileCoord_[0]),v=mc(t,n,m,p);if(!isFinite(v)||v<=0){this.state=P.EMPTY;return}const y=c!==void 0?c:ca;if(this.triangulation_=new _a(t,n,m,_,v*y,p),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=e.getZForResolution(v);let R=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(R[1]=pt(R[1],_[1],_[3]),R[3]=pt(R[3],_[1],_[3])):R=Wt(R,_)),!Ai(R))this.state=P.EMPTY;else{const x=e.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let T=x.minX;T<=x.maxX;T++)for(let w=x.minY;w<=x.maxY;w++){const C=h(this.sourceZ_,T,w,a);C&&this.sourceTiles_.push(C)}this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==P.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=P.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ma(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=P.LOADED}this.changed()}load(){if(this.state==P.IDLE){this.state=P.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==P.IDLE||n==P.LOADING){t++;const r=K(e,D.CHANGE,function(s){const o=e.getState();(o==P.LOADED||o==P.ERROR||o==P.EMPTY)&&(ot(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,r){e.getState()==P.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(ot),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Si(this.canvas_.getContext("2d")),Re.push(this.canvas_),this.canvas_=null),super.release()}}function et(i,t){if(!i)throw new Error(t)}class pc{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return et(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return et(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){et(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function Vr(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function Cs(i,t,e){return i+"/"+t+"/"+e}function Xe(i){return Cs(i[0],i[1],i[2])}function uf(i){return i.split("/").map(Number)}function df(i){return(i[1]<<i[0])+i[2]}function gf(i,t){const e=i[0],n=i[1],r=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,r):!0}class Ec extends pc{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),e=uf(t)[0];this.forEach(n=>{n.tileCoord[0]!==e&&(this.remove(Xe(n.tileCoord)),n.release())})}}const Hs={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Mi={PROPERTYCHANGE:"propertychange"};class Zi extends zi{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(D.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=K(this,t[s],e);return r}return K(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=jr(this,t[s],e)}else n=jr(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)ff(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}Zi.prototype.on;Zi.prototype.once;Zi.prototype.un;function ff(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)ot(i[t]);else ot(i)}class Il extends we{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Ce extends Zi{constructor(t){super(),this.on,this.once,this.un,wt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Il(n,t,e)),n=Mi.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Il(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],_g(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}class yc extends Ce{constructor(t){super(),this.projection=ae(t.projection),this.attributions_=Pl(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,r){e.viewResolver=n,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Pl(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Pl(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}class pa{constructor(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Cn(i,t,e,n,r){return r!==void 0?(r.minX=i,r.maxX=t,r.minY=e,r.maxY=n,r):new pa(i,t,e,n)}const _f=42,Ea=256;function mf(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function pf(i,t,e,n,r){return!dc(r,function(s){return!cn(i,t,e,n,s[0],s[1])})}function cn(i,t,e,n,r,s){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Tc(i,t,e,n,r,s){if(e.length===0||!cn(i,t,e[0],n,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(cn(i,e[o-1],e[o],n,r,s))return!1;return!0}function vc(i,t,e,n,r){const s=uc(si(),i,t,e,n);return Bi(r,s)?kr(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:mf(i,t,e,n,function(o,a){return Ug(r,o,a)}):!1}function Rc(i,t,e,n,r){return!!(vc(i,t,e,n,r)||cn(i,t,e,n,r[0],r[1])||cn(i,t,e,n,r[0],r[3])||cn(i,t,e,n,r[2],r[1])||cn(i,t,e,n,r[2],r[3]))}function Ef(i,t,e,n,r){if(!Rc(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(pf(i,e[s-1],e[s],n,r)&&!vc(i,e[s-1],e[s],n,r))return!1;return!0}function Sl(i){return i[0]>0&&i[1]>0}function yf(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function ie(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}const bn=[0,0,0],Pe=5;class xc{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,et(dg(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,et(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=oi(n)),et(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,et(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ea,et(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new pa(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,r){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=Cn(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return Cn(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return Cn(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(s*l),c=Math.floor(o*l);if(e<r)return Cn(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return Cn(h,u,c,d,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,bn);const r=bn[1],s=bn[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,bn);const o=bn[1],a=bn[2];return Cn(r,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=ie(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=ie(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*r,a=n[1]-(t[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return $i(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=ie(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/n/h[0],u=a*(l[1]-e)/n/h[1];return r?(c=Be(c,Pe)-1,u=Be(u,Pe)-1):(c=hr(c,Pe),u=hr(u,Pe)),Vr(o,c,u,s)}getTileCoordForXYAndZ_(t,e,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=ie(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return r?(h=Be(h,Pe)-1,c=Be(c,Pe)-1):(h=hr(h,Pe),c=hr(c,Pe)),Vr(n,h,c,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=ms(this.resolutions_,t,e||0);return pt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Rc(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n}}function wc(i){let t=i.getDefaultTileGrid();return t||(t=xf(i),i.setDefaultTileGrid(t)),t}function Tf(i,t,e){const n=t[0],r=i.getTileCoordCenter(t),s=ya(e);if(!Li(s,r)){const o=ut(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return t}function vf(i,t,e,n){n=n!==void 0?n:"top-left";const r=Cc(i,t,e);return new xc({extent:i,origin:Dg(i,n),resolutions:r,tileSize:e})}function Rf(i){const t=i||{},e=t.extent||ae("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Cc(e,t.maxZoom,t.tileSize,t.maxResolution)};return new xc(n)}function Cc(i,t,e,n){t=t!==void 0?t:_f,e=ie(e!==void 0?e:Ea);const r=Ot(i),s=ut(i);n=n>0?n:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function xf(i,t,e,n){const r=ya(i);return vf(r,t,e,n)}function ya(i){i=ae(i);let t=i.getExtent();if(!t){const e=180*ti.degrees/i.getMetersPerUnit();t=$i(-e,-e,e,e)}return t}class wf extends yc{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ie(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Ec(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,r){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=Cs(e,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===P.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,r,s){return ht()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:wc(t)}getTileCacheForProjection(t){const e=this.getProjection();return et(e===null||ke(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=ie(r.getTileSize(t),this.tmpSize);return s==1?o:yf(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Tf(n,t,e)),gf(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,r){}}class Cf extends we{constructor(t,e){super(t),this.tile=e}}function bf(i,t){const e=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function If(i,t){const e=i.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=bf(i[r],t);return Pf(n)}function Pf(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const r=df(t),s=Yn(r,i.length);return i[s](t,e,n)}}function Sf(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=n;s<=r;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=n;r++)t.push(i.replace(e[0],r.toString()));return t}return t.push(i),t}class Ta extends wf{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ta.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=wt(e),r=e.getState();let s;r==P.LOADING?(this.tileLoadingKeys_[n]=!0,s=Hs.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==P.ERROR?Hs.TILELOADERROR:r==P.LOADED?Hs.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Cf(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Sf(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(If(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const r=Cs(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class Lf extends Ta{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Af,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:ys,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!ke(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!ke(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ke(e,t)))return this.tileGrid;const n=wt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=wc(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||ke(e,t))return this.tileCache;const n=wt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Ec(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,r,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?P.IDLE:P.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(D.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,n,r,s){const o=this.getProjection();if(!o||!s||ke(o,s))return this.getTileInternal(t,e,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,n];let h;const c=Xe(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new ws(o,d,s,g,l,f,this.getTilePixelRatio(r),this.getGutter(),(m,E,p,v)=>this.getTileInternal(m,E,p,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(t,e,n,r,s){let o=null;const a=Cs(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,r,s,l),h.getState()==P.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=ae(t);if(n){const r=wt(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Af(i,t){i.getImage().src=t}class bc extends Lf{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Rf({extent:ya(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}function Do(i){return Array.isArray(i)?Math.min(...i):i}class Mf extends lc{constructor(t,e,n,r,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Wt(n,h):n,u=_n(c),d=Oo(t,e,u,r),g=ca,f=new _a(t,e,c,l,d*g,r),_=f.calculateSourceExtent(),m=Tn(_)?null:o(_,d,s),E=m?rt.IDLE:rt.EMPTY,p=m?m.getPixelRatio():1;super(n,r,p,E),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==rt.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==rt.LOADED){const e=ut(this.targetExtent_)/this.targetResolution_,n=Ot(this.targetExtent_)/this.targetResolution_;this.canvas_=ma(e,n,this.sourcePixelRatio_,Do(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==rt.IDLE){this.state=rt.LOADING,this.changed();const t=this.sourceImage_.getState();t==rt.LOADED||t==rt.ERROR?this.reproject_():(this.sourceListenerKey_=K(this.sourceImage_,D.CHANGE,function(e){const n=this.sourceImage_.getState();(n==rt.LOADED||n==rt.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){ot(this.sourceListenerKey_),this.sourceListenerKey_=null}}const cr=4,Ys={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Of extends we{constructor(t,e){super(t),this.image=e}}class Df extends yc{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=ms(e,t,0);t=e[n]}return t}getImage(t,e,n,r){const s=this.getProjection();if(!s||!r||ke(s,r))return s&&(r=s),this.getImageInternal(t,e,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ke(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&So(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Mf(s,r,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,r){if(this.loader){const s=Nf(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&kr(this.wantedExtent_,s)||kr(this.image.getExtent(),s))&&(this.wantedResolution_&&Do(this.wantedResolution_)===o||Do(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new lc(s,o,n,this.loader),this.image.addEventListener(D.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case rt.LOADING:this.loading=!0,n=Ys.IMAGELOADSTART;break;case rt.LOADED:this.loading=!1,n=Ys.IMAGELOADEND;break;case rt.ERROR:this.loading=!1,n=Ys.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Of(n,e))}}function Nf(i,t,e,n){const r=t/e,s=_n(i),o=Be(ut(i)/r,cr),a=Be(Ot(i)/r,cr),l=Be((n-1)*o/2,cr),h=o+2*l,c=Be((n-1)*a/2,cr),u=a+2*c;return Xr(s,r,0,[h,u])}var Ff=Object.defineProperty,Uf=(i,t,e)=>t in i?Ff(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,We=(i,t,e)=>(Uf(i,typeof t!="symbol"?t+"":t,e),e);const No=class Fo extends bc{constructor(t,e={}){super({tileUrlFunction:(n,r)=>`${ie(this.tileGrid.getTileSize(n[0]))[0]*(r||1)}`,tileLoadFunction:async(n,r)=>{const s=this.getrenderFunction();if(this.tileGrid&&s){console.assert(n instanceof ys);const o=n,a=parseInt(r),l=Math.round(a/256),h=fe(a,a),c=await s(this.api,n.getTileCoord(),a,l,this.getextentBufferFactor());h.putImageData(c,0,0),e.debug&&(h.strokeStyle="grey",h.strokeRect(.5,.5,a+.5,a+.5),h.fillStyle="darkgrey",h.strokeStyle="black",h.textAlign="center",h.textBaseline="middle",h.font="20px sans-serif",h.lineWidth=2,h.strokeText(r,a/2,a/2,a),h.fillText(r,a/2,a/2,a)),o.setImage(h.canvas)}},...e}),We(this,"api"),We(this,"renderFunction"),We(this,"extentBufferFactor"),this.api=t,this.renderFunction=e.renderFunction,this.extentBufferFactor=e.extentBufferFactor}getrenderFunction(){return this.renderFunction||Fo.DEFAULT_RENDERFUNCTION}getextentBufferFactor(){return typeof this.extentBufferFactor=="function"?this.extentBufferFactor():this.extentBufferFactor||Fo.DEFAULT_EXTENTBUFFERFACTOR}};We(No,"DEFAULT_RENDERFUNCTION",(i,t,e,n,r)=>i.renderXYZTile(t[1],t[2],t[0],e,n,r)),We(No,"DEFAULT_EXTENTBUFFERFACTOR",0);let Gf=No;const Ic=class Pc extends Df{constructor(t,e={}){super({loader:(n,r,s)=>new Promise(async o=>{var a;const l=s||window?.devicePixelRatio||1,h=r/l,c=Math.round(ut(n)/h),u=Math.round(Ot(n)/h),d=await this.getrenderFunction()(this.api,((a=this.getProjection())==null?void 0:a.getCode())||"EPSG:3857",n[0],n[1],n[2],n[3],c,u,l);o(createImageBitmap(d))}),...e}),We(this,"api"),We(this,"renderFunction"),this.api=t,this.renderFunction=e.renderFunction}getrenderFunction(){return this.renderFunction||Pc.DEFAULT_RENDERFUNCTION}};We(Ic,"DEFAULT_RENDERFUNCTION",(i,t,e,n,r,s,o,a,l)=>i.renderImage(t,new i.Rectangle(e,n,r,s),o,a,l));let Ll=Ic;const Bt={ADD:"add",REMOVE:"remove"},Al={LENGTH:"length"};class ur extends we{constructor(t,e,n){super(t),this.element=e,this.index=n}}class Te extends Ce{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Al.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new ur(Bt.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new ur(Bt.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new ur(Bt.REMOVE,r,t)),this.dispatchEvent(new ur(Bt.ADD,e,t))}updateLength_(){this.set(Al.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}const va=new Array(6);function ce(){return[1,0,0,1,0,0]}function jf(i){return bs(i,1,0,0,1,0,0)}function Ra(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],g=t[5];return i[0]=e*l+r*h,i[1]=n*l+s*h,i[2]=e*c+r*u,i[3]=n*c+s*u,i[4]=e*d+r*g+o,i[5]=n*d+s*g+a,i}function bs(i,t,e,n,r,s,o){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function zt(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function kf(i,t){const e=Math.cos(t),n=Math.sin(t);return Ra(i,bs(va,e,n,-n,e,0,0))}function Ml(i,t,e){return Ra(i,bs(va,t,0,0,e,0,0))}function Xf(i,t,e){return Ra(i,bs(va,1,0,0,1,t,e))}function mn(i,t,e,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+t,i[5]=o*r*l+a*r*h+e,i}function Sc(i,t){const e=zf(t);et(e!==0,"Transformation matrix cannot be inverted");const n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-r/e,i[2]=-s/e,i[3]=n/e,i[4]=(s*l-o*a)/e,i[5]=-(n*l-r*a)/e,i}function zf(i){return i[0]*i[3]-i[1]*i[2]}let Ol;function $f(i){const t="matrix("+i.join(", ")+")";if(oc)return t;const e=Ol||(Ol=document.createElement("div"));return e.style.transform=t,e.style.transform}const Wr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var At={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};At.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};At.max=At.whitepoint[2].D65;At.rgb=function(i,t){t=t||At.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Wr.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,o=e*.21263900587151+n*.71516867876775+r*.072192315360733,a=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||At.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};const Lc={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,o,a,l,h,c,u,d,g,f,_;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=At.whitepoint[e][t][0],d=At.whitepoint[e][t][1],g=At.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,r=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*m,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};At.luv=function(i,t,e){var n,r,s,o,a,l,h,c,u,d,g,f,_,m=.008856451679035631,E=903.2962962962961;t=t||"D65",e=e||2,u=At.whitepoint[e][t][0],d=At.whitepoint[e][t][1],g=At.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/d;return s=p<=m?E*p:116*Math.pow(p,1/3)-16,o=13*s*(n-f),a=13*s*(r-_),[s,o,a]};Lc.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]};At.lchuv=function(i){return Lc.lchuv(At.luv(i))};const Dl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Nl={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Bf(i){var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Dl[i])e=Dl[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=t[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(c,u){if(c[c.length-1]==="%")return c=parseFloat(c)/100,u===3?c:r==="rgb"?c*255:r[0]==="h"||r[0]==="l"&&!u?c*100:r==="lab"?c*125:r==="lch"?u<2?c*150:c*360:r[0]==="o"&&!u?c:r==="oklab"?c*.4:r==="oklch"?u<2?c*.4:c*360:c;if(r[u]==="h"||u===2&&r[r.length-1]==="h"){if(Nl[c]!==void 0)return Nl[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return parseFloat(c)*360;if(c.endsWith("grad"))return parseFloat(c)*360/400;if(c.endsWith("rad"))return parseFloat(c)*180/Math.PI}return c==="none"?0:parseFloat(c)}),n=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=i.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:e,alpha:n}}const qs={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};Wr.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),o=s-r,a,l,h;return s===r?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function Kf(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Bf(i);if(!e.space)return[];const n=e.space[0]==="h"?qs.min:Wr.min,r=e.space[0]==="h"?qs.max:Wr.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=qs.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Zf(i){return typeof i=="string"?i:Hf(i)}const Vf=1024,pi={};let Qs=0;function Ac(i){if(pi.hasOwnProperty(i))return pi[i];if(Qs>=Vf){let e=0;for(const n in pi)e++&3||(delete pi[n],--Qs)}const t=Kf(i);if(t.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+i+'" as color');return Wf(t),pi[i]=t,++Qs,t}function Hr(i){return Array.isArray(i)?i:Ac(i)}function Wf(i){return i[0]=pt(i[0]+.5|0,0,255),i[1]=pt(i[1]+.5|0,0,255),i[2]=pt(i[2]+.5|0,0,255),i[3]=pt(i[3],0,1),i}function Hf(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+t+","+e+","+n+","+r+")"}function Yf(i){try{return Ac(i),!0}catch{return!1}}class qf{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,n){const r=Fl(t,e,n);return r in this.cache_?this.cache_[r]:null}set(t,e,n,r){const s=Fl(t,e,n);this.cache_[s]=r,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Fl(i,t,e){const n=e?Zf(e):"null";return t+":"+i+":"+n}const Mc=new qf,Y={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Oc extends Ce{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Y.OPACITY]=t.opacity!==void 0?t.opacity:1,et(typeof e[Y.OPACITY]=="number","Layer opacity must be a number"),e[Y.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Y.Z_INDEX]=t.zIndex,e[Y.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Y.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Y.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Y.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=pt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ht()}getLayerStatesArray(t){return ht()}getExtent(){return this.get(Y.EXTENT)}getMaxResolution(){return this.get(Y.MAX_RESOLUTION)}getMinResolution(){return this.get(Y.MIN_RESOLUTION)}getMinZoom(){return this.get(Y.MIN_ZOOM)}getMaxZoom(){return this.get(Y.MAX_ZOOM)}getOpacity(){return this.get(Y.OPACITY)}getSourceState(){return ht()}getVisible(){return this.get(Y.VISIBLE)}getZIndex(){return this.get(Y.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Y.EXTENT,t)}setMaxResolution(t){this.set(Y.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Y.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Y.MAX_ZOOM,t)}setMinZoom(t){this.set(Y.MIN_ZOOM,t)}setOpacity(t){et(typeof t=="number","Layer opacity must be a number"),this.set(Y.OPACITY,t)}setVisible(t){this.set(Y.VISIBLE,t)}setZIndex(t){this.set(Y.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const jt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Ut={ANIMATING:0,INTERACTING:1},Jt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Ul(i,t,e){return function(n,r,s,o,a){if(!n)return;if(!r&&!t)return n;const l=t?0:s[0]*r,h=t?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,_=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=pt(n[0],d,g),E=pt(n[1],f,_);if(o&&e&&r){const p=30*r;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,E]}}function Qf(i){return i}function xa(i,t,e,n){const r=ut(t)/e[0],s=Ot(t)/e[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function wa(i,t,e){let n=Math.min(i,t);const r=50;return n*=Math.log(1+r*Math.max(0,i/t-1))/r+1,e&&(n=Math.max(n,e),n/=Math.log(1+r*Math.max(0,e/i-1))/r+1),pt(n,e/2,t*2)}function Jf(i,t,e,n){return t=t!==void 0?t:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=e?xa(l,e,o,n):l;if(a)return t?wa(r,c,h):pt(r,h,c);const u=Math.min(c,r),d=Math.floor(ms(i,u,s));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function t_(i,t,e,n,r,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=r?xa(t,r,l,s):t;if(h)return n?wa(o,c,e):pt(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(t/f)/Math.log(i)+g),m=Math.max(d,_),E=t/Math.pow(i,m);return pt(E,e,c)}}}function Gl(i,t,e,n,r){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?xa(i,n,a,r):i;return!e||!l?pt(s,t,h):wa(s,h,t)}}}function Ca(i){if(i!==void 0)return 0}function jl(i){if(i!==void 0)return i}function e_(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function n_(i){const t=Sr(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function i_(i,t,e,n,r,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function r_(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=t;d<e;d+=n){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function s_(i,t,e,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function o_(i,t,e,n,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const kl=ce();class a_ extends Ce{constructor(){super(),this.extent_=si(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=gg((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ht()}closestPointXY(t,e,n,r){return ht()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ht()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ts(e),this.extentRevision_=this.getRevision()}return Fg(this.extent_,t)}rotate(t,e){ht()}scale(t,e,n){ht()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ht()}getType(){return ht()}applyTransform(t){ht()}intersectsExtent(t){return ht()}translate(t,e){ht()}transform(t,e){const n=ae(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Ot(h)/Ot(l);return mn(kl,h[0],h[3],c,-c,0,0,0),i_(s,0,s.length,a,kl,o),Zr(n,e)(s,o,a)}:Zr(n,e);return this.applyTransform(r),this}}class ba extends a_{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ag(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ht()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Xl(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ht()}setLayout(t,e,n){let r;if(t)r=Xl(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=l_(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();r_(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=_n(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();s_(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();o_(n,0,n.length,r,t,e,n),this.changed()}}}function l_(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Xl(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function zl(i,t,e,n,r,s,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let g=0;g<n;++g)o[g]=Hg(i[t+g],i[e+g],d);o.length=n;return}else u=t}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function Dc(i,t,e,n,r){let s=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=Hn(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function h_(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=Dc(i,t,a,n,r),t=a}return r}function Nc(i,t,e,n,r,s,o,a,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=Hn(o,a,i[t],i[t+1]),d<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=t+n;for(;g<e;)if(zl(i,g-n,g,n,o,a,c),d=Hn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(zl(i,e-n,t,n,o,a,c),d=Hn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function c_(i,t,e,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=Nc(i,t,g,n,r,s,o,a,l,h,c),t=g}return h}function u_(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function Fc(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function d_(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=Fc(i,t,e[o],n);r[s++]=l,t=l}return r.length=s,r}function g_(i,t,e,n,r,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=i[t],s[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],_=i[d+1],m=i[u],E=i[u+1];for(let p=d+n;p<u;p+=n){const v=i[p],y=i[p+1],R=Vg(v,y,f,_,m,E);R>g&&(c=p,g=R)}g>r&&(l[(c-t)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[t+u*n],s[o++]=i[t+u*n+1]);return o}function In(i,t){return t*Math.round(i/t)}function f_(i,t,e,n,r,s,o){if(t==e)return o;let a=In(i[t],r),l=In(i[t+1],r);t+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=In(i[t],r),c=In(i[t+1],r),t+=n,t==e)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=In(i[t],r),d=In(i[t+1],r);if(t+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,m=d-l;if(g*m==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function __(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=f_(i,t,c,n,r,s,o),a.push(o),t=c}return o}function Uc(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<e;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function m_(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=Uc(i,t,l,n,r[s]),t=l}return r.length=s,r}function Gc(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=o*a-s*l,s=a,o=l}return r/2}function p_(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Gc(i,t,a,n),t=a}return r}class Oi extends ba{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Oi(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<hc(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Dc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Gc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Uc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=g_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Oi(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Fc(this.flatCoordinates,0,t,this.stride),this.changed()}}class Ia extends ba{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Ia(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=Hn(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Lg(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return cc(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=u_(this.flatCoordinates,0,t,this.stride),this.changed()}}function E_(i,t,e,n,r,s,o){let a,l,h,c,u,d,g;const f=r[s+1],_=[];for(let p=0,v=e.length;p<v;++p){const y=e[p];for(c=i[y-n],d=i[y-n+1],a=t;a<y;a+=n)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let m=NaN,E=-1/0;for(_.sort(la),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>E&&(h=(c+u)/2,Tc(i,t,e,n,h,f)&&(m=h,E=p)),c=u}return isNaN(m)&&(m=r[s]),[m,f,E]}function y_(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function jc(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function T_(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=jc(i,t,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function $l(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=jc(i,t,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&y_(i,t,a,n),t=a}return t}class Di extends ba{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?ug(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Di(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<hc(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(h_(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),c_(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Tc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return p_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),$l(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,m_(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=_n(this.getExtent());this.flatInteriorPoint_=E_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ia(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Oi(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Oi(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;T_(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=$l(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=__(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Di(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return Ef(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=d_(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Bl(i){if(Tn(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],r=i[3],s=[t,e,t,r,n,r,n,e,t,e];return new Di(s,"XY",[s.length])}const Js=0;class ee extends Ce{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=ga(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&ef(),t.center&&(t.center=pe(t.center,this.projection_)),t.extent&&(t.extent=Ke(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Jt)delete e[a];this.setProperties(e,!0);const n=R_(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const r=v_(t),s=n.constraint,o=x_(t);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const r=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-e[3]+e[1]-r[1]),a=s/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=pe(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=pe(r.anchor,this.getProjection())),e[n]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===e){n&&dr(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||pg,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Yn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}w_(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Ut.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ut.ANIMATING]>0}getInteracting(){return this.hints_[Ut.INTERACTING]>0}cancelAnimations(){this.setHint(Ut.ANIMATING,-this.hints_[Ut.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const r=this.animations_[e];if(r[0].callback&&dr(r[0].callback,!1),!t)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[m,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Yn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Ut.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&dr(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-e[0],r[1]-e[1]],ua(n,t-this.getRotation()),Yg(n,e)),n}calculateCenterZoom(t,e){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-r[0])/s,a=e[1]-t*(e[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],r=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Mo(t,this.getProjection())}getCenterInternal(){return this.get(Jt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return af(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();et(e,"The view center is not defined");const n=this.getResolution();et(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return et(r!==void 0,"The view rotation is not defined"),Xr(e,n,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Jt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ke(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=ut(t)/e[0],r=Ot(t)/e[1];return Math.max(n,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*r)}}getRotation(){return this.get(Jt.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=to(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,r;if(this.resolutions_){const s=ms(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(n/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=pt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,pt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(et(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){et(!Tn(t),"Cannot fit empty extent provided as `geometry`");const r=Ke(t,this.getProjection());n=Bl(r)}else if(t.getType()==="Circle"){const r=Ke(t.getExtent(),this.getProjection());n=Bl(r),n.rotate(this.getRotation(),_n(r))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),r=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*r,f=s[u]*r+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=_n(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),m=e.callback?e.callback:Ur;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),dr(m,!0))}centerOn(t,e,n){this.centerOnInternal(pe(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(to(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,r){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=to(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Mo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&pe(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,r,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=pe(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&pe(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Jt.ROTATION)!==r&&this.set(Jt.ROTATION,r),this.get(Jt.RESOLUTION)!==o&&(this.set(Jt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Jt.CENTER)||!Br(this.get(Jt.CENTER),a))&&this.set(Jt.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const r=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Br(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:ri,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ut.INTERACTING,1)}endInteraction(t,e,n){n=n&&pe(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(Ut.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function dr(i,t){setTimeout(function(){i(t)},0)}function v_(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Ul(i.extent,i.constrainOnlyCenter,e)}const t=ga(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ul(e,!1,!1)}return Qf}function R_(i){let t,e,n,r=i.minZoom!==void 0?i.minZoom:Js,s=i.maxZoom!==void 0?i.maxZoom:28;const o=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=ga(i.projection,"EPSG:3857"),u=c.getExtent();let d=i.constrainOnlyCenter,g=i.extent;if(!a&&!g&&c.isGlobal()&&(d=!1,g=u),i.resolutions!==void 0){const f=i.resolutions;e=f[r],n=f[s]!==void 0?f[s]:f[f.length-1],i.constrainResolution?t=Jf(f,l,!d&&g,h):t=Gl(e,n,l,!d&&g,h)}else{const f=(u?Math.max(ut(u),Ot(u)):360*ti.degrees/c.getMetersPerUnit())/Ea/Math.pow(2,Js),_=f/Math.pow(2,28-Js);e=i.maxResolution,e!==void 0?r=0:e=f/Math.pow(o,r),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(o,s):n=f/Math.pow(o,s):n=_),s=r+Math.floor(Math.log(e/n)/Math.log(o)),n=e/Math.pow(o,s-r),i.constrainResolution?t=t_(o,e,n,l,!d&&g,h):t=Gl(e,n,l,!d&&g,h)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:r,zoomFactor:o}}function x_(i){if(i.enableRotation===void 0||i.enableRotation){const t=i.constrainRotation;return t===void 0||t===!0?n_():t===!1?jl:typeof t=="number"?e_(t):jl}return Ca}function w_(i){return!(i.sourceCenter&&i.targetCenter&&!Br(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function to(i,t,e,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class C_ extends Oc{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Y.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Y.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(ot(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=K(t,D.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof ee?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return Pa(r,e.viewState)&&(!s||Bi(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const r=t instanceof ee?t.getViewStateAndExtent():t;let s=e(r);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(Y.MAP,t)}getMapInternal(){return this.get(Y.MAP)}setMap(t){this.mapPrecomposeKey_&&(ot(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(ot(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=K(t,jt.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,r=this.getLayerState(!1);et(!n.some(function(s){return s.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(r)},this),this.mapRenderKey_=K(this,D.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Y.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Pa(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}const Is=C_;class b_ extends _s{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ht()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;mn(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Sc(r,n)}forEachFeatureAtCoordinate(t,e,n,r,s,o,a,l){let h;const c=e.viewState;function u(y,R,x,T){return s.call(o,R,y?x:null,T)}const d=c.projection,g=Qg(t.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const y=d.getExtent(),R=ut(y);f.push([-R,0],[R,0])}const _=e.layerStatesArray,m=_.length,E=[],p=[];for(let y=0;y<f.length;y++)for(let R=m-1;R>=0;--R){const x=_[R],T=x.layer;if(T.hasRenderer()&&Pa(x,c)&&a.call(l,T)){const w=T.getRenderer(),C=T.getSource();if(w&&C){const L=C.getWrapX()?g:t,O=u.bind(null,x.managed);p[0]=L[0]+f[y][0],p[1]=L[1]+f[y][1],h=w.forEachFeatureAtCoordinate(p,e,n,O,E)}if(h)return h}}if(E.length===0)return;const v=1/E.length;return E.forEach((y,R)=>y.distanceSq+=R*v),E.sort((y,R)=>y.distanceSq-R.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(t,e,n,r,s,o){return this.forEachFeatureAtCoordinate(t,e,n,r,Fr,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){ht()}flushDeclutterItems(t){}scheduleExpireIconCache(t){Mc.canExpireCache()&&t.postRenderFunctions.push(I_)}}function I_(i,t){Mc.expire()}class bi extends we{constructor(t,e,n,r){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=r}}const gr="ol-hidden",ai="ol-unselectable",Kl="ol-unsupported",Ps="ol-control",Zl="ol-collapsed",P_=new Ce;class S_ extends b_{constructor(t){super(t),this.fontChangeListenerKey_=K(P_,Mi.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=ai+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const r=new bi(t,void 0,e);n.dispatchEvent(r)}}disposeInternal(){ot(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(jt.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=t.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!Pa(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(t,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(t),Cg(this.element_,this.children_),this.dispatchRenderEvent(jt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}flushDeclutterItems(t){const e=this.declutterLayers_;for(let n=e.length-1;n>=0;--n)e[n].renderDeclutter(t);e.length=0}}class Ge extends we{constructor(t,e){super(t),this.layer=e}}const eo={LAYERS:"layers"};class li extends Oc{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(eo.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Te(n.slice(),{unique:!0}):et(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Te(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(ot),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(K(t,Bt.ADD,this.handleLayersAdd_,this),K(t,Bt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(ot);Xi(this.listenerKeys_);const e=t.getArray();for(let n=0,r=e.length;n<r;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new Ge("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[K(t,Mi.PROPERTYCHANGE,this.handleLayerChange_,this),K(t,D.CHANGE,this.handleLayerChange_,this)];t instanceof li&&e.push(K(t,"addlayer",this.handleLayerGroupAdd_,this),K(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[wt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ge("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ge("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ge("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=wt(e);this.listenerKeys_[n].forEach(ot),delete this.listenerKeys_[n],this.dispatchEvent(new Ge("removelayer",e)),this.changed()}getLayers(){return this.get(eo.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new Ge("removelayer",n[r]))}this.set(eo.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Wt(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}class Gn extends we{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class Oe extends Gn{constructor(t,e,n,r,s,o){super(t,e,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const gt={SINGLECLICK:"singleclick",CLICK:D.CLICK,DBLCLICK:D.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Uo={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class L_ extends zi{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=K(n,Uo.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=K(n,Uo.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(D.TOUCHMOVE,this.boundHandleTouchMove_,ac?{passive:!1}:!1)}emulateClick_(t){let e=new Oe(gt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Oe(gt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Oe(gt.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==gt.POINTERUP||e.type==gt.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==gt.POINTERDOWN||e.type==gt.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Oe(gt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(ot),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Oe(gt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(K(n,gt.POINTERMOVE,this.handlePointerMove_,this),K(n,gt.POINTERUP,this.handlePointerUp_,this),K(this.element_,gt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(K(this.element_.getRootNode(),gt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Oe(gt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Oe(gt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(ot(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(D.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ot(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ot),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const De={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Tt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Go=1/0;class A_{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Xi(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(t){et(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Go?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,r=e.length,s=e[t],o=n[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,r=this.priorities_,s=n[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(r[a]>o)n[e]=n[a],r[e]=r[a],e=a;else break}n[e]=s,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let r=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==Go?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,e[r++]=o);e.length=r,n.length=r,this.heapify_()}}class M_ extends A_{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(D.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===P.LOADED||n===P.ERROR||n===P.EMPTY){n!==P.ERROR&&e.removeEventListener(D.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,r,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===P.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function O_(i,t,e,n,r){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return Go;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class Vi extends Ce{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Io(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Io(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)ot(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ur&&this.listenerKeys.push(K(t,De.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class D_ extends Vi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(D.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+ai+" "+Ps+(this.collapsed_&&this.collapsible_?" "+Zl:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!ps(e,this.renderedAttributions_)){wg(this.ulElement_);for(let r=0,s=e.length;r<s;++r){const o=document.createElement("li");o.innerHTML=e[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Zl),this.collapsed_?Gr(this.collapseLabel_,this.label_):Gr(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class N_ extends Vi{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(D.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+ai+" "+Ps,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(gr)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();e!==void 0&&(this.duration_>0&&e%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:ri}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(gr);!s&&n===0?this.element.classList.add(gr):s&&n!==0&&this.element.classList.remove(gr)}this.label_.style.transform=r}this.rotation_=n}}class F_ extends Vi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(D.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(D.CLICK,this.handleClick_.bind(this,-n),!1);const d=e+" "+ai+" "+Ps,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const n=e.getZoom();if(n!==void 0){const r=e.getConstrainedZoom(n+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:r,duration:this.duration_,easing:ri})):e.setZoom(r)}}}function Sa(i){i=i||{};const t=new Te;return(i.zoom===void 0||i.zoom)&&t.push(new F_(i.zoomOptions)),(i.rotate===void 0||i.rotate)&&t.push(new N_(i.rotateOptions)),(i.attribution===void 0||i.attribution)&&t.push(new D_(i.attributionOptions)),t}const Vl={ACTIVE:"active"};class Wi extends Ce{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Vl.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Vl.ACTIVE,t)}setMap(t){this.map_=t}}function U_(i,t,e){const n=i.getCenterInternal();if(n){const r=[n[0]+t[0],n[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:Eg,center:i.getConstrainedCenter(r)})}}function La(i,t,e,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+t),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:n!==void 0?n:250,easing:ri})}class G_ extends Wi{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==gt.DBLCLICK){const n=t.originalEvent,r=t.map,s=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();La(a,o,s,this.duration_),n.preventDefault(),e=!0}return!e}}class Hi extends Wi{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==gt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==gt.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==gt.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==gt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Aa(i){const t=i.length;let e=0,n=0;for(let r=0;r<t;r++)e+=i[r].clientX,n+=i[r].clientY;return{clientX:e/t,clientY:n/t}}function jo(i){const t=arguments;return function(e){let n=!0;for(let r=0,s=t.length;r<s&&(n=n&&t[r](e),!!n);++r);return n}}const j_=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},k_=function(i){const t=i.map.getTargetElement(),e=i.map.getOwnerDocument().activeElement;return t.contains(e)},kc=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?k_(i):!0},X_=Fr,Xc=function(i){const t=i.originalEvent;return t.button==0&&!(Rg&&rc&&t.ctrlKey)},zc=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},z_=function(i){const t=i.originalEvent;return rc?t.metaKey:t.ctrlKey},$_=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},$c=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},no=function(i){const t=i.originalEvent;return et(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},B_=function(i){const t=i.originalEvent;return et(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class K_ extends Hi{constructor(t){super({stopDown:Es}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:jo(zc,B_);this.condition_=t.onFocusOnly?jo(kc,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,r=e.getEventPixel(Aa(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=t.map.getView();qg(s,o.getResolution()),ua(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:ri})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Z_ extends Hi{constructor(t){t=t||{},super({stopDown:Es}),this.condition_=t.condition?t.condition:j_,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!no(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===Ca)return;const r=e.getSize(),s=t.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return no(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return no(t)&&Xc(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class V_ extends _s{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+n,r.top=Math.min(t[1],e[1])+n,r.width=Math.abs(e[0]-t[0])+n,r.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Di([n])}getGeometry(){return this.geometry_}}const fr={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class io extends we{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class W_ extends Hi{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new V_(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Xc,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const r=n[0]-e[0],s=n[1]-e[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new io(fr.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new io(e?fr.BOXEND:fr.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new io(fr.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}class H_ extends W_{constructor(t){t=t||{};const e=t.condition?t.condition:$_;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const e=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=e.rotatedExtentForGeometry(n),s=e.getResolutionForExtentInternal(r),o=e.getResolution()/s;n=n.clone(),n.scale(o*o)}e.fitInternal(n,{duration:this.duration_,easing:ri})}}const nn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Y_ extends Wi{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return zc(e)&&$c(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==D.KEYDOWN){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==nn.DOWN||r==nn.LEFT||r==nn.RIGHT||r==nn.UP)){const s=t.map.getView(),o=s.getResolution()*this.pixelDelta_;let a=0,l=0;r==nn.DOWN?l=-o:r==nn.LEFT?a=-o:r==nn.RIGHT?a=o:l=o;const h=[a,l];ua(h,s.getRotation()),U_(s,h,this.duration_),n.preventDefault(),e=!0}}return!e}}class q_ extends Wi{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!z_(e)&&$c(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==D.KEYDOWN||t.type==D.KEYPRESS){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==="+"||r==="-")){const s=t.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();La(a,o,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}class Q_{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const r=this.points_[e+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[e]-this.points_[n],o=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class J_ extends Wi{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:X_;this.condition_=t.onFocusOnly?jo(kc,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==D.WHEEL)return!0;const e=t.map,n=t.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let r;if(t.type==D.WHEEL&&(r=n.deltaY,yg&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=sc),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=e.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),a),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-pt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),La(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class tm extends Hi{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Es),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;const o=t.map,a=o.getView();a.getConstraints().rotation!==Ca&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Aa(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class em extends Hi{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Es),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Aa(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function nm(i){i=i||{};const t=new Te,e=new Q_(-.005,.05,100);return(i.altShiftDragRotate===void 0||i.altShiftDragRotate)&&t.push(new Z_),(i.doubleClickZoom===void 0||i.doubleClickZoom)&&t.push(new G_({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan===void 0||i.dragPan)&&t.push(new K_({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate===void 0||i.pinchRotate)&&t.push(new tm),(i.pinchZoom===void 0||i.pinchZoom)&&t.push(new em({duration:i.zoomDuration})),(i.keyboard===void 0||i.keyboard)&&(t.push(new Y_),t.push(new q_({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom===void 0||i.mouseWheelZoom)&&t.push(new J_({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom===void 0||i.shiftDragZoom)&&t.push(new H_({duration:i.zoomDuration})),t}function Bc(i){if(i instanceof Is){i.setMapInternal(null);return}i instanceof li&&i.getLayers().forEach(Bc)}function Kc(i,t){if(i instanceof Is){i.setMapInternal(t);return}if(i instanceof li){const e=i.getLayers().getArray();for(let n=0,r=e.length;n<r;++n)Kc(e[n],t)}}let Zc=class extends Ce{constructor(i){super(),i=i||{},this.on,this.once,this.un;const t=im(i);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:sc,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=ce(),this.pixelToCoordinateTransform_=ce(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||Sa(),this.interactions=t.interactions||nm({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new M_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Tt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Tt.VIEW,this.handleViewChanged_),this.addChangeListener(Tt.SIZE,this.handleSizeChanged_),this.addChangeListener(Tt.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const e=this;i.view&&!(i.view instanceof ee)&&i.view.then(function(n){e.setView(new ee(n))}),this.controls.addEventListener(Bt.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(Bt.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(Bt.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(Bt.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(Bt.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(Bt.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){Kc(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){const t=i.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,t,e){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(i);e=e!==void 0?e:{};const r=e.hitTolerance!==void 0?e.hitTolerance:0,s=e.layerFilter!==void 0?e.layerFilter:Fr,o=e.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,o,t,null,s,null)}getFeaturesAtPixel(i,t){const e=[];return this.forEachFeatureAtPixel(i,function(n){e.push(n)},t),e}getAllLayers(){const i=[];function t(e){e.forEach(function(n){n instanceof li?t(n.getLayers()):i.push(n)})}return t(this.getLayers()),i}hasFeatureAtPixel(i,t){if(!this.frameState_||!this.renderer_)return!1;const e=this.getCoordinateFromPixelInternal(i);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:Fr,r=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(e,this.frameState_,r,s,n,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){const t=this.viewport_.getBoundingClientRect(),e=this.getSize(),n=t.width/e[0],r=t.height/e[1],s="changedTouches"in i?i.changedTouches[0]:i;return[(s.clientX-t.left)/n,(s.clientY-t.top)/r]}getTarget(){return this.get(Tt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(i){return Mo(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){const t=this.frameState_;return t?zt(t.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){const t=this.overlayIdIndex_[i.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Tt.LAYERGROUP)}setLayers(i){const t=this.getLayerGroup();if(i instanceof Te){t.setLayers(i);return}const e=t.getLayers();e.clear(),e.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const n=i[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const s=n.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(i){const t=pe(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(i){const t=this.frameState_;return t?zt(t.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Tt.SIZE)}getView(){return this.get(Tt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,t,e,n){return O_(this.frameState_,i,t,e,n)}handleBrowserEvent(i,t){t=t||i.type;const e=new Oe(t,this,i);this.handleMapBrowserEvent(e)}handleMapBrowserEvent(i){if(!this.frameState_)return;const t=i.originalEvent,e=t.type;if(e===Uo.POINTERDOWN||e===D.WHEEL||e===D.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,s=t.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===n?n.documentElement:r).contains(s))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const s=n[r];if(!(s.getMap()!==this||!s.getActive()||!this.getTargetElement())&&(!s.handleEvent(i)||i.propagationStopped))break}}}handlePostRender(){const i=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(i){const s=i.viewHints;if(s[Ut.ANIMATING]||s[Ut.INTERACTING]){const o=Date.now()-i.time>8;n=o?0:8,r=o?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}i&&this.renderer_&&!i.animate&&(this.renderComplete_===!0?(this.hasListener(jt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(jt.RENDERCOMPLETE,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Gn(De.LOADEND,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Gn(De.LOADSTART,this,i))));const e=this.postRenderFunctions_;for(let n=0,r=e.length;n<r;++n)e[n](this,i);e.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,n=this.targetChangeHandlerKeys_.length;e<n;++e)ot(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(D.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(D.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Io(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const i=this.getTarget(),t=typeof i=="string"?document.getElementById(i):i;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new S_(this)),this.mapBrowserEventHandler_=new L_(this,this.moveTolerance_);for(const r in gt)this.mapBrowserEventHandler_.addEventListener(gt[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(D.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(D.WHEEL,this.boundHandleBrowserEvent_,ac?{passive:!1}:!1);const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[K(e,D.KEYDOWN,this.handleBrowserEvent,this),K(e,D.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(ot(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ot(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const i=this.getView();i&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=K(i,Mi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=K(i,D.CHANGE,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ot),this.layerGroupPropertyListenerKeys_=null);const i=this.getLayerGroup();i&&(this.handleLayerAdd_(new Ge("addlayer",i)),this.layerGroupPropertyListenerKeys_=[K(i,Mi.PROPERTYCHANGE,this.render,this),K(i,D.CHANGE,this.render,this),K(i,"addlayer",this.handleLayerAdd_,this),K(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const i=this.getLayerGroup().getLayerStatesArray();for(let t=0,e=i.length;t<e;++t){const n=i[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const i=this.frameState_;i&&this.renderer_.flushDeclutterItems(i)}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){Bc(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){const t=this.getSize(),e=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&Sl(t)&&e&&e.isDef()){const s=e.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=e.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Xr(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:o,viewHints:s,wantedTiles:{},mapId:wt(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=Xr(o.nextCenter,o.nextResolution,a,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!Tn(this.previousExtent_)&&!So(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Gn(De.MOVESTART,this,n)),this.previousExtent_=Ts(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Ut.ANIMATING]&&!r.viewHints[Ut.INTERACTING]&&!So(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Gn(De.MOVEEND,this,r)),Sg(r.extent,this.previousExtent_))),this.dispatchEvent(new Gn(De.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(De.LOADSTART)||this.hasListener(De.LOADEND)||this.hasListener(jt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ge("removelayer",t)),this.set(Tt.LAYERGROUP,i)}setSize(i){this.set(Tt.SIZE,i)}setTarget(i){this.set(Tt.TARGET,i)}setView(i){if(!i||i instanceof ee){this.set(Tt.VIEW,i);return}this.set(Tt.VIEW,new ee);const t=this;i.then(function(e){t.setView(new ee(e))})}updateSize(){const i=this.getTargetElement();let t;if(i){const n=getComputedStyle(i),r=i.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=i.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(s)&&(t=[r,s],!Sl(t)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&fc("No map visible because the map container's width or height are 0."))}const e=this.getSize();t&&(!e||!ps(t,e))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(i){const t=this.getView();t&&t.setViewportSize(i)}};function im(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new li({layers:i.layers});e[Tt.LAYERGROUP]=n,e[Tt.TARGET]=i.target,e[Tt.VIEW]=i.view instanceof ee?i.view:new ee;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new Te(i.controls.slice()):(et(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new Te(i.interactions.slice()):(et(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new Te(i.overlays.slice()):(et(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new Te,{controls:r,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}const _r={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class rm extends Is{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(_r.PRELOAD)}setPreload(t){this.set(_r.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(_r.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(_r.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}function Yr(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function ko(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let Pn=null;function sm(i){Pn||(Pn=fe(i.width,i.height,void 0,{willReadFrequently:!0}));const t=Pn.canvas,e=i.width;t.width!==e&&(t.width=e);const n=i.height;return t.height!==n&&(t.height=n),Pn.clearRect(0,0,e,n),Pn.drawImage(i,0,0),Pn.getImageData(0,0,e,n).data}const om=[256,256];class Vc extends ha{constructor(t){const e=P.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=Yr(this.data_);return t?[t.width,t.height]:om}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=P.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=P.ERROR,t.changed()})}}class Wc extends Vc{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=n?Wt(e,n):e;if(Ai(s)===0){this.state=P.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(r?r=Wt(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,c=mc(o,h,s,l);if(!isFinite(c)||c<=0){this.state=P.EMPTY;return}const u=t.errorThreshold!==void 0?t.errorThreshold:ca;if(this.triangulation_=new _a(o,h,s,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=pt(d[1],r[1],r[3]),d[3]=pt(d[3],r[1],r[3])):d=Wt(d,r)),!Ai(d))this.state=P.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=t.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let m=g.minY;m<=g.maxY;m++){const E=f(this.sourceZ_,_,m,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==P.LOADED)return;const n=e.getSize(),r=this.gutter_;let s;const o=ko(e.getData());o?s=o:s=sm(Yr(e.getData()));const a=[n[0]+2*r,n[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),m=h*_;let E=u;if(u.length!==m){E=new c(m);let p=0,v=0;const y=a[0]*_;for(let R=0;R<a[1];++R){for(let x=0;x<y;++x)E[p++]=u[v+x];v+=f/d}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=P.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=t[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,R=t.length;y<R;++y){const x=t[y],T=x.data,w=x.pixelSize,C=w[0],L=w[1],O=fe(C,L,Re),lt=O.createImageData(C,L),tt=lt.data;let z=g*3;for(let V=0,it=tt.length;V<it;V+=4)tt[V]=T[z],tt[V+1]=T[z+1],tt[V+2]=T[z+2],tt[V+3]=255,z+=u;O.putImageData(lt,0,0),f.push({extent:x.extent,image:O.canvas})}const _=ma(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,R=f.length;y<R;++y){const x=f[y].image.getContext("2d");Si(x),Re.push(x.canvas)}const m=_.getContext("2d"),E=m.getImageData(0,0,_.width,_.height);Si(m),Re.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new t[0].dataType(c.buffer));const p=E.data;let v=g*3;for(let y=0,R=p.length;y<R;y+=4)p[y+3]===255?(c[v]=p[y],c[v+1]=p[y+1],c[v+2]=p[y+2]):(c[v]=0,c[v+1]=0,c[v+2]=0),v+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=P.LOADED}this.changed()}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n!==P.IDLE&&n!==P.LOADING)return;t++;const r=K(e,D.CHANGE,function(){const s=e.getState();(s==P.LOADED||s==P.ERROR||s==P.EMPTY)&&(ot(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==P.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(ot),this.sourcesListenerKeys_=null}}class am extends zi{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(D.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===P.LOADED,this.loaded)this.uploadTile();else{if(t instanceof ys){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(D.CHANGE,this.handleTileChange_)}}uploadTile(){ht()}setReady(){this.ready=!0,this.dispatchEvent(D.CHANGE)}handleTileChange_(){this.tile.getState()===P.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(D.CHANGE,this.handleTileChange_)}}const Ma=34962,Oa=34963,lm=35040,Da=35044,hm=35048,cm=5121,um=5123,dm=5125,Hc=5126,Wl=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function gm(i,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!vg},t);const e=Wl.length;for(let n=0;n<e;++n)try{const r=i.getContext(Wl[n],t);if(r)return r}catch{}return null}const fm={STATIC_DRAW:Da,STREAM_DRAW:lm,DYNAMIC_DRAW:hm};class Yc{constructor(t,e){this.array_=null,this.type_=t,et(t===Ma||t===Oa,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:fm.STATIC_DRAW}ofSize(t){return this.array_=new(ro(this.type_))(t),this}fromArray(t){return this.array_=ro(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(ro(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function ro(i){switch(i){case Ma:return Float32Array;case Oa:return Uint32Array;default:return Float32Array}}function qc(i,t,e){const n=e?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function _m(i,t,e,n){qc(i,t,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}function Hl(i,t,e,n,r,s){const o=i.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),qc(o,t,s&&l);const h=e.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let jn=null;function mm(){jn=fe(1,1,void 0,{willReadFrequently:!0})}class pm extends am{constructor(t){super(t),this.textures=[],this.renderSize_=ie(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new Yc(Ma,Da);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;this.textures.length=0;let r;n instanceof ys||n instanceof ws?r=n.getImage():r=n.getData();const s=Yr(r);if(s){const p=e.createTexture();this.textures.push(p),this.bandCount=4,_m(e,p,s,n.interpolate),this.setReady();return}r=ko(r);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const p=e.createTexture();this.textures.push(p),Hl(t,p,r,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let p=0;p<g;++p){const v=e.createTexture();this.textures.push(v);const y=p<g-1?4:(this.bandCount-1)%4+1;f[p]=new c(h*y)}let _=0,m=0;const E=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let v=0;v<E;++v){const y=r[m+v],R=Math.floor(_/this.bandCount),x=v%this.bandCount,T=Math.floor(x/4),w=f[T],C=w.length/h,L=x%4;w[R*C+L]=y,++_}m+=d/u}for(let p=0;p<g;++p){const v=this.textures[p],y=f[p],R=y.length/h;Hl(t,v,y,a,R,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(D.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];jn||mm(),jn.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(e/s)),d=r+Math.floor(c*(n/o));let g;try{jn.drawImage(t,u,d,1,1,0,0,1,1),g=jn.getImageData(0,0,1,1).data}catch{return jn=null,null}return g}getArrayPixelData_(t,e,n,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(r/a));if(t instanceof DataView){const _=t.byteLength/(c*u),m=_*(g*c+d),E=t.buffer.slice(m,m+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return t.slice(f,f+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Vc){const n=this.tile.getData(),r=ko(n);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,t,e)}return this.getImagePixelData_(Yr(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class Qc extends Zi{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ht()}getData(t){return null}prepareFrame(t){return ht()}renderFrame(t,e){return ht()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,s,o)}}forEachFeatureAtCoordinate(t,e,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===rt.LOADED||e.getState()===rt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=rt.LOADED&&e!=rt.ERROR&&t.addEventListener(D.CHANGE,this.boundHandleImageChange_),e==rt.IDLE&&(t.load(),e=t.getState()),e==rt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const mr={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Em=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,ym=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Yl{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||Em),e.compileShader(n);const r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fragmentShader||ym),e.compileShader(r),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,r),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const r=0,s=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,r,s,n[0],n[1],o,a,l,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,r){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=wt(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,r=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${r}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,r++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(s.location,n[0],n[1]);return;case 3:e.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(s.location,n)})}}function Jc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function tu(i,t){return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}const Se={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},xi={UNSIGNED_BYTE:cm,UNSIGNED_SHORT:um,UNSIGNED_INT:dm,FLOAT:Hc},qr={};function ql(i){return"shared/"+i}let Ql=0;function Tm(){const i="unique/"+Ql;return Ql+=1,i}function vm(i){let t=qr[i];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:gm(e)},qr[i]=t}return t.users+=1,t.context}function Rm(i){const t=qr[i];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const r=e.canvas;r.width=1,r.height=1,delete qr[i]}class xm extends _s{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?ql(t.canvasCacheKey):Tm(),this.gl_=vm(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(mr.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(mr.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=ce(),this.offsetScaleMatrix_=ce(),this.tmpMat4_=Jc(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new Yl({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Yl({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===ql(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=wt(t);let r=this.bufferCache_[n];if(!r){const s=e.createBuffer();r={buffer:t,webGlBuffer:s},this.bufferCache_[n]=r}e.bindBuffer(t.getType(),r.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=wt(t),r=this.bufferCache_[n];r&&!e.isContextLost()&&e.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(mr.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(mr.RESTORED,this.boundHandleWebGLContextRestored_),Rm(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const r=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(t,e,n){const r=this.gl_;r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n,r){const s=this.gl_,o=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const r=n.UNSIGNED_INT,s=4,o=e-t,a=t*s;n.drawElements(n.TRIANGLES,o,r,a)}finalizeDraw(t,e,n){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(t,null,e,n):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,r=t.pixelRatio;this.setUniformFloatValue(Se.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Se.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Se.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Se.PIXEL_RATIO,r),this.setUniformFloatVec2(Se.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Se.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Se.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Se.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,r=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,r,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),r++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,tu(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}getProgram(t,e){const n=this.gl_,r=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=wt(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=wt(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,r=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return mn(e,0,0,2/(s*n[0]),2/(s*n[1]),-r,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,r,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,r,s))}enableAttributes(t){const e=wm(t);let n=0;for(let r=0;r<t.length;r++){const s=t[r];this.enableAttributeArray_(s.name,s.size,s.type||Hc,e,n),n+=s.size*eu(s.type)}}handleWebGLContextLost(t){Xi(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n){const r=this.gl_;n=n||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,n),e?r.texImage2D(r.TEXTURE_2D,s,o,l,h,e):r.texImage2D(r.TEXTURE_2D,s,o,t[0],t[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n}}function wm(i){let t=0;for(let e=0;e<i.length;e++){const n=i[e];t+=n.size*eu(n.type)}return t}function eu(i){switch(i){case xi.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case xi.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case xi.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case xi.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Na extends Qc{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=ce(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(Y.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(jt.PRECOMPOSE)){const r=new bi(jt.PRECOMPOSE,void 0,e,t);n.dispatchEvent(r)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(jt.POSTCOMPOSE)){const r=new bi(jt.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,r;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Na)){e=!0;continue}const c=l.getClassName();if((e||c!==r)&&(n+=1,e=!1),r=c,h===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new xm({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){mn(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new bi(t,this.inversePixelTransform_,n,e);r.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(jt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(jt.POSTRENDER,t,e)}}const Cm={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},bm={};function Jl(i){return 1/(i+2)}function Im(){return{tileIds:new Set,representationsByZ:{}}}function th(i,t){return i.tileIds.has(wt(t))}function eh(i,t,e){const n=i.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),i.tileIds.add(wt(t.tile))}function so(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=Wt(t,Ke(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(t=Wt(t,r))}return t}function Xo(i,t){return`${i.getKey()},${Xe(t)}`}class Pm extends Na{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=ce(),this.tempMat4=Jc(),this.tempTileRange_=new pa(0,0,0,0),this.tempTileCoord_=Vr(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new pc(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==P.LOADED||n==P.EMPTY||n==P.ERROR&&!r}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const e=this.getLayer().getRenderSource();return!e||Tn(so(t,t.extent))?!1:e.getState()==="ready"}createTileRepresentation(t){return ht()}enqueueTiles(t,e,n,r,s){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=wt(l);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=n;m>=_;--m){const E=h.getTileRangeForExtentAndZ(e,m,this.tempTileRange_),p=h.getResolution(m);for(let v=E.minX;v<=E.maxX;++v)for(let y=E.minY;y<=E.maxY;++y){const R=Vr(m,v,y,this.tempTileCoord_),x=Xo(l,R);let T,w;if(g.containsKey(x)&&(T=g.get(x),w=T.tile),(!T||T.tile.key!==l.getKey())&&(w=l.getTile(m,v,y,t.pixelRatio,o.projection)),th(r,w))continue;if(!T)T=this.createTileRepresentation({tile:w,grid:h,helper:this.helper,gutter:c}),g.set(x,T);else if(this.isDrawableTile_(w))T.setTile(w);else{const L=w.getInterimTile();T.setTile(L)}eh(r,T,m);const C=w.getKey();d[C]=!0,w.getState()===P.IDLE&&(t.tileQueue.isKeyQueued(C)||t.tileQueue.enqueue([w,u,h.getTileCoordCenter(R),p]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,r,s,o,a,l,h,c,u){}renderTileMask(t,e,n,r){}drawTile_(t,e,n,r,s,o,a){if(!e.ready)return;const l=e.tile.tileCoord,h=Xe(l),c=h in o?o[h]:1,u=a.getResolution(n),d=ie(a.getTileSize(n),this.tempSize_),g=a.getOrigin(n),f=a.getTileCoordExtent(l),_=c<1?-1:Jl(n);c<1&&(t.animate=!0);const m=t.viewState,E=m.center[0],p=m.center[1],v=d[0]+2*r,y=d[1]+2*r,R=v/y,x=(E-g[0])/(d[0]*u),T=(g[1]-p)/(d[1]*u),w=m.resolution/u,C=l[1],L=l[2];jf(this.tileTransform_),Ml(this.tileTransform_,2/(t.size[0]*w/v),-2/(t.size[1]*w/v)),kf(this.tileTransform_,m.rotation),Ml(this.tileTransform_,1,1/R),Xf(this.tileTransform_,(d[0]*(C-x)-r)/v,(d[1]*(L-T)-r)/y),this.renderTile(e,this.tileTransform_,t,s,u,d,g,f,_,r,c)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=so(t,t.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=Im(),u=r.getPreload();if(t.nextExtent){const R=o.getZForResolution(n.nextResolution,s.zDirection),x=so(t,t.nextExtent);this.enqueueTiles(t,x,R,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const d={},g=wt(this),f=t.time;let _=!1;for(const R of c.representationsByZ[h]){const x=R.tile;if((x instanceof ws||x instanceof Wc)&&x.getState()===P.EMPTY)continue;const T=x.tileCoord;if(R.ready){const C=x.getAlpha(g,f);if(C===1){x.endTransition(g);continue}_=!0;const L=Xe(T);d[L]=C}if(this.renderComplete=!1,this.findAltTiles_(o,T,h+1,c))continue;const w=o.getMinZoom();for(let C=h-1;C>=w&&!this.findAltTiles_(o,T,C,c);--C);}const m=c.representationsByZ,E=Object.keys(m).map(Number).sort(cg);if(this.beforeTilesMaskRender(t))for(let R=0,x=E.length;R<x;++R){const T=E[R];for(const w of m[T]){const C=w.tile.tileCoord;if(Xe(C)in d)continue;const L=o.getTileCoordExtent(C);this.renderTileMask(w,T,L,Jl(T))}}this.beforeTilesRender(t,_);for(let R=0,x=E.length;R<x;++R){const T=E[R];for(const w of m[T]){const C=w.tile.tileCoord;Xe(C)in d||this.drawTile_(t,w,T,a,l,d,o)}}for(const R of m[h]){const x=R.tile.tileCoord;Xe(x)in d&&this.drawTile_(t,R,h,a,l,d,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const p=this.helper.getCanvas(),v=this.tileRepresentationCache;for(;v.canExpireCache();)v.pop().dispose();const y=function(R,x){s.updateCacheSize(.1,x.viewState.projection),s.expireCache(x.viewState.projection,bm)};return t.postRenderFunctions.push(y),this.postRender(e,t),p}findAltTiles_(t,e,n,r){const s=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=Xo(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!th(r,g.tile)&&(eh(r,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const G={...Cm,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Lr={TEXTURE_COORD:"a_textureCoord"},Sm=[{name:Lr.TEXTURE_COORD,size:2,type:xi.FLOAT}];class Lm extends Pm{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new Yc(Oa,Da),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new pm(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,r,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Sm);let g=0;for(;g<t.textures.length;){const R=`${G.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,R),++g}for(let R=0;R<this.paletteTextures_.length;++R){const x=this.paletteTextures_[R],T=x.getTexture(d);this.helper.bindTexture(T,g,x.name),++g}const f=n.viewState,_=o[0]+2*c,m=o[1]+2*c,E=t.tile.tileCoord,p=E[1],v=E[2];this.helper.setUniformMatrixValue(G.TILE_TRANSFORM,tu(this.tempMat4,e)),this.helper.setUniformFloatValue(G.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(G.DEPTH,h);let y=r;c>0&&(y=l,Wt(y,r,y)),this.helper.setUniformFloatVec4(G.RENDER_EXTENT,y),this.helper.setUniformFloatValue(G.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(G.ZOOM,f.zoom),this.helper.setUniformFloatValue(G.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(G.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(G.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(G.TEXTURE_ORIGIN_X,a[0]+p*o[0]*s-c*s),this.helper.setUniformFloatValue(G.TEXTURE_ORIGIN_Y,a[1]-v*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=zt(e.pixelToCoordinateTransform,t.slice()),s=e.viewState,o=n.getExtent();if(o&&!Li(Ke(o,s.projection),r))return null;const a=n.getSources(Po([r]),s.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(s.projection),h.getWrapX())break;const d=c.getExtent();if(!d||Li(d,r))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let d=c.getZForResolution(s.resolution);d>=c.getMinZoom();--d){const g=c.getTileCoordForCoordAndZ(r,d),f=Xo(h,g);if(!u.containsKey(f))continue;const _=u.get(f),m=_.tile;if((m instanceof ws||m instanceof Wc)&&m.getState()===P.EMPTY)return null;if(!_.loaded)continue;const E=c.getOrigin(d),p=ie(c.getTileSize(d)),v=c.getResolution(d),y=(r[0]-E[0])/v-g[1]*p[0],R=(E[1]-r[1])/v-g[2]*p[1];return _.getPixelData(y,R)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}let hi=0;const vn=0,_t=1<<hi++,A=1<<hi++,re=1<<hi++,Pt=1<<hi++,ei=1<<hi++,Nt=Math.pow(2,hi)-1,nu={[_t]:"boolean",[A]:"number",[re]:"string",[Pt]:"color",[ei]:"number[]"},Am=Object.keys(nu).map(Number).sort(la);function bt(i){const t=[];for(const e of Am)Mm(i,e)&&t.push(nu[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Mm(i,t){return(i&t)===t}function ue(i,t){return!!(i&t)}function Yi(i,t){return i===t}class un{constructor(t,e){this.type=t,this.value=e}}class iu{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Om(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function Dm(i){switch(i){case"string":return re;case"color":return Pt;case"number":return A;case"boolean":return _t;case"number[]":return ei;default:throw new Error(`Unrecognized type hint: ${i}`)}}function Q(i,t,e){switch(typeof i){case"boolean":return new un(_t,i);case"number":return new un(A,i);case"string":{let r=re;return Yf(i)&&(r|=Pt),Yi(r&e,vn)||(r&=e),new un(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return Km(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=ei;return(i.length===3||i.length===4)&&(n|=Pt),e&&(n&=e),new un(n,i)}const b={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},Nm={[b.Get]:F(([i,t])=>t!==void 0?Dm(t.value):Nt,k(1,2),Fm),[b.Var]:F(([i])=>i.type,k(1,1),Um),[b.Id]:F(A|re,Ei,Gm),[b.Concat]:F(re,k(2,1/0),W(Nt)),[b.GeometryType]:F(re,Ei),[b.Resolution]:F(A,Ei),[b.Zoom]:F(A,Ei),[b.Time]:F(A,Ei),[b.Any]:F(_t,k(2,1/0),W(_t)),[b.All]:F(_t,k(2,1/0),W(_t)),[b.Not]:F(_t,k(1,1),W(_t)),[b.Equal]:F(_t,k(2,2),W(Nt),rn),[b.NotEqual]:F(_t,k(2,2),W(Nt),rn),[b.GreaterThan]:F(_t,k(2,2),W(Nt),rn),[b.GreaterThanOrEqualTo]:F(_t,k(2,2),W(Nt),rn),[b.LessThan]:F(_t,k(2,2),W(Nt),rn),[b.LessThanOrEqualTo]:F(_t,k(2,2),W(Nt),rn),[b.Multiply]:F(i=>{let t=A|Pt;for(let e=0;e<i.length;e++)t&=i[e].type;return t},k(2,1/0),W(A|Pt),rn),[b.Divide]:F(A,k(2,2),W(A)),[b.Add]:F(A,k(2,1/0),W(A)),[b.Subtract]:F(A,k(2,2),W(A)),[b.Clamp]:F(A,k(3,3),W(A)),[b.Mod]:F(A,k(2,2),W(A)),[b.Pow]:F(A,k(2,2),W(A)),[b.Abs]:F(A,k(1,1),W(A)),[b.Floor]:F(A,k(1,1),W(A)),[b.Ceil]:F(A,k(1,1),W(A)),[b.Round]:F(A,k(1,1),W(A)),[b.Sin]:F(A,k(1,1),W(A)),[b.Cos]:F(A,k(1,1),W(A)),[b.Atan]:F(A,k(1,2),W(A)),[b.Sqrt]:F(A,k(1,1),W(A)),[b.Match]:F(i=>{let t=Nt;for(let e=2;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},k(4,1/0),nh,km),[b.Between]:F(_t,k(3,3),W(A)),[b.Interpolate]:F(i=>{let t=Pt|A;for(let e=3;e<i.length;e+=2)t&=i[e].type;return t},k(6,1/0),nh,Xm),[b.Case]:F(i=>{let t=Nt;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},k(3,1/0),jm,zm),[b.In]:F(_t,k(2,2),$m),[b.Number]:F(A,k(1,1/0),W(Nt)),[b.String]:F(re,k(1,1/0),W(Nt)),[b.Array]:F(i=>i.length===3||i.length===4?ei|Pt:ei,k(1,1/0),W(A)),[b.Color]:F(Pt,k(3,4),W(A)),[b.Band]:F(A,k(1,3),W(A)),[b.Palette]:F(Pt,k(2,2),Bm)};function Fm(i,t){const e=Q(i[1],t);if(!(e instanceof un))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),i.length===3){const n=Q(i[2],t);return[e,n]}return[e]}function Um(i,t,e,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new un(Nt,r)];const s=t.style.variables[r],o=Q(s,t);if(o.value=r,n&&!ue(n,o.type))throw new Error(`The variable ${r} has type ${bt(o.type)} but the following type was expected: ${bt(n)}`);return[o]}function Gm(i,t){t.featureId=!0}function Ei(i,t){const e=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function k(i,t){return function(e,n){const r=e[0],s=e.length-1;if(i===t){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>t){const o=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function W(i){return function(t,e){const n=t[0],r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=Q(t[o+1],e);if(!ue(i,a.type)){const l=bt(i),h=bt(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function rn(i,t,e){const n=i[0],r=i.length-1;let s=Nt;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===vn)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=Q(i[a+1],t,s);return o}function jm(i,t){const e=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function nh(i,t){const e=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function km(i,t,e,n){const r=i.length-1;let s=Q(i[1],t).type;const o=Q(i[i.length-1],t);let a=n!==void 0?n&o.type:o.type;const l=new Array(r-2);for(let c=0;c<r-2;c+=2){const u=Q(i[c+2],t),d=Q(i[c+3],t);s&=u.type,a&=d.type,l[c]=u,l[c+1]=d}const h=re|A|_t;if(!ue(h,s))throw new Error(`Expected an input of type ${bt(h)} for the interpolate operation, got ${bt(s)} instead`);if(Yi(a,vn))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let c=0;c<r-2;c+=2){const u=Q(i[c+2],t,s),d=Q(i[c+3],t,a);l[c]=u,l[c+1]=d}return[Q(i[1],t,s),...l,Q(i[i.length-1],t,a)]}function Xm(i,t,e,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=Q(s,t);let o=Q(i[2],t);if(!ue(A,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${bt(o.type)} instead`);o=Q(i[2],t,A);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=Q(i[l+3],t);if(!ue(A,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${bt(h.type)} at position ${l+2} instead`);let c=Q(i[l+4],t);if(!ue(A|Pt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${bt(c.type)} at position ${l+3} instead`);h=Q(i[l+3],t,A),c=Q(i[l+4],t,A|Pt),a[l]=h,a[l+1]=c}return[s,o,...a]}function zm(i,t,e,n){const r=Q(i[i.length-1],t);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=Q(i[a+1],t),h=Q(i[a+2],t);if(!ue(_t,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${bt(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(Yi(s,vn))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=Q(i[a+2],t,s);return o[o.length-1]=Q(i[i.length-1],t,s),o}function $m(i,t){let e=i[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=re|A;const r=new Array(e.length);for(let s=0;s<r.length;s++){const o=Q(e[s],t);n&=o.type,r[s]=o}if(Yi(n,vn))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[Q(i[1],t,n),...r]}function Bm(i,t){const e=Q(i[1],t,A);if(e.type!==A)throw new Error(`The first argument of palette must be an number, got ${bt(e.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=Q(n[s],t,Pt);if(!(o instanceof un))throw new Error(`The palette color at index ${s} must be a literal value`);if(!ue(o.type,Pt))throw new Error(`The palette color at index ${s} should be of type color, got ${bt(o.type)} instead`);r[s]=o}return[e,...r]}function F(i,...t){return function(e,n,r){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!ue(a,r))throw new Error(`The following expression was expected to return ${bt(r)}, but returns ${bt(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===vn)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new iu(a,s,...o)}}function Km(i,t,e){const n=i[0],r=Nm[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,t,e)}class Zm{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}function Vm(i,t){return`operator_${i}_${Object.keys(t.functions).length}`}function Ss(i){const t=i.toString();return t.includes(".")?t:t+".0"}function ru(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Ss).join(", ")})`}function Wm(i){const t=Hr(i),e=t.length>3?t[3]:1;return ru([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const oo={};let Hm=0;function su(i){return i in oo||(oo[i]=Hm++),oo[i]}function Ym(i){return Ss(su(i))}function ou(i){return"u_var_"+i}function qm(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const ao="getBandValue",au="u_paletteTextures";function Qm(i,t,e,n){const r=Q(i,e,t);if(Yi(r.type,vn))throw new Error("No matching type was found");if(!ue(t,r.type)){const s=bt(t),o=bt(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Fa(r,t,n)}function $(i){return(t,e,n)=>{const r=e.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=Fa(e.args[o],n,t);return i(s,t)}}const Jm={[b.Get]:(i,t)=>{const e=t.args[0].value;return e in i.properties||(i.properties[e]={name:e,type:t.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+e},[b.GeometryType]:(i,t,e)=>{const n="geometryType",r=s=>{const o=s.getType();switch(o){case"Point":case"LineString":case"Polygon":return o;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return o.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(s.getGeometries()[0])}};return n in i.properties||(i.properties[n]={name:n,type:re,evaluator:s=>r(s.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[b.Var]:(i,t)=>{const e=t.args[0].value;return e in i.variables||(i.variables[e]={name:e,type:t.type}),ou(e)},[b.Resolution]:()=>"u_resolution",[b.Zoom]:()=>"u_zoom",[b.Time]:()=>"u_time",[b.Any]:$(i=>`(${i.join(" || ")})`),[b.All]:$(i=>`(${i.join(" && ")})`),[b.Not]:$(([i])=>`(!${i})`),[b.Equal]:$(([i,t])=>`(${i} == ${t})`),[b.NotEqual]:$(([i,t])=>`(${i} != ${t})`),[b.GreaterThan]:$(([i,t])=>`(${i} > ${t})`),[b.GreaterThanOrEqualTo]:$(([i,t])=>`(${i} >= ${t})`),[b.LessThan]:$(([i,t])=>`(${i} < ${t})`),[b.LessThanOrEqualTo]:$(([i,t])=>`(${i} <= ${t})`),[b.Multiply]:$(i=>`(${i.join(" * ")})`),[b.Divide]:$(([i,t])=>`(${i} / ${t})`),[b.Add]:$(i=>`(${i.join(" + ")})`),[b.Subtract]:$(([i,t])=>`(${i} - ${t})`),[b.Clamp]:$(([i,t,e])=>`clamp(${i}, ${t}, ${e})`),[b.Mod]:$(([i,t])=>`mod(${i}, ${t})`),[b.Pow]:$(([i,t])=>`pow(${i}, ${t})`),[b.Abs]:$(([i])=>`abs(${i})`),[b.Floor]:$(([i])=>`floor(${i})`),[b.Ceil]:$(([i])=>`ceil(${i})`),[b.Round]:$(([i])=>`floor(${i} + 0.5)`),[b.Sin]:$(([i])=>`sin(${i})`),[b.Cos]:$(([i])=>`cos(${i})`),[b.Atan]:$(([i,t])=>t!==void 0?`atan(${i}, ${t})`:`atan(${i})`),[b.Sqrt]:$(([i])=>`sqrt(${i})`),[b.Match]:$(i=>{const t=i[0],e=i[i.length-1];let n=null;for(let r=i.length-3;r>=1;r-=2){const s=i[r],o=i[r+1];n=`(${t} == ${s} ? ${o} : ${n||e})`}return n}),[b.Between]:$(([i,t,e])=>`(${i} >= ${t} && ${i} <= ${e})`),[b.Interpolate]:$(([i,t,...e])=>{let n="";for(let r=0;r<e.length-2;r+=2){const s=e[r],o=n||e[r+1],a=e[r+2],l=e[r+3];let h;i===Ss(1)?h=`(${t} - ${s}) / (${a} - ${s})`:h=`(pow(${i}, (${t} - ${s})) - 1.0) / (pow(${i}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[b.Case]:$(i=>{const t=i[i.length-1];let e=null;for(let n=i.length-3;n>=0;n-=2){const r=i[n],s=i[n+1];e=`(${r} ? ${s} : ${e||t})`}return e}),[b.In]:$(([i,...t],e)=>{const n=Vm("in",e),r=[];for(let s=0;s<t.length;s+=1)r.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${i})`}),[b.Array]:$(i=>`vec${i.length}(${i.join(", ")})`),[b.Color]:$(i=>{const t=i.slice(0,3).map(e=>`${e} / 255.0`);return i.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${i[3]} * vec4(${t.join(", ")}, 1.0))`}),[b.Band]:$(([i,t,e],n)=>{if(!(ao in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${G.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[ao]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${G.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${G.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${ao}(${i}, ${t??"0.0"}, ${e??"0.0"})`}),[b.Palette]:(i,t)=>{const[e,...n]=t.args,r=n.length,s=new Uint8Array(r*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Hr(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${au}[${i.paletteTextures.length}]`,a=new Zm(o,s);i.paletteTextures.push(a);const l=Fa(e,A,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function Fa(i,t,e){if(i instanceof iu){const n=Jm[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(e,i,t)}if((i.type&A)>0)return Ss(i.value);if((i.type&_t)>0)return i.value.toString();if((i.type&re)>0)return Ym(i.value.toString());if((i.type&Pt)>0)return Wm(i.value);if((i.type&ei)>0)return ru(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${bt(t)})`)}function Sn(i,t,e){const n=Om();return n.style=i.style,Qm(t,e,n,i)}function ih(i,t){const e=`
    attribute vec2 ${Lr.TEXTURE_COORD};
    uniform mat4 ${G.TILE_TRANSFORM};
    uniform float ${G.TEXTURE_PIXEL_WIDTH};
    uniform float ${G.TEXTURE_PIXEL_HEIGHT};
    uniform float ${G.TEXTURE_RESOLUTION};
    uniform float ${G.TEXTURE_ORIGIN_X};
    uniform float ${G.TEXTURE_ORIGIN_Y};
    uniform float ${G.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Lr.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${G.TEXTURE_ORIGIN_X} + ${G.TEXTURE_RESOLUTION} * ${G.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${G.TEXTURE_ORIGIN_Y} - ${G.TEXTURE_RESOLUTION} * ${G.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${G.TILE_TRANSFORM} * vec4(${Lr.TEXTURE_COORD}, ${G.DEPTH}, 1.0);
    }
  `,n={...qm(),inFragmentShader:!0,bandCount:t,style:i},r=[];if(i.color!==void 0){const u=Sn(n,i.color,Pt);r.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Sn(n,i.contrast,A);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Sn(n,i.exposure,A);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Sn(n,i.saturation,A);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Sn(n,i.gamma,A);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Sn(n,i.brightness,A);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=ou(d.name);s[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=su(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${G.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${au}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${G.RENDER_EXTENT};
    uniform float ${G.TRANSITION_ALPHA};
    uniform float ${G.TEXTURE_PIXEL_WIDTH};
    uniform float ${G.TEXTURE_PIXEL_HEIGHT};
    uniform float ${G.RESOLUTION};
    uniform float ${G.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${G.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${G.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${G.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${G.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${G.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${G.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class zo extends rm{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(Y.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=ih(this.style_,this.getSourceBandCount_());return new Lm(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let r;for(let s=0,o=e.length;s<o;++s)this.renderedSource_=e[s],n.prepareFrame(t)&&(r=n.renderFrame(t));return r}render(t,e){this.rendered=!0;const n=t.viewState,r=this.getSources(t.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(t,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=ih(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}zo.prototype.dispose;class tp extends Is{constructor(t){t=t||{},super(t)}}let kn=null;function ep(){kn=fe(1,1,void 0,{willReadFrequently:!0})}class np extends Qc{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=ce(),this.pixelTransform=ce(),this.inversePixelTransform=ce(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){kn||ep(),kn.clearRect(0,0,1,1);let r;try{kn.drawImage(t,e,n,1,1,0,0,1,1),r=kn.getImageData(0,0,1,1).data}catch{return kn=null,null}return r}getBackground(t){let e=this.getLayer().getBackground();return typeof e=="function"&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,n){const r=this.getLayer().getClassName();let s,o;if(t&&t.className===r&&(!n||t&&t.style.backgroundColor&&ps(Hr(t.style.backgroundColor),Hr(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=fe();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const r=oi(n),s=xs(n),o=Rs(n),a=vs(n);zt(e.coordinateToPixelTransform,r),zt(e.coordinateToPixelTransform,s),zt(e.coordinateToPixelTransform,o),zt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;zt(l,r),zt(l,s),zt(l,o),zt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){const s=new bi(t,this.inversePixelTransform,n,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(jt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(jt.POSTRENDER,t,e)}getRenderTransform(t,e,n,r,s,o,a){const l=s/2,h=o/2,c=r/e,u=-c,d=-t[0]+a,g=-t[1];return mn(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class ip extends np{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,r=t.viewState,s=r.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=Wt(l,Ke(e.extent,r.projection))),!a[Ut.ANIMATING]&&!a[Ut.INTERACTING]&&!Tn(l))if(o){const h=r.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===rt.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=zt(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!Li(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=ut(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=Ot(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),_=c*a/(g*l),m=t.extent,E=u.resolution,p=u.rotation,v=Math.round(ut(m)/E*c),y=Math.round(Ot(m)/E*c);mn(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,p,-v/2,-y/2),Sc(this.inversePixelTransform,this.pixelTransform);const R=$f(this.pixelTransform);this.useContainer(e,R,this.getBackground(t));const x=this.context,T=x.canvas;T.width!=v||T.height!=y?(T.width=v,T.height=y):this.containerReused||x.clearRect(0,0,v,y);let w=!1,C=!0;if(h.extent){const z=Ke(h.extent,u.projection);C=Bi(z,t.extent),w=C&&!kr(z,t.extent),w&&this.clipUnrotated(x,t,z)}const L=n.getImage(),O=mn(this.tempTransform,v/2,y/2,f,_,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const lt=L.width*O[0],tt=L.height*O[3];if(this.getLayer().getSource().getInterpolate()||(x.imageSmoothingEnabled=!1),this.preRender(x,t),C&&lt>=.5&&tt>=.5){const z=O[4],V=O[5],it=h.opacity;let Xt;it!==1&&(Xt=x.globalAlpha,x.globalAlpha=it),x.drawImage(L,0,0,+L.width,+L.height,z,V,lt,tt),it!==1&&(x.globalAlpha=Xt)}return this.postRender(x,t),w&&x.restore(),x.imageSmoothingEnabled=!0,R!==T.style.transform&&(T.style.transform=R),this.container}}class rp extends tp{constructor(t){super(t)}createRenderer(){return new ip(this)}getData(t){return super.getData(t)}}const rh=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],sh={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class lu extends Vi{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const e=t.label!==void 0?t.label:"";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;const n=t.labelActive!==void 0?t.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const r=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(D.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${ai} ${Ps}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(oh(e))if(ah(e))op(e);else{let n;this.source_?n=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?sp(n):hu(n)}}handleFullScreenChange_(){const t=this.getMap();if(!t)return;const e=this.isInFullscreen_;this.isInFullscreen_=ah(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Gr(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(sh.ENTERFULLSCREEN)):(Gr(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(sh.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){const e=this.getMap();e&&e.removeChangeListener(Tt.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(Tt.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const t=this.documentListeners_;for(let n=0,r=t.length;n<r;++n)ot(t[n]);t.length=0;const e=this.getMap();if(e){const n=e.getOwnerDocument();oh(n)?this.element.classList.remove(Kl):this.element.classList.add(Kl);for(let r=0,s=rh.length;r<s;++r)t.push(K(n,rh[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function oh(i){const t=i.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&i.fullscreenEnabled)}function ah(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function hu(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function sp(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():hu(i)}function op(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}const lo="units",ap=[1,2,5],yi=25.4/.28;class cu extends Vi{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const n=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+ai,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(lo,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(lo)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(lo,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=t.center,n=t.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=Kr(n,t.resolution,e,s);const a=this.minWidth_*(this.dpi_||yi)/yi,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||yi)/yi:void 0;let h=a*o,c="";if(r=="degrees"){const v=ti.degrees;h*=v,h<v/60?(c="",o*=3600):h<v?(c="",o*=60):c=""}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,g,f,_,m,E;for(;;){f=Math.floor(u/3);const v=Math.pow(10,f);if(d=ap[(u%3+3)%3]*v,g=Math.round(d/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=_,g=m,f=E;break}else if(g>=a)break;_=d,m=g,E=f,++u}const p=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,n){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const c=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${c}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,t,!1,e,n):"")+"</div>")}return l.push(this.createStepText(o,t,!0,e,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+s+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,n,r,s){const o=(t===0?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+s),a=t===0?-3:e/this.scaleBarSteps_*-1,l=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${a}px;text-align: ${t===0?"left":"center"};min-width: ${l}px;left: ${n?e+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const t=Kr(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||yi,n=1e3/25.4;return t*n*e}render(t){const e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}}hg(()=>Promise.resolve({}),Ar([0]));const uu=500,lp=!0;function hp(i,t){let e,n,r,s;const o=()=>{const u=t.srid(),d=t.fullExtent();return u==="EPSG:3857"?d:t.transformRectangle(d,u,"EPSG:3857")},a=()=>{i.innerHTML="";const u=o().center();e=new ee({center:[u.x,u.y],zoom:10}),s=new Gf(t,{debug:!1,extentBufferFactor:()=>document.getElementById("extentBufferFactor").valueAsNumber}),r=new zo({source:s}),n=new Zc({target:i,view:e,controls:Sa().extend([new cu,new lu]),layers:[r,new zo({visible:lp,source:new bc({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),style:{saturation:["var","saturation"],variables:{saturation:-.75}}})].reverse()}),n.once("precompose",function(d){l()})},l=()=>{const u=o();e.fit([u.xMinimum,u.yMinimum,u.xMaximum,u.yMaximum],{duration:uu}),setTimeout(()=>{h()},0)},h=()=>{s?.clear(),r?.getRenderer()?.clearCache(),r?.changed()},c=document.getElementById("xyzBaseMap");return c&&c.addEventListener("change",()=>{n&&n.getLayers().getArray()[0].setVisible(c.checked)}),a(),{init:a,update:l,render:h}}function cp(i,t){let e,n,r,s,o;const a=()=>{i.innerHTML="",n=t.srid();const c=new zr({code:n,units:"m"}),u=t.fullExtent().center();e=new ee({projection:c,center:[u.x,u.y],zoom:10}),o=new Ll(t,{projection:c}),s=new rp({source:o}),r=new Zc({target:i,view:e,controls:Sa().extend([new cu,new lu]),layers:[s]}),r.once("precompose",function(d){const g=t.fullExtent();e.fit([g.xMinimum,g.yMinimum,g.xMaximum,g.yMaximum],{duration:uu})})},l=()=>{a()},h=()=>{setTimeout(()=>{o=new Ll(t,{projection:new zr({code:n,units:"m"})}),s?.setSource(o)},0)};return a(),{init:a,update:l,render:h}}function up(i,t){const e=()=>{i.innerHTML="";const n=document.createElement("div");n.className="layers",i.appendChild(n);const r=t.mapLayers();for(const s of r){const o=document.createElement("div");o.className="layer";const a=document.createElement("input");a.type="checkbox",s.visible&&(a.checked=!0),a.addEventListener("change",()=>{s.visible=a.checked,redraw(),e()}),o.appendChild(a);const l=document.createTextNode(s.name);o.appendChild(l);const h=document.createElement("input");s.visible||(h.style.visibility="hidden"),h.type="range",h.min="0",h.max="100",h.value=""+s.opacity*100,h.step="1",h.addEventListener("change",()=>{s.opacity=parseInt(h.value)/100,redraw()}),o.appendChild(h),n.appendChild(o)}if(t.mapThemes().length>0){const s=document.createElement("div");s.className="themes",i.appendChild(s);const o=document.createElement("select");o.addEventListener("change",()=>{o.value&&(t.setMapTheme(o.value),redraw(),e())}),s.appendChild(o);const a=t.getMapTheme(),l=document.createElement("option");l.value="",l.text="",a||(l.selected=!0),o.appendChild(l);for(const h of t.mapThemes()){const c=document.createElement("option");c.value=h,c.text=h,h===a&&(c.selected=!0),o.appendChild(c)}}};return e(),e}const dp=i=>({owner:"boardend",repo:"qgis-js-projects",path:"/"+i,branch:"main",prefix:`${i[0].toUpperCase()}${i.slice(1)}: `}),gp=[dp("demo")];async function fp(){console.log(`qgis-js (${Nd})`);const i=document.getElementById("status"),t=document.getElementById("project");let e=!1;const n=o=>{e||(i.firstElementChild.innerHTML=o)},r=o=>{e=!0,console.error(o);const a=""+o&&o.message?o.message:"Runtime error";t.style.visibility="none",i.style.display="auto",i.innerHTML=`<div class="alert alert-danger" role="alert">
      <b style="color: red">Error:&nbsp;</b>
      ${a}
    </div>`},s=()=>{i.style.display="none",t.style.visibility="visible"};try{const{api:o,fs:a}=await Dd({prefix:"/assets/wasm",onStatus:T=>n(T)});n("Loading projects...");const l=[],h=[],{openProject:c,loadLocalProject:u,loadRemoteProjects:d,loadGithubProjects:g}=sg(a,T=>{o.loadProject(T),setTimeout(()=>{l.forEach(w=>w())},0)}),f=async function(){const T=await u();await c(T),E(T.name,()=>T),m.value=T.name},_=new Map,m=document.getElementById("projects");m.addEventListener("change",()=>{const T=_.get(m.value);T&&c(T())});const E=(T,w)=>{_.set(T,w);const C=document.createElement("option");C.value=T,C.text=T,m.add(C,null)};document.getElementById("local-project").onclick=f;const p=await d();p.forEach(T=>E(T.name,()=>T));for(const T of gp)try{const w=await g(T.owner,T.repo,T.path,T.branch);Object.entries(w).forEach(([C,L])=>{E((T.prefix||"")+C,L)})}catch(w){console.warn(`Unable to load GitHub project "${T.owner}/${T.repo}"`,w)}n("Opening first project..."),await c(p[0]),n("Rendering first frame..."),await o.renderImage(o.srid(),o.fullExtent(),42,42,1),s();const v=document.getElementById("layers-control");v&&l.push(up(v,o,()=>{setTimeout(()=>{h.forEach(T=>T())},0)}));const y=document.getElementById("js-demo-canvas");if(y){const{update:T,render:w}=og(y,o);l.push(T),h.push(w);const C=document.getElementById("tab1");C.addEventListener("change",()=>{C.checked&&T()})}const R=document.getElementById("ol-demo-xyz");if(R){const{update:T,render:w}=hp(R,o);l.push(T),h.push(w)}const x=document.getElementById("ol-demo-canvas");if(x){const{update:T,render:w}=cp(x,o);l.push(T),h.push(w)}}catch(o){r(o)}}document.addEventListener("DOMContentLoaded",function(){fp()});function Ar(i){return Ar.viteFileDeps||(Ar.viteFileDeps=["assets/ol-CSy_vbSQ.css"]),i.map(t=>Ar.viteFileDeps[t])}var _p=Object.defineProperty,mp=(i,t,e)=>t in i?_p(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Ii=(i,t,e)=>(mp(i,typeof t!="symbol"?t+"":t,e),e),du=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)},hn=(i,t,e)=>(du(i,t,"read from private field"),e?e.call(i):t.get(i)),ho=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},Ne=(i,t,e,n)=>(du(i,t,"write to private field"),t.set(i,e),e),lh=(i,t,e,n)=>({set _(r){Ne(i,t,r)},get _(){return hn(i,t,n)}});function pp(){return Math.min(Math.max(navigator?.hardwareConcurrency||4,4),8)}let Ep=class{constructor(t){Ii(this,"value"),Ii(this,"next"),this.value=t}};var Ee,Xn,zn;let yp=class{constructor(){ho(this,Ee,void 0),ho(this,Xn,void 0),ho(this,zn,void 0),this.clear()}enqueue(t){const e=new Ep(t);hn(this,Ee)?(hn(this,Xn).next=e,Ne(this,Xn,e)):(Ne(this,Ee,e),Ne(this,Xn,e)),lh(this,zn)._++}dequeue(){const t=hn(this,Ee);if(t)return Ne(this,Ee,hn(this,Ee).next),lh(this,zn)._--,t.value}clear(){Ne(this,Ee,void 0),Ne(this,Xn,void 0),Ne(this,zn,0)}get size(){return hn(this,zn)}*[Symbol.iterator](){let t=hn(this,Ee);for(;t;)yield t.value,t=t.next}};Ee=new WeakMap,Xn=new WeakMap,zn=new WeakMap;const Tp={bind(i,t,e){return i.bind(e)}};function vp(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new yp;let e=0;const n=()=>{e--,t.size>0&&t.dequeue()()},r=async(a,l,h)=>{e++;const c=(async()=>a(...h))();l(c);try{await c}catch{}n()},s=(a,l,h)=>{t.enqueue(Tp.bind(r.bind(void 0,a,l,h))),(async()=>(await Promise.resolve(),e<i&&t.size>0&&t.dequeue()()))()},o=(a,...l)=>new Promise(h=>{s(a,h,l)});return Object.defineProperties(o,{activeCount:{get:()=>e},pendingCount:{get:()=>t.size},clearQueue:{value(){t.clear()}}}),o}let Rp=class{constructor(t){Ii(this,"_api"),Ii(this,"_threadPoolSize"),Ii(this,"_limit"),this._api=t,this._threadPoolSize=pp(),this._limit=vp(this._threadPoolSize)}runLimited(t){return this._limit(t)}renderImage(t,e,n,r,s=window?.devicePixelRatio||1){return this.runLimited(()=>new Promise(o=>{this._api.renderImage(t,e,n,r,s,a=>{const l=new Uint8ClampedArray(a),h=new ImageData(l,n,r);o(h)})}))}renderXYZTile(t,e,n,r=256,s=window?.devicePixelRatio||1,o=0){return this.runLimited(()=>new Promise(a=>{this._api.renderXYZTile(t,e,n,r,s,o,l=>{const h=new Uint8ClampedArray(l),c=new ImageData(h,r,r);a(c)})}))}mapLayers(){const t=this._api.mapLayers(),e=new Array(t.size());for(let n=0;n<t.size();n++)e[n]=t.get(n);return e}mapThemes(){const t=this._api.mapThemes(),e=new Array(t.size());for(let n=0;n<t.size();n++)e[n]=t.get(n);return e}};function xp(i){const t=new Rp(i);return new Proxy({},{has(e,n){return n in t||n in i},get(e,n){if(n in t)return t[n];if(n in i)return i[n]}})}function wp(i){return new Promise(async(t,e)=>{try{const n=(await new Function(`return import("${i}")`)()).default;t({createQtAppInstance:n})}catch(n){e(n)}})}async function Cp(i={}){return new Promise(async(t,e)=>{let n;if(i.prefix)n=i.prefix;else{const l=import.meta.url;/.*\/src\/loader\.[ts|js]\?*[^/]*$/.test(l)?(console.warn(['qgis-js loader is running in development mode and no "prefix" seems to be configured.'," - Consider adding the QgisRuntimePlugin when bundling with Vite."," - For more information see: https://github.com/qgis/qgis-js/blob/main/docs/bundling.md"].join(`
`)),typeof window<"u"&&(n=new URL("assets/wasm",window.location.href).pathname)):n=new URL("assets/wasm",import.meta.url).href}n?n=n.replace(/\/$/,""):n="assets/wasm";let r;try{const l=`${n}/qgis-js.js`;r=await wp(l)}catch(l){e(new Error("Unable to load the qgis-js.js script",{cause:l}));return}const{createQtAppInstance:s}=r;let o;typeof document<"u"&&(o=document?.querySelector("#screen"));const a=s({locateFile:l=>`${n}/`+l,preRun:[function(l){l.qtContainerElements=o?[o]:[],l.qtFontDpi=96}],postRun:[async function(){const l=await a;t({api:xp(l),module:l,fs:l.FS})}],...i.onStatus?{setStatus:i.onStatus}:{}})})}const bp="0.0.3";var Ip=Object.defineProperty,Pp=(i,t,e)=>t in i?Ip(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Vt=(i,t,e)=>(Pp(i,typeof t!="symbol"?t+"":t,e),e);const pn="/upload/projects";let Ua=class{constructor(t,e){Vt(this,"FS"),Vt(this,"type"),Vt(this,"name"),this.FS=t,this.type=e}isValid(){return this.getFiles().length>0&&this.getProjectFile()!==void 0}getProjectFile(){const t=this.getFiles().filter(e=>e.endsWith(".qgs")||e.endsWith(".qgz"));return t.length==1?t[0]:t.length>1?(console.warn("Found multiple project file candiates"),t[0]):void 0}getDirectoriesToCreate(){const t=new Set;for(const e of this.getDirectories()){let n=e.split("/");for(let r=0;r<n.length;r++){const s=n.slice(0,r+1).join("/");t.add(s)}}return Array.from(t).sort()}ensureDirectories(){for(const t of this.getDirectoriesToCreate()){const e=pn+"/"+t,n=this.FS.analyzePath(e,!1);(!n||!n.exists)&&this.FS.mkdir(e)}}isProjectUploaded(){return this.FS.readdir(pn).includes(this.name)}};const Ga=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();Ga?Promise.resolve().then(function(){return Op}):Promise.resolve().then(function(){return jp});const Sp=Ga?Promise.resolve().then(function(){return Np}):Promise.resolve().then(function(){return Xp});async function Lp(...i){return(await Sp).default(...i)}Ga?Promise.resolve().then(function(){return Up}):Promise.resolve().then(function(){return $p});const Ap=async i=>{const t=await i.getFile();return t.handle=i,t};var Mp=async(i=[{}])=>{Array.isArray(i)||(i=[i]);const t=[];i.forEach((r,s)=>{t[s]={description:r.description||"Files",accept:{}},r.mimeTypes?r.mimeTypes.map(o=>{t[s].accept[o]=r.extensions||[]}):t[s].accept["*/*"]=r.extensions||[]});const e=await window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:t,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await Promise.all(e.map(Ap));return i[0].multiple?n:n[0]},Op={__proto__:null,default:Mp};function Mr(i){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var n=e.done;return Promise.resolve(e.value).then(function(r){return{value:r,done:n}})}return Mr=function(e){this.s=e,this.n=e.next},Mr.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return n===void 0?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return n===void 0?Promise.reject(e):t(n.apply(this.s,arguments))}},new Mr(i)}const gu=async(i,t,e=i.name,n)=>{const r=[],s=[];var o,a=!1,l=!1;try{for(var h,c=function(u){var d,g,f,_=2;for(typeof Symbol<"u"&&(g=Symbol.asyncIterator,f=Symbol.iterator);_--;){if(g&&(d=u[g])!=null)return d.call(u);if(f&&(d=u[f])!=null)return new Mr(d.call(u));g="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());a=!(h=await c.next()).done;a=!1){const u=h.value,d=`${e}/${u.name}`;u.kind==="file"?s.push(u.getFile().then(g=>(g.directoryHandle=i,g.handle=u,Object.defineProperty(g,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):u.kind!=="directory"||!t||n&&n(u)||r.push(gu(u,t,d,n))}}catch(u){l=!0,o=u}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]};var Dp=async(i={})=>{i.recursive=i.recursive||!1,i.mode=i.mode||"read";const t=await window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return(await(await t.values()).next()).done?[t]:gu(t,i.recursive,void 0,i.skipDirectory)},Np={__proto__:null,default:Dp},Fp=async(i,t=[{}],e=null,n=!1,r=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const s=[];let o=null;if(i instanceof Blob&&i.type?o=i.type:i.headers&&i.headers.get("content-type")&&(o=i.headers.get("content-type")),t.forEach((h,c)=>{s[c]={description:h.description||"Files",accept:{}},h.mimeTypes?(c===0&&o&&h.mimeTypes.push(o),h.mimeTypes.map(u=>{s[c].accept[u]=h.extensions||[]})):o?s[c].accept[o]=h.extensions||[]:s[c].accept["*/*"]=h.extensions||[]}),e)try{await e.getFile()}catch(h){if(e=null,n)throw h}const a=e||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:s,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!e&&r&&r(a);const l=await a.createWritable();return"stream"in i?(await i.stream().pipeTo(l),a):"body"in i?(await i.body.pipeTo(l),a):(await l.write(await i),await l.close(),a)},Up={__proto__:null,default:Fp},Gp=async(i=[{}])=>(Array.isArray(i)||(i=[i]),new Promise((t,e)=>{const n=document.createElement("input");n.type="file";const r=[...i.map(l=>l.mimeTypes||[]),...i.map(l=>l.extensions||[])].join();n.multiple=i[0].multiple||!1,n.accept=r||"",n.style.display="none",document.body.append(n);const s=l=>{typeof o=="function"&&o(),t(l)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(e),n),a=()=>{window.removeEventListener("focus",a),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",a)}),n.addEventListener("change",()=>{window.removeEventListener("focus",a),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),jp={__proto__:null,default:Gp},kp=async(i=[{}])=>(Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((t,e)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=o=>{typeof s=="function"&&s(),t(o)},s=i[0].legacySetup&&i[0].legacySetup(r,()=>s(e),n);n.addEventListener("change",()=>{let o=Array.from(n.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!i[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),r(o)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),Xp={__proto__:null,default:kp},zp=async(i,t={})=>{Array.isArray(t)&&(t=t[0]);const e=document.createElement("a");let n=i;"body"in i&&(n=await async function(o,a){const l=o.getReader(),h=new ReadableStream({start:d=>async function g(){return l.read().then(({done:f,value:_})=>{if(!f)return d.enqueue(_),g();d.close()})}()}),c=new Response(h),u=await c.blob();return l.releaseLock(),new Blob([u],{type:a})}(i.body,i.headers.get("content-type"))),e.download=t.fileName||"Untitled",e.href=URL.createObjectURL(await n);const r=()=>{typeof s=="function"&&s()},s=t.legacySetup&&t.legacySetup(r,()=>s(),e);return e.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(e.href),3e4),r()}),e.click(),null},$p={__proto__:null,default:zp};class Bp extends Ua{constructor(t,e){super(t,"Local"),Vt(this,"entries"),this.entries=e;const n=e.map(r=>r.webkitRelativePath).filter(r=>r&&r.length>0&&r.includes("/")).map(r=>r.split("/",1)[0]);if(n.length<1)throw new Error("Could not determine project name");this.name=n[0]}getDirectories(){const t=new Set;t.add(this.name);for(const e of this.entries){const n=e.webkitRelativePath;t.add(n.substring(0,n.lastIndexOf("/")))}return Array.from(t)}getFiles(){return this.entries.map(t=>t.webkitRelativePath)}async uploadProject(){this.ensureDirectories();for(const t of this.entries)this.FS.writeFile(pn+"/"+t.webkitRelativePath,new Uint8Array(await t.arrayBuffer()))}}function ja(i,t){return i.reduce((e,n)=>n.type==="Folder"?e.concat([t+"/"+n.name,...ja(n.entries,t+"/"+n.name)]):e,[])}function ka(i,t){return i.reduce((e,n)=>n.type==="Folder"?e.concat(ka(n.entries,t+"/"+n.name)):e.concat(t+"/"+n.name),[])}class Kp extends Ua{constructor(t,e,n){super(t,"Remote"),Vt(this,"folder"),Vt(this,"path"),Vt(this,"baseUrl"),this.baseUrl=new URL(e),this.folder=n;const r=this.baseUrl.pathname.split("/").pop();this.name=n.name,this.path=n.path.replace(new RegExp(`^${r}/`),"")}getDirectories(){return[this.path,...ja(this.folder.entries,this.path)]}getFiles(){return ka(this.folder.entries,this.path)}async uploadProject(){const t=Object.fromEntries(this.getFiles().map(e=>[e,new Promise((n,r)=>{const s=new URL(`${this.baseUrl.href}/${e}`);fetch(s).then(o=>o.arrayBuffer().then(a=>{n(a)}))})]));await Promise.all([Object.values(t)]),this.ensureDirectories();for(const e of this.getFiles()){const n=new Uint8Array(await t[e]);this.FS.writeFile(pn+"/"+e,n)}}}const fu="main";async function Zp(i,t,e="/",n=fu){const r=`https://api.github.com/repos/${i}/${t}/contents${e}?ref=${n}`;return await(await fetch(r)).json()}async function Vp(i,t,e){const n=`https://api.github.com/repos/${i}/${t}/git/trees/${e}?recursive=1`;return(await(await fetch(n)).json()).tree.filter(r=>r.type==="blob").map(r=>r.path)}function Wp(i,t,e){const n={name:i,path:t,type:"Folder",entries:[]};return e.sort().forEach(r=>{const s=r.split("/");let o=n;for(let a=0;a<s.length-1;a++){const l=s[a],h=o.entries.find(c=>c.name===l);if(h)o=h;else{const c={name:l,path:o.path+"/"+l,type:"Folder",entries:[]};o.entries.push(c),o=c}}o.entries.push({name:s[s.length-1],path:r,type:"File"})}),n}class Hp extends Ua{constructor(t,e,n,r,s=fu){super(t,"Github"),Vt(this,"folder"),Vt(this,"path"),Vt(this,"owner"),Vt(this,"repo"),Vt(this,"branch"),this.folder=e,this.name=e.name,this.path=e.path,this.owner=n,this.repo=r,this.branch=s}getDirectories(){return[this.path,...ja(this.folder.entries,this.path)]}getFiles(){return ka(this.folder.entries,this.path)}async uploadProject(){const t=Object.fromEntries(this.getFiles().map(e=>[e,new Promise(async(n,r)=>{const s=`https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${e}`,o=await fetch(s);n(o.arrayBuffer())})]));await Promise.all([Object.values(t)]),this.ensureDirectories();for(const e of this.getFiles()){const n=new Uint8Array(await t[e]);this.FS.writeFile(pn+"/"+e,n)}}}function Yp(i,t){let e=pn.split("/");for(let s=1;s<e.length;s++)i.mkdir(e.slice(0,s+1).join("/"));const n=async s=>{if(s){if(s instanceof Promise&&(s=await s),!s.isValid())throw new Error(`Project "${s.name}" is not valid`);s.isProjectUploaded()||await s.uploadProject(),r(s)}else return},r=s=>{const o=pn+"/"+s.getProjectFile();t(o)};return{openProject:n,loadLocalProject:()=>new Promise(async(s,o)=>{try{const a=await Lp({recursive:!0,mode:"read"}),l=new Bp(i,a);s(l)}catch(a){o(a)}}),loadRemoteProjects:(s="./projects/directory-listing.json")=>new Promise(async(o,a)=>{try{const l=new URL(s,window.location.href).href.split("/").slice(0,-1).join("/"),h=await(await fetch(s)).json();if(!h.type||h.type!=="Folder"){a(new Error("Remote projects response seems not a folder"));return}o(h.entries.filter(c=>c.type==="Folder").map(c=>new Kp(i,l,c)))}catch(l){a(l)}}),loadGithubProjects:(s,o,a="/",l="main")=>new Promise(async(h,c)=>{try{const u=await Zp(s,o,a,l);if(u instanceof Array)h(Object.fromEntries(u.filter(d=>d.type==="dir").map(d=>[d.name,()=>new Promise(async g=>{const f=await Vp(s,o,d.sha);g(new Hp(i,Wp(d.name,d.path,f),s,o,l))})])));else{console.warn(u),h({});return}}catch(u){c(u)}})}}const hh=1.5,pr=.1;function qp(i,t){let e=null;new ResizeObserver(o=>{const a=o.find(l=>l.target===i);a&&(i.width=a.devicePixelContentBoxSize[0].inlineSize,i.height=a.devicePixelContentBoxSize[0].blockSize),r()}).observe(i,{box:"device-pixel-content-box"});async function r(){var o=window.devicePixelRatio||1,a=i.getBoundingClientRect();const l=a.width*o,h=a.height*o;if(l&&h){const c=await t.renderImage(t.srid(),e,l,h,window.devicePixelRatio),u=i.getContext("2d");i.width=l,i.height=h,u.scale(o,o),u.putImageData(c,0,0)}}document.getElementById("zoomin").onclick=function(){e.scale(1/hh),r()},document.getElementById("zoomout").onclick=function(){e.scale(hh),r()},document.getElementById("panleft").onclick=function(){e.move((e.xMaximum-e.xMinimum)*pr,0),r()},document.getElementById("panright").onclick=function(){e.move(-(e.xMaximum-e.xMinimum)*pr,0),r()},document.getElementById("panup").onclick=function(){e.move(0,-(e.yMaximum-e.yMinimum)*pr),r()},document.getElementById("pandown").onclick=function(){e.move(0,(e.yMaximum-e.yMinimum)*pr),r()};function s(){e=t.fullExtent(),r()}return s(),{update:()=>{s()},render:()=>{r()}}}const Qp="modulepreload",Jp=function(i){return"/"+i},ch={},t0=function(t,e,n){let r=Promise.resolve();return e&&e.length>0&&(document.getElementsByTagName("link"),r=Promise.all(e.map(s=>{if(s=Jp(s),s in ch)return;ch[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":Qp,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((h,c)=>{l.addEventListener("load",h),l.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})}))),r.then(()=>t()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},N={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Ls{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}class be{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function Xa(i,t){return i>t?1:i<t?-1:0}function e0(i,t){return i<t?1:i>t?-1:0}function As(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===t)return r;if(s<t)return e(t,i[r-1],s)>0?r-1:r}return n-1}if(e>0){for(let r=1;r<n;++r)if(i[r]<t)return r-1;return n-1}if(e<0){for(let r=1;r<n;++r)if(i[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==t)return r;if(i[r]<t)return i[r-1]-t<t-i[r]?r-1:r}return n-1}function n0(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)i[i.length]=e[r]}function Ms(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function i0(i,t,e){const n=t||Xa;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||o===0)})}function Qr(){return!0}function Os(){return!1}function Jr(){}function r0(i){let t=!1,e,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==r||!Ms(s,n))&&(t=!0,r=this,n=s,e=i.apply(this,arguments)),e}}function s0(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function qi(i){for(const t in i)delete i[t]}function o0(i){let t;for(t in i)return!1;return!t}class Qi extends Ls{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=e?new be(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,Jr);delete o[n]}return l}disposeInternal(){this.listeners_&&qi(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Jr,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}const S={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ct(){throw new Error("Unimplemented abstract method.")}let a0=0;function Ct(i){return i.ol_uid||(i.ol_uid=String(++a0))}function _u(i){return Math.pow(i,3)}function ci(i){return 1-_u(1-i)}function l0(i){return 3*i*i-2*i*i*i}function h0(i){return i}class za extends Qi{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(N.CHANGE)}release(){this.state===S.ERROR&&this.setState(S.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==S.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==S.LOADED){t.interimTile=null;break}t.getState()==S.LOADING?e=t:t.getState()==S.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==S.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ct()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const r=e-n+1e3/60;return r>=this.transition_?1:_u(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const qe=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",c0=qe.includes("firefox"),u0=qe.includes("safari")&&!qe.includes("chrom"),d0=u0&&(qe.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(qe)),g0=qe.includes("webkit")&&!qe.includes("edge"),mu=qe.includes("macintosh"),pu=typeof devicePixelRatio<"u"?devicePixelRatio:1,Eu=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,f0=typeof Image<"u"&&Image.prototype.decode,yu=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();function _e(i,t,e,n){let r;return e&&e.length?r=e.shift():Eu?r=new OffscreenCanvas(i||300,t||300):r=document.createElement("canvas"),i&&(r.width=i),t&&(r.height=t),r.getContext("2d",n)}function Ni(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function ts(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function $o(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function _0(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function m0(i,t){const e=i.childNodes;for(let n=0;;++n){const r=e[n],s=t[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}const st={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Z(i,t,e,n,r){if(n&&n!==i&&(e=e.bind(n)),r){const o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function es(i,t,e,n){return Z(i,t,e,n,!0)}function at(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),qi(i))}class p0 extends Qi{constructor(t,e,n,r){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof r=="function"?st.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(N.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==st.IDLE&&this.loader){this.state=st.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;s0(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=st.LOADED}).catch(n=>{this.state=st.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function E0(i,t,e){const n=i;let r=!0,s=!1,o=!1;const a=[es(n,N.LOAD,function(){o=!0,s||t()})];return n.src&&f0?(s=!0,n.decode().then(function(){r&&t()}).catch(function(l){r&&(o?t():e())})):a.push(es(n,N.ERROR,e)),function(){r=!1,a.forEach(at)}}const Tu=p0;class Ds extends za{constructor(t,e,n,r,s,o){super(t,e,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=S.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=S.ERROR,this.unlistenImage_(),this.image_=y0(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=S.LOADED:this.state=S.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==S.ERROR&&(this.state=S.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==S.IDLE&&(this.state=S.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=E0(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function y0(){const i=_e(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const $a=.5,xt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Bo(i){const t=ui();for(let e=0,n=i.length;e<n;++e)Or(t,i[e]);return t}function T0(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function vu(i,t,e){let n,r;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?r=i[1]-e:i[3]<e?r=e-i[3]:r=0,n*n+r*r}function Fi(i,t){return Ru(i,t[0],t[1])}function ns(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Ru(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function uh(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=t[0],a=t[1];let l=xt.UNKNOWN;return o<e?l=l|xt.LEFT:o>r&&(l=l|xt.RIGHT),a<n?l=l|xt.BELOW:a>s&&(l=l|xt.ABOVE),l===xt.UNKNOWN&&(l=xt.INTERSECTING),l}function ui(){return[1/0,1/0,-1/0,-1/0]}function Ji(i,t,e,n,r){return r?(r[0]=i,r[1]=t,r[2]=e,r[3]=n,r):[i,t,e,n]}function Ns(i){return Ji(1/0,1/0,-1/0,-1/0,i)}function v0(i,t){const e=i[0],n=i[1];return Ji(e,n,e,n,t)}function R0(i,t,e,n,r){const s=Ns(r);return xu(s,i,t,e,n)}function Ko(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function x0(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function Or(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function xu(i,t,e,n,r){for(;e<n;e+=r)w0(i,t[e],t[e+1]);return i}function w0(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function wu(i,t){let e;return e=t(Fs(i)),e||(e=t(Us(i)),e)||(e=t(Gs(i)),e)||(e=t(di(i)),e)?e:!1}function Ui(i){let t=0;return Rn(i)||(t=dt(i)*Dt(i)),t}function Fs(i){return[i[0],i[1]]}function Us(i){return[i[2],i[1]]}function En(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function C0(i,t){let e;if(t==="bottom-left")e=Fs(i);else if(t==="bottom-right")e=Us(i);else if(t==="top-left")e=di(i);else if(t==="top-right")e=Gs(i);else throw new Error("Invalid corner");return e}function is(i,t,e,n,r){const[s,o,a,l,h,c,u,d]=b0(i,t,e,n);return Ji(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function b0(i,t,e,n){const r=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=r*o,h=r*a,c=s*o,u=s*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function Dt(i){return i[3]-i[1]}function Ht(i,t,e){const n=e||ui();return tr(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):Ns(n),n}function di(i){return[i[0],i[3]]}function Gs(i){return[i[2],i[3]]}function dt(i){return i[2]-i[0]}function tr(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Rn(i){return i[2]<i[0]||i[3]<i[1]}function I0(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function P0(i,t,e){let n=!1;const r=uh(i,t),s=uh(i,e);if(r===xt.INTERSECTING||s===xt.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=t[0],u=t[1],d=e[0],g=e[1],f=(g-u)/(d-c);let _,m;s&xt.ABOVE&&!(r&xt.ABOVE)&&(_=d-(g-h)/f,n=_>=o&&_<=l),!n&&s&xt.RIGHT&&!(r&xt.RIGHT)&&(m=g-(d-l)*f,n=m>=a&&m<=h),!n&&s&xt.BELOW&&!(r&xt.BELOW)&&(_=d-(g-a)/f,n=_>=o&&_<=l),!n&&s&xt.LEFT&&!(r&xt.LEFT)&&(m=g-(d-o)*f,n=m>=a&&m<=h)}return n}const ni={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class rs{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ni[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const er=6378137,Vn=Math.PI*er,S0=[-Vn,-Vn,Vn,Vn],L0=[-180,-85,180,85],Er=er*Math.log(Math.tan(Math.PI/2));class Ln extends rs{constructor(t){super({code:t,units:"m",extent:S0,global:!0,worldExtent:L0,getPointResolution:function(e,n){return e/Math.cosh(n[1]/er)}})}}const dh=[new Ln("EPSG:3857"),new Ln("EPSG:102100"),new Ln("EPSG:102113"),new Ln("EPSG:900913"),new Ln("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ln("http://www.opengis.net/gml/srs/epsg.xml#3857")];function A0(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e){t[r]=Vn*i[r]/180;let s=er*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>Er?s=Er:s<-Er&&(s=-Er),t[r+1]=s}return t}function M0(i,t,e){const n=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(n));for(let r=0;r<n;r+=e)t[r]=180*i[r]/Vn,t[r+1]=360*Math.atan(Math.exp(i[r+1]/er))/Math.PI-90;return t}const O0=6378137,gh=[-180,-90,180,90],D0=Math.PI*O0/180;class sn extends rs{constructor(t,e){super({code:t,units:"degrees",extent:gh,axisOrientation:e,global:!0,metersPerUnit:D0,worldExtent:gh})}}const fh=[new sn("CRS:84"),new sn("EPSG:4326","neu"),new sn("urn:ogc:def:crs:OGC:1.3:CRS84"),new sn("urn:ogc:def:crs:OGC:2:84"),new sn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new sn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new sn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Zo={};function N0(i){return Zo[i]||Zo[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function F0(i,t){Zo[i]=t}let qn={};function ss(i,t,e){const n=i.getCode(),r=t.getCode();n in qn||(qn[n]={}),qn[n][r]=e}function U0(i,t){let e;return i in qn&&t in qn[i]&&(e=qn[i][t]),e}function Et(i,t,e){return Math.min(Math.max(i,t),e)}function G0(i,t,e,n,r,s){const o=r-e,a=s-n;if(o!==0||a!==0){const l=((i-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=r,n=s):l>0&&(e+=o*l,n+=a*l)}return Qn(i,t,e,n)}function Qn(i,t,e,n){const r=e-i,s=n-t;return r*r+s*s}function j0(i){const t=i.length;for(let n=0;n<t;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<t;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<t+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let r=n-1;r>=0;r--)i[r][t]-=i[r][n]*e[n]}return e}function Dr(i){return i*Math.PI/180}function Jn(i,t){const e=i%t;return e*t<0?e+t:e}function k0(i,t,e){return i+e*(t-i)}function Cu(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function yr(i,t){return Math.floor(Cu(i,t))}function Ze(i,t){return Math.ceil(Cu(i,t))}function X0(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function os(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function Ba(i,t){const e=Math.cos(t),n=Math.sin(t),r=i[0]*e-i[1]*n,s=i[1]*e+i[0]*n;return i[0]=r,i[1]=s,i}function z0(i,t){return i[0]*=t,i[1]*=t,i}function $0(i,t){if(t.canWrapX()){const e=dt(t.getExtent()),n=B0(i,t,e);n&&(i[0]-=n*e)}return i}function B0(i,t,e){const n=t.getExtent();let r=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||dt(n),r=Math.floor((i[0]-n[0])/e)),r}const K0=63710088e-1;function _h(i,t,e){e=e||K0;const n=Dr(i[1]),r=Dr(t[1]),s=(r-n)/2,o=Dr(t[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function bu(...i){console.warn(...i)}let Vo=!0;function Z0(i){Vo=!1}function Ka(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Iu(i,t){if(t!==void 0&&i!==t){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];i=t}return i}function V0(i){F0(i.getCode(),i),ss(i,i,Ka)}function W0(i){i.forEach(V0)}function le(i){return typeof i=="string"?N0(i):i||null}function as(i,t,e,n){i=le(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(t,e),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/ni[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=t;else{const a=Va(i,le("EPSG:4326"));if(a===Iu&&o!=="degrees")r=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=_h(h.slice(0,2),h.slice(2,4)),u=_h(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?ni[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function mh(i){W0(i),i.forEach(function(t){i.forEach(function(e){t!==e&&ss(t,e,Ka)})})}function H0(i,t,e,n){i.forEach(function(r){t.forEach(function(s){ss(r,s,e),ss(s,r,n)})})}function Za(i,t){return i?typeof i=="string"?le(i):i:le(t)}function ze(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Va(i,t)===Ka)&&e}function Va(i,t){const e=i.getCode(),n=t.getCode();let r=U0(e,n);return r||(r=Iu),r}function ls(i,t){const e=le(i),n=le(t);return Va(e,n)}function Y0(i,t,e){return ls(t,e)(i,void 0,i.length)}function Wo(i,t){return i}function ye(i,t){return Vo&&!os(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Vo=!1,bu("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function q0(i,t){return i}function Ve(i,t){return i}function Q0(){mh(dh),mh(fh),H0(fh,dh,A0,M0)}Q0();const J0=10,ph=.25;class Wa{constructor(t,e,n,r,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=ls(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const v=p[0]+"/"+p[1];return a[v]||(a[v]=l(p)),a[v]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&dt(r)>=dt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?dt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?dt(this.targetProj_.getExtent()):null;const h=di(n),c=Gs(n),u=Us(n),d=Fs(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),E=J0+(o?Math.max(0,Math.ceil(Math.log2(Ui(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,m,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(v,y,R){p=Math.min(p,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-p>this.sourceWorldWidth_/2){const y=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];y[0][0]-p>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-p>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-p>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const R=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-R<this.sourceWorldWidth_/2&&(v.source=y)}})}a={}}addTriangle_(t,e,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,n]})}addQuad_(t,e,n,r,s,o,a,l,h){const c=Bo([s,o,a,l]),u=this.sourceWorldWidth_?dt(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=Bo([t,e,n,r]);f=dt(m)/this.targetWorldWidth_>ph||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>ph||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!tr(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(m);let p;g?p=(Jn(s[0],d)+Jn(a[0],d))/2-Jn(E[0],d):p=(s[0]+a[0])/2-E[0];const v=(s[1]+a[1])/2-E[1];f=p*p+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(m),p=[(r[0]+t[0])/2,(r[1]+t[1])/2],v=this.transformInv_(p);this.addQuad_(t,e,m,p,s,o,E,v,h-1),this.addQuad_(p,m,n,r,v,E,a,l,h-1)}else{const m=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(m),p=[(n[0]+r[0])/2,(n[1]+r[1])/2],v=this.transformInv_(p);this.addQuad_(t,m,p,r,s,E,v,l,h-1),this.addQuad_(m,e,n,p,E,o,a,v,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(t,n,r,s,a,l),_&14||this.addTriangle_(t,n,e,s,a,o),_&&(_&13||this.addTriangle_(e,r,t,o,l,s),_&7||this.addTriangle_(e,r,n,o,l,a))}calculateSourceExtent(){const t=ui();return this.triangles_.forEach(function(e,n,r){const s=e.source;Or(t,s[0]),Or(t,s[1]),Or(t,s[2])}),t}getTriangles(){return this.triangles_}}let co;const xe=[];function Eh(i,t,e,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,r)),i.restore()}function uo(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function tE(){if(co===void 0){const i=_e(6,6,xe);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Eh(i,4,5,4,0),Eh(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;co=uo(t,0)||uo(t,4)||uo(t,8),Ni(i),xe.push(i.canvas)}return co}function Ho(i,t,e,n){const r=Y0(e,t,i);let s=as(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||Fi(l,r)){const h=as(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Pu(i,t,e,n){const r=En(e);let s=Ho(i,t,r,n);return(!isFinite(s)||s<=0)&&wu(e,function(o){return s=Ho(i,t,o,n),isFinite(s)&&s>0}),s}function Ha(i,t,e,n,r,s,o,a,l,h,c,u,d){const g=_e(Math.round(e*i),Math.round(e*t),xe);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function f(p){return Math.round(p*e)/e}g.globalCompositeOperation="lighter";const _=ui();l.forEach(function(p,v,y){x0(_,p.extent)});let m;if(!d||l.length!==1||h!==0){const p=dt(_),v=Dt(_);m=_e(Math.round(e*p/n),Math.round(e*v/n),xe),u||(m.imageSmoothingEnabled=!1);const y=e/n;l.forEach(function(R,x,T){const w=R.extent[0]-_[0],C=-(R.extent[3]-_[3]),L=dt(R.extent),O=Dt(R.extent);R.image.width>0&&R.image.height>0&&m.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,w*y,C*y,L*y,O*y)})}const E=di(o);return a.getTriangles().forEach(function(p,v,y){const R=p.source,x=p.target;let T=R[0][0],w=R[0][1],C=R[1][0],L=R[1][1],O=R[2][0],lt=R[2][1];const tt=f((x[0][0]-E[0])/s),z=f(-(x[0][1]-E[1])/s),V=f((x[1][0]-E[0])/s),it=f(-(x[1][1]-E[1])/s),Xt=f((x[2][0]-E[0])/s),Qe=f(-(x[2][1]-E[1])/s),Je=T,tn=w;T=0,w=0,C-=Je,L-=tn,O-=Je,lt-=tn;const Ks=[[C,L,0,0,V-tt],[O,lt,0,0,Xt-tt],[0,0,C,L,it-z],[0,0,O,lt,Qe-z]],Yt=j0(Ks);if(!Yt)return;if(g.save(),g.beginPath(),tE()||!u){g.moveTo(V,it);const yt=4,Qt=tt-V,mi=z-it;for(let Lt=0;Lt<yt;Lt++)g.lineTo(V+f((Lt+1)*Qt/yt),it+f(Lt*mi/(yt-1))),Lt!=yt-1&&g.lineTo(V+f((Lt+1)*Qt/yt),it+f((Lt+1)*mi/(yt-1)));g.lineTo(Xt,Qe)}else g.moveTo(V,it),g.lineTo(tt,z),g.lineTo(Xt,Qe);g.clip(),g.transform(Yt[0],Yt[2],Yt[1],Yt[3],tt,z),g.translate(_[0]-Je,_[3]-tn);let qt;if(m)qt=m.canvas,g.scale(n/e,-n/e);else{const yt=l[0],Qt=yt.extent;qt=yt.image,g.scale(dt(Qt)/qt.width,-Dt(Qt)/qt.height)}g.drawImage(qt,0,0),g.restore()}),m&&(Ni(m),xe.push(m.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(p,v,y){const R=p.target,x=(R[0][0]-E[0])/s,T=-(R[0][1]-E[1])/s,w=(R[1][0]-E[0])/s,C=-(R[1][1]-E[1])/s,L=(R[2][0]-E[0])/s,O=-(R[2][1]-E[1])/s;g.beginPath(),g.moveTo(w,C),g.lineTo(x,T),g.lineTo(L,O),g.closePath(),g.stroke()}),g.restore()),g.canvas}class js extends za{constructor(t,e,n,r,s,o,a,l,h,c,u,d){super(s,S.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=f?Ht(g,f):g;if(Ui(m)===0){this.state=S.EMPTY;return}const E=t.getExtent();E&&(_?_=Ht(_,E):_=E);const p=r.getResolution(this.wrappedTileCoord_[0]),v=Pu(t,n,m,p);if(!isFinite(v)||v<=0){this.state=S.EMPTY;return}const y=c!==void 0?c:$a;if(this.triangulation_=new Wa(t,n,m,_,v*y,p),this.triangulation_.getTriangles().length===0){this.state=S.EMPTY;return}this.sourceZ_=e.getZForResolution(v);let R=this.triangulation_.calculateSourceExtent();if(_&&(t.canWrapX()?(R[1]=Et(R[1],_[1],_[3]),R[3]=Et(R[3],_[1],_[3])):R=Ht(R,_)),!Ui(R))this.state=S.EMPTY;else{const x=e.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let T=x.minX;T<=x.maxX;T++)for(let w=x.minY;w<=x.maxY;w++){const C=h(this.sourceZ_,T,w,a);C&&this.sourceTiles_.push(C)}this.sourceTiles_.length===0&&(this.state=S.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==S.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=S.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ha(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=S.LOADED}this.changed()}load(){if(this.state==S.IDLE){this.state=S.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n==S.IDLE||n==S.LOADING){t++;const r=Z(e,N.CHANGE,function(s){const o=e.getState();(o==S.LOADED||o==S.ERROR||o==S.EMPTY)&&(at(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,r){e.getState()==S.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ni(this.canvas_.getContext("2d")),xe.push(this.canvas_),this.canvas_=null),super.release()}}function nt(i,t){if(!i)throw new Error(t)}class Su{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return nt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return nt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){nt(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function hs(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function ks(i,t,e){return i+"/"+t+"/"+e}function $e(i){return ks(i[0],i[1],i[2])}function eE(i){return i.split("/").map(Number)}function nE(i){return(i[1]<<i[0])+i[2]}function iE(i,t){const e=i[0],n=i[1],r=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,r):!0}class Lu extends Su{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=eE(t)[0];this.forEach(r=>{r.tileCoord[0]!==n&&(this.remove($e(r.tileCoord)),r.release())})}}const go={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Gi={PROPERTYCHANGE:"propertychange"};class nr extends Qi{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(N.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=Z(this,t[s],e);return r}return Z(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=es(this,t[s],e)}else n=es(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)rE(n);else if(Array.isArray(t))for(let r=0,s=t.length;r<s;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}nr.prototype.on;nr.prototype.once;nr.prototype.un;function rE(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)at(i[t]);else at(i)}class yh extends be{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Ie extends nr{constructor(t){super(),this.on,this.once,this.un,Ct(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new yh(n,t,e)),n=Gi.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new yh(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const s=r[t];r[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],o0(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}class Au extends Ie{constructor(t){super(),this.projection=le(t.projection),this.attributions_=Th(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,r){e.viewResolver=n,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Th(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Th(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}class Ya{constructor(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function An(i,t,e,n,r){return r!==void 0?(r.minX=i,r.maxX=t,r.minY=e,r.maxY=n,r):new Ya(i,t,e,n)}const sE=42,qa=256;function oE(i,t,e,n,r){let s;for(t+=n;t<e;t+=n)if(s=r(i.slice(t-n,t),i.slice(t,t+n)),s)return s;return!1}function aE(i,t,e,n,r){return!wu(r,function(o){return!dn(i,t,e,n,o[0],o[1])})}function dn(i,t,e,n,r,s){let o=0,a=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Mu(i,t,e,n,r,s){if(e.length===0||!dn(i,t,e[0],n,r,s))return!1;for(let o=1,a=e.length;o<a;++o)if(dn(i,e[o-1],e[o],n,r,s))return!1;return!0}function Ou(i,t,e,n,r){const s=xu(ui(),i,t,e,n);return tr(r,s)?ns(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:oE(i,t,e,n,function(o,a){return P0(r,o,a)}):!1}function Du(i,t,e,n,r){return!!(Ou(i,t,e,n,r)||dn(i,t,e,n,r[0],r[1])||dn(i,t,e,n,r[0],r[3])||dn(i,t,e,n,r[2],r[1])||dn(i,t,e,n,r[2],r[3]))}function lE(i,t,e,n,r){if(!Du(i,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(aE(i,e[s-1],e[s],n,r)&&!Ou(i,e[s-1],e[s],n,r))return!1;return!0}function vh(i){return i[0]>0&&i[1]>0}function hE(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function se(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}const Mn=[0,0,0],Le=5;class Nu{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,nt(i0(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,nt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=di(n)),nt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,nt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:qa,nt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,s)=>{const o=new Ya(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const r=this.getTileRangeForExtentAndZ(t,e);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,r){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=An(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return An(s,s+1,o,o+1,e)}const r=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],s=t[1],o=t[2];if(e===r)return An(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-r),h=Math.floor(s*l),c=Math.floor(o*l);if(e<r)return An(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return An(h,u,c,d,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Mn);const r=Mn[1],s=Mn[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Mn);const o=Mn[1],a=Mn[2];return An(r,o,s,a,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=se(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),r=this.getResolution(t[0]),s=se(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*r,a=n[1]-(t[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return Ji(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=se(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/n/h[0],u=a*(l[1]-e)/n/h[1];return r?(c=Ze(c,Le)-1,u=Ze(u,Le)-1):(c=yr(c,Le),u=yr(u,Le)),hs(o,c,u,s)}getTileCoordForXYAndZ_(t,e,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=se(this.getTileSize(n),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return r?(h=Ze(h,Le)-1,c=Ze(c,Le)-1):(h=yr(h,Le),c=yr(c,Le)),hs(n,h,c,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=As(this.resolutions_,t,e||0);return Et(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Du(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n}}function Fu(i){let t=i.getDefaultTileGrid();return t||(t=gE(i),i.setDefaultTileGrid(t)),t}function cE(i,t,e){const n=t[0],r=i.getTileCoordCenter(t),s=Qa(e);if(!Fi(s,r)){const o=dt(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return t}function uE(i,t,e,n){n=n!==void 0?n:"top-left";const r=Uu(i,t,e);return new Nu({extent:i,origin:C0(i,n),resolutions:r,tileSize:e})}function dE(i){const t=i||{},e=t.extent||le("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Uu(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Nu(n)}function Uu(i,t,e,n){t=t!==void 0?t:sE,e=se(e!==void 0?e:qa);const r=Dt(i),s=dt(i);n=n>0?n:Math.max(s/e[0],r/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function gE(i,t,e,n){const r=Qa(i);return uE(r,t,e,n)}function Qa(i){i=le(i);let t=i.getExtent();if(!t){const e=180*ni.degrees/i.getMetersPerUnit();t=Ji(-e,-e,e,e)}return t}class fE extends Au{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&se(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Lu(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,r){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=ks(e,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===S.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,r,s){return ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Fu(t)}getTileCacheForProjection(t){const e=this.getProjection();return nt(e===null||ze(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=se(r.getTileSize(t),this.tmpSize);return s==1?o:hE(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=cE(n,t,e)),iE(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,r){}}class _E extends be{constructor(t,e){super(t),this.tile=e}}function mE(i,t){const e=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=t.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function pE(i,t){const e=i.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=mE(i[r],t);return EE(n)}function EE(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const r=nE(t),s=Jn(r,i.length);return i[s](t,e,n)}}function yE(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let s;for(s=n;s<=r;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=n;r++)t.push(i.replace(e[0],r.toString()));return t}return t.push(i),t}class Ja extends fE{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ja.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=Ct(e),r=e.getState();let s;r==S.LOADING?(this.tileLoadingKeys_[n]=!0,s=go.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==S.ERROR?go.TILELOADERROR:r==S.LOADED?go.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new _E(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=yE(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(pE(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const r=ks(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class TE extends Ja{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:vE,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Ds,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!ze(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!ze(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ze(e,t)))return this.tileGrid;const n=Ct(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Fu(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||ze(e,t))return this.tileCache;const n=Ct(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Lu(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,r,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?S.IDLE:S.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(N.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,n,r,s){const o=this.getProjection();if(!o||!s||ze(o,s))return this.getTileInternal(t,e,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[t,e,n];let h;const c=$e(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new js(o,d,s,g,l,f,this.getTilePixelRatio(r),this.getGutter(),(m,E,p,v)=>this.getTileInternal(m,E,p,v,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(t,e,n,r,s){let o=null;const a=ks(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,n,r,s,l),h.getState()==S.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=le(t);if(n){const r=Ct(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function vE(i,t){i.getImage().src=t}class Gu extends TE{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:dE({extent:Qa(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}function Yo(i){return Array.isArray(i)?Math.min(...i):i}class RE extends Tu{constructor(t,e,n,r,s,o,a){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Ht(n,h):n,u=En(c),d=Ho(t,e,u,r),g=$a,f=new Wa(t,e,c,l,d*g,r),_=f.calculateSourceExtent(),m=Rn(_)?null:o(_,d,s),E=m?st.IDLE:st.EMPTY,p=m?m.getPixelRatio():1;super(n,r,p,E),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==st.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==st.LOADED){const e=dt(this.targetExtent_)/this.targetResolution_,n=Dt(this.targetExtent_)/this.targetResolution_;this.canvas_=Ha(e,n,this.sourcePixelRatio_,Yo(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==st.IDLE){this.state=st.LOADING,this.changed();const t=this.sourceImage_.getState();t==st.LOADED||t==st.ERROR?this.reproject_():(this.sourceListenerKey_=Z(this.sourceImage_,N.CHANGE,function(e){const n=this.sourceImage_.getState();(n==st.LOADED||n==st.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){at(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Tr=4,fo={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class xE extends be{constructor(t,e){super(t),this.image=e}}class wE extends Au{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=As(e,t,0);t=e[n]}return t}getImage(t,e,n,r){const s=this.getProjection();if(!s||!r||ze(s,r))return s&&(r=s),this.getImageInternal(t,e,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ze(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&Ko(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new RE(s,r,t,e,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,r){if(this.loader){const s=CE(t,e,n,1),o=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&ns(this.wantedExtent_,s)||ns(this.image.getExtent(),s))&&(this.wantedResolution_&&Yo(this.wantedResolution_)===o||Yo(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Tu(s,o,n,this.loader),this.image.addEventListener(N.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case st.LOADING:this.loading=!0,n=fo.IMAGELOADSTART;break;case st.LOADED:this.loading=!1,n=fo.IMAGELOADEND;break;case st.ERROR:this.loading=!1,n=fo.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new xE(n,e))}}function CE(i,t,e,n){const r=t/e,s=En(i),o=Ze(dt(i)/r,Tr),a=Ze(Dt(i)/r,Tr),l=Ze((n-1)*o/2,Tr),h=o+2*l,c=Ze((n-1)*a/2,Tr),u=a+2*c;return is(s,r,0,[h,u])}var bE=Object.defineProperty,IE=(i,t,e)=>t in i?bE(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,He=(i,t,e)=>(IE(i,typeof t!="symbol"?t+"":t,e),e);const qo=class Qo extends Gu{constructor(t,e={}){super({tileUrlFunction:(n,r)=>`${se(this.tileGrid.getTileSize(n[0]))[0]*(r||1)}`,tileLoadFunction:async(n,r)=>{const s=this.getrenderFunction();if(this.tileGrid&&s){console.assert(n instanceof Ds);const o=n,a=parseInt(r),l=Math.round(a/256),h=_e(a,a),c=await s(this.api,n.getTileCoord(),a,l,this.getextentBufferFactor());h.putImageData(c,0,0),e.debug&&(h.strokeStyle="grey",h.strokeRect(.5,.5,a+.5,a+.5),h.fillStyle="darkgrey",h.strokeStyle="black",h.textAlign="center",h.textBaseline="middle",h.font="20px sans-serif",h.lineWidth=2,h.strokeText(r,a/2,a/2,a),h.fillText(r,a/2,a/2,a)),o.setImage(h.canvas)}},...e}),He(this,"api"),He(this,"renderFunction"),He(this,"extentBufferFactor"),this.api=t,this.renderFunction=e.renderFunction,this.extentBufferFactor=e.extentBufferFactor}getrenderFunction(){return this.renderFunction||Qo.DEFAULT_RENDERFUNCTION}getextentBufferFactor(){return typeof this.extentBufferFactor=="function"?this.extentBufferFactor():this.extentBufferFactor||Qo.DEFAULT_EXTENTBUFFERFACTOR}};He(qo,"DEFAULT_RENDERFUNCTION",(i,t,e,n,r)=>i.renderXYZTile(t[1],t[2],t[0],e,n,r)),He(qo,"DEFAULT_EXTENTBUFFERFACTOR",0);let PE=qo;const ju=class ku extends wE{constructor(t,e={}){super({loader:(n,r,s)=>new Promise(async o=>{var a;const l=s||window?.devicePixelRatio||1,h=r/l,c=Math.round(dt(n)/h),u=Math.round(Dt(n)/h),d=await this.getrenderFunction()(this.api,((a=this.getProjection())==null?void 0:a.getCode())||"EPSG:3857",n[0],n[1],n[2],n[3],c,u,l);o(createImageBitmap(d))}),...e}),He(this,"api"),He(this,"renderFunction"),this.api=t,this.renderFunction=e.renderFunction}getrenderFunction(){return this.renderFunction||ku.DEFAULT_RENDERFUNCTION}};He(ju,"DEFAULT_RENDERFUNCTION",(i,t,e,n,r,s,o,a,l)=>i.renderImage(t,new i.Rectangle(e,n,r,s),o,a,l));let Rh=ju;const Kt={ADD:"add",REMOVE:"remove"},xh={LENGTH:"length"};class vr extends be{constructor(t,e,n){super(t),this.element=e,this.index=n}}class ve extends Ie{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(xh.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new vr(Kt.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new vr(Kt.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new vr(Kt.REMOVE,r,t)),this.dispatchEvent(new vr(Kt.ADD,e,t))}updateLength_(){this.set(xh.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}const tl=new Array(6);function de(){return[1,0,0,1,0,0]}function SE(i){return Xs(i,1,0,0,1,0,0)}function el(i,t){const e=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=t[0],h=t[1],c=t[2],u=t[3],d=t[4],g=t[5];return i[0]=e*l+r*h,i[1]=n*l+s*h,i[2]=e*c+r*u,i[3]=n*c+s*u,i[4]=e*d+r*g+o,i[5]=n*d+s*g+a,i}function Xs(i,t,e,n,r,s,o){return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function $t(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function LE(i,t){const e=Math.cos(t),n=Math.sin(t);return el(i,Xs(tl,e,n,-n,e,0,0))}function wh(i,t,e){return el(i,Xs(tl,t,0,0,e,0,0))}function AE(i,t,e){return el(i,Xs(tl,1,0,0,1,t,e))}function yn(i,t,e,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+t,i[5]=o*r*l+a*r*h+e,i}function Xu(i,t){const e=ME(t);nt(e!==0,"Transformation matrix cannot be inverted");const n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return i[0]=o/e,i[1]=-r/e,i[2]=-s/e,i[3]=n/e,i[4]=(s*l-o*a)/e,i[5]=-(n*l-r*a)/e,i}function ME(i){return i[0]*i[3]-i[1]*i[2]}let Ch;function OE(i){const t="matrix("+i.join(", ")+")";if(Eu)return t;const e=Ch||(Ch=document.createElement("div"));return e.style.transform=t,e.style.transform}const cs={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Mt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Mt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Mt.max=Mt.whitepoint[2].D65;Mt.rgb=function(i,t){t=t||Mt.whitepoint[2].E;var e=i[0]/t[0],n=i[1]/t[1],r=i[2]/t[2],s,o,a;return s=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};cs.xyz=function(i,t){var e=i[0]/255,n=i[1]/255,r=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=e*.41239079926595+n*.35758433938387+r*.18048078840183,o=e*.21263900587151+n*.71516867876775+r*.072192315360733,a=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||Mt.whitepoint[2].E,[s*t[0],o*t[1],a*t[2]]};const zu={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var n,r,s,o,a,l,h,c,u,d,g,f,_;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var m=.0011070564598794539;return t=t||"D65",e=e||2,u=Mt.whitepoint[e][t][0],d=Mt.whitepoint[e][t][1],g=Mt.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,r=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*m,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};Mt.luv=function(i,t,e){var n,r,s,o,a,l,h,c,u,d,g,f,_,m=.008856451679035631,E=903.2962962962961;t=t||"D65",e=e||2,u=Mt.whitepoint[e][t][0],d=Mt.whitepoint[e][t][1],g=Mt.whitepoint[e][t][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/d;return s=p<=m?E*p:116*Math.pow(p,1/3)-16,o=13*s*(n-f),a=13*s*(r-_),[s,o,a]};zu.lchuv=function(i){var t=i[0],e=i[1],n=i[2],r=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),o=s*360/2/Math.PI;return o<0&&(o+=360),[t,r,o]};Mt.lchuv=function(i){return zu.lchuv(Mt.luv(i))};const bh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Ih={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function DE(i){var t,e=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),bh[i])e=bh[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",e=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=t[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(c,u){if(c[c.length-1]==="%")return c=parseFloat(c)/100,u===3?c:r==="rgb"?c*255:r[0]==="h"||r[0]==="l"&&!u?c*100:r==="lab"?c*125:r==="lch"?u<2?c*150:c*360:r[0]==="o"&&!u?c:r==="oklab"?c*.4:r==="oklch"?u<2?c*.4:c*360:c;if(r[u]==="h"||u===2&&r[r.length-1]==="h"){if(Ih[c]!==void 0)return Ih[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return parseFloat(c)*360;if(c.endsWith("grad"))return parseFloat(c)*360/400;if(c.endsWith("rad"))return parseFloat(c)*180/Math.PI}return c==="none"?0:parseFloat(c)}),n=e.length>h?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=i.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:e,alpha:n}}const _o={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(e===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+e):n+e-n*e,r=2*n-s,a=[0,0,0];h<3;)o=t+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};cs.hsl=function(i){var t=i[0]/255,e=i[1]/255,n=i[2]/255,r=Math.min(t,e,n),s=Math.max(t,e,n),o=s-r,a,l,h;return s===r?a=0:t===s?a=(e-n)/o:e===s?a=2+(n-t)/o:n===s&&(a=4+(t-e)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function NE(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=DE(i);if(!e.space)return[];const n=e.space[0]==="h"?_o.min:cs.min,r=e.space[0]==="h"?_o.max:cs.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=_o.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function FE(i){return typeof i=="string"?i:jE(i)}const UE=1024,Ti={};let mo=0;function $u(i){if(Ti.hasOwnProperty(i))return Ti[i];if(mo>=UE){let e=0;for(const n in Ti)e++&3||(delete Ti[n],--mo)}const t=NE(i);if(t.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+i+'" as color');return GE(t),Ti[i]=t,++mo,t}function us(i){return Array.isArray(i)?i:$u(i)}function GE(i){return i[0]=Et(i[0]+.5|0,0,255),i[1]=Et(i[1]+.5|0,0,255),i[2]=Et(i[2]+.5|0,0,255),i[3]=Et(i[3],0,1),i}function jE(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+t+","+e+","+n+","+r+")"}function kE(i){try{return $u(i),!0}catch{return!1}}class XE{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,n){const r=Ph(t,e,n);return r in this.cache_?this.cache_[r]:null}set(t,e,n,r){const s=Ph(t,e,n);this.cache_[s]=r,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ph(i,t,e){const n=e?FE(e):"null";return t+":"+i+":"+n}const Bu=new XE,q={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Ku extends Ie{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[q.OPACITY]=t.opacity!==void 0?t.opacity:1,nt(typeof e[q.OPACITY]=="number","Layer opacity must be a number"),e[q.VISIBLE]=t.visible!==void 0?t.visible:!0,e[q.Z_INDEX]=t.zIndex,e[q.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[q.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[q.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[q.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=Et(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ct()}getLayerStatesArray(t){return ct()}getExtent(){return this.get(q.EXTENT)}getMaxResolution(){return this.get(q.MAX_RESOLUTION)}getMinResolution(){return this.get(q.MIN_RESOLUTION)}getMinZoom(){return this.get(q.MIN_ZOOM)}getMaxZoom(){return this.get(q.MAX_ZOOM)}getOpacity(){return this.get(q.OPACITY)}getSourceState(){return ct()}getVisible(){return this.get(q.VISIBLE)}getZIndex(){return this.get(q.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(q.EXTENT,t)}setMaxResolution(t){this.set(q.MAX_RESOLUTION,t)}setMinResolution(t){this.set(q.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(q.MAX_ZOOM,t)}setMinZoom(t){this.set(q.MIN_ZOOM,t)}setOpacity(t){nt(typeof t=="number","Layer opacity must be a number"),this.set(q.OPACITY,t)}setVisible(t){this.set(q.VISIBLE,t)}setZIndex(t){this.set(q.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const kt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Gt={ANIMATING:0,INTERACTING:1},te={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Sh(i,t,e){return function(n,r,s,o,a){if(!n)return;if(!r&&!t)return n;const l=t?0:s[0]*r,h=t?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,_=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=Et(n[0],d,g),E=Et(n[1],f,_);if(o&&e&&r){const p=30*r;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,E]}}function zE(i){return i}function nl(i,t,e,n){const r=dt(t)/e[0],s=Dt(t)/e[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function il(i,t,e){let n=Math.min(i,t);const r=50;return n*=Math.log(1+r*Math.max(0,i/t-1))/r+1,e&&(n=Math.max(n,e),n/=Math.log(1+r*Math.max(0,e/i-1))/r+1),Et(n,e/2,t*2)}function $E(i,t,e,n){return t=t!==void 0?t:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=e?nl(l,e,o,n):l;if(a)return t?il(r,c,h):Et(r,h,c);const u=Math.min(c,r),d=Math.floor(As(i,u,s));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function BE(i,t,e,n,r,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=r?nl(t,r,l,s):t;if(h)return n?il(o,c,e):Et(o,e,c);const u=1e-9,d=Math.ceil(Math.log(t/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(t/f)/Math.log(i)+g),m=Math.max(d,_),E=t/Math.pow(i,m);return Et(E,e,c)}}}function Lh(i,t,e,n,r){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=n?nl(i,n,a,r):i;return!e||!l?Et(s,t,h):il(s,h,t)}}}function rl(i){if(i!==void 0)return 0}function Ah(i){if(i!==void 0)return i}function KE(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function ZE(i){const t=Dr(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function VE(i,t,e,n,r,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function WE(i,t,e,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=t;d<e;d+=n){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function HE(i,t,e,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=t;u<e;u+=n){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function YE(i,t,e,n,r,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Mh=de();class qE extends Ie{constructor(){super(),this.extent_=ui(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=r0((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ct()}closestPointXY(t,e,n,r){return ct()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ns(e),this.extentRevision_=this.getRevision()}return I0(this.extent_,t)}rotate(t,e){ct()}scale(t,e,n){ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ct()}getType(){return ct()}applyTransform(t){ct()}intersectsExtent(t){return ct()}translate(t,e){ct()}transform(t,e){const n=le(t),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=Dt(h)/Dt(l);return yn(Mh,h[0],h[3],c,-c,0,0,0),VE(s,0,s.length,a,Mh,o),ls(n,e)(s,o,a)}:ls(n,e);return this.applyTransform(r),this}}class sl extends qE{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return R0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Oh(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ct()}setLayout(t,e,n){let r;if(t)r=Oh(t);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=QE(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();WE(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=En(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();HE(r,0,r.length,s,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();YE(n,0,n.length,r,t,e,n),this.changed()}}}function QE(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Oh(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function Dh(i,t,e,n,r,s,o){const a=i[t],l=i[t+1],h=i[e]-a,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=e;else if(d>0){for(let g=0;g<n;++g)o[g]=k0(i[t+g],i[e+g],d);o.length=n;return}else u=t}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function Zu(i,t,e,n,r){let s=i[t],o=i[t+1];for(t+=n;t<e;t+=n){const a=i[t],l=i[t+1],h=Qn(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function JE(i,t,e,n,r){for(let s=0,o=e.length;s<o;++s){const a=e[s];r=Zu(i,t,a,n,r),t=a}return r}function Vu(i,t,e,n,r,s,o,a,l,h,c){if(t==e)return h;let u,d;if(r===0){if(d=Qn(o,a,i[t],i[t+1]),d<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=t+n;for(;g<e;)if(Dh(i,g-n,g,n,o,a,c),d=Qn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(Dh(i,e-n,t,n,o,a,c),d=Qn(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function ty(i,t,e,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const g=e[u];h=Vu(i,t,g,n,r,s,o,a,l,h,c),t=g}return h}function ey(i,t,e,n){for(let r=0,s=e.length;r<s;++r)i[t++]=e[r];return t}function Wu(i,t,e,n){for(let r=0,s=e.length;r<s;++r){const o=e[r];for(let a=0;a<n;++a)i[t++]=o[a]}return t}function ny(i,t,e,n,r){r=r||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=Wu(i,t,e[o],n);r[s++]=l,t=l}return r.length=s,r}function iy(i,t,e,n,r,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=i[t],s[o++]=i[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],_=i[d+1],m=i[u],E=i[u+1];for(let p=d+n;p<u;p+=n){const v=i[p],y=i[p+1],R=G0(v,y,f,_,m,E);R>g&&(c=p,g=R)}g>r&&(l[(c-t)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[t+u*n],s[o++]=i[t+u*n+1]);return o}function On(i,t){return t*Math.round(i/t)}function ry(i,t,e,n,r,s,o){if(t==e)return o;let a=On(i[t],r),l=On(i[t+1],r);t+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=On(i[t],r),c=On(i[t+1],r),t+=n,t==e)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;t<e;){const u=On(i[t],r),d=On(i[t+1],r);if(t+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,m=d-l;if(g*m==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function sy(i,t,e,n,r,s,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=ry(i,t,c,n,r,s,o),a.push(o),t=c}return o}function Hu(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=t;o<e;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function oy(i,t,e,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];r[s++]=Hu(i,t,l,n,r[s]),t=l}return r.length=s,r}function Yu(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=o*a-s*l,s=a,o=l}return r/2}function ay(i,t,e,n){let r=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];r+=Yu(i,t,a,n),t=a}return r}class ji extends sl{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new ji(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<vu(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Zu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return Yu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Hu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=iy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new ji(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Wu(this.flatCoordinates,0,t,this.stride),this.changed()}}class ol extends sl{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ol(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const s=this.flatCoordinates,o=Qn(t,e,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return v0(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Ru(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ey(this.flatCoordinates,0,t,this.stride),this.changed()}}function ly(i,t,e,n,r,s,o){let a,l,h,c,u,d,g;const f=r[s+1],_=[];for(let p=0,v=e.length;p<v;++p){const y=e[p];for(c=i[y-n],d=i[y-n+1],a=t;a<y;a+=n)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let m=NaN,E=-1/0;for(_.sort(Xa),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>E&&(h=(c+u)/2,Mu(i,t,e,n,h,f)&&(m=h,E=p)),c=u}return isNaN(m)&&(m=r[s]),[m,f,E]}function hy(i,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const s=i[t+r];i[t+r]=i[e-n+r],i[e-n+r]=s}t+=n,e-=n}}function qu(i,t,e,n){let r=0,s=i[e-n],o=i[e-n+1];for(;t<e;t+=n){const a=i[t],l=i[t+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function cy(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=qu(i,t,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;t=a}return!0}function Nh(i,t,e,n,r){r=r!==void 0?r:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=qu(i,t,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&hy(i,t,a,n),t=a}return t}class ki extends sl{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?n0(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ki(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<vu(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(JE(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ty(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Mu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return ay(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Nh(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,oy(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=En(this.getExtent());this.flatInteriorPoint_=ly(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ol(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new ji(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new ji(e.slice(s,l),t);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;cy(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Nh(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=sy(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new ki(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return lE(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ny(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Fh(i){if(Rn(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],r=i[3],s=[t,e,t,r,n,r,n,e,t,e];return new ki(s,"XY",[s.length])}const po=0;class ne extends Ie{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Za(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Z0(),t.center&&(t.center=ye(t.center,this.projection_)),t.extent&&(t.extent=Ve(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in te)delete e[a];this.setProperties(e,!0);const n=dy(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const r=uy(t),s=n.constraint,o=gy(t);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const r=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-e[3]+e[1]-r[1]),a=s/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=ye(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=ye(r.anchor,this.getProjection())),e[n]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===e){n&&Rr(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<e;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||l0,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Jn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}fy(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Gt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Gt.ANIMATING]>0}getInteracting(){return this.hints_[Gt.INTERACTING]>0}cancelAnimations(){this.setHint(Gt.ANIMATING,-this.hints_[Gt.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const r=this.animations_[e];if(r[0].callback&&Rr(r[0].callback,!1),!t)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[m,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Jn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Gt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Rr(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-e[0],r[1]-e[1]],Ba(n,t-this.getRotation()),X0(n,e)),n}calculateCenterZoom(t,e){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-r[0])/s,a=e[1]-t*(e[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],r=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Wo(t,this.getProjection())}getCenterInternal(){return this.get(te.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return q0(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();nt(e,"The view center is not defined");const n=this.getResolution();nt(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return nt(r!==void 0,"The view rotation is not defined"),is(e,n,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(te.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ve(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=dt(t)/e[0],r=Dt(t)/e[1];return Math.max(n,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*r)}}getRotation(){return this.get(te.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=Eo(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,r;if(this.resolutions_){const s=As(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(n/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Et(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,Et(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(nt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){nt(!Rn(t),"Cannot fit empty extent provided as `geometry`");const r=Ve(t,this.getProjection());n=Fh(r)}else if(t.getType()==="Circle"){const r=Ve(t.getExtent(),this.getProjection());n=Fh(r),n.rotate(this.getRotation(),En(r))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),r=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*r,f=s[u]*r+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=En(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),m=e.callback?e.callback:Jr;e.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:e.duration,easing:e.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Rr(m,!0))}centerOn(t,e,n){this.centerOnInternal(ye(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(Eo(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,r){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=Eo(t,r,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Wo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&ye(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,r,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=ye(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ye(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(te.ROTATION)!==r&&this.set(te.ROTATION,r),this.get(te.RESOLUTION)!==o&&(this.set(te.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(te.CENTER)||!os(this.get(te.CENTER),a))&&this.set(te.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const r=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!os(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:ci,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Gt.INTERACTING,1)}endInteraction(t,e,n){n=n&&ye(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(Gt.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function Rr(i,t){setTimeout(function(){i(t)},0)}function uy(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Sh(i.extent,i.constrainOnlyCenter,e)}const t=Za(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Sh(e,!1,!1)}return zE}function dy(i){let t,e,n,o=i.minZoom!==void 0?i.minZoom:po,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,d=Za(i.projection,"EPSG:3857"),g=d.getExtent();let f=i.constrainOnlyCenter,_=i.extent;if(!h&&!_&&d.isGlobal()&&(f=!1,_=g),i.resolutions!==void 0){const m=i.resolutions;e=m[o],n=m[a]!==void 0?m[a]:m[m.length-1],i.constrainResolution?t=$E(m,c,!f&&_,u):t=Lh(e,n,c,!f&&_,u)}else{const E=(g?Math.max(dt(g),Dt(g)):360*ni.degrees/d.getMetersPerUnit())/qa/Math.pow(2,po),p=E/Math.pow(2,28-po);e=i.maxResolution,e!==void 0?o=0:e=E/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(l,a):n=E/Math.pow(l,a):n=p),a=o+Math.floor(Math.log(e/n)/Math.log(l)),n=e/Math.pow(l,a-o),i.constrainResolution?t=BE(l,e,n,c,!f&&_,u):t=Lh(e,n,c,!f&&_,u)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:o,zoomFactor:l}}function gy(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?ZE():e===!1?Ah:typeof e=="number"?KE(e):Ah}return rl}function fy(i){return!(i.sourceCenter&&i.targetCenter&&!os(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Eo(i,t,e,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class _y extends Ku{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(q.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(q.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(at(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=Z(t,N.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof ne?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return al(r,e.viewState)&&(!s||tr(s,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const r=t instanceof ne?t.getViewStateAndExtent():t;let s=e(r);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(q.MAP,t)}getMapInternal(){return this.get(q.MAP)}setMap(t){this.mapPrecomposeKey_&&(at(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(at(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Z(t,kt.PRECOMPOSE,function(e){const r=e.frameState.layerStatesArray,s=this.getLayerState(!1);nt(!r.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=Z(this,N.CHANGE,t.render,t),this.changed())}setSource(t){this.set(q.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function al(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}const zs=_y;class my extends Ls{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ct()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;yn(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Xu(r,n)}forEachFeatureAtCoordinate(t,e,n,r,s,o,a,l){let h;const c=e.viewState;function u(y,R,x,T){return s.call(o,R,y?x:null,T)}const d=c.projection,g=$0(t.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const y=d.getExtent(),R=dt(y);f.push([-R,0],[R,0])}const _=e.layerStatesArray,m=_.length,E=[],p=[];for(let y=0;y<f.length;y++)for(let R=m-1;R>=0;--R){const x=_[R],T=x.layer;if(T.hasRenderer()&&al(x,c)&&a.call(l,T)){const w=T.getRenderer(),C=T.getSource();if(w&&C){const L=C.getWrapX()?g:t,O=u.bind(null,x.managed);p[0]=L[0]+f[y][0],p[1]=L[1]+f[y][1],h=w.forEachFeatureAtCoordinate(p,e,n,O,E)}if(h)return h}}if(E.length===0)return;const v=1/E.length;return E.forEach((y,R)=>y.distanceSq+=R*v),E.sort((y,R)=>y.distanceSq-R.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(t,e,n,r,s,o){return this.forEachFeatureAtCoordinate(t,e,n,r,Qr,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){ct()}flushDeclutterItems(t){}scheduleExpireIconCache(t){Bu.canExpireCache()&&t.postRenderFunctions.push(py)}}function py(i,t){Bu.expire()}class Pi extends be{constructor(t,e,n,r){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=r}}const xr="ol-hidden",gi="ol-unselectable",Uh="ol-unsupported",$s="ol-control",Gh="ol-collapsed",Ey=new Ie;class yy extends my{constructor(t){super(t),this.fontChangeListenerKey_=Z(Ey,Gi.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=gi+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const r=new Pi(t,void 0,e);n.dispatchEvent(r)}}disposeInternal(){at(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(kt.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=t.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!al(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(t,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(t),m0(this.element_,this.children_),this.dispatchRenderEvent(kt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}flushDeclutterItems(t){const e=this.declutterLayers_;for(let n=e.length-1;n>=0;--n)e[n].renderDeclutter(t);e.length=0}}class je extends be{constructor(t,e){super(t),this.layer=e}}const yo={LAYERS:"layers"};class fi extends Ku{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(yo.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new ve(n.slice(),{unique:!0}):nt(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new ve(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(at),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(Z(t,Kt.ADD,this.handleLayersAdd_,this),Z(t,Kt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(at);qi(this.listenerKeys_);const e=t.getArray();for(let n=0,r=e.length;n<r;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new je("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[Z(t,Gi.PROPERTYCHANGE,this.handleLayerChange_,this),Z(t,N.CHANGE,this.handleLayerChange_,this)];t instanceof fi&&e.push(Z(t,"addlayer",this.handleLayerGroupAdd_,this),Z(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Ct(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new je("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new je("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new je("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=Ct(e);this.listenerKeys_[n].forEach(at),delete this.listenerKeys_[n],this.dispatchEvent(new je("removelayer",e)),this.changed()}getLayers(){return this.get(yo.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new je("removelayer",n[r]))}this.set(yo.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const r=this.getLayerState();let s=r.zIndex;!t&&r.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Ht(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}class $n extends be{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class Fe extends $n{constructor(t,e,n,r,s,o){super(t,e,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ft={SINGLECLICK:"singleclick",CLICK:N.CLICK,DBLCLICK:N.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Jo={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Ty extends Qi{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Z(n,Jo.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Z(n,Jo.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(N.TOUCHMOVE,this.boundHandleTouchMove_,yu?{passive:!1}:!1)}emulateClick_(t){let e=new Fe(ft.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Fe(ft.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Fe(ft.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==ft.POINTERUP||e.type==ft.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==ft.POINTERDOWN||e.type==ft.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Fe(ft.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Fe(ft.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Z(n,ft.POINTERMOVE,this.handlePointerMove_,this),Z(n,ft.POINTERUP,this.handlePointerUp_,this),Z(this.element_,ft.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(Z(this.element_.getRootNode(),ft.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Fe(ft.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Fe(ft.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(at(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(N.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(at(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(at),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Ue={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},vt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ds=1/0;class vy{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,qi(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(t){nt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=ds?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,r=e.length,s=e[t],o=n[t],a=t;for(;t<r>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<r&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,r=this.priorities_,s=n[e],o=r[e];for(;e>t;){const a=this.getParentIndex_(e);if(r[a]>o)n[e]=n[a],r[e]=r[a],e=a;else break}n[e]=s,r[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let r=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==ds?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,e[r++]=o);e.length=r,n.length=r,this.heapify_()}}class Ry extends vy{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(N.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===S.LOADED||n===S.ERROR||n===S.EMPTY){n!==S.ERROR&&e.removeEventListener(N.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,r,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===S.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function xy(i,t,e,n,r){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return ds;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class ir extends Ie{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){$o(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&$o(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)at(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Jr&&this.listenerKeys.push(Z(t,Ue.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class wy extends ir{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(N.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+gi+" "+$s+(this.collapsed_&&this.collapsible_?" "+Gh:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ms(e,this.renderedAttributions_)){_0(this.ulElement_);for(let r=0,s=e.length;r<s;++r){const o=document.createElement("li");o.innerHTML=e[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Gh),this.collapsed_?ts(this.collapseLabel_,this.label_):ts(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class Cy extends ir{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(N.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+gi+" "+$s,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(xr)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:ci}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(xr);!s&&n===0?this.element.classList.add(xr):s&&n!==0&&this.element.classList.remove(xr)}this.label_.style.transform=r}this.rotation_=n}}class by extends ir{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(N.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(N.CLICK,this.handleClick_.bind(this,-n),!1);const d=e+" "+gi+" "+$s,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const r=n.getZoom();if(r!==void 0){const s=n.getConstrainedZoom(r+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:ci})):n.setZoom(s)}}}function ll(i){i=i||{};const t=new ve;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new by(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new Cy(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new wy(i.attributionOptions)),t}const jh={ACTIVE:"active"};class rr extends Ie{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(jh.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(jh.ACTIVE,t)}setMap(t){this.map_=t}}function Iy(i,t,e){const n=i.getCenterInternal();if(n){const r=[n[0]+t[0],n[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:h0,center:i.getConstrainedCenter(r)})}}function hl(i,t,e,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+t),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:e,duration:n!==void 0?n:250,easing:ci})}class Py extends rr{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==ft.DBLCLICK){const n=t.originalEvent,r=t.map,s=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();hl(a,o,s,this.duration_),n.preventDefault(),e=!0}return!e}}class sr extends rr{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==ft.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==ft.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==ft.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==ft.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function cl(i){const t=i.length;let e=0,n=0;for(let r=0;r<t;r++)e+=i[r].clientX,n+=i[r].clientY;return{clientX:e/t,clientY:n/t}}function ta(i){const t=arguments;return function(e){let n=!0;for(let r=0,s=t.length;r<s&&(n=n&&t[r](e),!!n);++r);return n}}const Sy=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Ly=function(i){const t=i.map.getTargetElement(),e=i.map.getOwnerDocument().activeElement;return t.contains(e)},Qu=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?Ly(i):!0},Ay=Qr,Ju=function(i){const t=i.originalEvent;return t.button==0&&!(g0&&mu&&t.ctrlKey)},td=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},My=function(i){const t=i.originalEvent;return mu?t.metaKey:t.ctrlKey},Oy=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ed=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},To=function(i){const t=i.originalEvent;return nt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},Dy=function(i){const t=i.originalEvent;return nt(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class Ny extends sr{constructor(t){super({stopDown:Os}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:ta(td,Dy);this.condition_=t.onFocusOnly?ta(Qu,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,r=e.getEventPixel(cl(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=t.map.getView();z0(s,a.getResolution()),Ba(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:ci})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Fy extends sr{constructor(t){t=t||{},super({stopDown:Os}),this.condition_=t.condition?t.condition:Sy,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!To(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===rl)return;const r=e.getSize(),s=t.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return To(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return To(t)&&Ju(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Uy extends Ls{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+n,r.top=Math.min(t[1],e[1])+n,r.width=Math.abs(e[0]-t[0])+n,r.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new ki([r])}getGeometry(){return this.geometry_}}const wr={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class vo extends be{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class Gy extends sr{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Uy(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Ju,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const r=n[0]-e[0],s=n[1]-e[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new vo(wr.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new vo(e?wr.BOXEND:wr.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new vo(wr.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}class jy extends Gy{constructor(t){t=t||{};const e=t.condition?t.condition:Oy;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(r),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;r=r.clone(),r.scale(a*a)}n.fitInternal(r,{duration:this.duration_,easing:ci})}}const on={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class ky extends rr{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return td(e)&&ed(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==N.KEYDOWN){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==on.DOWN||r==on.LEFT||r==on.RIGHT||r==on.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;r==on.DOWN?h=-a:r==on.LEFT?l=-a:r==on.RIGHT?l=a:h=a;const c=[l,h];Ba(c,o.getRotation()),Iy(o,c,this.duration_),n.preventDefault(),e=!0}}return!e}}class Xy extends rr{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!My(e)&&ed(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==N.KEYDOWN||t.type==N.KEYPRESS){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==="+"||r==="-")){const s=t.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();hl(a,o,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}class zy{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const r=this.points_[e+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[e]-this.points_[n],o=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class $y extends rr{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:Ay;this.condition_=t.onFocusOnly?ta(Qu,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==N.WHEEL)return!0;const n=t.map,r=t.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let s;if(t.type==N.WHEEL&&(s=r.deltaY,c0&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=pu),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-Et(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),hl(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class By extends sr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Os),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;const o=t.map,a=o.getView();a.getConstraints().rotation!==rl&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(cl(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class Ky extends sr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Os),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(cl(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function Zy(i){i=i||{};const t=new ve,e=new zy(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new Fy),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new Py({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new Ny({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new By),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new Ky({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new ky),t.push(new Xy({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new $y({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new jy({duration:i.zoomDuration})),t}function nd(i){if(i instanceof zs){i.setMapInternal(null);return}i instanceof fi&&i.getLayers().forEach(nd)}function id(i,t){if(i instanceof zs){i.setMapInternal(t);return}if(i instanceof fi){const e=i.getLayers().getArray();for(let n=0,r=e.length;n<r;++n)id(e[n],t)}}let rd=class extends Ie{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Vy(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:pu,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=de(),this.pixelToCoordinateTransform_=de(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||ll(),this.interactions=e.interactions||Zy({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Ry(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(vt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(vt.VIEW,this.handleViewChanged_),this.addChangeListener(vt.SIZE,this.handleSizeChanged_),this.addChangeListener(vt.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof ne)&&t.view.then(function(r){n.setView(new ne(r))}),this.controls.addEventListener(Kt.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Kt.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Kt.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Kt.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Kt.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Kt.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){id(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:Qr,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(r){n.push(r)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(r){r instanceof fi?e(r.getLayers()):t.push(r)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const r=e.layerFilter!==void 0?e.layerFilter:Qr,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,r,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=n.width/r[0],o=n.height/r[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-n.left)/s,(a.clientY-n.top)/o]}getTarget(){return this.get(vt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Wo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?$t(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(vt.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof ve){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=ye(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?$t(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(vt.SIZE)}getView(){return this.get(vt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,r){return xy(this.frameState_,t,e,n,r)}handleBrowserEvent(t,e){e=e||t.type;const n=new Fe(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===Jo.POINTERDOWN||n===N.WHEEL||n===N.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===r?r.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,s=r;if(t){const o=t.viewHints;if(o[Gt.ANIMATING]||o[Gt.INTERACTING]){const a=Date.now()-t.time>8;r=a?0:8,s=a?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(kt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(kt.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new $n(Ue.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new $n(Ue.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let r=0,s=n.length;r<s;++r)n[r](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,r=this.targetChangeHandlerKeys_.length;n<r;++n)at(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(N.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(N.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,$o(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new yy(this)),this.mapBrowserEventHandler_=new Ty(this,this.moveTolerance_);for(const s in ft)this.mapBrowserEventHandler_.addEventListener(ft[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(N.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(N.WHEEL,this.boundHandleBrowserEvent_,yu?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[Z(n,N.KEYDOWN,this.handleBrowserEvent,this),Z(n,N.KEYPRESS,this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(at(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(at(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Z(t,Gi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Z(t,N.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(at),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new je("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Z(t,Gi.PROPERTYCHANGE,this.render,this),Z(t,N.CHANGE,this.render,this),Z(t,"addlayer",this.handleLayerAdd_,this),Z(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const t=this.frameState_;t&&this.renderer_.flushDeclutterItems(t)}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){nd(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),r=this.frameState_;let s=null;if(e!==void 0&&vh(e)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:is(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Ct(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=is(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!Rn(this.previousExtent_)&&!Ko(s.extent,this.previousExtent_))&&(this.dispatchEvent(new $n(Ue.MOVESTART,this,r)),this.previousExtent_=Ns(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Gt.ANIMATING]&&!s.viewHints[Gt.INTERACTING]&&!Ko(s.extent,this.previousExtent_)&&(this.dispatchEvent(new $n(Ue.MOVEEND,this,s)),T0(s.extent,this.previousExtent_))),this.dispatchEvent(new $n(Ue.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Ue.LOADSTART)||this.hasListener(Ue.LOADEND)||this.hasListener(kt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new je("removelayer",e)),this.set(vt.LAYERGROUP,t)}setSize(t){this.set(vt.SIZE,t)}setTarget(t){this.set(vt.TARGET,t)}setView(t){if(!t||t instanceof ne){this.set(vt.VIEW,t);return}this.set(vt.VIEW,new ne);const e=this;t.then(function(n){e.setView(new ne(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),s=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(e=[s,o],!vh(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&bu("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!Ms(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function Vy(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new fi({layers:i.layers});e[vt.LAYERGROUP]=n,e[vt.TARGET]=i.target,e[vt.VIEW]=i.view instanceof ne?i.view:new ne;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new ve(i.controls.slice()):(nt(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new ve(i.interactions.slice()):(nt(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new ve(i.overlays.slice()):(nt(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new ve,{controls:r,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}const Cr={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Wy extends zs{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(Cr.PRELOAD)}setPreload(t){this.set(Cr.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Cr.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Cr.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}function gs(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function ea(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let Dn=null;function Hy(i){Dn||(Dn=_e(i.width,i.height,void 0,{willReadFrequently:!0}));const t=Dn.canvas,e=i.width;t.width!==e&&(t.width=e);const n=i.height;return t.height!==n&&(t.height=n),Dn.clearRect(0,0,e,n),Dn.drawImage(i,0,0),Dn.getImageData(0,0,e,n).data}const Yy=[256,256];class sd extends za{constructor(t){const e=S.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null}getSize(){if(this.size_)return this.size_;const t=gs(this.data_);return t?[t.width,t.height]:Yy}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==S.IDLE&&this.state!==S.ERROR)return;this.state=S.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=S.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=S.ERROR,t.changed()})}}class od extends sd{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:t.interpolate,transition:t.transition}),this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=n?Ht(e,n):e;if(Ui(s)===0){this.state=S.EMPTY;return}const o=t.sourceProj,a=o.getExtent();a&&(r?r=Ht(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=t.targetProj,c=Pu(o,h,s,l);if(!isFinite(c)||c<=0){this.state=S.EMPTY;return}const u=t.errorThreshold!==void 0?t.errorThreshold:$a;if(this.triangulation_=new Wa(o,h,s,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=S.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=Et(d[1],r[1],r[3]),d[3]=Et(d[3],r[1],r[3])):d=Ht(d,r)),!Ui(d))this.state=S.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=t.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let m=g.minY;m<=g.maxY;m++){const E=f(this.sourceZ_,_,m,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=S.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{if(!e||e.getState()!==S.LOADED)return;const n=e.getSize(),r=this.gutter_;let s;const o=ea(e.getData());o?s=o:s=Hy(gs(e.getData()));const a=[n[0]+2*r,n[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),m=h*_;let E=u;if(u.length!==m){E=new c(m);let p=0,v=0;const y=a[0]*_;for(let R=0;R<a[1];++R){for(let x=0;x<y;++x)E[p++]=u[v+x];v+=f/d}}t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,t.length===0)this.state=S.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=t[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,R=t.length;y<R;++y){const x=t[y],T=x.data,w=x.pixelSize,C=w[0],L=w[1],O=_e(C,L,xe),lt=O.createImageData(C,L),tt=lt.data;let z=g*3;for(let V=0,it=tt.length;V<it;V+=4)tt[V]=T[z],tt[V+1]=T[z+1],tt[V+2]=T[z+2],tt[V+3]=255,z+=u;O.putImageData(lt,0,0),f.push({extent:x.extent,image:O.canvas})}const _=Ha(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,R=f.length;y<R;++y){const T=f[y].image.getContext("2d");Ni(T),xe.push(T.canvas)}const m=_.getContext("2d"),E=m.getImageData(0,0,_.width,_.height);Ni(m),xe.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new t[0].dataType(c.buffer));const p=E.data;let v=g*3;for(let y=0,R=p.length;y<R;y+=4)p[y+3]===255?(c[v]=p[y],c[v+1]=p[y+1],c[v+2]=p[y+2]):(c[v]=0,c[v+1]=0,c[v+2]=0),v+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=S.LOADED}this.changed()}load(){if(this.state!==S.IDLE&&this.state!==S.ERROR)return;this.state=S.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{const n=e.getState();if(n!==S.IDLE&&n!==S.LOADING)return;t++;const r=Z(e,N.CHANGE,function(){const s=e.getState();(s==S.LOADED||s==S.ERROR||s==S.EMPTY)&&(at(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e){e.getState()==S.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(at),this.sourcesListenerKeys_=null}}class qy extends Qi{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=t.gutter||0,this.helper_=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(N.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===S.LOADED,this.loaded)this.uploadTile();else{if(t instanceof Ds){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(N.CHANGE,this.handleTileChange_)}}uploadTile(){ct()}setReady(){this.ready=!0,this.dispatchEvent(N.CHANGE)}handleTileChange_(){this.tile.getState()===S.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(N.CHANGE,this.handleTileChange_)}}const ul=34962,dl=34963,Qy=35040,gl=35044,Jy=35048,tT=5121,eT=5123,nT=5125,ad=5126,kh=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function iT(i,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!d0},t);const e=kh.length;for(let n=0;n<e;++n)try{const r=i.getContext(kh[n],t);if(r)return r}catch{}return null}const rT={STATIC_DRAW:gl,STREAM_DRAW:Qy,DYNAMIC_DRAW:Jy};class ld{constructor(t,e){this.array_=null,this.type_=t,nt(t===ul||t===dl,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:rT.STATIC_DRAW}ofSize(t){return this.array_=new(Ro(this.type_))(t),this}fromArray(t){return this.array_=Ro(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Ro(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Ro(i){switch(i){case ul:return Float32Array;case dl:return Uint32Array;default:return Float32Array}}function hd(i,t,e){const n=e?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function sT(i,t,e,n){hd(i,t,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}function Xh(i,t,e,n,r,s){const o=i.getGL();let a,l;e instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),hd(o,t,s&&l);const h=e.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,e),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let Bn=null;function oT(){Bn=_e(1,1,void 0,{willReadFrequently:!0})}class aT extends qy{constructor(t){super(t),this.textures=[],this.renderSize_=se(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new ld(ul,gl);e.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(e),this.coords=e,this.setTile(t.tile)}uploadTile(){const t=this.helper_,e=t.getGL(),n=this.tile;this.textures.length=0;let r;n instanceof Ds||n instanceof js?r=n.getImage():r=n.getData();const s=gs(r);if(s){const p=e.createTexture();this.textures.push(p),this.bandCount=4,sT(e,p,s,n.interpolate),this.setReady();return}r=ea(r);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const p=e.createTexture();this.textures.push(p),Xh(t,p,r,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let p=0;p<g;++p){const v=e.createTexture();this.textures.push(v);const y=p<g-1?4:(this.bandCount-1)%4+1;f[p]=new c(h*y)}let _=0,m=0;const E=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let v=0;v<E;++v){const y=r[m+v],R=Math.floor(_/this.bandCount),x=v%this.bandCount,T=Math.floor(x/4),w=f[T],C=w.length/h,L=x%4;w[R*C+L]=y,++_}m+=d/u}for(let p=0;p<g;++p){const v=this.textures[p],y=f[p],R=y.length/h;Xh(t,v,y,a,R,n.interpolate)}this.setReady()}disposeInternal(){const t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(N.CHANGE,this.handleTileChange_)}getImagePixelData_(t,e,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];Bn||oT(),Bn.clearRect(0,0,1,1);const a=t.width,l=t.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(e/s)),d=r+Math.floor(c*(n/o));let g;try{Bn.drawImage(t,u,d,1,1,0,0,1,1),g=Bn.getImageData(0,0,1,1).data}catch{return Bn=null,null}return g}getArrayPixelData_(t,e,n,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=e[0],h=e[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(r/a));if(t instanceof DataView){const _=t.byteLength/(c*u),m=_*(g*c+d),E=t.buffer.slice(m,m+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return t.slice(f,f+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof sd){const n=this.tile.getData(),r=ea(n);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,t,e)}return this.getImagePixelData_(gs(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class cd extends nr{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ct()}getData(t){return null}prepareFrame(t){return ct()}renderFrame(t,e){return ct()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,s,o)}}forEachFeatureAtCoordinate(t,e,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===st.LOADED||e.getState()===st.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=st.LOADED&&e!=st.ERROR&&t.addEventListener(N.CHANGE,this.boundHandleImageChange_),e==st.IDLE&&(t.load(),e=t.getState()),e==st.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const br={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},lT=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,hT=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class zh{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||lT),e.compileShader(n);const r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fragmentShader||hT),e.compileShader(r),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,r),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(s),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(o=>{this.uniforms_.push({value:t.uniforms[o],location:e.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const r=0,s=e.RGBA,o=0,a=e.RGBA,l=e.UNSIGNED_BYTE,h=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,r,s,n[0],n[1],o,a,l,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,r){const s=this.getGL(),o=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const l=Ct(s.canvas);if(!t.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=t.layerStatesArray[t.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(t),n&&n(s,t),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,r=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${r}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(s.location,r++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(s.location,n[0],n[1]);return;case 3:e.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(s.location,n)})}}function ud(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dd(i,t){return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}const Ae={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},wi={UNSIGNED_BYTE:tT,UNSIGNED_SHORT:eT,UNSIGNED_INT:nT,FLOAT:ad},fs={};function $h(i){return"shared/"+i}let Bh=0;function cT(){const i="unique/"+Bh;return Bh+=1,i}function uT(i){let t=fs[i];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:iT(e)},fs[i]=t}return t.users+=1,t.context}function dT(i){const t=fs[i];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const r=e.canvas;r.width=1,r.height=1,delete fs[i]}class gT extends Ls{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?$h(t.canvasCacheKey):cT(),this.gl_=uT(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(br.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(br.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=de(),this.offsetScaleMatrix_=de(),this.tmpMat4_=ud(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new zh({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new zh({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===$h(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=Ct(t);let r=this.bufferCache_[n];if(!r){const s=e.createBuffer();r={buffer:t,webGlBuffer:s},this.bufferCache_[n]=r}e.bindBuffer(t.getType(),r.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.gl_,n=Ct(t),r=this.bufferCache_[n];r&&!e.isContextLost()&&e.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(br.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(br.RESTORED,this.boundHandleWebGLContextRestored_),dT(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const r=this.gl_,s=this.getCanvas(),o=t.size,a=t.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(t,e,n){const r=this.gl_;r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,t),r.uniform1i(this.getUniformLocation(n),e)}prepareDrawToRenderTarget(t,e,n,r){const s=this.gl_,o=e.getSize();s.bindFramebuffer(s.FRAMEBUFFER,e.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,e.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,e.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const r=n.UNSIGNED_INT,s=4,o=e-t,a=t*s;n.drawElements(n.TRIANGLES,o,r,a)}finalizeDraw(t,e,n){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(t,null,e,n):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,r=t.pixelRatio;this.setUniformFloatValue(Ae.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Ae.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Ae.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Ae.PIXEL_RATIO,r),this.setUniformFloatVec2(Ae.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Ae.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Ae.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Ae.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,r=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(t):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),this.bindTexture(s.texture,r,s.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),r++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,dd(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(t,e){this.gl_.useProgram(t),this.currentProgram_=t,this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const n=this.gl_,r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}getProgram(t,e){const n=this.gl_,r=this.compileShader(t,n.FRAGMENT_SHADER),s=this.compileShader(e,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(t){const e=Ct(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=Ct(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,r=t.viewState.rotation,s=t.viewState.resolution,o=t.viewState.center;return yn(e,0,0,2/(s*n[0]),2/(s*n[1]),-r,-o[0],-o[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,n,r,s){const o=this.getAttributeLocation(t);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,e,n,!1,r,s))}enableAttributes(t){const e=fT(t);let n=0;for(let r=0;r<t.length;r++){const s=t[r];this.enableAttributeArray_(s.name,s.size,s.type||ad,e,n),n+=s.size*gd(s.type)}}handleWebGLContextLost(t){qi(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n){const r=this.gl_;n=n||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,n),e?r.texImage2D(r.TEXTURE_2D,s,o,l,h,e):r.texImage2D(r.TEXTURE_2D,s,o,t[0],t[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n}}function fT(i){let t=0;for(let e=0;e<i.length;e++){const n=i[e];t+=n.size*gd(n.type)}return t}function gd(i){switch(i){case wi.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case wi.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case wi.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case wi.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class fl extends cd{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=de(),this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,t.addChangeListener(q.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(kt.PRECOMPOSE)){const r=new Pi(kt.PRECOMPOSE,void 0,e,t);n.dispatchEvent(r)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(kt.POSTCOMPOSE)){const r=new Pi(kt.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(r)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,r;for(let o=0,a=t.layerStatesArray.length;o<a;o++){const l=t.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof fl)){e=!0;continue}const c=l.getClassName();if((e||c!==r)&&(n+=1,e=!1),r=c,h===this)break}const s="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new gT({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){yn(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new Pi(t,this.inversePixelTransform_,n,e);r.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(kt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(kt.POSTRENDER,t,e)}}const _T={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},mT={};function Kh(i){return 1/(i+2)}function pT(){return{tileIds:new Set,representationsByZ:{}}}function Zh(i,t){return i.tileIds.has(Ct(t))}function Vh(i,t,e){const n=i.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),i.tileIds.add(Ct(t.tile))}function xo(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=Ht(t,Ve(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(t=Ht(t,r))}return t}function na(i,t){return`${i.getKey()},${$e(t)}`}class ET extends fl{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=de(),this.tempMat4=ud(),this.tempTileRange_=new Ya(0,0,0,0),this.tempTileCoord_=hs(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new Su(n),this.frameState=null,this.projection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}isDrawableTile_(t){const e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==S.LOADED||n==S.EMPTY||n==S.ERROR&&!r}prepareFrameInternal(t){this.projection_?t.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=t.viewState.projection):this.projection_=t.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Rn(xo(t,t.extent))?!1:n.getState()==="ready"}createTileRepresentation(t){return ct()}enqueueTiles(t,e,n,r,s){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=Ct(l);u in t.wantedTiles||(t.wantedTiles[u]={});const d=t.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=n;m>=_;--m){const E=h.getTileRangeForExtentAndZ(e,m,this.tempTileRange_),p=h.getResolution(m);for(let v=E.minX;v<=E.maxX;++v)for(let y=E.minY;y<=E.maxY;++y){const R=hs(m,v,y,this.tempTileCoord_),x=na(l,R);let T,w;if(g.containsKey(x)&&(T=g.get(x),w=T.tile),(!T||T.tile.key!==l.getKey())&&(w=l.getTile(m,v,y,t.pixelRatio,o.projection)),Zh(r,w))continue;if(!T)T=this.createTileRepresentation({tile:w,grid:h,helper:this.helper,gutter:c}),g.set(x,T);else if(this.isDrawableTile_(w))T.setTile(w);else{const L=w.getInterimTile();T.setTile(L)}Vh(r,T,m);const C=w.getKey();d[C]=!0,w.getState()===S.IDLE&&(t.tileQueue.isKeyQueued(C)||t.tileQueue.enqueue([w,u,h.getTileCoordCenter(R),p]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,r,s,o,a,l,h,c,u){}renderTileMask(t,e,n,r){}drawTile_(t,e,n,r,s,o,a){if(!e.ready)return;const h=e.tile.tileCoord,c=$e(h),u=c in o?o[c]:1,d=a.getResolution(n),g=se(a.getTileSize(n),this.tempSize_),f=a.getOrigin(n),_=a.getTileCoordExtent(h),m=u<1?-1:Kh(n);u<1&&(t.animate=!0);const E=t.viewState,p=E.center[0],v=E.center[1],y=g[0]+2*r,R=g[1]+2*r,x=y/R,T=(p-f[0])/(g[0]*d),w=(f[1]-v)/(g[1]*d),C=E.resolution/d,L=h[1],O=h[2];SE(this.tileTransform_),wh(this.tileTransform_,2/(t.size[0]*C/y),-2/(t.size[1]*C/y)),LE(this.tileTransform_,E.rotation),wh(this.tileTransform_,1,1/x),AE(this.tileTransform_,(g[0]*(L-T)-r)/y,(g[1]*(O-w)-r)/R),this.renderTile(e,this.tileTransform_,t,s,d,g,f,_,m,r,u)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=xo(t,t.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=pT(),u=r.getPreload();if(t.nextExtent){const x=o.getZForResolution(n.nextResolution,s.zDirection),T=xo(t,t.nextExtent);this.enqueueTiles(t,T,x,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const d={},g=Ct(this),f=t.time;let _=!1;for(const x of c.representationsByZ[h]){const T=x.tile;if((T instanceof js||T instanceof od)&&T.getState()===S.EMPTY)continue;const w=T.tileCoord;if(x.ready){const O=T.getAlpha(g,f);if(O===1){T.endTransition(g);continue}_=!0;const lt=$e(w);d[lt]=O}if(this.renderComplete=!1,this.findAltTiles_(o,w,h+1,c))continue;const L=o.getMinZoom();for(let O=h-1;O>=L&&!this.findAltTiles_(o,w,O,c);--O);}const m=c.representationsByZ,E=Object.keys(m).map(Number).sort(e0);if(this.beforeTilesMaskRender(t))for(let x=0,T=E.length;x<T;++x){const w=E[x];for(const C of m[w]){const L=C.tile.tileCoord;if($e(L)in d)continue;const lt=o.getTileCoordExtent(L);this.renderTileMask(C,w,lt,Kh(w))}}this.beforeTilesRender(t,_);for(let x=0,T=E.length;x<T;++x){const w=E[x];for(const C of m[w]){const L=C.tile.tileCoord;$e(L)in d||this.drawTile_(t,C,w,a,l,d,o)}}for(const x of m[h]){const T=x.tile.tileCoord;$e(T)in d&&this.drawTile_(t,x,h,a,l,d,o)}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const v=this.helper.getCanvas(),y=this.tileRepresentationCache;for(;y.canExpireCache();)y.pop().dispose();const R=function(x,T){s.updateCacheSize(.1,T.viewState.projection),s.expireCache(T.viewState.projection,mT)};return t.postRenderFunctions.push(R),this.postRender(e,t),v}findAltTiles_(t,e,n,r){const s=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=na(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!Zh(r,g.tile)&&(Vh(r,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const j={..._T,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Nr={TEXTURE_COORD:"a_textureCoord"},yT=[{name:Nr.TEXTURE_COORD,size:2,type:wi.FLOAT}];class TT extends ET{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new ld(dl,gl),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){super.reset(t),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(t){return new aT(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,r,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(yT);let g=0;for(;g<t.textures.length;){const x=`${j.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(t.textures[g],g,x),++g}for(let x=0;x<this.paletteTextures_.length;++x){const T=this.paletteTextures_[x],w=T.getTexture(d);this.helper.bindTexture(w,g,T.name),++g}const f=n.viewState,_=o[0]+2*c,m=o[1]+2*c,p=t.tile.tileCoord,v=p[1],y=p[2];this.helper.setUniformMatrixValue(j.TILE_TRANSFORM,dd(this.tempMat4,e)),this.helper.setUniformFloatValue(j.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(j.DEPTH,h);let R=r;c>0&&(R=l,Ht(R,r,R)),this.helper.setUniformFloatVec4(j.RENDER_EXTENT,R),this.helper.setUniformFloatValue(j.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(j.ZOOM,f.zoom),this.helper.setUniformFloatValue(j.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(j.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(j.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(j.TEXTURE_ORIGIN_X,a[0]+v*o[0]*s-c*s),this.helper.setUniformFloatValue(j.TEXTURE_ORIGIN_Y,a[1]-y*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const r=this.getLayer(),s=$t(n.pixelToCoordinateTransform,t.slice()),o=n.viewState,a=r.getExtent();if(a&&!Fi(Ve(a,o.projection),s))return null;const l=r.getSources(Bo([s]),o.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(o.projection),c.getWrapX())break;const g=u.getExtent();if(!g||Fi(g,s))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let g=u.getZForResolution(o.resolution);g>=u.getMinZoom();--g){const f=u.getTileCoordForCoordAndZ(s,g),_=na(c,f);if(!d.containsKey(_))continue;const m=d.get(_),E=m.tile;if((E instanceof js||E instanceof od)&&E.getState()===S.EMPTY)return null;if(!m.loaded)continue;const p=u.getOrigin(g),v=se(u.getTileSize(g)),y=u.getResolution(g),R=(s[0]-p[0])/y-f[1]*v[0],x=(p[1]-s[1])/y-f[2]*v[1];return m.getPixelData(R,x)}return null}disposeInternal(){const t=this.helper;t&&(t.getGL().deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}let _i=0;const xn=0,mt=1<<_i++,M=1<<_i++,oe=1<<_i++,St=1<<_i++,ii=1<<_i++,Ft=Math.pow(2,_i)-1,fd={[mt]:"boolean",[M]:"number",[oe]:"string",[St]:"color",[ii]:"number[]"},vT=Object.keys(fd).map(Number).sort(Xa);function It(i){const t=[];for(const e of vT)RT(i,e)&&t.push(fd[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function RT(i,t){return(i&t)===t}function ge(i,t){return!!(i&t)}function or(i,t){return i===t}class gn{constructor(t,e){this.type=t,this.value=e}}class _d{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function xT(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function wT(i){switch(i){case"string":return oe;case"color":return St;case"number":return M;case"boolean":return mt;case"number[]":return ii;default:throw new Error(`Unrecognized type hint: ${i}`)}}function J(i,t,e){switch(typeof i){case"boolean":return new gn(mt,i);case"number":return new gn(M,i);case"string":{let r=oe;return kE(i)&&(r|=St),or(r&e,xn)||(r&=e),new gn(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return NT(i,t,e);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=ii;return(i.length===3||i.length===4)&&(n|=St),e&&(n&=e),new gn(n,i)}const I={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},CT={[I.Get]:U(([i,t])=>t!==void 0?wT(t.value):Ft,X(1,2),bT),[I.Var]:U(([i])=>i.type,X(1,1),IT),[I.Id]:U(M|oe,vi,PT),[I.Concat]:U(oe,X(2,1/0),H(Ft)),[I.GeometryType]:U(oe,vi),[I.Resolution]:U(M,vi),[I.Zoom]:U(M,vi),[I.Time]:U(M,vi),[I.Any]:U(mt,X(2,1/0),H(mt)),[I.All]:U(mt,X(2,1/0),H(mt)),[I.Not]:U(mt,X(1,1),H(mt)),[I.Equal]:U(mt,X(2,2),H(Ft),an),[I.NotEqual]:U(mt,X(2,2),H(Ft),an),[I.GreaterThan]:U(mt,X(2,2),H(Ft),an),[I.GreaterThanOrEqualTo]:U(mt,X(2,2),H(Ft),an),[I.LessThan]:U(mt,X(2,2),H(Ft),an),[I.LessThanOrEqualTo]:U(mt,X(2,2),H(Ft),an),[I.Multiply]:U(i=>{let t=M|St;for(let e=0;e<i.length;e++)t&=i[e].type;return t},X(2,1/0),H(M|St),an),[I.Divide]:U(M,X(2,2),H(M)),[I.Add]:U(M,X(2,1/0),H(M)),[I.Subtract]:U(M,X(2,2),H(M)),[I.Clamp]:U(M,X(3,3),H(M)),[I.Mod]:U(M,X(2,2),H(M)),[I.Pow]:U(M,X(2,2),H(M)),[I.Abs]:U(M,X(1,1),H(M)),[I.Floor]:U(M,X(1,1),H(M)),[I.Ceil]:U(M,X(1,1),H(M)),[I.Round]:U(M,X(1,1),H(M)),[I.Sin]:U(M,X(1,1),H(M)),[I.Cos]:U(M,X(1,1),H(M)),[I.Atan]:U(M,X(1,2),H(M)),[I.Sqrt]:U(M,X(1,1),H(M)),[I.Match]:U(i=>{let t=Ft;for(let e=2;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},X(4,1/0),Wh,LT),[I.Between]:U(mt,X(3,3),H(M)),[I.Interpolate]:U(i=>{let t=St|M;for(let e=3;e<i.length;e+=2)t&=i[e].type;return t},X(6,1/0),Wh,AT),[I.Case]:U(i=>{let t=Ft;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},X(3,1/0),ST,MT),[I.In]:U(mt,X(2,2),OT),[I.Number]:U(M,X(1,1/0),H(Ft)),[I.String]:U(oe,X(1,1/0),H(Ft)),[I.Array]:U(i=>i.length===3||i.length===4?ii|St:ii,X(1,1/0),H(M)),[I.Color]:U(St,X(3,4),H(M)),[I.Band]:U(M,X(1,3),H(M)),[I.Palette]:U(St,X(2,2),DT)};function bT(i,t){const e=J(i[1],t);if(!(e instanceof gn))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),i.length===3){const n=J(i[2],t);return[e,n]}return[e]}function IT(i,t,e,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new gn(Ft,r)];const s=t.style.variables[r],o=J(s,t);if(o.value=r,n&&!ge(n,o.type))throw new Error(`The variable ${r} has type ${It(o.type)} but the following type was expected: ${It(n)}`);return[o]}function PT(i,t){t.featureId=!0}function vi(i,t){const e=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function X(i,t){return function(e,n){const r=e[0],s=e.length-1;if(i===t){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>t){const o=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function H(i){return function(t,e){const n=t[0],r=t.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=J(t[o+1],e);if(!ge(i,a.type)){const l=It(i),h=It(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function an(i,t,e){const n=i[0],r=i.length-1;let s=Ft;for(let a=0;a<e.length;++a)s&=e[a].type;if(s===xn)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=J(i[a+1],t,s);return o}function ST(i,t){const e=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function Wh(i,t){const e=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function LT(i,t,e,n){const r=i.length-1;let o=J(i[1],t).type;const a=J(i[i.length-1],t);let l=n!==void 0?n&a.type:a.type;const h=new Array(r-2);for(let u=0;u<r-2;u+=2){const d=J(i[u+2],t),g=J(i[u+3],t);o&=d.type,l&=g.type,h[u]=d,h[u+1]=g}const c=oe|M|mt;if(!ge(c,o))throw new Error(`Expected an input of type ${It(c)} for the interpolate operation, got ${It(o)} instead`);if(or(l,xn))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let u=0;u<r-2;u+=2){const d=J(i[u+2],t,o),g=J(i[u+3],t,l);h[u]=d,h[u+1]=g}return[J(i[1],t,o),...h,J(i[i.length-1],t,l)]}function AT(i,t,e,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=J(s,t);let o=J(i[2],t);if(!ge(M,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${It(o.type)} instead`);o=J(i[2],t,M);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=J(i[l+3],t);if(!ge(M,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${It(h.type)} at position ${l+2} instead`);let c=J(i[l+4],t);if(!ge(M|St,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${It(c.type)} at position ${l+3} instead`);h=J(i[l+3],t,M),c=J(i[l+4],t,M|St),a[l]=h,a[l+1]=c}return[s,o,...a]}function MT(i,t,e,n){const r=J(i[i.length-1],t);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=J(i[a+1],t),h=J(i[a+2],t);if(!ge(mt,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${It(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(or(s,xn))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=J(i[a+2],t,s);return o[o.length-1]=J(i[i.length-1],t,s),o}function OT(i,t){let e=i[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=oe|M;const r=new Array(e.length);for(let o=0;o<r.length;o++){const a=J(e[o],t);n&=a.type,r[o]=a}if(or(n,xn))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[J(i[1],t,n),...r]}function DT(i,t){const e=J(i[1],t,M);if(e.type!==M)throw new Error(`The first argument of palette must be an number, got ${It(e.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=J(n[s],t,St);if(!(o instanceof gn))throw new Error(`The palette color at index ${s} must be a literal value`);if(!ge(o.type,St))throw new Error(`The palette color at index ${s} should be of type color, got ${It(o.type)} instead`);r[s]=o}return[e,...r]}function U(i,...t){return function(e,n,r){const s=e[0];let o=[];for(let l=0;l<t.length;l++)o=t[l](e,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!ge(a,r))throw new Error(`The following expression was expected to return ${It(r)}, but returns ${It(a)} instead: ${JSON.stringify(e)}`);a&=r}if(a===xn)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new _d(a,s,...o)}}function NT(i,t,e){const n=i[0],r=CT[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,t,e)}class FT{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}function UT(i,t){return`operator_${i}_${Object.keys(t.functions).length}`}function Bs(i){const t=i.toString();return t.includes(".")?t:t+".0"}function md(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Bs).join(", ")})`}function GT(i){const t=us(i),e=t.length>3?t[3]:1;return md([t[0]/255*e,t[1]/255*e,t[2]/255*e,e])}const wo={};let jT=0;function pd(i){return i in wo||(wo[i]=jT++),wo[i]}function kT(i){return Bs(pd(i))}function Ed(i){return"u_var_"+i}function XT(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Co="getBandValue",yd="u_paletteTextures";function zT(i,t,e,n){const r=J(i,e,t);if(or(r.type,xn))throw new Error("No matching type was found");if(!ge(t,r.type)){const s=It(t),o=It(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return _l(r,t,n)}function B(i){return(t,e,n)=>{const r=e.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=_l(e.args[o],n,t);return i(s,t)}}const $T={[I.Get]:(i,t)=>{const n=t.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:t.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[I.GeometryType]:(i,t,e)=>{const n="geometryType",r=a=>{const l=a.getType();switch(l){case"Point":case"LineString":case"Polygon":return l;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return l.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(a.getGeometries()[0])}};return n in i.properties||(i.properties[n]={name:n,type:oe,evaluator:a=>r(a.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[I.Var]:(i,t)=>{const n=t.args[0].value;return n in i.variables||(i.variables[n]={name:n,type:t.type}),Ed(n)},[I.Resolution]:()=>"u_resolution",[I.Zoom]:()=>"u_zoom",[I.Time]:()=>"u_time",[I.Any]:B(i=>`(${i.join(" || ")})`),[I.All]:B(i=>`(${i.join(" && ")})`),[I.Not]:B(([i])=>`(!${i})`),[I.Equal]:B(([i,t])=>`(${i} == ${t})`),[I.NotEqual]:B(([i,t])=>`(${i} != ${t})`),[I.GreaterThan]:B(([i,t])=>`(${i} > ${t})`),[I.GreaterThanOrEqualTo]:B(([i,t])=>`(${i} >= ${t})`),[I.LessThan]:B(([i,t])=>`(${i} < ${t})`),[I.LessThanOrEqualTo]:B(([i,t])=>`(${i} <= ${t})`),[I.Multiply]:B(i=>`(${i.join(" * ")})`),[I.Divide]:B(([i,t])=>`(${i} / ${t})`),[I.Add]:B(i=>`(${i.join(" + ")})`),[I.Subtract]:B(([i,t])=>`(${i} - ${t})`),[I.Clamp]:B(([i,t,e])=>`clamp(${i}, ${t}, ${e})`),[I.Mod]:B(([i,t])=>`mod(${i}, ${t})`),[I.Pow]:B(([i,t])=>`pow(${i}, ${t})`),[I.Abs]:B(([i])=>`abs(${i})`),[I.Floor]:B(([i])=>`floor(${i})`),[I.Ceil]:B(([i])=>`ceil(${i})`),[I.Round]:B(([i])=>`floor(${i} + 0.5)`),[I.Sin]:B(([i])=>`sin(${i})`),[I.Cos]:B(([i])=>`cos(${i})`),[I.Atan]:B(([i,t])=>t!==void 0?`atan(${i}, ${t})`:`atan(${i})`),[I.Sqrt]:B(([i])=>`sqrt(${i})`),[I.Match]:B(i=>{const t=i[0],e=i[i.length-1];let n=null;for(let r=i.length-3;r>=1;r-=2){const s=i[r],o=i[r+1];n=`(${t} == ${s} ? ${o} : ${n||e})`}return n}),[I.Between]:B(([i,t,e])=>`(${i} >= ${t} && ${i} <= ${e})`),[I.Interpolate]:B(([i,t,...e])=>{let n="";for(let r=0;r<e.length-2;r+=2){const s=e[r],o=n||e[r+1],a=e[r+2],l=e[r+3];let h;i===Bs(1)?h=`(${t} - ${s}) / (${a} - ${s})`:h=`(pow(${i}, (${t} - ${s})) - 1.0) / (pow(${i}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[I.Case]:B(i=>{const t=i[i.length-1];let e=null;for(let n=i.length-3;n>=0;n-=2){const r=i[n],s=i[n+1];e=`(${r} ? ${s} : ${e||t})`}return e}),[I.In]:B(([i,...t],e)=>{const n=UT("in",e),r=[];for(let s=0;s<t.length;s+=1)r.push(`  if (inputValue == ${t[s]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${i})`}),[I.Array]:B(i=>`vec${i.length}(${i.join(", ")})`),[I.Color]:B(i=>{const t=i.slice(0,3).map(n=>`${n} / 255.0`);return i.length===3?`vec4(${t.join(", ")}, 1.0)`:`(${i[3]} * vec4(${t.join(", ")}, 1.0))`}),[I.Band]:B(([i,t,e],n)=>{if(!(Co in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${j.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Co]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${j.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${j.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${Co}(${i}, ${t??"0.0"}, ${e??"0.0"})`}),[I.Palette]:(i,t)=>{const[e,...n]=t.args,r=n.length,s=new Uint8Array(r*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=us(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${yd}[${i.paletteTextures.length}]`,a=new FT(o,s);i.paletteTextures.push(a);const l=_l(e,M,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function _l(i,t,e){if(i instanceof _d){const n=$T[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(e,i,t)}if((i.type&M)>0)return Bs(i.value);if((i.type&mt)>0)return i.value.toString();if((i.type&oe)>0)return kT(i.value.toString());if((i.type&St)>0)return GT(i.value);if((i.type&ii)>0)return md(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${It(t)})`)}function Nn(i,t,e){const n=xT();return n.style=i.style,zT(t,e,n,i)}function Hh(i,t){const e=`
    attribute vec2 ${Nr.TEXTURE_COORD};
    uniform mat4 ${j.TILE_TRANSFORM};
    uniform float ${j.TEXTURE_PIXEL_WIDTH};
    uniform float ${j.TEXTURE_PIXEL_HEIGHT};
    uniform float ${j.TEXTURE_RESOLUTION};
    uniform float ${j.TEXTURE_ORIGIN_X};
    uniform float ${j.TEXTURE_ORIGIN_Y};
    uniform float ${j.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Nr.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${j.TEXTURE_ORIGIN_X} + ${j.TEXTURE_RESOLUTION} * ${j.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${j.TEXTURE_ORIGIN_Y} - ${j.TEXTURE_RESOLUTION} * ${j.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${j.TILE_TRANSFORM} * vec4(${Nr.TEXTURE_COORD}, ${j.DEPTH}, 1.0);
    }
  `,n={...XT(),inFragmentShader:!0,bandCount:t,style:i},r=[];if(i.color!==void 0){const u=Nn(n,i.color,St);r.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Nn(n,i.contrast,M);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Nn(n,i.exposure,M);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Nn(n,i.saturation,M);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Nn(n,i.gamma,M);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Nn(n,i.brightness,M);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=Ed(d.name);s[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=pd(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);a.push(`uniform sampler2D ${j.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${yd}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${j.RENDER_EXTENT};
    uniform float ${j.TRANSITION_ALPHA};
    uniform float ${j.TEXTURE_PIXEL_WIDTH};
    uniform float ${j.TEXTURE_PIXEL_HEIGHT};
    uniform float ${j.RESOLUTION};
    uniform float ${j.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${j.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${j.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${j.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${j.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${j.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${j.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class ia extends Wy{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style;const n=t.cacheSize;delete t.cacheSize,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(q.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=Hh(this.style_,this.getSourceBandCount_());return new TT(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let r;for(let s=0,o=e.length;s<o;++s)this.renderedSource_=e[s],n.prepareFrame(t)&&(r=n.renderFrame(t));return r}render(t,e){this.rendered=!0;const n=t.viewState,r=this.getSources(t.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(t,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(t.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(t,a)}return o}setStyle(t){this.styleVariables_=t.variables||{},this.style_=t;const e=Hh(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}ia.prototype.dispose;class BT extends zs{constructor(t){t=t||{},super(t)}}let Kn=null;function KT(){Kn=_e(1,1,void 0,{willReadFrequently:!0})}class ZT extends cd{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=de(),this.pixelTransform=de(),this.inversePixelTransform=de(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){Kn||KT(),Kn.clearRect(0,0,1,1);let r;try{Kn.drawImage(t,e,n,1,1,0,0,1,1),r=Kn.getImageData(0,0,1,1).data}catch{return Kn=null,null}return r}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const r=this.getLayer().getClassName();let s,o;if(t&&t.className===r&&(!n||t&&t.style.backgroundColor&&Ms(us(t.style.backgroundColor),us(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=_e();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const r=di(n),s=Gs(n),o=Us(n),a=Fs(n);$t(e.coordinateToPixelTransform,r),$t(e.coordinateToPixelTransform,s),$t(e.coordinateToPixelTransform,o),$t(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;$t(l,r),$t(l,s),$t(l,o),$t(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){const s=new Pi(t,this.inversePixelTransform,n,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(kt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(kt.POSTRENDER,t,e)}getRenderTransform(t,e,n,r,s,o,a){const l=s/2,h=o/2,c=r/e,u=-c,d=-t[0]+a,g=-t[1];return yn(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class VT extends ZT{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,r=t.viewState,s=r.resolution,o=this.getLayer().getSource(),a=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=Ht(l,Ve(e.extent,r.projection))),!a[Gt.ANIMATING]&&!a[Gt.INTERACTING]&&!Rn(l))if(o){const h=r.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===st.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=$t(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!Fi(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=dt(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=Dt(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(t,e){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),_=c*a/(g*l),m=t.extent,E=u.resolution,p=u.rotation,v=Math.round(dt(m)/E*c),y=Math.round(Dt(m)/E*c);yn(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,p,-v/2,-y/2),Xu(this.inversePixelTransform,this.pixelTransform);const R=OE(this.pixelTransform);this.useContainer(e,R,this.getBackground(t));const x=this.context,T=x.canvas;T.width!=v||T.height!=y?(T.width=v,T.height=y):this.containerReused||x.clearRect(0,0,v,y);let w=!1,C=!0;if(h.extent){const z=Ve(h.extent,u.projection);C=tr(z,t.extent),w=C&&!ns(z,t.extent),w&&this.clipUnrotated(x,t,z)}const L=n.getImage(),O=yn(this.tempTransform,v/2,y/2,f,_,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const lt=L.width*O[0],tt=L.height*O[3];if(this.getLayer().getSource().getInterpolate()||(x.imageSmoothingEnabled=!1),this.preRender(x,t),C&&lt>=.5&&tt>=.5){const z=O[4],V=O[5],it=h.opacity;let Xt;it!==1&&(Xt=x.globalAlpha,x.globalAlpha=it),x.drawImage(L,0,0,+L.width,+L.height,z,V,lt,tt),it!==1&&(x.globalAlpha=Xt)}return this.postRender(x,t),w&&x.restore(),x.imageSmoothingEnabled=!0,R!==T.style.transform&&(T.style.transform=R),this.container}}class WT extends BT{constructor(t){super(t)}createRenderer(){return new VT(this)}getData(t){return super.getData(t)}}const Yh=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],qh={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class Td extends ir{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target}),this.on,this.once,this.un,this.keys_=t.keys!==void 0?t.keys:!1,this.source_=t.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=t.className!==void 0?t.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=t.activeClassName!==void 0?t.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=t.inactiveClassName!==void 0?t.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const e=t.label!==void 0?t.label:"";this.labelNode_=typeof e=="string"?document.createTextNode(e):e;const n=t.labelActive!==void 0?t.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const r=t.tipLabel?t.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(N.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${gi} ${$s}`,this.element.appendChild(this.button_)}handleClick_(t){t.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const t=this.getMap();if(!t)return;const e=t.getOwnerDocument();if(Qh(e))if(Jh(e))YT(e);else{let n;this.source_?n=typeof this.source_=="string"?e.getElementById(this.source_):this.source_:n=t.getTargetElement(),this.keys_?HT(n):vd(n)}}handleFullScreenChange_(){const t=this.getMap();if(!t)return;const e=this.isInFullscreen_;this.isInFullscreen_=Jh(t.getOwnerDocument()),e!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(ts(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(qh.ENTERFULLSCREEN)):(ts(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(qh.LEAVEFULLSCREEN)),t.updateSize())}setClassName_(t,e){e?(t.classList.remove(...this.inactiveClassName_),t.classList.add(...this.activeClassName_)):(t.classList.remove(...this.activeClassName_),t.classList.add(...this.inactiveClassName_))}setMap(t){const e=this.getMap();e&&e.removeChangeListener(vt.TARGET,this.boundHandleMapTargetChange_),super.setMap(t),this.handleMapTargetChange_(),t&&t.addChangeListener(vt.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const t=this.documentListeners_;for(let n=0,r=t.length;n<r;++n)at(t[n]);t.length=0;const e=this.getMap();if(e){const n=e.getOwnerDocument();Qh(n)?this.element.classList.remove(Uh):this.element.classList.add(Uh);for(let r=0,s=Yh.length;r<s;++r)t.push(Z(n,Yh[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Qh(i){const t=i.body;return!!(t.webkitRequestFullscreen||t.requestFullscreen&&i.fullscreenEnabled)}function Jh(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function vd(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function HT(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():vd(i)}function YT(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}const bo="units",qT=[1,2,5],Ri=25.4/.28;class Rd extends ir{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const n=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+gi,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(bo,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(bo)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(bo,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=t.center,n=t.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=as(n,t.resolution,e,s);const a=this.minWidth_*(this.dpi_||Ri)/Ri,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Ri)/Ri:void 0;let h=a*o,c="";if(r=="degrees"){const v=ni.degrees;h*=v,h<v/60?(c="",o*=3600):h<v?(c="",o*=60):c=""}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,g,f,_,m,E;for(;;){f=Math.floor(u/3);const v=Math.pow(10,f);if(d=qT[(u%3+3)%3]*v,g=Math.round(d/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=_,g=m,f=E;break}else if(g>=a)break;_=d,m=g,E=f,++u}const p=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,n){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const u=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,t,!1,e,n):"")+"</div>")}return l.push(this.createStepText(o,t,!0,e,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+s+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,n,r,s){const a=(t===0?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+s),l=t===0?-3:e/this.scaleBarSteps_*-1,h=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${t===0?"left":"center"};min-width: ${h}px;left: ${n?e+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const t=as(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||Ri,n=1e3/25.4;return t*n*e}render(t){const e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}}t0(()=>Promise.resolve({}),__vite__mapDeps([0]));const xd=500,QT=!0;function JT(i,t){let e,n,r,s;const o=()=>{const u=t.srid(),d=t.fullExtent();return u==="EPSG:3857"?d:t.transformRectangle(d,u,"EPSG:3857")},a=()=>{i.innerHTML="";const u=o().center();e=new ne({center:[u.x,u.y],zoom:10}),s=new PE(t,{debug:!1,extentBufferFactor:()=>document.getElementById("extentBufferFactor").valueAsNumber}),r=new ia({source:s}),n=new rd({target:i,view:e,controls:ll().extend([new Rd,new Td]),layers:[r,new ia({visible:QT,source:new Gu({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),style:{saturation:["var","saturation"],variables:{saturation:-.75}}})].reverse()}),n.once("precompose",function(d){l()})},l=()=>{const u=o();e.fit([u.xMinimum,u.yMinimum,u.xMaximum,u.yMaximum],{duration:xd}),setTimeout(()=>{h()},0)},h=()=>{s?.clear(),r?.getRenderer()?.clearCache(),r?.changed()},c=document.getElementById("xyzBaseMap");return c&&c.addEventListener("change",()=>{n&&n.getLayers().getArray()[0].setVisible(c.checked)}),a(),{init:a,update:l,render:h}}function t1(i,t){let e,n,r,s,o;const a=()=>{i.innerHTML="",n=t.srid();const c=new rs({code:n,units:"m"}),d=t.fullExtent().center();e=new ne({projection:c,center:[d.x,d.y],zoom:10}),o=new Rh(t,{projection:c}),s=new WT({source:o}),r=new rd({target:i,view:e,controls:ll().extend([new Rd,new Td]),layers:[s]}),r.once("precompose",function(g){const f=t.fullExtent();e.fit([f.xMinimum,f.yMinimum,f.xMaximum,f.yMaximum],{duration:xd})})},l=()=>{a()},h=()=>{setTimeout(()=>{o=new Rh(t,{projection:new rs({code:n,units:"m"})}),s?.setSource(o)},0)};return a(),{init:a,update:l,render:h}}function e1(i,t){const e=()=>{i.innerHTML="";const n=document.createElement("div");n.className="layers",i.appendChild(n);const r=t.mapLayers();for(const s of r){const o=document.createElement("div");o.className="layer";const a=document.createElement("input");a.type="checkbox",s.visible&&(a.checked=!0),a.addEventListener("change",()=>{s.visible=a.checked,redraw(),e()}),o.appendChild(a);const l=document.createTextNode(s.name);o.appendChild(l);const h=document.createElement("input");s.visible||(h.style.visibility="hidden"),h.type="range",h.min="0",h.max="100",h.value=""+s.opacity*100,h.step="1",h.addEventListener("change",()=>{s.opacity=parseInt(h.value)/100,redraw()}),o.appendChild(h),n.appendChild(o)}if(t.mapThemes().length>0){const s=document.createElement("div");s.className="themes",i.appendChild(s);const o=document.createElement("select");o.addEventListener("change",()=>{o.value&&(t.setMapTheme(o.value),redraw(),e())}),s.appendChild(o);const a=t.getMapTheme(),l=document.createElement("option");l.value="",l.text="",a||(l.selected=!0),o.appendChild(l);for(const h of t.mapThemes()){const c=document.createElement("option");c.value=h,c.text=h,h===a&&(c.selected=!0),o.appendChild(c)}}};return e(),e}const he=!1,n1=i=>({owner:"boardend",repo:"qgis-js-projects",path:"/"+i,branch:"main",prefix:`${i[0].toUpperCase()}${i.slice(1)}: `}),i1=[n1("demo")];async function r1(){console.log(`qgis-js (${bp})`);const i=document.getElementById("status"),t=document.getElementById("project");let e=!1;const n=o=>{e||(i.firstElementChild.innerHTML=o)},r=o=>{e=!0,console.error(o);const a=""+o&&o.message?o.message:"Runtime error";t.style.visibility="none",i.style.display="auto",i.innerHTML=`<div class="alert alert-danger" role="alert">
      <b style="color: red">Error:&nbsp;</b>
      ${a}
    </div>`},s=()=>{i.style.display="none",t.style.visibility="visible"};try{const{api:o,fs:a}=await Cp({prefix:"dist/assets/wasm",onStatus:T=>n(T)});n("Loading projects...");const l=[],h=[],{openProject:c,loadLocalProject:u,loadRemoteProjects:d,loadGithubProjects:g}=Yp(a,T=>{o.loadProject(T),setTimeout(()=>{l.forEach(w=>w())},0)}),f=async function(){const T=await u();await c(T),E(T.name,()=>T),m.value=T.name},_=new Map,m=document.getElementById("projects");m.addEventListener("change",()=>{const T=_.get(m.value);T&&c(T())});const E=(T,w)=>{_.set(T,w);const C=document.createElement("option");C.value=T,C.text=T,m.add(C,null)};document.getElementById("local-project").onclick=f;const p=await d();p.forEach(T=>E(T.name,()=>T));for(const T of i1)try{const w=await g(T.owner,T.repo,T.path,T.branch);Object.entries(w).forEach(([C,L])=>{E((T.prefix||"")+C,L)})}catch(w){console.warn(`Unable to load GitHub project "${T.owner}/${T.repo}"`,w)}n("Opening first project..."),await c(p[0]),n("Rendering first frame..."),await o.renderImage(o.srid(),o.fullExtent(),42,42,1),s();const v=document.getElementById("layers-control");v&&l.push(e1(v,o,()=>{setTimeout(()=>{h.forEach(T=>T())},0)}));const y=document.getElementById("js-demo-canvas");if(y){const{update:T,render:w}=qp(y,o);l.push(T),h.push(w);const C=document.getElementById("tab1");C.addEventListener("change",()=>{C.checked&&T()})}const R=document.getElementById("ol-demo-xyz");if(R){const{update:T,render:w}=JT(R,o);l.push(T),h.push(w)}const x=document.getElementById("ol-demo-canvas");if(x){const{update:T,render:w}=t1(x,o);l.push(T),h.push(w)}}catch(o){r(o)}}document.addEventListener("DOMContentLoaded",function(){r1()});
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ol-CSy_vbSQ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
