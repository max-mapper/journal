(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();var X0=Object.defineProperty,z0=(i,e,t)=>e in i?X0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ms=(i,e,t)=>(z0(i,typeof e!="symbol"?e+"":e,t),t),s_=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ei=(i,e,t)=>(s_(i,e,"read from private field"),t?t.call(i):e.get(i)),Zl=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},On=(i,e,t,n)=>(s_(i,e,"write to private field"),e.set(i,t),t),Sd=(i,e,t,n)=>({set _(r){On(i,e,r)},get _(){return Ei(i,e,n)}});function B0(){return Math.min(Math.max(navigator?.hardwareConcurrency||4,4),8)}let $0=class{constructor(i){ms(this,"value"),ms(this,"next"),this.value=i}};var ln,or,ar;let K0=class{constructor(){Zl(this,ln,void 0),Zl(this,or,void 0),Zl(this,ar,void 0),this.clear()}enqueue(i){const e=new $0(i);Ei(this,ln)?(Ei(this,or).next=e,On(this,or,e)):(On(this,ln,e),On(this,or,e)),Sd(this,ar)._++}dequeue(){const i=Ei(this,ln);if(i)return On(this,ln,Ei(this,ln).next),Sd(this,ar)._--,i.value}clear(){On(this,ln,void 0),On(this,or,void 0),On(this,ar,0)}get size(){return Ei(this,ar)}*[Symbol.iterator](){let i=Ei(this,ln);for(;i;)yield i.value,i=i.next}};ln=new WeakMap,or=new WeakMap,ar=new WeakMap;const V0={bind(i,e,t){return i.bind(t)}};function Z0(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new K0;let t=0;const n=()=>{t--,e.size>0&&e.dequeue()()},r=async(a,l,h)=>{t++;const c=(async()=>a(...h))();l(c);try{await c}catch{}n()},s=(a,l,h)=>{e.enqueue(V0.bind(r.bind(void 0,a,l,h))),(async()=>(await Promise.resolve(),t<i&&e.size>0&&e.dequeue()()))()},o=(a,...l)=>new Promise(h=>{s(a,h,l)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}}}),o}let H0=class{constructor(i){ms(this,"_api"),ms(this,"_threadPoolSize"),ms(this,"_limit"),this._api=i,this._threadPoolSize=B0(),this._limit=Z0(this._threadPoolSize)}runLimited(i){return this._limit(i)}renderImage(i,e,t,n,r=window?.devicePixelRatio||1){return this.runLimited(()=>new Promise(s=>{this._api.renderImage(i,e,t,n,r,o=>{const a=new Uint8ClampedArray(o),l=new ImageData(a,t,n);s(l)})}))}renderXYZTile(i,e,t,n=256,r=window?.devicePixelRatio||1,s=0){return this.runLimited(()=>new Promise(o=>{this._api.renderXYZTile(i,e,t,n,r,s,a=>{const l=new Uint8ClampedArray(a),h=new ImageData(l,n,n);o(h)})}))}mapLayers(){const i=this._api.mapLayers(),e=new Array(i.size());for(let t=0;t<i.size();t++)e[t]=i.get(t);return e}mapThemes(){const i=this._api.mapThemes(),e=new Array(i.size());for(let t=0;t<i.size();t++)e[t]=i.get(t);return e}};function W0(i){const e=new H0(i);return new Proxy({},{has(t,n){return n in e||n in i},get(t,n){if(n in e)return e[n];if(n in i)return i[n]}})}function Y0(i){return new Promise(async(e,t)=>{try{const n=(await new Function(`return import("${i}")`)()).default;e({createQtAppInstance:n})}catch(n){t(n)}})}async function q0(i={}){return new Promise(async(e,t)=>{let n;if(i.prefix)n=i.prefix;else{const l=import.meta.url;/.*\/src\/loader\.[ts|js]\?*[^/]*$/.test(l)?(console.warn(['qgis-js loader is running in development mode and no "prefix" seems to be configured.'," - Consider adding the QgisRuntimePlugin when bundling with Vite."," - For more information see: https://github.com/qgis/qgis-js/blob/main/docs/bundling.md"].join(`
`)),typeof window<"u"&&(n=new URL("assets/wasm",window.location.href).pathname)):n=new URL("assets/wasm",import.meta.url).href}n?n=n.replace(/\/$/,""):n="assets/wasm";let r;try{const l=`${n}/qgis-js.js`;r=await Y0(l)}catch(l){t(new Error("Unable to load the qgis-js.js script",{cause:l}));return}const{createQtAppInstance:s}=r;let o;typeof document<"u"&&(o=document?.querySelector("#screen"));const a=s({locateFile:l=>`${n}/`+l,preRun:[function(l){l.qtContainerElements=o?[o]:[],l.qtFontDpi=96}],postRun:[async function(){const l=await a;e({api:W0(l),module:l,fs:l.FS})}],...i.onStatus?{setStatus:i.onStatus}:{}})})}const Q0="0.0.3";var J0=Object.defineProperty,eE=(i,e,t)=>e in i?J0(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,It=(i,e,t)=>(eE(i,typeof e!="symbol"?e+"":e,t),t);const Ii="/upload/projects";let Uc=class{constructor(i,e){It(this,"FS"),It(this,"type"),It(this,"name"),this.FS=i,this.type=e}isValid(){return this.getFiles().length>0&&this.getProjectFile()!==void 0}getProjectFile(){const i=this.getFiles().filter(e=>e.endsWith(".qgs")||e.endsWith(".qgz"));return i.length==1?i[0]:i.length>1?(console.warn("Found multiple project file candiates"),i[0]):void 0}getDirectoriesToCreate(){const i=new Set;for(const e of this.getDirectories()){let t=e.split("/");for(let n=0;n<t.length;n++){const r=t.slice(0,n+1).join("/");i.add(r)}}return Array.from(i).sort()}ensureDirectories(){for(const i of this.getDirectoriesToCreate()){const e=Ii+"/"+i,t=this.FS.analyzePath(e,!1);(!t||!t.exists)&&this.FS.mkdir(e)}}isProjectUploaded(){return this.FS.readdir(Ii).includes(this.name)}};const Gc=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();Gc?Promise.resolve().then(function(){return sE}):Promise.resolve().then(function(){return uE});const tE=Gc?Promise.resolve().then(function(){return aE}):Promise.resolve().then(function(){return gE});async function nE(...i){return(await tE).default(...i)}Gc?Promise.resolve().then(function(){return hE}):Promise.resolve().then(function(){return _E});const iE=async i=>{const e=await i.getFile();return e.handle=i,e};var rE=async(i=[{}])=>{Array.isArray(i)||(i=[i]);const e=[];i.forEach((r,s)=>{e[s]={description:r.description||"Files",accept:{}},r.mimeTypes?r.mimeTypes.map(o=>{e[s].accept[o]=r.extensions||[]}):e[s].accept["*/*"]=r.extensions||[]});const t=await window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:e,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await Promise.all(t.map(iE));return i[0].multiple?n:n[0]},sE={__proto__:null,default:rE};function Zo(i){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:n}})}return Zo=function(t){this.s=t,this.n=t.next},Zo.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?Promise.reject(t):e(n.apply(this.s,arguments))}},new Zo(i)}const o_=async(i,e,t=i.name,n)=>{const r=[],s=[];var o,a=!1,l=!1;try{for(var h,c=function(u){var d,g,f,_=2;for(typeof Symbol<"u"&&(g=Symbol.asyncIterator,f=Symbol.iterator);_--;){if(g&&(d=u[g])!=null)return d.call(u);if(f&&(d=u[f])!=null)return new Zo(d.call(u));g="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());a=!(h=await c.next()).done;a=!1){const u=h.value,d=`${t}/${u.name}`;u.kind==="file"?s.push(u.getFile().then(g=>(g.directoryHandle=i,g.handle=u,Object.defineProperty(g,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):u.kind!=="directory"||!e||n&&n(u)||r.push(o_(u,e,d,n))}}catch(u){l=!0,o=u}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]};var oE=async(i={})=>{i.recursive=i.recursive||!1,i.mode=i.mode||"read";const e=await window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return(await(await e.values()).next()).done?[e]:o_(e,i.recursive,void 0,i.skipDirectory)},aE={__proto__:null,default:oE},lE=async(i,e=[{}],t=null,n=!1,r=null)=>{Array.isArray(e)||(e=[e]),e[0].fileName=e[0].fileName||"Untitled";const s=[];let o=null;if(i instanceof Blob&&i.type?o=i.type:i.headers&&i.headers.get("content-type")&&(o=i.headers.get("content-type")),e.forEach((h,c)=>{s[c]={description:h.description||"Files",accept:{}},h.mimeTypes?(c===0&&o&&h.mimeTypes.push(o),h.mimeTypes.map(u=>{s[c].accept[u]=h.extensions||[]})):o?s[c].accept[o]=h.extensions||[]:s[c].accept["*/*"]=h.extensions||[]}),t)try{await t.getFile()}catch(h){if(t=null,n)throw h}const a=t||await window.showSaveFilePicker({suggestedName:e[0].fileName,id:e[0].id,startIn:e[0].startIn,types:s,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1});!t&&r&&r(a);const l=await a.createWritable();return"stream"in i?(await i.stream().pipeTo(l),a):"body"in i?(await i.body.pipeTo(l),a):(await l.write(await i),await l.close(),a)},hE={__proto__:null,default:lE},cE=async(i=[{}])=>(Array.isArray(i)||(i=[i]),new Promise((e,t)=>{const n=document.createElement("input");n.type="file";const r=[...i.map(l=>l.mimeTypes||[]),...i.map(l=>l.extensions||[])].join();n.multiple=i[0].multiple||!1,n.accept=r||"",n.style.display="none",document.body.append(n);const s=l=>{typeof o=="function"&&o(),e(l)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(t),n),a=()=>{window.removeEventListener("focus",a),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",a)}),n.addEventListener("change",()=>{window.removeEventListener("focus",a),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),uE={__proto__:null,default:cE},dE=async(i=[{}])=>(Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((e,t)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=o=>{typeof s=="function"&&s(),e(o)},s=i[0].legacySetup&&i[0].legacySetup(r,()=>s(t),n);n.addEventListener("change",()=>{let o=Array.from(n.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!i[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),r(o)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),gE={__proto__:null,default:dE},fE=async(i,e={})=>{Array.isArray(e)&&(e=e[0]);const t=document.createElement("a");let n=i;"body"in i&&(n=await async function(o,a){const l=o.getReader(),h=new ReadableStream({start:d=>async function g(){return l.read().then(({done:f,value:_})=>{if(!f)return d.enqueue(_),g();d.close()})}()}),c=new Response(h),u=await c.blob();return l.releaseLock(),new Blob([u],{type:a})}(i.body,i.headers.get("content-type"))),t.download=e.fileName||"Untitled",t.href=URL.createObjectURL(await n);const r=()=>{typeof s=="function"&&s()},s=e.legacySetup&&e.legacySetup(r,()=>s(),t);return t.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(t.href),3e4),r()}),t.click(),null},_E={__proto__:null,default:fE};class mE extends Uc{constructor(e,t){super(e,"Local"),It(this,"entries"),this.entries=t;const n=t.map(r=>r.webkitRelativePath).filter(r=>r&&r.length>0&&r.includes("/")).map(r=>r.split("/",1)[0]);if(n.length<1)throw new Error("Could not determine project name");this.name=n[0]}getDirectories(){const e=new Set;e.add(this.name);for(const t of this.entries){const n=t.webkitRelativePath;e.add(n.substring(0,n.lastIndexOf("/")))}return Array.from(e)}getFiles(){return this.entries.map(e=>e.webkitRelativePath)}async uploadProject(){this.ensureDirectories();for(const e of this.entries)this.FS.writeFile(Ii+"/"+e.webkitRelativePath,new Uint8Array(await e.arrayBuffer()))}}function jc(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat([e+"/"+n.name,...jc(n.entries,e+"/"+n.name)]):t,[])}function kc(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat(kc(n.entries,e+"/"+n.name)):t.concat(e+"/"+n.name),[])}class pE extends Uc{constructor(e,t,n){super(e,"Remote"),It(this,"folder"),It(this,"path"),It(this,"baseUrl"),this.baseUrl=new URL(t),this.folder=n;const r=this.baseUrl.pathname.split("/").pop();this.name=n.name,this.path=n.path.replace(new RegExp(`^${r}/`),"")}getDirectories(){return[this.path,...jc(this.folder.entries,this.path)]}getFiles(){return kc(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise((n,r)=>{const s=new URL(`${this.baseUrl.href}/${t}`);fetch(s).then(o=>o.arrayBuffer().then(a=>{n(a)}))})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Ii+"/"+t,n)}}}const a_="main";async function EE(i,e,t="/",n=a_){const r=`https://api.github.com/repos/${i}/${e}/contents${t}?ref=${n}`;return await(await fetch(r)).json()}async function yE(i,e,t){const n=`https://api.github.com/repos/${i}/${e}/git/trees/${t}?recursive=1`;return(await(await fetch(n)).json()).tree.filter(r=>r.type==="blob").map(r=>r.path)}function TE(i,e,t){const n={name:i,path:e,type:"Folder",entries:[]};return t.sort().forEach(r=>{const s=r.split("/");let o=n;for(let a=0;a<s.length-1;a++){const l=s[a],h=o.entries.find(c=>c.name===l);if(h)o=h;else{const c={name:l,path:o.path+"/"+l,type:"Folder",entries:[]};o.entries.push(c),o=c}}o.entries.push({name:s[s.length-1],path:r,type:"File"})}),n}class vE extends Uc{constructor(e,t,n,r,s=a_){super(e,"Github"),It(this,"folder"),It(this,"path"),It(this,"owner"),It(this,"repo"),It(this,"branch"),this.folder=t,this.name=t.name,this.path=t.path,this.owner=n,this.repo=r,this.branch=s}getDirectories(){return[this.path,...jc(this.folder.entries,this.path)]}getFiles(){return kc(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise(async(n,r)=>{const s=`https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${t}`,o=await fetch(s);n(o.arrayBuffer())})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Ii+"/"+t,n)}}}function RE(i,e){let t=Ii.split("/");for(let s=1;s<t.length;s++)i.mkdir(t.slice(0,s+1).join("/"));const n=async s=>{if(s){if(s instanceof Promise&&(s=await s),!s.isValid())throw new Error(`Project "${s.name}" is not valid`);s.isProjectUploaded()||await s.uploadProject(),r(s)}else return},r=s=>{const o=Ii+"/"+s.getProjectFile();e(o)};return{openProject:n,loadLocalProject:()=>new Promise(async(s,o)=>{try{const a=await nE({recursive:!0,mode:"read"}),l=new mE(i,a);s(l)}catch(a){o(a)}}),loadRemoteProjects:(s="./projects/directory-listing.json")=>new Promise(async(o,a)=>{try{const l=new URL(s,window.location.href).href.split("/").slice(0,-1).join("/"),h=await(await fetch(s)).json();if(!h.type||h.type!=="Folder"){a(new Error("Remote projects response seems not a folder"));return}o(h.entries.filter(c=>c.type==="Folder").map(c=>new pE(i,l,c)))}catch(l){a(l)}}),loadGithubProjects:(s,o,a="/",l="main")=>new Promise(async(h,c)=>{try{const u=await EE(s,o,a,l);if(u instanceof Array)h(Object.fromEntries(u.filter(d=>d.type==="dir").map(d=>[d.name,()=>new Promise(async g=>{const f=await yE(s,o,d.sha);g(new vE(i,TE(d.name,d.path,f),s,o,l))})])));else{console.warn(u),h({});return}}catch(u){c(u)}})}}const Ld=1.5,po=.1;function xE(i,e){let t=null;new ResizeObserver(s=>{const o=s.find(a=>a.target===i);o&&(i.width=o.devicePixelContentBoxSize[0].inlineSize,i.height=o.devicePixelContentBoxSize[0].blockSize),n()}).observe(i,{box:"device-pixel-content-box"});async function n(){var s=window.devicePixelRatio||1,o=i.getBoundingClientRect();const a=o.width*s,l=o.height*s;if(a&&l){const h=await e.renderImage(e.srid(),t,a,l,window.devicePixelRatio),c=i.getContext("2d");i.width=a,i.height=l,c.scale(s,s),c.putImageData(h,0,0)}}document.getElementById("zoomin").onclick=function(){t.scale(1/Ld),n()},document.getElementById("zoomout").onclick=function(){t.scale(Ld),n()},document.getElementById("panleft").onclick=function(){t.move((t.xMaximum-t.xMinimum)*po,0),n()},document.getElementById("panright").onclick=function(){t.move(-(t.xMaximum-t.xMinimum)*po,0),n()},document.getElementById("panup").onclick=function(){t.move(0,-(t.yMaximum-t.yMinimum)*po),n()},document.getElementById("pandown").onclick=function(){t.move(0,(t.yMaximum-t.yMinimum)*po),n()};function r(){t=e.fullExtent(),n()}return r(),{update:()=>{r()},render:()=>{n()}}}const wE="modulepreload",CE=function(i){return"/"+i},Pd={},bE=function(i,e,t){let n=Promise.resolve();return e&&e.length>0&&(document.getElementsByTagName("link"),n=Promise.all(e.map(r=>{if(r=CE(r),r in Pd)return;Pd[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":wE,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,h)=>{a.addEventListener("load",l),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})}))),n.then(()=>i()).catch(r=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r})},j={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class nl{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}class Tn{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function Xc(i,e){return i>e?1:i<e?-1:0}function IE(i,e){return i<e?1:i>e?-1:0}function il(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===e)return r;if(s<e)return t(e,i[r-1],s)>0?r-1:r}return n-1}if(t>0){for(let r=1;r<n;++r)if(i[r]<e)return r-1;return n-1}if(t<0){for(let r=1;r<n;++r)if(i[r]<=e)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==e)return r;if(i[r]<e)return i[r-1]-e<e-i[r]?r-1:r}return n-1}function SE(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let r=0;r<n;r++)i[i.length]=t[r]}function rl(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function LE(i,e,t){const n=e||Xc;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||o===0)})}function aa(){return!0}function sl(){return!1}function la(){}function PE(i){let e=!1,t,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!rl(s,n))&&(e=!0,r=this,n=s,t=i.apply(this,arguments)),t}}function AE(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function ks(i){for(const e in i)delete i[e]}function ME(i){let e;for(e in i)return!1;return!e}class Xs extends nl{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),r=n[e]||(n[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=t?new Tn(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,la);delete o[n]}return l}disposeInternal(){this.listeners_&&ks(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const r=n.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[r]=la,++this.pendingRemovals_[e]):(n.splice(r,1),n.length===0&&delete this.listeners_[e]))}}const P={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Ce(){throw new Error("Unimplemented abstract method.")}let OE=0;function qe(i){return i.ol_uid||(i.ol_uid=String(++OE))}function l_(i){return Math.pow(i,3)}function jr(i){return 1-l_(1-i)}function DE(i){return 3*i*i-2*i*i*i}function NE(i){return i}class zc extends Xs{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(j.CHANGE)}release(){this.state===P.ERROR&&this.setState(P.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==P.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==P.LOADED){e.interimTile=null;break}e.getState()==P.LOADING?t=e:e.getState()==P.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==P.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Ce()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const r=t-n+1e3/60;return r>=this.transition_?1:l_(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const oi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",FE=oi.includes("firefox"),UE=oi.includes("safari")&&!oi.includes("chrom"),GE=UE&&(oi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(oi)),jE=oi.includes("webkit")&&!oi.includes("edge"),h_=oi.includes("macintosh"),c_=typeof devicePixelRatio<"u"?devicePixelRatio:1,u_=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,kE=typeof Image<"u"&&Image.prototype.decode,d_=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}();function sn(i,e,t,n){let r;return t&&t.length?r=t.shift():u_?r=new OffscreenCanvas(i||300,e||300):r=document.createElement("canvas"),i&&(r.width=i),e&&(r.height=e),r.getContext("2d",n)}function Rs(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function ha(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function $h(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function XE(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function zE(i,e){const t=i.childNodes;for(let n=0;;++n){const r=t[n],s=e[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}const ye={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ie(i,e,t,n,r){if(n&&n!==i&&(t=t.bind(n)),r){const o=t;t=function(){i.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:i,type:e,listener:t};return i.addEventListener(e,t),s}function ca(i,e,t,n){return ie(i,e,t,n,!0)}function Re(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ks(i))}class BE extends Xs{constructor(e,t,n,r){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=typeof r=="function"?ye.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(j.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ye.IDLE&&this.loader){this.state=ye.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;AE(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=ye.LOADED}).catch(n=>{this.state=ye.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function $E(i,e,t){const n=i;let r=!0,s=!1,o=!1;const a=[ca(n,j.LOAD,function(){o=!0,s||e()})];return n.src&&kE?(s=!0,n.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(ca(n,j.ERROR,t)),function(){r=!1,a.forEach(Re)}}const g_=BE;class ol extends zc{constructor(e,t,n,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=P.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=P.ERROR,this.unlistenImage_(),this.image_=KE(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=P.LOADED:this.state=P.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==P.ERROR&&(this.state=P.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==P.IDLE&&(this.state=P.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=$E(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function KE(){const i=sn(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const Bc=.5,He={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Kh(i){const e=kr();for(let t=0,n=i.length;t<n;++t)Ho(e,i[t]);return e}function VE(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function f_(i,e,t){let n,r;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?r=i[1]-t:i[3]<t?r=t-i[3]:r=0,n*n+r*r}function xs(i,e){return __(i,e[0],e[1])}function ua(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function __(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function Ad(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=e[0],a=e[1];let l=He.UNKNOWN;return o<t?l=l|He.LEFT:o>r&&(l=l|He.RIGHT),a<n?l=l|He.BELOW:a>s&&(l=l|He.ABOVE),l===He.UNKNOWN&&(l=He.INTERSECTING),l}function kr(){return[1/0,1/0,-1/0,-1/0]}function zs(i,e,t,n,r){return r?(r[0]=i,r[1]=e,r[2]=t,r[3]=n,r):[i,e,t,n]}function al(i){return zs(1/0,1/0,-1/0,-1/0,i)}function ZE(i,e){const t=i[0],n=i[1];return zs(t,n,t,n,e)}function HE(i,e,t,n,r){const s=al(r);return m_(s,i,e,t,n)}function Vh(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function WE(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function Ho(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function m_(i,e,t,n,r){for(;t<n;t+=r)YE(i,e[t],e[t+1]);return i}function YE(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function p_(i,e){let t;return t=e(ll(i)),t||(t=e(hl(i)),t)||(t=e(cl(i)),t)||(t=e(Xr(i)),t)?t:!1}function ws(i){let e=0;return Fi(i)||(e=Le(i)*ht(i)),e}function ll(i){return[i[0],i[1]]}function hl(i){return[i[2],i[1]]}function Si(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function qE(i,e){let t;if(e==="bottom-left")t=ll(i);else if(e==="bottom-right")t=hl(i);else if(e==="top-left")t=Xr(i);else if(e==="top-right")t=cl(i);else throw new Error("Invalid corner");return t}function da(i,e,t,n,r){const[s,o,a,l,h,c,u,d]=QE(i,e,t,n);return zs(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function QE(i,e,t,n){const r=e*n[0]/2,s=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,h=r*a,c=s*o,u=s*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function ht(i){return i[3]-i[1]}function Pt(i,e,t){const n=t||kr();return Bs(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):al(n),n}function Xr(i){return[i[0],i[3]]}function cl(i){return[i[2],i[3]]}function Le(i){return i[2]-i[0]}function Bs(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function Fi(i){return i[2]<i[0]||i[3]<i[1]}function JE(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function ey(i,e,t){let n=!1;const r=Ad(i,e),s=Ad(i,t);if(r===He.INTERSECTING||s===He.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],d=t[0],g=t[1],f=(g-u)/(d-c);let _,m;s&He.ABOVE&&!(r&He.ABOVE)&&(_=d-(g-h)/f,n=_>=o&&_<=l),!n&&s&He.RIGHT&&!(r&He.RIGHT)&&(m=g-(d-l)*f,n=m>=a&&m<=h),!n&&s&He.BELOW&&!(r&He.BELOW)&&(_=d-(g-a)/f,n=_>=o&&_<=l),!n&&s&He.LEFT&&!(r&He.LEFT)&&(m=g-(d-o)*f,n=m>=a&&m<=h)}return n}const Or={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ga{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Or[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const $s=6378137,vr=Math.PI*$s,ty=[-vr,-vr,vr,vr],ny=[-180,-85,180,85],Eo=$s*Math.log(Math.tan(Math.PI/2));class zi extends ga{constructor(e){super({code:e,units:"m",extent:ty,global:!0,worldExtent:ny,getPointResolution:function(t,n){return t/Math.cosh(n[1]/$s)}})}}const Md=[new zi("EPSG:3857"),new zi("EPSG:102100"),new zi("EPSG:102113"),new zi("EPSG:900913"),new zi("http://www.opengis.net/def/crs/EPSG/0/3857"),new zi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function iy(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t){e[r]=vr*i[r]/180;let s=$s*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>Eo?s=Eo:s<-Eo&&(s=-Eo),e[r+1]=s}return e}function ry(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t)e[r]=180*i[r]/vr,e[r+1]=360*Math.atan(Math.exp(i[r+1]/$s))/Math.PI-90;return e}const sy=6378137,Od=[-180,-90,180,90],oy=Math.PI*sy/180;class hi extends ga{constructor(e,t){super({code:e,units:"degrees",extent:Od,axisOrientation:t,global:!0,metersPerUnit:oy,worldExtent:Od})}}const Dd=[new hi("CRS:84"),new hi("EPSG:4326","neu"),new hi("urn:ogc:def:crs:OGC:1.3:CRS84"),new hi("urn:ogc:def:crs:OGC:2:84"),new hi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new hi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new hi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Zh={};function ay(i){return Zh[i]||Zh[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function ly(i,e){Zh[i]=e}let wr={};function fa(i,e,t){const n=i.getCode(),r=e.getCode();n in wr||(wr[n]={}),wr[n][r]=t}function hy(i,e){let t;return i in wr&&e in wr[i]&&(t=wr[i][e]),t}function je(i,e,t){return Math.min(Math.max(i,e),t)}function cy(i,e,t,n,r,s){const o=r-t,a=s-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=r,n=s):l>0&&(t+=o*l,n+=a*l)}return Cr(i,e,t,n)}function Cr(i,e,t,n){const r=t-i,s=n-e;return r*r+s*s}function uy(i){const e=i.length;for(let n=0;n<e;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let r=n-1;r>=0;r--)i[r][e]-=i[r][n]*t[n]}return t}function Wo(i){return i*Math.PI/180}function br(i,e){const t=i%e;return t*e<0?t+e:t}function dy(i,e,t){return i+t*(e-i)}function E_(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function yo(i,e){return Math.floor(E_(i,e))}function qn(i,e){return Math.ceil(E_(i,e))}function gy(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function _a(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function $c(i,e){const t=Math.cos(e),n=Math.sin(e),r=i[0]*t-i[1]*n,s=i[1]*t+i[0]*n;return i[0]=r,i[1]=s,i}function fy(i,e){return i[0]*=e,i[1]*=e,i}function _y(i,e){if(e.canWrapX()){const t=Le(e.getExtent()),n=my(i,e,t);n&&(i[0]-=n*t)}return i}function my(i,e,t){const n=e.getExtent();let r=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Le(n),r=Math.floor((i[0]-n[0])/t)),r}const py=63710088e-1;function Nd(i,e,t){t=t||py;const n=Wo(i[1]),r=Wo(e[1]),s=(r-n)/2,o=Wo(e[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function y_(...i){console.warn(...i)}let Hh=!0;function Ey(i){Hh=!1}function Kc(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function T_(i,e){if(e!==void 0&&i!==e){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];i=e}return i}function yy(i){ly(i.getCode(),i),fa(i,i,Kc)}function Ty(i){i.forEach(yy)}function Ht(i){return typeof i=="string"?ay(i):i||null}function ma(i,e,t,n){i=Ht(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/Or[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=e;else{const a=Zc(i,Ht("EPSG:4326"));if(a===T_&&o!=="degrees")r=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Nd(h.slice(0,2),h.slice(2,4)),u=Nd(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?Or[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Fd(i){Ty(i),i.forEach(function(e){i.forEach(function(t){e!==t&&fa(e,t,Kc)})})}function vy(i,e,t,n){i.forEach(function(r){e.forEach(function(s){fa(r,s,t),fa(s,r,n)})})}function Vc(i,e){return i?typeof i=="string"?Ht(i):i:Ht(e)}function Kn(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||Zc(i,e)===Kc)&&t}function Zc(i,e){const t=i.getCode(),n=e.getCode();let r=hy(t,n);return r||(r=T_),r}function pa(i,e){const t=Ht(i),n=Ht(e);return Zc(t,n)}function Ry(i,e,t){return pa(e,t)(i,void 0,i.length)}function Wh(i,e){return i}function hn(i,e){return Hh&&!_a(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Hh=!1,y_("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function xy(i,e){return i}function Qn(i,e){return i}function wy(){Fd(Md),Fd(Dd),vy(Dd,Md,iy,ry)}wy();const Cy=10,Ud=.25;class Hc{constructor(e,t,n,r,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=pa(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const T=p[0]+"/"+p[1];return a[T]||(a[T]=l(p)),a[T]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Le(r)>=Le(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Le(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Le(this.targetProj_.getExtent()):null;const h=Xr(n),c=cl(n),u=hl(n),d=ll(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),E=Cy+(o?Math.max(0,Math.ceil(Math.log2(ws(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,m,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(T,y,v){p=Math.min(p,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-p>this.sourceWorldWidth_/2){const y=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];y[0][0]-p>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-p>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-p>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const v=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-v<this.sourceWorldWidth_/2&&(T.source=y)}})}a={}}addTriangle_(e,t,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,n]})}addQuad_(e,t,n,r,s,o,a,l,h){const c=Kh([s,o,a,l]),u=this.sourceWorldWidth_?Le(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=Kh([e,t,n,r]);f=Le(m)/this.targetWorldWidth_>Ud||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Ud||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Bs(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(m);let p;g?p=(br(s[0],d)+br(a[0],d))/2-br(E[0],d):p=(s[0]+a[0])/2-E[0];const T=(s[1]+a[1])/2-E[1];f=p*p+T*T>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(m),p=[(r[0]+e[0])/2,(r[1]+e[1])/2],T=this.transformInv_(p);this.addQuad_(e,t,m,p,s,o,E,T,h-1),this.addQuad_(p,m,n,r,T,E,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(m),p=[(n[0]+r[0])/2,(n[1]+r[1])/2],T=this.transformInv_(p);this.addQuad_(e,m,p,r,s,E,T,l,h-1),this.addQuad_(m,t,n,p,E,o,a,T,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,n,r,s,a,l),_&14||this.addTriangle_(e,n,t,s,a,o),_&&(_&13||this.addTriangle_(t,r,e,o,l,s),_&7||this.addTriangle_(t,r,n,o,l,a))}calculateSourceExtent(){const e=kr();return this.triangles_.forEach(function(t,n,r){const s=t.source;Ho(e,s[0]),Ho(e,s[1]),Ho(e,s[2])}),e}getTriangles(){return this.triangles_}}let Hl;const pn=[];function Gd(i,e,t,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,r)),i.restore()}function Wl(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function by(){if(Hl===void 0){const i=sn(6,6,pn);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Gd(i,4,5,4,0),Gd(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;Hl=Wl(e,0)||Wl(e,4)||Wl(e,8),Rs(i),pn.push(i.canvas)}return Hl}function Yh(i,e,t,n){const r=Ry(t,e,i);let s=ma(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||xs(l,r)){const h=ma(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function v_(i,e,t,n){const r=Si(t);let s=Yh(i,e,r,n);return(!isFinite(s)||s<=0)&&p_(t,function(o){return s=Yh(i,e,o,n),isFinite(s)&&s>0}),s}function Wc(i,e,t,n,r,s,o,a,l,h,c,u,d){const g=sn(Math.round(t*i),Math.round(t*e),pn);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function f(p){return Math.round(p*t)/t}g.globalCompositeOperation="lighter";const _=kr();l.forEach(function(p,T,y){WE(_,p.extent)});let m;if(!d||l.length!==1||h!==0){const p=Le(_),T=ht(_);m=sn(Math.round(t*p/n),Math.round(t*T/n),pn),u||(m.imageSmoothingEnabled=!1);const y=t/n;l.forEach(function(v,x,R){const w=v.extent[0]-_[0],C=-(v.extent[3]-_[3]),b=Le(v.extent),O=ht(v.extent);v.image.width>0&&v.image.height>0&&m.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,w*y,C*y,b*y,O*y)})}const E=Xr(o);return a.getTriangles().forEach(function(p,T,y){const v=p.source,x=p.target;let R=v[0][0],w=v[0][1],C=v[1][0],b=v[1][1],O=v[2][0],J=v[2][1];const z=f((x[0][0]-E[0])/s),U=f(-(x[0][1]-E[1])/s),G=f((x[1][0]-E[0])/s),W=f(-(x[1][1]-E[1])/s),Ne=f((x[2][0]-E[0])/s),Ot=f(-(x[2][1]-E[1])/s),Dt=R,Nt=w;R=0,w=0,C-=Dt,b-=Nt,O-=Dt,J-=Nt;const is=[[C,b,0,0,G-z],[O,J,0,0,Ne-z],[0,0,C,b,W-U],[0,0,O,J,Ot-U]],Ke=uy(is);if(!Ke)return;if(g.save(),g.beginPath(),by()||!u){g.moveTo(G,W);const _e=4,Ze=z-G,bn=U-W;for(let Se=0;Se<_e;Se++)g.lineTo(G+f((Se+1)*Ze/_e),W+f(Se*bn/(_e-1))),Se!=_e-1&&g.lineTo(G+f((Se+1)*Ze/_e),W+f((Se+1)*bn/(_e-1)));g.lineTo(Ne,Ot)}else g.moveTo(G,W),g.lineTo(z,U),g.lineTo(Ne,Ot);g.clip(),g.transform(Ke[0],Ke[2],Ke[1],Ke[3],z,U),g.translate(_[0]-Dt,_[3]-Nt);let Ve;if(m)Ve=m.canvas,g.scale(n/t,-n/t);else{const _e=l[0],Ze=_e.extent;Ve=_e.image,g.scale(Le(Ze)/Ve.width,-ht(Ze)/Ve.height)}g.drawImage(Ve,0,0),g.restore()}),m&&(Rs(m),pn.push(m.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(p,T,y){const v=p.target,x=(v[0][0]-E[0])/s,R=-(v[0][1]-E[1])/s,w=(v[1][0]-E[0])/s,C=-(v[1][1]-E[1])/s,b=(v[2][0]-E[0])/s,O=-(v[2][1]-E[1])/s;g.beginPath(),g.moveTo(w,C),g.lineTo(x,R),g.lineTo(b,O),g.closePath(),g.stroke()}),g.restore()),g.canvas}class ul extends zc{constructor(e,t,n,r,s,o,a,l,h,c,u,d){super(s,P.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=f?Pt(g,f):g;if(ws(m)===0){this.state=P.EMPTY;return}const E=e.getExtent();E&&(_?_=Pt(_,E):_=E);const p=r.getResolution(this.wrappedTileCoord_[0]),T=v_(e,n,m,p);if(!isFinite(T)||T<=0){this.state=P.EMPTY;return}const y=c!==void 0?c:Bc;if(this.triangulation_=new Hc(e,n,m,_,T*y,p),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=t.getZForResolution(T);let v=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(v[1]=je(v[1],_[1],_[3]),v[3]=je(v[3],_[1],_[3])):v=Pt(v,_)),!ws(v))this.state=P.EMPTY;else{const x=t.getTileRangeForExtentAndZ(v,this.sourceZ_);for(let R=x.minX;R<=x.maxX;R++)for(let w=x.minY;w<=x.maxY;w++){const C=h(this.sourceZ_,R,w,a);C&&this.sourceTiles_.push(C)}this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==P.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=P.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Wc(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=P.LOADED}this.changed()}load(){if(this.state==P.IDLE){this.state=P.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==P.IDLE||n==P.LOADING){e++;const r=ie(t,j.CHANGE,function(s){const o=t.getState();(o==P.LOADED||o==P.ERROR||o==P.EMPTY)&&(Re(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,r){t.getState()==P.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Re),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Rs(this.canvas_.getContext("2d")),pn.push(this.canvas_),this.canvas_=null),super.release()}}function me(i,e){if(!i)throw new Error(e)}class R_{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return me(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return me(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){me(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function Ea(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function dl(i,e,t){return i+"/"+e+"/"+t}function Vn(i){return dl(i[0],i[1],i[2])}function Iy(i){return i.split("/").map(Number)}function Sy(i){return(i[1]<<i[0])+i[2]}function Ly(i,e){const t=i[0],n=i[1],r=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(n,r):!0}class x_ extends R_{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),t=Iy(e)[0];this.forEach(n=>{n.tileCoord[0]!==t&&(this.remove(Vn(n.tileCoord)),n.release())})}}const Yl={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Cs={PROPERTYCHANGE:"propertychange"};class Ks extends Xs{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(j.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=ie(this,e[s],t);return r}return ie(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const r=e.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=ca(this,e[s],t)}else n=ca(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)Py(n);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}Ks.prototype.on;Ks.prototype.once;Ks.prototype.un;function Py(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)Re(i[e]);else Re(i)}class jd extends Tn{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class vn extends Ks{constructor(e){super(),this.on,this.once,this.un,qe(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new jd(n,e,t)),n=Cs.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new jd(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const r=this.values_||(this.values_={});if(n)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],ME(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}class w_ extends vn{constructor(e){super(),this.projection=Ht(e.projection),this.attributions_=kd(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,r){t.viewResolver=n,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=kd(e),this.changed()}setState(e){this.state_=e,this.changed()}}function kd(i){return i?Array.isArray(i)?function(e){return i}:typeof i=="function"?i:function(e){return[i]}:null}class Yc{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Bi(i,e,t,n,r){return r!==void 0?(r.minX=i,r.maxX=e,r.minY=t,r.maxY=n,r):new Yc(i,e,t,n)}const Ay=42,qc=256;function My(i,e,t,n,r){let s;for(e+=n;e<t;e+=n)if(s=r(i.slice(e-n,e),i.slice(e,e+n)),s)return s;return!1}function Oy(i,e,t,n,r){return!p_(r,function(s){return!vi(i,e,t,n,s[0],s[1])})}function vi(i,e,t,n,r,s){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function C_(i,e,t,n,r,s){if(t.length===0||!vi(i,e,t[0],n,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(vi(i,t[o-1],t[o],n,r,s))return!1;return!0}function b_(i,e,t,n,r){const s=m_(kr(),i,e,t,n);return Bs(r,s)?ua(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:My(i,e,t,n,function(o,a){return ey(r,o,a)}):!1}function I_(i,e,t,n,r){return!!(b_(i,e,t,n,r)||vi(i,e,t,n,r[0],r[1])||vi(i,e,t,n,r[0],r[3])||vi(i,e,t,n,r[2],r[1])||vi(i,e,t,n,r[2],r[3]))}function Dy(i,e,t,n,r){if(!I_(i,e,t[0],n,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(Oy(i,t[s-1],t[s],n,r)&&!b_(i,t[s-1],t[s],n,r))return!1;return!0}function Xd(i){return i[0]>0&&i[1]>0}function Ny(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function zt(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}const $i=[0,0,0],In=5;class S_{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,me(LE(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,me(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Xr(n)),me(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,me(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:qc,me(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,s)=>{const o=new Yc(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([t,s,a])}forEachTileCoordParentTileRange(e,t,n,r){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=Bi(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return Bi(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return Bi(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),h=Math.floor(s*l),c=Math.floor(o*l);if(t<r)return Bi(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return Bi(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,$i);const r=$i[1],s=$i[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,$i);const o=$i[1],a=$i[2];return Bi(r,o,s,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=zt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=zt(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*s[0]*r,a=n[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return zs(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=zt(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return r?(c=qn(c,In)-1,u=qn(u,In)-1):(c=yo(c,In),u=yo(u,In)),Ea(o,c,u,s)}getTileCoordForXYAndZ_(e,t,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=zt(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return r?(h=qn(h,In)-1,c=qn(c,In)-1):(h=yo(h,In),c=yo(c,In)),Ea(n,h,c,s)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=il(this.resolutions_,e,t||0);return je(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return I_(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}}function L_(i){let e=i.getDefaultTileGrid();return e||(e=jy(i),i.setDefaultTileGrid(e)),e}function Fy(i,e,t){const n=e[0],r=i.getTileCoordCenter(e),s=Qc(t);if(!xs(s,r)){const o=Le(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return e}function Uy(i,e,t,n){n=n!==void 0?n:"top-left";const r=P_(i,e,t);return new S_({extent:i,origin:qE(i,n),resolutions:r,tileSize:t})}function Gy(i){const e=i||{},t=e.extent||Ht("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:P_(t,e.maxZoom,e.tileSize,e.maxResolution)};return new S_(n)}function P_(i,e,t,n){e=e!==void 0?e:Ay,t=zt(t!==void 0?t:qc);const r=ht(i),s=Le(i);n=n>0?n:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function jy(i,e,t,n){const r=Qc(i);return Uy(r,e,t,n)}function Qc(i){i=Ht(i);let e=i.getExtent();if(!e){const t=180*Or.degrees/i.getMetersPerUnit();e=zs(-t,-t,t,t)}return e}class ky extends w_{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&zt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new x_(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=dl(t,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===P.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,s){return Ce()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:L_(e)}getTileCacheForProjection(e){const t=this.getProjection();return me(t===null||Kn(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=zt(r.getTileSize(e),this.tmpSize);return s==1?o:Ny(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Fy(n,e,t)),Ly(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(e,t,n,r){}}class Xy extends Tn{constructor(e,t){super(e),this.tile=t}}function zy(i,e){const t=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(t,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=e.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function By(i,e){const t=i.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=zy(i[r],e);return $y(n)}function $y(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const r=Sy(e),s=br(r,i.length);return i[s](e,t,n)}}function Ky(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=n;s<=r;++s)e.push(i.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=n;r++)e.push(i.replace(t[0],r.toString()));return e}return e.push(i),e}class Jc extends ky{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Jc.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=qe(t),r=t.getState();let s;r==P.LOADING?(this.tileLoadingKeys_[n]=!0,s=Yl.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==P.ERROR?Yl.TILELOADERROR:r==P.LOADED?Yl.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Xy(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Ky(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(By(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const r=dl(e,t,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class Vy extends Jc{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Zy,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:ol,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Kn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Kn(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Kn(t,e)))return this.tileGrid;const n=qe(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=L_(e)),this.tileGridForProjection[n]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Kn(t,e))return this.tileCache;const n=qe(e);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new x_(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(e,t,n,r,s,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?P.IDLE:P.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(j.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,r,s){const o=this.getProjection();if(!o||!s||Kn(o,s))return this.getTileInternal(e,t,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,n];let h;const c=Vn(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new ul(o,d,s,g,l,f,this.getTilePixelRatio(r),this.getGutter(),(m,E,p,T)=>this.getTileInternal(m,E,p,T,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(e,t,n,r,s){let o=null;const a=dl(e,t,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,n,r,s,l),h.getState()==P.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const n=Ht(e);if(n){const r=qe(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function Zy(i,e){i.getImage().src=e}class A_ extends Vy{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:Gy({extent:Qc(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}function qh(i){return Array.isArray(i)?Math.min(...i):i}class Hy extends g_{constructor(e,t,n,r,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Pt(n,h):n,u=Si(c),d=Yh(e,t,u,r),g=Bc,f=new Hc(e,t,c,l,d*g,r),_=f.calculateSourceExtent(),m=Fi(_)?null:o(_,d,s),E=m?ye.IDLE:ye.EMPTY,p=m?m.getPixelRatio():1;super(n,r,p,E),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ye.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==ye.LOADED){const t=Le(this.targetExtent_)/this.targetResolution_,n=ht(this.targetExtent_)/this.targetResolution_;this.canvas_=Wc(t,n,this.sourcePixelRatio_,qh(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==ye.IDLE){this.state=ye.LOADING,this.changed();const e=this.sourceImage_.getState();e==ye.LOADED||e==ye.ERROR?this.reproject_():(this.sourceListenerKey_=ie(this.sourceImage_,j.CHANGE,function(t){const n=this.sourceImage_.getState();(n==ye.LOADED||n==ye.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){Re(this.sourceListenerKey_),this.sourceListenerKey_=null}}const To=4,ql={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Wy extends Tn{constructor(e,t){super(e),this.image=t}}class Yy extends w_{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const n=il(t,e,0);e=t[n]}return e}getImage(e,t,n,r){const s=this.getProjection();if(!s||!r||Kn(s,r))return s&&(r=s),this.getImageInternal(e,t,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Kn(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&Vh(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Hy(s,r,e,t,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,r){if(this.loader){const s=qy(e,t,n,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&ua(this.wantedExtent_,s)||ua(this.image.getExtent(),s))&&(this.wantedResolution_&&qh(this.wantedResolution_)===o||qh(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new g_(s,o,n,this.loader),this.image.addEventListener(j.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case ye.LOADING:this.loading=!0,n=ql.IMAGELOADSTART;break;case ye.LOADED:this.loading=!1,n=ql.IMAGELOADEND;break;case ye.ERROR:this.loading=!1,n=ql.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Wy(n,t))}}function qy(i,e,t,n){const r=e/t,s=Si(i),o=qn(Le(i)/r,To),a=qn(ht(i)/r,To),l=qn((n-1)*o/2,To),h=o+2*l,c=qn((n-1)*a/2,To),u=a+2*c;return da(s,r,0,[h,u])}var Qy=Object.defineProperty,Jy=(i,e,t)=>e in i?Qy(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ii=(i,e,t)=>(Jy(i,typeof e!="symbol"?e+"":e,t),t);const Qh=class Jh extends A_{constructor(e,t={}){super({tileUrlFunction:(n,r)=>`${zt(this.tileGrid.getTileSize(n[0]))[0]*(r||1)}`,tileLoadFunction:async(n,r)=>{const s=this.getrenderFunction();if(this.tileGrid&&s){console.assert(n instanceof ol);const o=n,a=parseInt(r),l=Math.round(a/256),h=sn(a,a),c=await s(this.api,n.getTileCoord(),a,l,this.getextentBufferFactor());h.putImageData(c,0,0),t.debug&&(h.strokeStyle="grey",h.strokeRect(.5,.5,a+.5,a+.5),h.fillStyle="darkgrey",h.strokeStyle="black",h.textAlign="center",h.textBaseline="middle",h.font="20px sans-serif",h.lineWidth=2,h.strokeText(r,a/2,a/2,a),h.fillText(r,a/2,a/2,a)),o.setImage(h.canvas)}},...t}),ii(this,"api"),ii(this,"renderFunction"),ii(this,"extentBufferFactor"),this.api=e,this.renderFunction=t.renderFunction,this.extentBufferFactor=t.extentBufferFactor}getrenderFunction(){return this.renderFunction||Jh.DEFAULT_RENDERFUNCTION}getextentBufferFactor(){return typeof this.extentBufferFactor=="function"?this.extentBufferFactor():this.extentBufferFactor||Jh.DEFAULT_EXTENTBUFFERFACTOR}};ii(Qh,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r)=>i.renderXYZTile(e[1],e[2],e[0],t,n,r)),ii(Qh,"DEFAULT_EXTENTBUFFERFACTOR",0);let eT=Qh;const M_=class O_ extends Yy{constructor(e,t={}){super({loader:(n,r,s)=>new Promise(async o=>{var a;const l=s||window?.devicePixelRatio||1,h=r/l,c=Math.round(Le(n)/h),u=Math.round(ht(n)/h),d=await this.getrenderFunction()(this.api,((a=this.getProjection())==null?void 0:a.getCode())||"EPSG:3857",n[0],n[1],n[2],n[3],c,u,l);o(createImageBitmap(d))}),...t}),ii(this,"api"),ii(this,"renderFunction"),this.api=e,this.renderFunction=t.renderFunction}getrenderFunction(){return this.renderFunction||O_.DEFAULT_RENDERFUNCTION}};ii(M_,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r,s,o,a,l)=>i.renderImage(e,new i.Rectangle(t,n,r,s),o,a,l));let zd=M_;const wt={ADD:"add",REMOVE:"remove"},Bd={LENGTH:"length"};class vo extends Tn{constructor(e,t,n){super(e),this.element=t,this.index=n}}class fn extends vn{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Bd.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new vo(wt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new vo(wt.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new vo(wt.REMOVE,r,e)),this.dispatchEvent(new vo(wt.ADD,t,e))}updateLength_(){this.set(Bd.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const eu=new Array(6);function Qt(){return[1,0,0,1,0,0]}function tT(i){return gl(i,1,0,0,1,0,0)}function tu(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],g=e[5];return i[0]=t*l+r*h,i[1]=n*l+s*h,i[2]=t*c+r*u,i[3]=n*c+s*u,i[4]=t*d+r*g+o,i[5]=n*d+s*g+a,i}function gl(i,e,t,n,r,s,o){return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function vt(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function nT(i,e){const t=Math.cos(e),n=Math.sin(e);return tu(i,gl(eu,t,n,-n,t,0,0))}function $d(i,e,t){return tu(i,gl(eu,e,0,0,t,0,0))}function iT(i,e,t){return tu(i,gl(eu,1,0,0,1,e,t))}function Li(i,e,t,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+e,i[5]=o*r*l+a*r*h+t,i}function D_(i,e){const t=rT(e);me(t!==0,"Transformation matrix cannot be inverted");const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-r/t,i[2]=-s/t,i[3]=n/t,i[4]=(s*l-o*a)/t,i[5]=-(n*l-r*a)/t,i}function rT(i){return i[0]*i[3]-i[1]*i[2]}let Kd;function sT(i){const e="matrix("+i.join(", ")+")";if(u_)return e;const t=Kd||(Kd=document.createElement("div"));return t.style.transform=e,t.style.transform}const ya={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var ot={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};ot.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};ot.max=ot.whitepoint[2].D65;ot.rgb=function(i,e){e=e||ot.whitepoint[2].E;var t=i[0]/e[0],n=i[1]/e[1],r=i[2]/e[2],s,o,a;return s=t*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=t*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};ya.xyz=function(i,e){var t=i[0]/255,n=i[1]/255,r=i[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.41239079926595+n*.35758433938387+r*.18048078840183,o=t*.21263900587151+n*.71516867876775+r*.072192315360733,a=t*.019330818715591+n*.11919477979462+r*.95053215224966;return e=e||ot.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const N_={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var m=.0011070564598794539;return e=e||"D65",t=t||2,u=ot.whitepoint[t][e][0],d=ot.whitepoint[t][e][1],g=ot.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,r=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*m,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};ot.luv=function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_,m=.008856451679035631,E=903.2962962962961;e=e||"D65",t=t||2,u=ot.whitepoint[t][e][0],d=ot.whitepoint[t][e][1],g=ot.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/d;return s=p<=m?E*p:116*Math.pow(p,1/3)-16,o=13*s*(n-f),a=13*s*(r-_),[s,o,a]};N_.lchuv=function(i){var e=i[0],t=i[1],n=i[2],r=Math.sqrt(t*t+n*n),s=Math.atan2(n,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,r,o]};ot.lchuv=function(i){return N_.lchuv(ot.luv(i))};const Vd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Zd={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function oT(i){var e,t=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Vd[i])t=Vd[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",t=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),r="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=e[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=t.shift()),t=t.map(function(c,u){if(c[c.length-1]==="%")return c=parseFloat(c)/100,u===3?c:r==="rgb"?c*255:r[0]==="h"||r[0]==="l"&&!u?c*100:r==="lab"?c*125:r==="lch"?u<2?c*150:c*360:r[0]==="o"&&!u?c:r==="oklab"?c*.4:r==="oklch"?u<2?c*.4:c*360:c;if(r[u]==="h"||u===2&&r[r.length-1]==="h"){if(Zd[c]!==void 0)return Zd[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return parseFloat(c)*360;if(c.endsWith("grad"))return parseFloat(c)*360/400;if(c.endsWith("rad"))return parseFloat(c)*180/Math.PI}return c==="none"?0:parseFloat(c)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=i.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:t,alpha:n}}const Ql={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+t):n+t-n*t,r=2*n-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};ya.hsl=function(i){var e=i[0]/255,t=i[1]/255,n=i[2]/255,r=Math.min(e,t,n),s=Math.max(e,t,n),o=s-r,a,l,h;return s===r?a=0:e===s?a=(t-n)/o:t===s?a=2+(n-e)/o:n===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function aT(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var e,t=oT(i);if(!t.space)return[];const n=t.space[0]==="h"?Ql.min:ya.min,r=t.space[0]==="h"?Ql.max:ya.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),r[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),r[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),r[2]),t.space[0]==="h"&&(e=Ql.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function lT(i){return typeof i=="string"?i:uT(i)}const hT=1024,rs={};let Jl=0;function F_(i){if(rs.hasOwnProperty(i))return rs[i];if(Jl>=hT){let t=0;for(const n in rs)t++&3||(delete rs[n],--Jl)}const e=aT(i);if(e.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+i+'" as color');return cT(e),rs[i]=e,++Jl,e}function Ta(i){return Array.isArray(i)?i:F_(i)}function cT(i){return i[0]=je(i[0]+.5|0,0,255),i[1]=je(i[1]+.5|0,0,255),i[2]=je(i[2]+.5|0,0,255),i[3]=je(i[3],0,1),i}function uT(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+e+","+t+","+n+","+r+")"}function dT(i){try{return F_(i),!0}catch{return!1}}class gT{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const r=Hd(e,t,n);return r in this.cache_?this.cache_[r]:null}set(e,t,n,r){const s=Hd(e,t,n);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Hd(i,e,t){const n=t?lT(t):"null";return e+":"+i+":"+n}const U_=new gT,he={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class G_ extends vn{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[he.OPACITY]=e.opacity!==void 0?e.opacity:1,me(typeof t[he.OPACITY]=="number","Layer opacity must be a number"),t[he.VISIBLE]=e.visible!==void 0?e.visible:!0,t[he.Z_INDEX]=e.zIndex,t[he.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[he.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[he.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[he.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=je(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Ce()}getLayerStatesArray(e){return Ce()}getExtent(){return this.get(he.EXTENT)}getMaxResolution(){return this.get(he.MAX_RESOLUTION)}getMinResolution(){return this.get(he.MIN_RESOLUTION)}getMinZoom(){return this.get(he.MIN_ZOOM)}getMaxZoom(){return this.get(he.MAX_ZOOM)}getOpacity(){return this.get(he.OPACITY)}getSourceState(){return Ce()}getVisible(){return this.get(he.VISIBLE)}getZIndex(){return this.get(he.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(he.EXTENT,e)}setMaxResolution(e){this.set(he.MAX_RESOLUTION,e)}setMinResolution(e){this.set(he.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(he.MAX_ZOOM,e)}setMinZoom(e){this.set(he.MIN_ZOOM,e)}setOpacity(e){me(typeof e=="number","Layer opacity must be a number"),this.set(he.OPACITY,e)}setVisible(e){this.set(he.VISIBLE,e)}setZIndex(e){this.set(he.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Et={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},_t={ANIMATING:0,INTERACTING:1},Ft={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Wd(i,e,t){return function(n,r,s,o,a){if(!n)return;if(!r&&!e)return n;const l=e?0:s[0]*r,h=e?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,_=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=je(n[0],d,g),E=je(n[1],f,_);if(o&&t&&r){const p=30*r;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,E]}}function fT(i){return i}function nu(i,e,t,n){const r=Le(e)/t[0],s=ht(e)/t[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function iu(i,e,t){let n=Math.min(i,e);const r=50;return n*=Math.log(1+r*Math.max(0,i/e-1))/r+1,t&&(n=Math.max(n,t),n/=Math.log(1+r*Math.max(0,t/i-1))/r+1),je(n,t/2,e*2)}function _T(i,e,t,n){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=t?nu(l,t,o,n):l;if(a)return e?iu(r,c,h):je(r,h,c);const u=Math.min(c,r),d=Math.floor(il(i,u,s));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function mT(i,e,t,n,r,s){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=r?nu(e,r,l,s):e;if(h)return n?iu(o,c,t):je(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(e/f)/Math.log(i)+g),m=Math.max(d,_),E=e/Math.pow(i,m);return je(E,t,c)}}}function Yd(i,e,t,n,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=n?nu(i,n,a,r):i;return!t||!l?je(s,e,h):iu(s,h,e)}}}function ru(i){if(i!==void 0)return 0}function qd(i){if(i!==void 0)return i}function pT(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function ET(i){const e=Wo(5);return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function yT(i,e,t,n,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function TT(i,e,t,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=e;d<t;d+=n){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function vT(i,e,t,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function RT(i,e,t,n,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Qd=Qt();class xT extends vn{constructor(){super(),this.extent_=kr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=PE((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Ce()}closestPointXY(e,t,n,r){return Ce()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Ce()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&al(t),this.extentRevision_=this.getRevision()}return JE(this.extent_,e)}rotate(e,t){Ce()}scale(e,t,n){Ce()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Ce()}getType(){return Ce()}applyTransform(e){Ce()}intersectsExtent(e){return Ce()}translate(e,t){Ce()}transform(e,t){const n=Ht(e),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=ht(h)/ht(l);return Li(Qd,h[0],h[3],c,-c,0,0,0),yT(s,0,s.length,a,Qd,o),pa(n,t)(s,o,a)}:pa(n,t);return this.applyTransform(r),this}}class su extends xT{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return HE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Ce()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Jd(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Ce()}setLayout(e,t,n){let r;if(e)r=Jd(e);else{for(let s=0;s<n;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=wT(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();TT(n,0,n.length,r,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=Si(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();vT(r,0,r.length,s,e,t,n,r),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();RT(n,0,n.length,r,e,t,n),this.changed()}}}function wT(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function Jd(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function eg(i,e,t,n,r,s,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let g=0;g<n;++g)o[g]=dy(i[e+g],i[t+g],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function j_(i,e,t,n,r){let s=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=Cr(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function CT(i,e,t,n,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=j_(i,e,a,n,r),e=a}return r}function k_(i,e,t,n,r,s,o,a,l,h,c){if(e==t)return h;let u,d;if(r===0){if(d=Cr(o,a,i[e],i[e+1]),d<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=e+n;for(;g<t;)if(eg(i,g-n,g,n,o,a,c),d=Cr(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(eg(i,t-n,e,n,o,a,c),d=Cr(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function bT(i,e,t,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];h=k_(i,e,g,n,r,s,o,a,l,h,c),e=g}return h}function IT(i,e,t,n){for(let r=0,s=t.length;r<s;++r)i[e++]=t[r];return e}function X_(i,e,t,n){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function ST(i,e,t,n,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=X_(i,e,t[o],n);r[s++]=l,e=l}return r.length=s,r}function LT(i,e,t,n,r,s,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)s[o++]=i[e],s[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],_=i[d+1],m=i[u],E=i[u+1];for(let p=d+n;p<u;p+=n){const T=i[p],y=i[p+1],v=cy(T,y,f,_,m,E);v>g&&(c=p,g=v)}g>r&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[e+u*n],s[o++]=i[e+u*n+1]);return o}function Ki(i,e){return e*Math.round(i/e)}function PT(i,e,t,n,r,s,o){if(e==t)return o;let a=Ki(i[e],r),l=Ki(i[e+1],r);e+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=Ki(i[e],r),c=Ki(i[e+1],r),e+=n,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=Ki(i[e],r),d=Ki(i[e+1],r);if(e+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,m=d-l;if(g*m==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function AT(i,e,t,n,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=PT(i,e,c,n,r,s,o),a.push(o),e=c}return o}function z_(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function MT(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=z_(i,e,l,n,r[s]),e=l}return r.length=s,r}function B_(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function OT(i,e,t,n){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=B_(i,e,a,n),e=a}return r}class bs extends su{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new bs(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,r){return r<f_(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(j_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),k_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,r))}getArea(){return B_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return z_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=LT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new bs(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=X_(this.flatCoordinates,0,e,this.stride),this.changed()}}class ou extends su{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new ou(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const s=this.flatCoordinates,o=Cr(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return ZE(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return __(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=IT(this.flatCoordinates,0,e,this.stride),this.changed()}}function DT(i,e,t,n,r,s,o){let a,l,h,c,u,d,g;const f=r[s+1],_=[];for(let p=0,T=t.length;p<T;++p){const y=t[p];for(c=i[y-n],d=i[y-n+1],a=e;a<y;a+=n)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let m=NaN,E=-1/0;for(_.sort(Xc),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>E&&(h=(c+u)/2,C_(i,e,t,n,h,f)&&(m=h,E=p)),c=u}return isNaN(m)&&(m=r[s]),[m,f,E]}function NT(i,e,t,n){for(;e<t-n;){for(let r=0;r<n;++r){const s=i[e+r];i[e+r]=i[t-n+r],i[t-n+r]=s}e+=n,t-=n}}function $_(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function FT(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=$_(i,e,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function tg(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=$_(i,e,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&NT(i,e,a,n),e=a}return e}class Is extends su{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?SE(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Is(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<f_(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(CT(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bT(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,r))}containsXY(e,t){return C_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return OT(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),tg(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,MT(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Si(this.getExtent());this.flatInteriorPoint_=DT(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ou(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new bs(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new bs(t.slice(s,l),e);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;FT(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=tg(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=AT(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Is(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return Dy(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ST(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function ng(i){if(Fi(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],r=i[3],s=[e,t,e,r,n,r,n,t,e,t];return new Is(s,"XY",[s.length])}const eh=0;class jt extends vn{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Vc(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Ey(),e.center&&(e.center=hn(e.center,this.projection_)),e.extent&&(e.extent=Qn(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Ft)delete t[a];this.setProperties(t,!0);const n=GT(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const r=UT(e),s=n.constraint,o=jT(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=hn(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=hn(r.anchor,this.getProjection())),t[n]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===t){n&&Ro(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<t;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||DE,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=br(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}kT(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(_t.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[_t.ANIMATING]>0}getInteracting(){return this.hints_[_t.INTERACTING]>0}cancelAnimations(){this.setHint(_t.ANIMATING,-this.hints_[_t.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const r=this.animations_[t];if(r[0].callback&&Ro(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[m,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?br(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(_t.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Ro(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-t[0],r[1]-t[1]],$c(n,e-this.getRotation()),gy(n,t)),n}calculateCenterZoom(e,t){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],r=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Wh(e,this.getProjection())}getCenterInternal(){return this.get(Ft.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return xy(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();me(t,"The view center is not defined");const n=this.getResolution();me(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return me(r!==void 0,"The view rotation is not defined"),da(t,n,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ft.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Qn(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Le(e)/t[0],r=ht(e)/t[1];return Math.max(n,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(t/n)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(Ft.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/t;return function(o){return Math.log(n/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=th(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,n)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,r;if(this.resolutions_){const s=il(this.resolutions_,e,1);t=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(n/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=je(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,je(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(me(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){me(!Fi(e),"Cannot fit empty extent provided as `geometry`");const r=Qn(e,this.getProjection());n=ng(r)}else if(e.getType()==="Circle"){const r=Qn(e.getExtent(),this.getProjection());n=ng(r),n.rotate(this.getRotation(),Si(r))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*r,f=s[u]*r+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Si(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),m=t.callback?t.callback:la;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Ro(m,!0))}centerOn(e,t,n){this.centerOnInternal(hn(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(th(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=th(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,n);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Wh(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&hn(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,n);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=hn(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&hn(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Ft.ROTATION)!==r&&this.set(Ft.ROTATION,r),this.get(Ft.RESOLUTION)!==o&&(this.set(Ft.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ft.CENTER)||!_a(this.get(Ft.CENTER),a))&&this.set(Ft.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!_a(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:jr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(_t.INTERACTING,1)}endInteraction(e,t,n){n=n&&hn(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(_t.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function Ro(i,e){setTimeout(function(){i(e)},0)}function UT(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Wd(i.extent,i.constrainOnlyCenter,t)}const e=Vc(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Wd(t,!1,!1)}return fT}function GT(i){let e,t,n,r=i.minZoom!==void 0?i.minZoom:eh,s=i.maxZoom!==void 0?i.maxZoom:28;const o=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=Vc(i.projection,"EPSG:3857"),u=c.getExtent();let d=i.constrainOnlyCenter,g=i.extent;if(!a&&!g&&c.isGlobal()&&(d=!1,g=u),i.resolutions!==void 0){const f=i.resolutions;t=f[r],n=f[s]!==void 0?f[s]:f[f.length-1],i.constrainResolution?e=_T(f,l,!d&&g,h):e=Yd(t,n,l,!d&&g,h)}else{const f=(u?Math.max(Le(u),ht(u)):360*Or.degrees/c.getMetersPerUnit())/qc/Math.pow(2,eh),_=f/Math.pow(2,28-eh);t=i.maxResolution,t!==void 0?r=0:t=f/Math.pow(o,r),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(o,s):n=f/Math.pow(o,s):n=_),s=r+Math.floor(Math.log(t/n)/Math.log(o)),n=t/Math.pow(o,s-r),i.constrainResolution?e=mT(o,t,n,l,!d&&g,h):e=Yd(t,n,l,!d&&g,h)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:r,zoomFactor:o}}function jT(i){if(i.enableRotation===void 0||i.enableRotation){const e=i.constrainRotation;return e===void 0||e===!0?ET():e===!1?qd:typeof e=="number"?pT(e):qd}return ru}function kT(i){return!(i.sourceCenter&&i.targetCenter&&!_a(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function th(i,e,t,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class XT extends G_{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(he.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(he.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Re(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=ie(e,j.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof jt?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return au(r,t.viewState)&&(!s||Bs(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const r=e instanceof jt?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(he.MAP,e)}getMapInternal(){return this.get(he.MAP)}setMap(e){this.mapPrecomposeKey_&&(Re(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(Re(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=ie(e,Et.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,r=this.getLayerState(!1);me(!n.some(function(s){return s.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(r)},this),this.mapRenderKey_=ie(this,j.CHANGE,e.render,e),this.changed())}setSource(e){this.set(he.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function au(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}const fl=XT;class zT extends nl{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Ce()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Li(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),D_(r,n)}forEachFeatureAtCoordinate(e,t,n,r,s,o,a,l){let h;const c=t.viewState;function u(y,v,x,R){return s.call(o,v,y?x:null,R)}const d=c.projection,g=_y(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const y=d.getExtent(),v=Le(y);f.push([-v,0],[v,0])}const _=t.layerStatesArray,m=_.length,E=[],p=[];for(let y=0;y<f.length;y++)for(let v=m-1;v>=0;--v){const x=_[v],R=x.layer;if(R.hasRenderer()&&au(x,c)&&a.call(l,R)){const w=R.getRenderer(),C=R.getSource();if(w&&C){const b=C.getWrapX()?g:e,O=u.bind(null,x.managed);p[0]=b[0]+f[y][0],p[1]=b[1]+f[y][1],h=w.forEachFeatureAtCoordinate(p,t,n,O,E)}if(h)return h}}if(E.length===0)return;const T=1/E.length;return E.forEach((y,v)=>y.distanceSq+=v*T),E.sort((y,v)=>y.distanceSq-v.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(e,t,n,r,s,o){return this.forEachFeatureAtCoordinate(e,t,n,r,aa,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){Ce()}flushDeclutterItems(e){}scheduleExpireIconCache(e){U_.canExpireCache()&&e.postRenderFunctions.push(BT)}}function BT(i,e){U_.expire()}class ps extends Tn{constructor(e,t,n,r){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=r}}const xo="ol-hidden",zr="ol-unselectable",ig="ol-unsupported",_l="ol-control",rg="ol-collapsed",$T=new vn;class KT extends zT{constructor(e){super(e),this.fontChangeListenerKey_=ie($T,Cs.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=zr+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new ps(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){Re(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Et.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!au(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(e),zE(this.element_,this.children_),this.dispatchRenderEvent(Et.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}class zn extends Tn{constructor(e,t){super(e),this.layer=t}}const nh={LAYERS:"layers"};class Br extends G_{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(nh.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new fn(n.slice(),{unique:!0}):me(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new fn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Re),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(ie(e,wt.ADD,this.handleLayersAdd_,this),ie(e,wt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Re);ks(this.listenerKeys_);const t=e.getArray();for(let n=0,r=t.length;n<r;n++){const s=t[n];this.registerLayerListeners_(s),this.dispatchEvent(new zn("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[ie(e,Cs.PROPERTYCHANGE,this.handleLayerChange_,this),ie(e,j.CHANGE,this.handleLayerChange_,this)];e instanceof Br&&t.push(ie(e,"addlayer",this.handleLayerGroupAdd_,this),ie(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[qe(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new zn("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new zn("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new zn("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=qe(t);this.listenerKeys_[n].forEach(Re),delete this.listenerKeys_[n],this.dispatchEvent(new zn("removelayer",t)),this.changed()}getLayers(){return this.get(nh.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new zn("removelayer",n[r]))}this.set(nh.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Pt(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class lr extends Tn{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}class Dn extends lr{constructor(e,t,n,r,s,o){super(e,t,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Me={SINGLECLICK:"singleclick",CLICK:j.CLICK,DBLCLICK:j.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ec={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class VT extends Xs{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=ie(n,ec.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ie(n,ec.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(j.TOUCHMOVE,this.boundHandleTouchMove_,d_?{passive:!1}:!1)}emulateClick_(e){let t=new Dn(Me.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Dn(Me.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Dn(Me.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==Me.POINTERUP||t.type==Me.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Me.POINTERDOWN||t.type==Me.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Dn(Me.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Re),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Dn(Me.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ie(n,Me.POINTERMOVE,this.handlePointerMove_,this),ie(n,Me.POINTERUP,this.handlePointerUp_,this),ie(this.element_,Me.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(ie(this.element_.getRootNode(),Me.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Dn(Me.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Dn(Me.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Re(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(j.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Re(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Re),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Nn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ze={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},tc=1/0;class ZT{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ks(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){me(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=tc?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,r=t.length,s=t[e],o=n[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<r&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=s,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,r=this.priorities_,s=n[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)n[t]=n[a],r[t]=r[a],t=a;else break}n[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==tc?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,t[r++]=o);t.length=r,n.length=r,this.heapify_()}}class HT extends ZT{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(j.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===P.LOADED||n===P.ERROR||n===P.EMPTY){n!==P.ERROR&&t.removeEventListener(j.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,r,s,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===P.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function WT(i,e,t,n,r){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return tc;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class Vs extends vn{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){$h(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&$h(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)Re(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==la&&this.listenerKeys.push(ie(e,Nn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class YT extends Vs{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(j.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+zr+" "+_l+(this.collapsed_&&this.collapsible_?" "+rg:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!rl(t,this.renderedAttributions_)){XE(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(rg),this.collapsed_?ha(this.collapseLabel_,this.label_):ha(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class qT extends Vs{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(j.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+zr+" "+_l,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(xo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:jr}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(xo);!s&&n===0?this.element.classList.add(xo):s&&n!==0&&this.element.classList.remove(xo)}this.label_.style.transform=r}this.rotation_=n}}class QT extends Vs{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(j.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(j.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+zr+" "+_l,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const n=t.getZoom();if(n!==void 0){const r=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:jr})):t.setZoom(r)}}}function lu(i){i=i||{};const e=new fn;return(i.zoom===void 0||i.zoom)&&e.push(new QT(i.zoomOptions)),(i.rotate===void 0||i.rotate)&&e.push(new qT(i.rotateOptions)),(i.attribution===void 0||i.attribution)&&e.push(new YT(i.attributionOptions)),e}const sg={ACTIVE:"active"};class Zs extends vn{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(sg.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(sg.ACTIVE,e)}setMap(e){this.map_=e}}function JT(i,e,t){const n=i.getCenterInternal();if(n){const r=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:NE,center:i.getConstrainedCenter(r)})}}function hu(i,e,t,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+e),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:jr})}class e1 extends Zs{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Me.DBLCLICK){const n=e.originalEvent,r=e.map,s=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();hu(a,o,s,this.duration_),n.preventDefault(),t=!0}return!t}}class Hs extends Zs{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Me.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Me.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==Me.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Me.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function cu(i){const e=i.length;let t=0,n=0;for(let r=0;r<e;r++)t+=i[r].clientX,n+=i[r].clientY;return{clientX:t/e,clientY:n/e}}function nc(i){const e=arguments;return function(t){let n=!0;for(let r=0,s=e.length;r<s&&(n=n&&e[r](t),!!n);++r);return n}}const t1=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},n1=function(i){const e=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return e.contains(t)},K_=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?n1(i):!0},i1=aa,V_=function(i){const e=i.originalEvent;return e.button==0&&!(jE&&h_&&e.ctrlKey)},Z_=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},r1=function(i){const e=i.originalEvent;return h_?e.metaKey:e.ctrlKey},s1=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},H_=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},ih=function(i){const e=i.originalEvent;return me(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},o1=function(i){const e=i.originalEvent;return me(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class a1 extends Hs{constructor(e){super({stopDown:sl}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:nc(Z_,o1);this.condition_=e.onFocusOnly?nc(K_,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,r=t.getEventPixel(cu(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=e.map.getView();fy(s,o.getResolution()),$c(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:jr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class l1 extends Hs{constructor(e){e=e||{},super({stopDown:sl}),this.condition_=e.condition?e.condition:t1,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!ih(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===ru)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return ih(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return ih(e)&&V_(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class h1 extends nl{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+n,r.top=Math.min(e[1],t[1])+n,r.width=Math.abs(t[0]-e[0])+n,r.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Is([n])}getGeometry(){return this.geometry_}}const wo={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class rh extends Tn{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class c1 extends Hs{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new h1(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:V_,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new rh(wo.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new rh(t?wo.BOXEND:wo.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new rh(wo.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class u1 extends c1{constructor(e){e=e||{};const t=e.condition?e.condition:s1;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const t=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=t.rotatedExtentForGeometry(n),s=t.getResolutionForExtentInternal(r),o=t.getResolution()/s;n=n.clone(),n.scale(o*o)}t.fitInternal(n,{duration:this.duration_,easing:jr})}}const ci={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class d1 extends Zs{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Z_(t)&&H_(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==j.KEYDOWN){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==ci.DOWN||r==ci.LEFT||r==ci.RIGHT||r==ci.UP)){const s=e.map.getView(),o=s.getResolution()*this.pixelDelta_;let a=0,l=0;r==ci.DOWN?l=-o:r==ci.LEFT?a=-o:r==ci.RIGHT?a=o:l=o;const h=[a,l];$c(h,s.getRotation()),JT(s,h,this.duration_),n.preventDefault(),t=!0}}return!t}}class g1 extends Zs{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!r1(t)&&H_(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==j.KEYDOWN||e.type==j.KEYPRESS){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();hu(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}class f1{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class _1 extends Zs{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:i1;this.condition_=e.onFocusOnly?nc(K_,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==j.WHEEL)return!0;const t=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==j.WHEEL&&(r=n.deltaY,FE&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=c_),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=t.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-je(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),hu(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class m1 extends Hs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=sl),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==ru&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(cu(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class p1 extends Hs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=sl),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(cu(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function E1(i){i=i||{};const e=new fn,t=new f1(-.005,.05,100);return(i.altShiftDragRotate===void 0||i.altShiftDragRotate)&&e.push(new l1),(i.doubleClickZoom===void 0||i.doubleClickZoom)&&e.push(new e1({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan===void 0||i.dragPan)&&e.push(new a1({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate===void 0||i.pinchRotate)&&e.push(new m1),(i.pinchZoom===void 0||i.pinchZoom)&&e.push(new p1({duration:i.zoomDuration})),(i.keyboard===void 0||i.keyboard)&&(e.push(new d1),e.push(new g1({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom===void 0||i.mouseWheelZoom)&&e.push(new _1({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom===void 0||i.shiftDragZoom)&&e.push(new u1({duration:i.zoomDuration})),e}function W_(i){if(i instanceof fl){i.setMapInternal(null);return}i instanceof Br&&i.getLayers().forEach(W_)}function Y_(i,e){if(i instanceof fl){i.setMapInternal(e);return}if(i instanceof Br){const t=i.getLayers().getArray();for(let n=0,r=t.length;n<r;++n)Y_(t[n],e)}}let q_=class extends vn{constructor(i){super(),i=i||{},this.on,this.once,this.un;const e=y1(i);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:c_,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Qt(),this.pixelToCoordinateTransform_=Qt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||lu(),this.interactions=e.interactions||E1({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new HT(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ze.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ze.VIEW,this.handleViewChanged_),this.addChangeListener(ze.SIZE,this.handleSizeChanged_),this.addChangeListener(ze.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const t=this;i.view&&!(i.view instanceof jt)&&i.view.then(function(n){t.setView(new jt(n))}),this.controls.addEventListener(wt.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(wt.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(wt.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(wt.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(wt.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(wt.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){Y_(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){const e=i.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,e,t){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(i);t=t!==void 0?t:{};const r=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.layerFilter!==void 0?t.layerFilter:aa,o=t.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,o,e,null,s,null)}getFeaturesAtPixel(i,e){const t=[];return this.forEachFeatureAtPixel(i,function(n){t.push(n)},e),t}getAllLayers(){const i=[];function e(t){t.forEach(function(n){n instanceof Br?e(n.getLayers()):i.push(n)})}return e(this.getLayers()),i}hasFeatureAtPixel(i,e){if(!this.frameState_||!this.renderer_)return!1;const t=this.getCoordinateFromPixelInternal(i);e=e!==void 0?e:{};const n=e.layerFilter!==void 0?e.layerFilter:aa,r=e.hitTolerance!==void 0?e.hitTolerance:0,s=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(t,this.frameState_,r,s,n,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){const e=this.viewport_.getBoundingClientRect(),t=this.getSize(),n=e.width/t[0],r=e.height/t[1],s="changedTouches"in i?i.changedTouches[0]:i;return[(s.clientX-e.left)/n,(s.clientY-e.top)/r]}getTarget(){return this.get(ze.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(i){return Wh(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){const e=this.frameState_;return e?vt(e.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){const e=this.overlayIdIndex_[i.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ze.LAYERGROUP)}setLayers(i){const e=this.getLayerGroup();if(i instanceof fn){e.setLayers(i);return}const t=e.getLayers();t.clear(),t.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const i=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=i.length;e<t;++e){const n=i[e];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const s=n.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(i){const e=hn(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(i){const e=this.frameState_;return e?vt(e.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ze.SIZE)}getView(){return this.get(ze.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,e,t,n){return WT(this.frameState_,i,e,t,n)}handleBrowserEvent(i,e){e=e||i.type;const t=new Dn(e,this,i);this.handleMapBrowserEvent(t)}handleMapBrowserEvent(i){if(!this.frameState_)return;const e=i.originalEvent,t=e.type;if(t===ec.POINTERDOWN||t===j.WHEEL||t===j.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===n?n.documentElement:r).contains(s))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const s=n[r];if(!(s.getMap()!==this||!s.getActive()||!this.getTargetElement())&&(!s.handleEvent(i)||i.propagationStopped))break}}}handlePostRender(){const i=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,r=n;if(i){const s=i.viewHints;if(s[_t.ANIMATING]||s[_t.INTERACTING]){const o=Date.now()-i.time>8;n=o?0:8,r=o?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,r))}i&&this.renderer_&&!i.animate&&(this.renderComplete_===!0?(this.hasListener(Et.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Et.RENDERCOMPLETE,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new lr(Nn.LOADEND,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new lr(Nn.LOADSTART,this,i))));const t=this.postRenderFunctions_;for(let n=0,r=t.length;n<r;++n)t[n](this,i);t.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,n=this.targetChangeHandlerKeys_.length;t<n;++t)Re(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(j.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(j.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,$h(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host),this.setSize(void 0)}const i=this.getTarget(),e=typeof i=="string"?document.getElementById(i):i;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new KT(this)),this.mapBrowserEventHandler_=new VT(this,this.moveTolerance_);for(const r in Me)this.mapBrowserEventHandler_.addEventListener(Me[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(j.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(j.WHEEL,this.boundHandleBrowserEvent_,d_?{passive:!1}:!1);const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[ie(t,j.KEYDOWN,this.handleBrowserEvent,this),ie(t,j.KEYPRESS,this.handleBrowserEvent,this)];const n=e.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Re(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Re(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const i=this.getView();i&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ie(i,Cs.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ie(i,j.CHANGE,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Re),this.layerGroupPropertyListenerKeys_=null);const i=this.getLayerGroup();i&&(this.handleLayerAdd_(new zn("addlayer",i)),this.layerGroupPropertyListenerKeys_=[ie(i,Cs.PROPERTYCHANGE,this.render,this),ie(i,j.CHANGE,this.render,this),ie(i,"addlayer",this.handleLayerAdd_,this),ie(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const i=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=i.length;e<t;++e){const n=i[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const i=this.frameState_;i&&this.renderer_.flushDeclutterItems(i)}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){W_(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){const e=this.getSize(),t=this.getView(),n=this.frameState_;let r=null;if(e!==void 0&&Xd(e)&&t&&t.isDef()){const s=t.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=t.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:da(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:o,viewHints:s,wantedTiles:{},mapId:qe(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=da(o.nextCenter,o.nextResolution,a,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!Fi(this.previousExtent_)&&!Vh(r.extent,this.previousExtent_))&&(this.dispatchEvent(new lr(Nn.MOVESTART,this,n)),this.previousExtent_=al(this.previousExtent_)),this.previousExtent_&&!r.viewHints[_t.ANIMATING]&&!r.viewHints[_t.INTERACTING]&&!Vh(r.extent,this.previousExtent_)&&(this.dispatchEvent(new lr(Nn.MOVEEND,this,r)),VE(r.extent,this.previousExtent_))),this.dispatchEvent(new lr(Nn.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(Nn.LOADSTART)||this.hasListener(Nn.LOADEND)||this.hasListener(Et.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new zn("removelayer",e)),this.set(ze.LAYERGROUP,i)}setSize(i){this.set(ze.SIZE,i)}setTarget(i){this.set(ze.TARGET,i)}setView(i){if(!i||i instanceof jt){this.set(ze.VIEW,i);return}this.set(ze.VIEW,new jt);const e=this;i.then(function(t){e.setView(new jt(t))})}updateSize(){const i=this.getTargetElement();let e;if(i){const n=getComputedStyle(i),r=i.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=i.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(s)&&(e=[r,s],!Xd(e)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&y_("No map visible because the map container's width or height are 0."))}const t=this.getSize();e&&(!t||!rl(e,t))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(i){const e=this.getView();e&&e.setViewportSize(i)}};function y1(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Br({layers:i.layers});t[ze.LAYERGROUP]=n,t[ze.TARGET]=i.target,t[ze.VIEW]=i.view instanceof jt?i.view:new jt;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new fn(i.controls.slice()):(me(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new fn(i.interactions.slice()):(me(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new fn(i.overlays.slice()):(me(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new fn,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const Co={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class T1 extends fl{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Co.PRELOAD)}setPreload(e){this.set(Co.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Co.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Co.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}function va(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function ic(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let Vi=null;function v1(i){Vi||(Vi=sn(i.width,i.height,void 0,{willReadFrequently:!0}));const e=Vi.canvas,t=i.width;e.width!==t&&(e.width=t);const n=i.height;return e.height!==n&&(e.height=n),Vi.clearRect(0,0,t,n),Vi.drawImage(i,0,0),Vi.getImageData(0,0,t,n).data}const R1=[256,256];class Q_ extends zc{constructor(e){const t=P.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=va(this.data_);return e?[e.width,e.height]:R1}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=P.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=P.ERROR,e.changed()})}}class J_ extends Q_{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=n?Pt(t,n):t;if(ws(s)===0){this.state=P.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(r?r=Pt(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=v_(o,h,s,l);if(!isFinite(c)||c<=0){this.state=P.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:Bc;if(this.triangulation_=new Hc(o,h,s,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=P.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=je(d[1],r[1],r[3]),d[3]=je(d[3],r[1],r[3])):d=Pt(d,r)),!ws(d))this.state=P.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=e.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let m=g.minY;m<=g.maxY;m++){const E=f(this.sourceZ_,_,m,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=P.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==P.LOADED)return;const n=t.getSize(),r=this.gutter_;let s;const o=ic(t.getData());o?s=o:s=v1(va(t.getData()));const a=[n[0]+2*r,n[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),m=h*_;let E=u;if(u.length!==m){E=new c(m);let p=0,T=0;const y=a[0]*_;for(let v=0;v<a[1];++v){for(let x=0;x<y;++x)E[p++]=u[T+x];T+=f/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=P.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,v=e.length;y<v;++y){const x=e[y],R=x.data,w=x.pixelSize,C=w[0],b=w[1],O=sn(C,b,pn),J=O.createImageData(C,b),z=J.data;let U=g*3;for(let G=0,W=z.length;G<W;G+=4)z[G]=R[U],z[G+1]=R[U+1],z[G+2]=R[U+2],z[G+3]=255,U+=u;O.putImageData(J,0,0),f.push({extent:x.extent,image:O.canvas})}const _=Wc(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,v=f.length;y<v;++y){const x=f[y].image.getContext("2d");Rs(x),pn.push(x.canvas)}const m=_.getContext("2d"),E=m.getImageData(0,0,_.width,_.height);Rs(m),pn.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new e[0].dataType(c.buffer));const p=E.data;let T=g*3;for(let y=0,v=p.length;y<v;y+=4)p[y+3]===255?(c[T]=p[y],c[T+1]=p[y+1],c[T+2]=p[y+2]):(c[T]=0,c[T+1]=0,c[T+2]=0),T+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=P.LOADED}this.changed()}load(){if(this.state!==P.IDLE&&this.state!==P.ERROR)return;this.state=P.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==P.IDLE&&n!==P.LOADING)return;e++;const r=ie(t,j.CHANGE,function(){const s=t.getState();(s==P.LOADED||s==P.ERROR||s==P.EMPTY)&&(Re(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==P.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(Re),this.sourcesListenerKeys_=null}}class x1 extends Xs{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(j.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===P.LOADED,this.loaded)this.uploadTile();else{if(e instanceof ol){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(j.CHANGE,this.handleTileChange_)}}uploadTile(){Ce()}setReady(){this.ready=!0,this.dispatchEvent(j.CHANGE)}handleTileChange_(){this.tile.getState()===P.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(j.CHANGE,this.handleTileChange_)}}const uu=34962,du=34963,w1=35040,gu=35044,C1=35048,b1=5121,I1=5123,S1=5125,em=5126,og=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function L1(i,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!GE},e);const t=og.length;for(let n=0;n<t;++n)try{const r=i.getContext(og[n],e);if(r)return r}catch{}return null}const P1={STATIC_DRAW:gu,STREAM_DRAW:w1,DYNAMIC_DRAW:C1};class tm{constructor(e,t){this.array_=null,this.type_=e,me(e===uu||e===du,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:P1.STATIC_DRAW}ofSize(e){return this.array_=new(sh(this.type_))(e),this}fromArray(e){return this.array_=sh(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(sh(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function sh(i){switch(i){case uu:return Float32Array;case du:return Uint32Array;default:return Float32Array}}function nm(i,e,t){const n=t?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function A1(i,e,t,n){nm(i,e,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}function ag(i,e,t,n,r,s){const o=i.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),nm(o,e,s&&l);const h=t.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let hr=null;function M1(){hr=sn(1,1,void 0,{willReadFrequently:!0})}class O1 extends x1{constructor(e){super(e),this.textures=[],this.renderSize_=zt(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new tm(uu,gu);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let r;n instanceof ol||n instanceof ul?r=n.getImage():r=n.getData();const s=va(r);if(s){const p=t.createTexture();this.textures.push(p),this.bandCount=4,A1(t,p,s,n.interpolate),this.setReady();return}r=ic(r);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const p=t.createTexture();this.textures.push(p),ag(e,p,r,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let p=0;p<g;++p){const T=t.createTexture();this.textures.push(T);const y=p<g-1?4:(this.bandCount-1)%4+1;f[p]=new c(h*y)}let _=0,m=0;const E=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let T=0;T<E;++T){const y=r[m+T],v=Math.floor(_/this.bandCount),x=T%this.bandCount,R=Math.floor(x/4),w=f[R],C=w.length/h,b=x%4;w[v*C+b]=y,++_}m+=d/u}for(let p=0;p<g;++p){const T=this.textures[p],y=f[p],v=y.length/h;ag(e,T,y,a,v,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(j.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];hr||M1(),hr.clearRect(0,0,1,1);const a=e.width,l=e.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(t/s)),d=r+Math.floor(c*(n/o));let g;try{hr.drawImage(e,u,d,1,1,0,0,1,1),g=hr.getImageData(0,0,1,1).data}catch{return hr=null,null}return g}getArrayPixelData_(e,t,n,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],h=t[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(r/a));if(e instanceof DataView){const _=e.byteLength/(c*u),m=_*(g*c+d),E=e.buffer.slice(m,m+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return e.slice(f,f+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Q_){const n=this.tile.getData(),r=ic(n);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,e,t)}return this.getImagePixelData_(va(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class im extends Ks{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return Ce()}getData(e){return null}prepareFrame(e){return Ce()}renderFrame(e,t){return Ce()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return e.forEachLoadedTile(t,r,s,o)}}forEachFeatureAtCoordinate(e,t,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===ye.LOADED||t.getState()===ye.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=ye.LOADED&&t!=ye.ERROR&&e.addEventListener(j.CHANGE,this.boundHandleImageChange_),t==ye.IDLE&&(e.load(),t=e.getState()),t==ye.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const bo={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},D1=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,N1=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class lg{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||D1),t.compileShader(n);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fragmentShader||N1),t.compileShader(r),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,r),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const r=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,r,s,n[0],n[1],o,a,l,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,r){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=qe(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,r=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,r++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}function rm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sm(i,e){return i[0]=e[0],i[1]=e[1],i[4]=e[2],i[5]=e[3],i[12]=e[4],i[13]=e[5],i}const Sn={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},gs={UNSIGNED_BYTE:b1,UNSIGNED_SHORT:I1,UNSIGNED_INT:S1,FLOAT:em},Ra={};function hg(i){return"shared/"+i}let cg=0;function F1(){const i="unique/"+cg;return cg+=1,i}function U1(i){let e=Ra[i];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:L1(t)},Ra[i]=e}return e.users+=1,e.context}function G1(i){const e=Ra[i];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const r=t.canvas;r.width=1,r.height=1,delete Ra[i]}class j1 extends nl{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?hg(e.canvasCacheKey):F1(),this.gl_=U1(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(bo.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(bo.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Qt(),this.offsetScaleMatrix_=Qt(),this.tmpMat4_=rm(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new lg({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new lg({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===hg(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=qe(e);let r=this.bufferCache_[n];if(!r){const s=t.createBuffer();r={buffer:e,webGlBuffer:s},this.bufferCache_[n]=r}t.bindBuffer(e.getType(),r.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=qe(e),r=this.bufferCache_[n];r&&!t.isContextLost()&&t.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(bo.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(bo.RESTORED,this.boundHandleWebGLContextRestored_),G1(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const r=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(e,t,n){const r=this.gl_;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,r){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const r=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,r,a)}finalizeDraw(e,t,n){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(e,null,t,n):this.postProcessPasses_[r].apply(e,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,r=e.pixelRatio;this.setUniformFloatValue(Sn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Sn.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Sn.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Sn.PIXEL_RATIO,r),this.setUniformFloatVec2(Sn.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(Sn.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(Sn.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(Sn.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,r=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,r,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),r++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,sm(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r}getProgram(e,t){const n=this.gl_,r=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=qe(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=qe(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,r=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Li(t,0,0,2/(s*n[0]),2/(s*n[1]),-r,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,r,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,r,s))}enableAttributes(e){const t=k1(e);let n=0;for(let r=0;r<e.length;r++){const s=e[r];this.enableAttributeArray_(s.name,s.size,s.type||em,t,n),n+=s.size*om(s.type)}}handleWebGLContextLost(e){ks(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const r=this.gl_;n=n||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,n),t?r.texImage2D(r.TEXTURE_2D,s,o,l,h,t):r.texImage2D(r.TEXTURE_2D,s,o,e[0],e[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n}}function k1(i){let e=0;for(let t=0;t<i.length;t++){const n=i[t];e+=n.size*om(n.type)}return e}function om(i){switch(i){case gs.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case gs.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case gs.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case gs.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class fu extends im{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Qt(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(he.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Et.PRECOMPOSE)){const r=new ps(Et.PRECOMPOSE,void 0,t,e);n.dispatchEvent(r)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Et.POSTCOMPOSE)){const r=new ps(Et.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(r)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,r;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof fu)){t=!0;continue}const c=l.getClassName();if((t||c!==r)&&(n+=1,t=!1),r=c,h===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new j1({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){Li(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new ps(e,this.inversePixelTransform_,n,t);r.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Et.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Et.POSTRENDER,e,t)}}const X1={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},z1={};function ug(i){return 1/(i+2)}function B1(){return{tileIds:new Set,representationsByZ:{}}}function dg(i,e){return i.tileIds.has(qe(e))}function gg(i,e,t){const n=i.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),i.tileIds.add(qe(e.tile))}function oh(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=Pt(e,Qn(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(e=Pt(e,r))}return e}function rc(i,e){return`${i.getKey()},${Vn(e)}`}class $1 extends fu{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=Qt(),this.tempMat4=rm(),this.tempTileRange_=new Yc(0,0,0,0),this.tempTileCoord_=Ea(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new R_(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),r=t.getUseInterimTilesOnError();return n==P.LOADED||n==P.EMPTY||n==P.ERROR&&!r}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer().getRenderSource();return!t||Fi(oh(e,e.extent))?!1:t.getState()==="ready"}createTileRepresentation(e){return Ce()}enqueueTiles(e,t,n,r,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=qe(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=n;m>=_;--m){const E=h.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),p=h.getResolution(m);for(let T=E.minX;T<=E.maxX;++T)for(let y=E.minY;y<=E.maxY;++y){const v=Ea(m,T,y,this.tempTileCoord_),x=rc(l,v);let R,w;if(g.containsKey(x)&&(R=g.get(x),w=R.tile),(!R||R.tile.key!==l.getKey())&&(w=l.getTile(m,T,y,e.pixelRatio,o.projection)),dg(r,w))continue;if(!R)R=this.createTileRepresentation({tile:w,grid:h,helper:this.helper,gutter:c}),g.set(x,R);else if(this.isDrawableTile_(w))R.setTile(w);else{const b=w.getInterimTile();R.setTile(b)}gg(r,R,m);const C=w.getKey();d[C]=!0,w.getState()===P.IDLE&&(e.tileQueue.isKeyQueued(C)||e.tileQueue.enqueue([w,u,h.getTileCoordCenter(v),p]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,r,s,o,a,l,h,c,u){}renderTileMask(e,t,n,r){}drawTile_(e,t,n,r,s,o,a){if(!t.ready)return;const l=t.tile.tileCoord,h=Vn(l),c=h in o?o[h]:1,u=a.getResolution(n),d=zt(a.getTileSize(n),this.tempSize_),g=a.getOrigin(n),f=a.getTileCoordExtent(l),_=c<1?-1:ug(n);c<1&&(e.animate=!0);const m=e.viewState,E=m.center[0],p=m.center[1],T=d[0]+2*r,y=d[1]+2*r,v=T/y,x=(E-g[0])/(d[0]*u),R=(g[1]-p)/(d[1]*u),w=m.resolution/u,C=l[1],b=l[2];tT(this.tileTransform_),$d(this.tileTransform_,2/(e.size[0]*w/T),-2/(e.size[1]*w/T)),nT(this.tileTransform_,m.rotation),$d(this.tileTransform_,1,1/v),iT(this.tileTransform_,(d[0]*(C-x)-r)/T,(d[1]*(b-R)-r)/y),this.renderTile(t,this.tileTransform_,e,s,u,d,g,f,_,r,c)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=oh(e,e.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=B1(),u=r.getPreload();if(e.nextExtent){const v=o.getZForResolution(n.nextResolution,s.zDirection),x=oh(e,e.nextExtent);this.enqueueTiles(e,x,v,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},g=qe(this),f=e.time;let _=!1;for(const v of c.representationsByZ[h]){const x=v.tile;if((x instanceof ul||x instanceof J_)&&x.getState()===P.EMPTY)continue;const R=x.tileCoord;if(v.ready){const C=x.getAlpha(g,f);if(C===1){x.endTransition(g);continue}_=!0;const b=Vn(R);d[b]=C}if(this.renderComplete=!1,this.findAltTiles_(o,R,h+1,c))continue;const w=o.getMinZoom();for(let C=h-1;C>=w&&!this.findAltTiles_(o,R,C,c);--C);}const m=c.representationsByZ,E=Object.keys(m).map(Number).sort(IE);if(this.beforeTilesMaskRender(e))for(let v=0,x=E.length;v<x;++v){const R=E[v];for(const w of m[R]){const C=w.tile.tileCoord;if(Vn(C)in d)continue;const b=o.getTileCoordExtent(C);this.renderTileMask(w,R,b,ug(R))}}this.beforeTilesRender(e,_);for(let v=0,x=E.length;v<x;++v){const R=E[v];for(const w of m[R]){const C=w.tile.tileCoord;Vn(C)in d||this.drawTile_(e,w,R,a,l,d,o)}}for(const v of m[h]){const x=v.tile.tileCoord;Vn(x)in d&&this.drawTile_(e,v,h,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const p=this.helper.getCanvas(),T=this.tileRepresentationCache;for(;T.canExpireCache();)T.pop().dispose();const y=function(v,x){s.updateCacheSize(.1,x.viewState.projection),s.expireCache(x.viewState.projection,z1)};return e.postRenderFunctions.push(y),this.postRender(t,e),p}findAltTiles_(e,t,n,r){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=rc(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!dg(r,g.tile)&&(gg(r,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const V={...X1,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},Yo={TEXTURE_COORD:"a_textureCoord"},K1=[{name:Yo.TEXTURE_COORD,size:2,type:gs.FLOAT}];class V1 extends $1{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new tm(du,gu),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new O1(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,r,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(K1);let g=0;for(;g<e.textures.length;){const v=`${V.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,v),++g}for(let v=0;v<this.paletteTextures_.length;++v){const x=this.paletteTextures_[v],R=x.getTexture(d);this.helper.bindTexture(R,g,x.name),++g}const f=n.viewState,_=o[0]+2*c,m=o[1]+2*c,E=e.tile.tileCoord,p=E[1],T=E[2];this.helper.setUniformMatrixValue(V.TILE_TRANSFORM,sm(this.tempMat4,t)),this.helper.setUniformFloatValue(V.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(V.DEPTH,h);let y=r;c>0&&(y=l,Pt(y,r,y)),this.helper.setUniformFloatVec4(V.RENDER_EXTENT,y),this.helper.setUniformFloatValue(V.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(V.ZOOM,f.zoom),this.helper.setUniformFloatValue(V.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(V.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(V.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(V.TEXTURE_ORIGIN_X,a[0]+p*o[0]*s-c*s),this.helper.setUniformFloatValue(V.TEXTURE_ORIGIN_Y,a[1]-T*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=vt(t.pixelToCoordinateTransform,e.slice()),s=t.viewState,o=n.getExtent();if(o&&!xs(Qn(o,s.projection),r))return null;const a=n.getSources(Kh([r]),s.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(s.projection),h.getWrapX())break;const d=c.getExtent();if(!d||xs(d,r))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let d=c.getZForResolution(s.resolution);d>=c.getMinZoom();--d){const g=c.getTileCoordForCoordAndZ(r,d),f=rc(h,g);if(!u.containsKey(f))continue;const _=u.get(f),m=_.tile;if((m instanceof ul||m instanceof J_)&&m.getState()===P.EMPTY)return null;if(!_.loaded)continue;const E=c.getOrigin(d),p=zt(c.getTileSize(d)),T=c.getResolution(d),y=(r[0]-E[0])/T-g[1]*p[0],v=(E[1]-r[1])/T-g[2]*p[1];return _.getPixelData(y,v)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}let $r=0;const Ui=0,Fe=1<<$r++,D=1<<$r++,Bt=1<<$r++,it=1<<$r++,Dr=1<<$r++,dt=Math.pow(2,$r)-1,am={[Fe]:"boolean",[D]:"number",[Bt]:"string",[it]:"color",[Dr]:"number[]"},Z1=Object.keys(am).map(Number).sort(Xc);function et(i){const e=[];for(const t of Z1)H1(i,t)&&e.push(am[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function H1(i,e){return(i&e)===e}function Jt(i,e){return!!(i&e)}function Ws(i,e){return i===e}class Ri{constructor(e,t){this.type=e,this.value=t}}class lm{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function W1(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function Y1(i){switch(i){case"string":return Bt;case"color":return it;case"number":return D;case"boolean":return Fe;case"number[]":return Dr;default:throw new Error(`Unrecognized type hint: ${i}`)}}function de(i,e,t){switch(typeof i){case"boolean":return new Ri(Fe,i);case"number":return new Ri(D,i);case"string":{let r=Bt;return dT(i)&&(r|=it),Ws(r&t,Ui)||(r&=t),new Ri(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return av(i,e,t);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=Dr;return(i.length===3||i.length===4)&&(n|=it),t&&(n&=t),new Ri(n,i)}const I={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},q1={[I.Get]:B(([i,e])=>e!==void 0?Y1(e.value):dt,Y(1,2),Q1),[I.Var]:B(([i])=>i.type,Y(1,1),J1),[I.Id]:B(D|Bt,ss,ev),[I.Concat]:B(Bt,Y(2,1/0),oe(dt)),[I.GeometryType]:B(Bt,ss),[I.Resolution]:B(D,ss),[I.Zoom]:B(D,ss),[I.Time]:B(D,ss),[I.Any]:B(Fe,Y(2,1/0),oe(Fe)),[I.All]:B(Fe,Y(2,1/0),oe(Fe)),[I.Not]:B(Fe,Y(1,1),oe(Fe)),[I.Equal]:B(Fe,Y(2,2),oe(dt),ui),[I.NotEqual]:B(Fe,Y(2,2),oe(dt),ui),[I.GreaterThan]:B(Fe,Y(2,2),oe(dt),ui),[I.GreaterThanOrEqualTo]:B(Fe,Y(2,2),oe(dt),ui),[I.LessThan]:B(Fe,Y(2,2),oe(dt),ui),[I.LessThanOrEqualTo]:B(Fe,Y(2,2),oe(dt),ui),[I.Multiply]:B(i=>{let e=D|it;for(let t=0;t<i.length;t++)e&=i[t].type;return e},Y(2,1/0),oe(D|it),ui),[I.Divide]:B(D,Y(2,2),oe(D)),[I.Add]:B(D,Y(2,1/0),oe(D)),[I.Subtract]:B(D,Y(2,2),oe(D)),[I.Clamp]:B(D,Y(3,3),oe(D)),[I.Mod]:B(D,Y(2,2),oe(D)),[I.Pow]:B(D,Y(2,2),oe(D)),[I.Abs]:B(D,Y(1,1),oe(D)),[I.Floor]:B(D,Y(1,1),oe(D)),[I.Ceil]:B(D,Y(1,1),oe(D)),[I.Round]:B(D,Y(1,1),oe(D)),[I.Sin]:B(D,Y(1,1),oe(D)),[I.Cos]:B(D,Y(1,1),oe(D)),[I.Atan]:B(D,Y(1,2),oe(D)),[I.Sqrt]:B(D,Y(1,1),oe(D)),[I.Match]:B(i=>{let e=dt;for(let t=2;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},Y(4,1/0),fg,nv),[I.Between]:B(Fe,Y(3,3),oe(D)),[I.Interpolate]:B(i=>{let e=it|D;for(let t=3;t<i.length;t+=2)e&=i[t].type;return e},Y(6,1/0),fg,iv),[I.Case]:B(i=>{let e=dt;for(let t=1;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},Y(3,1/0),tv,rv),[I.In]:B(Fe,Y(2,2),sv),[I.Number]:B(D,Y(1,1/0),oe(dt)),[I.String]:B(Bt,Y(1,1/0),oe(dt)),[I.Array]:B(i=>i.length===3||i.length===4?Dr|it:Dr,Y(1,1/0),oe(D)),[I.Color]:B(it,Y(3,4),oe(D)),[I.Band]:B(D,Y(1,3),oe(D)),[I.Palette]:B(it,Y(2,2),ov)};function Q1(i,e){const t=de(i[1],e);if(!(t instanceof Ri))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),i.length===3){const n=de(i[2],e);return[t,n]}return[t]}function J1(i,e,t,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(r),!("variables"in e.style)||e.style.variables[r]===void 0)return[new Ri(dt,r)];const s=e.style.variables[r],o=de(s,e);if(o.value=r,n&&!Jt(n,o.type))throw new Error(`The variable ${r} has type ${et(o.type)} but the following type was expected: ${et(n)}`);return[o]}function ev(i,e){e.featureId=!0}function ss(i,e){const t=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function Y(i,e){return function(t,n){const r=t[0],s=t.length-1;if(i===e){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>e){const o=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function oe(i){return function(e,t){const n=e[0],r=e.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=de(e[o+1],t);if(!Jt(i,a.type)){const l=et(i),h=et(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function ui(i,e,t){const n=i[0],r=i.length-1;let s=dt;for(let a=0;a<t.length;++a)s&=t[a].type;if(s===Ui)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=de(i[a+1],e,s);return o}function tv(i,e){const t=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function fg(i,e){const t=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function nv(i,e,t,n){const r=i.length-1;let s=de(i[1],e).type;const o=de(i[i.length-1],e);let a=n!==void 0?n&o.type:o.type;const l=new Array(r-2);for(let c=0;c<r-2;c+=2){const u=de(i[c+2],e),d=de(i[c+3],e);s&=u.type,a&=d.type,l[c]=u,l[c+1]=d}const h=Bt|D|Fe;if(!Jt(h,s))throw new Error(`Expected an input of type ${et(h)} for the interpolate operation, got ${et(s)} instead`);if(Ws(a,Ui))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let c=0;c<r-2;c+=2){const u=de(i[c+2],e,s),d=de(i[c+3],e,a);l[c]=u,l[c+1]=d}return[de(i[1],e,s),...l,de(i[i.length-1],e,a)]}function iv(i,e,t,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=de(s,e);let o=de(i[2],e);if(!Jt(D,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${et(o.type)} instead`);o=de(i[2],e,D);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=de(i[l+3],e);if(!Jt(D,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${et(h.type)} at position ${l+2} instead`);let c=de(i[l+4],e);if(!Jt(D|it,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${et(c.type)} at position ${l+3} instead`);h=de(i[l+3],e,D),c=de(i[l+4],e,D|it),a[l]=h,a[l+1]=c}return[s,o,...a]}function rv(i,e,t,n){const r=de(i[i.length-1],e);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=de(i[a+1],e),h=de(i[a+2],e);if(!Jt(Fe,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${et(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(Ws(s,Ui))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=de(i[a+2],e,s);return o[o.length-1]=de(i[i.length-1],e,s),o}function sv(i,e){let t=i[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let n=Bt|D;const r=new Array(t.length);for(let s=0;s<r.length;s++){const o=de(t[s],e);n&=o.type,r[s]=o}if(Ws(n,Ui))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[de(i[1],e,n),...r]}function ov(i,e){const t=de(i[1],e,D);if(t.type!==D)throw new Error(`The first argument of palette must be an number, got ${et(t.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=de(n[s],e,it);if(!(o instanceof Ri))throw new Error(`The palette color at index ${s} must be a literal value`);if(!Jt(o.type,it))throw new Error(`The palette color at index ${s} should be of type color, got ${et(o.type)} instead`);r[s]=o}return[t,...r]}function B(i,...e){return function(t,n,r){const s=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!Jt(a,r))throw new Error(`The following expression was expected to return ${et(r)}, but returns ${et(a)} instead: ${JSON.stringify(t)}`);a&=r}if(a===Ui)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new lm(a,s,...o)}}function av(i,e,t){const n=i[0],r=q1[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,e,t)}class lv{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}function hv(i,e){return`operator_${i}_${Object.keys(e.functions).length}`}function ml(i){const e=i.toString();return e.includes(".")?e:e+".0"}function hm(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(ml).join(", ")})`}function cv(i){const e=Ta(i),t=e.length>3?e[3]:1;return hm([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const ah={};let uv=0;function cm(i){return i in ah||(ah[i]=uv++),ah[i]}function dv(i){return ml(cm(i))}function um(i){return"u_var_"+i}function gv(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const lh="getBandValue",dm="u_paletteTextures";function fv(i,e,t,n){const r=de(i,t,e);if(Ws(r.type,Ui))throw new Error("No matching type was found");if(!Jt(e,r.type)){const s=et(e),o=et(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return _u(r,e,n)}function ee(i){return(e,t,n)=>{const r=t.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=_u(t.args[o],n,e);return i(s,e)}}const _v={[I.Get]:(i,e)=>{const t=e.args[0].value;return t in i.properties||(i.properties[t]={name:t,type:e.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+t},[I.GeometryType]:(i,e,t)=>{const n="geometryType",r=s=>{const o=s.getType();switch(o){case"Point":case"LineString":case"Polygon":return o;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return o.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(s.getGeometries()[0])}};return n in i.properties||(i.properties[n]={name:n,type:Bt,evaluator:s=>r(s.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[I.Var]:(i,e)=>{const t=e.args[0].value;return t in i.variables||(i.variables[t]={name:t,type:e.type}),um(t)},[I.Resolution]:()=>"u_resolution",[I.Zoom]:()=>"u_zoom",[I.Time]:()=>"u_time",[I.Any]:ee(i=>`(${i.join(" || ")})`),[I.All]:ee(i=>`(${i.join(" && ")})`),[I.Not]:ee(([i])=>`(!${i})`),[I.Equal]:ee(([i,e])=>`(${i} == ${e})`),[I.NotEqual]:ee(([i,e])=>`(${i} != ${e})`),[I.GreaterThan]:ee(([i,e])=>`(${i} > ${e})`),[I.GreaterThanOrEqualTo]:ee(([i,e])=>`(${i} >= ${e})`),[I.LessThan]:ee(([i,e])=>`(${i} < ${e})`),[I.LessThanOrEqualTo]:ee(([i,e])=>`(${i} <= ${e})`),[I.Multiply]:ee(i=>`(${i.join(" * ")})`),[I.Divide]:ee(([i,e])=>`(${i} / ${e})`),[I.Add]:ee(i=>`(${i.join(" + ")})`),[I.Subtract]:ee(([i,e])=>`(${i} - ${e})`),[I.Clamp]:ee(([i,e,t])=>`clamp(${i}, ${e}, ${t})`),[I.Mod]:ee(([i,e])=>`mod(${i}, ${e})`),[I.Pow]:ee(([i,e])=>`pow(${i}, ${e})`),[I.Abs]:ee(([i])=>`abs(${i})`),[I.Floor]:ee(([i])=>`floor(${i})`),[I.Ceil]:ee(([i])=>`ceil(${i})`),[I.Round]:ee(([i])=>`floor(${i} + 0.5)`),[I.Sin]:ee(([i])=>`sin(${i})`),[I.Cos]:ee(([i])=>`cos(${i})`),[I.Atan]:ee(([i,e])=>e!==void 0?`atan(${i}, ${e})`:`atan(${i})`),[I.Sqrt]:ee(([i])=>`sqrt(${i})`),[I.Match]:ee(i=>{const e=i[0],t=i[i.length-1];let n=null;for(let r=i.length-3;r>=1;r-=2){const s=i[r],o=i[r+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[I.Between]:ee(([i,e,t])=>`(${i} >= ${e} && ${i} <= ${t})`),[I.Interpolate]:ee(([i,e,...t])=>{let n="";for(let r=0;r<t.length-2;r+=2){const s=t[r],o=n||t[r+1],a=t[r+2],l=t[r+3];let h;i===ml(1)?h=`(${e} - ${s}) / (${a} - ${s})`:h=`(pow(${i}, (${e} - ${s})) - 1.0) / (pow(${i}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[I.Case]:ee(i=>{const e=i[i.length-1];let t=null;for(let n=i.length-3;n>=0;n-=2){const r=i[n],s=i[n+1];t=`(${r} ? ${s} : ${t||e})`}return t}),[I.In]:ee(([i,...e],t)=>{const n=hv("in",t),r=[];for(let s=0;s<e.length;s+=1)r.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${i})`}),[I.Array]:ee(i=>`vec${i.length}(${i.join(", ")})`),[I.Color]:ee(i=>{const e=i.slice(0,3).map(t=>`${t} / 255.0`);return i.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${i[3]} * vec4(${e.join(", ")}, 1.0))`}),[I.Band]:ee(([i,e,t],n)=>{if(!(lh in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${V.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[lh]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${V.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${V.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${lh}(${i}, ${e??"0.0"}, ${t??"0.0"})`}),[I.Palette]:(i,e)=>{const[t,...n]=e.args,r=n.length,s=new Uint8Array(r*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Ta(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${dm}[${i.paletteTextures.length}]`,a=new lv(o,s);i.paletteTextures.push(a);const l=_u(t,D,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function _u(i,e,t){if(i instanceof lm){const n=_v[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(t,i,e)}if((i.type&D)>0)return ml(i.value);if((i.type&Fe)>0)return i.value.toString();if((i.type&Bt)>0)return dv(i.value.toString());if((i.type&it)>0)return cv(i.value);if((i.type&Dr)>0)return hm(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${et(e)})`)}function Zi(i,e,t){const n=W1();return n.style=i.style,fv(e,t,n,i)}function _g(i,e){const t=`
    attribute vec2 ${Yo.TEXTURE_COORD};
    uniform mat4 ${V.TILE_TRANSFORM};
    uniform float ${V.TEXTURE_PIXEL_WIDTH};
    uniform float ${V.TEXTURE_PIXEL_HEIGHT};
    uniform float ${V.TEXTURE_RESOLUTION};
    uniform float ${V.TEXTURE_ORIGIN_X};
    uniform float ${V.TEXTURE_ORIGIN_Y};
    uniform float ${V.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${Yo.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${V.TEXTURE_ORIGIN_X} + ${V.TEXTURE_RESOLUTION} * ${V.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${V.TEXTURE_ORIGIN_Y} - ${V.TEXTURE_RESOLUTION} * ${V.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${V.TILE_TRANSFORM} * vec4(${Yo.TEXTURE_COORD}, ${V.DEPTH}, 1.0);
    }
  `,n={...gv(),inFragmentShader:!0,bandCount:e,style:i},r=[];if(i.color!==void 0){const u=Zi(n,i.color,it);r.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Zi(n,i.contrast,D);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Zi(n,i.exposure,D);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Zi(n,i.saturation,D);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Zi(n,i.gamma,D);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Zi(n,i.brightness,D);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=um(d.name);s[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=cm(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${V.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${dm}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${V.RENDER_EXTENT};
    uniform float ${V.TRANSITION_ALPHA};
    uniform float ${V.TEXTURE_PIXEL_WIDTH};
    uniform float ${V.TEXTURE_PIXEL_HEIGHT};
    uniform float ${V.RESOLUTION};
    uniform float ${V.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${V.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${V.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${V.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${V.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${V.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${V.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class sc extends T1{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(he.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=_g(this.style_,this.getSourceBandCount_());return new V1(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let r;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(r=n.renderFrame(e));return r}render(e,t){this.rendered=!0;const n=e.viewState,r=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(e,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=_g(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}sc.prototype.dispose;class mv extends fl{constructor(e){e=e||{},super(e)}}let cr=null;function pv(){cr=sn(1,1,void 0,{willReadFrequently:!0})}class Ev extends im{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Qt(),this.pixelTransform=Qt(),this.inversePixelTransform=Qt(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){cr||pv(),cr.clearRect(0,0,1,1);let r;try{cr.drawImage(e,t,n,1,1,0,0,1,1),r=cr.getImageData(0,0,1,1).data}catch{return cr=null,null}return r}getBackground(e){let t=this.getLayer().getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,n){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!n||e&&e.style.backgroundColor&&rl(Ta(e.style.backgroundColor),Ta(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=sn();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const r=Xr(n),s=cl(n),o=hl(n),a=ll(n);vt(t.coordinateToPixelTransform,r),vt(t.coordinateToPixelTransform,s),vt(t.coordinateToPixelTransform,o),vt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;vt(l,r),vt(l,s),vt(l,o),vt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){const s=new ps(e,this.inversePixelTransform,n,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(Et.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Et.POSTRENDER,e,t)}getRenderTransform(e,t,n,r,s,o,a){const l=s/2,h=o/2,c=r/t,u=-c,d=-e[0]+a,g=-e[1];return Li(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class yv extends Ev{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,r=e.viewState,s=r.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Pt(l,Qn(t.extent,r.projection))),!a[_t.ANIMATING]&&!a[_t.INTERACTING]&&!Fi(l))if(o){const h=r.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===ye.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=vt(t.pixelToCoordinateTransform,e.slice()),s=n.getExtent();if(s&&!xs(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Le(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=ht(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(e,t){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),_=c*a/(g*l),m=e.extent,E=u.resolution,p=u.rotation,T=Math.round(Le(m)/E*c),y=Math.round(ht(m)/E*c);Li(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,p,-T/2,-y/2),D_(this.inversePixelTransform,this.pixelTransform);const v=sT(this.pixelTransform);this.useContainer(t,v,this.getBackground(e));const x=this.context,R=x.canvas;R.width!=T||R.height!=y?(R.width=T,R.height=y):this.containerReused||x.clearRect(0,0,T,y);let w=!1,C=!0;if(h.extent){const U=Qn(h.extent,u.projection);C=Bs(U,e.extent),w=C&&!ua(U,e.extent),w&&this.clipUnrotated(x,e,U)}const b=n.getImage(),O=Li(this.tempTransform,T/2,y/2,f,_,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const J=b.width*O[0],z=b.height*O[3];if(this.getLayer().getSource().getInterpolate()||(x.imageSmoothingEnabled=!1),this.preRender(x,e),C&&J>=.5&&z>=.5){const U=O[4],G=O[5],W=h.opacity;let Ne;W!==1&&(Ne=x.globalAlpha,x.globalAlpha=W),x.drawImage(b,0,0,+b.width,+b.height,U,G,J,z),W!==1&&(x.globalAlpha=Ne)}return this.postRender(x,e),w&&x.restore(),x.imageSmoothingEnabled=!0,v!==R.style.transform&&(R.style.transform=v),this.container}}class Tv extends mv{constructor(e){super(e)}createRenderer(){return new yv(this)}getData(e){return super.getData(e)}}const mg=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],pg={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class gm extends Vs{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const n=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(j.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${zr} ${_l}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Eg(t))if(yg(t))Rv(t);else{let n;this.source_?n=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:n=e.getTargetElement(),this.keys_?vv(n):fm(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=yg(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(ha(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(pg.ENTERFULLSCREEN)):(ha(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(pg.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(ze.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(ze.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let n=0,r=e.length;n<r;++n)Re(e[n]);e.length=0;const t=this.getMap();if(t){const n=t.getOwnerDocument();Eg(n)?this.element.classList.remove(ig):this.element.classList.add(ig);for(let r=0,s=mg.length;r<s;++r)e.push(ie(n,mg[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Eg(i){const e=i.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&i.fullscreenEnabled)}function yg(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function fm(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function vv(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():fm(i)}function Rv(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}const hh="units",xv=[1,2,5],os=25.4/.28;class _m extends Vs{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+zr,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(hh,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(hh)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(hh,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=ma(n,e.resolution,t,s);const a=this.minWidth_*(this.dpi_||os)/os,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||os)/os:void 0;let h=a*o,c="";if(r=="degrees"){const T=Or.degrees;h*=T,h<T/60?(c="",o*=3600):h<T?(c="",o*=60):c=""}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,g,f,_,m,E;for(;;){f=Math.floor(u/3);const T=Math.pow(10,f);if(d=xv[(u%3+3)%3]*T,g=Math.round(d/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=_,g=m,f=E;break}else if(g>=a)break;_=d,m=g,E=f,++u}const p=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const c=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${c}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,e,!1,t,n):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+s+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,r,s){const o=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+s),a=e===0?-3:t/this.scaleBarSteps_*-1,l=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${a}px;text-align: ${e===0?"left":"center"};min-width: ${l}px;left: ${n?t+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const e=ma(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||os,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}bE(()=>Promise.resolve({}),qo([0]));const mm=500,wv=!0;function Cv(i,e){let t,n,r,s;const o=()=>{const u=e.srid(),d=e.fullExtent();return u==="EPSG:3857"?d:e.transformRectangle(d,u,"EPSG:3857")},a=()=>{i.innerHTML="";const u=o().center();t=new jt({center:[u.x,u.y],zoom:10}),s=new eT(e,{debug:!1,extentBufferFactor:()=>document.getElementById("extentBufferFactor").valueAsNumber}),r=new sc({source:s}),n=new q_({target:i,view:t,controls:lu().extend([new _m,new gm]),layers:[r,new sc({visible:wv,source:new A_({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),style:{saturation:["var","saturation"],variables:{saturation:-.75}}})].reverse()}),n.once("precompose",function(d){l()})},l=()=>{const u=o();t.fit([u.xMinimum,u.yMinimum,u.xMaximum,u.yMaximum],{duration:mm}),setTimeout(()=>{h()},0)},h=()=>{s?.clear(),r?.getRenderer()?.clearCache(),r?.changed()},c=document.getElementById("xyzBaseMap");return c&&c.addEventListener("change",()=>{n&&n.getLayers().getArray()[0].setVisible(c.checked)}),a(),{init:a,update:l,render:h}}function bv(i,e){let t,n,r,s,o;const a=()=>{i.innerHTML="",n=e.srid();const c=new ga({code:n,units:"m"}),u=e.fullExtent().center();t=new jt({projection:c,center:[u.x,u.y],zoom:10}),o=new zd(e,{projection:c}),s=new Tv({source:o}),r=new q_({target:i,view:t,controls:lu().extend([new _m,new gm]),layers:[s]}),r.once("precompose",function(d){const g=e.fullExtent();t.fit([g.xMinimum,g.yMinimum,g.xMaximum,g.yMaximum],{duration:mm})})},l=()=>{a()},h=()=>{setTimeout(()=>{o=new zd(e,{projection:new ga({code:n,units:"m"})}),s?.setSource(o)},0)};return a(),{init:a,update:l,render:h}}function Iv(i,e){const t=()=>{i.innerHTML="";const n=document.createElement("div");n.className="layers",i.appendChild(n);const r=e.mapLayers();for(const s of r){const o=document.createElement("div");o.className="layer";const a=document.createElement("input");a.type="checkbox",s.visible&&(a.checked=!0),a.addEventListener("change",()=>{s.visible=a.checked,redraw(),t()}),o.appendChild(a);const l=document.createTextNode(s.name);o.appendChild(l);const h=document.createElement("input");s.visible||(h.style.visibility="hidden"),h.type="range",h.min="0",h.max="100",h.value=""+s.opacity*100,h.step="1",h.addEventListener("change",()=>{s.opacity=parseInt(h.value)/100,redraw()}),o.appendChild(h),n.appendChild(o)}if(e.mapThemes().length>0){const s=document.createElement("div");s.className="themes",i.appendChild(s);const o=document.createElement("select");o.addEventListener("change",()=>{o.value&&(e.setMapTheme(o.value),redraw(),t())}),s.appendChild(o);const a=e.getMapTheme(),l=document.createElement("option");l.value="",l.text="",a||(l.selected=!0),o.appendChild(l);for(const h of e.mapThemes()){const c=document.createElement("option");c.value=h,c.text=h,h===a&&(c.selected=!0),o.appendChild(c)}}};return t(),t}const Sv=i=>({owner:"boardend",repo:"qgis-js-projects",path:"/"+i,branch:"main",prefix:`${i[0].toUpperCase()}${i.slice(1)}: `}),Lv=[Sv("demo")];async function Pv(){console.log(`qgis-js (${Q0})`);const i=document.getElementById("status"),e=document.getElementById("project");let t=!1;const n=o=>{t||(i.firstElementChild.innerHTML=o)},r=o=>{t=!0,console.error(o);const a=""+o&&o.message?o.message:"Runtime error";e.style.visibility="none",i.style.display="auto",i.innerHTML=`<div class="alert alert-danger" role="alert">
      <b style="color: red">Error:&nbsp;</b>
      ${a}
    </div>`},s=()=>{i.style.display="none",e.style.visibility="visible"};try{const{api:o,fs:a}=await q0({prefix:"/assets/wasm",onStatus:R=>n(R)});n("Loading projects...");const l=[],h=[],{openProject:c,loadLocalProject:u,loadRemoteProjects:d,loadGithubProjects:g}=RE(a,R=>{o.loadProject(R),setTimeout(()=>{l.forEach(w=>w())},0)}),f=async function(){const R=await u();await c(R),E(R.name,()=>R),m.value=R.name},_=new Map,m=document.getElementById("projects");m.addEventListener("change",()=>{const R=_.get(m.value);R&&c(R())});const E=(R,w)=>{_.set(R,w);const C=document.createElement("option");C.value=R,C.text=R,m.add(C,null)};document.getElementById("local-project").onclick=f;const p=await d();p.forEach(R=>E(R.name,()=>R));for(const R of Lv)try{const w=await g(R.owner,R.repo,R.path,R.branch);Object.entries(w).forEach(([C,b])=>{E((R.prefix||"")+C,b)})}catch(w){console.warn(`Unable to load GitHub project "${R.owner}/${R.repo}"`,w)}n("Opening first project..."),await c(p[0]),n("Rendering first frame..."),await o.renderImage(o.srid(),o.fullExtent(),42,42,1),s();const T=document.getElementById("layers-control");T&&l.push(Iv(T,o,()=>{setTimeout(()=>{h.forEach(R=>R())},0)}));const y=document.getElementById("js-demo-canvas");if(y){const{update:R,render:w}=xE(y,o);l.push(R),h.push(w);const C=document.getElementById("tab1");C.addEventListener("change",()=>{C.checked&&R()})}const v=document.getElementById("ol-demo-xyz");if(v){const{update:R,render:w}=Cv(v,o);l.push(R),h.push(w)}const x=document.getElementById("ol-demo-canvas");if(x){const{update:R,render:w}=bv(x,o);l.push(R),h.push(w)}}catch(o){r(o)}}document.addEventListener("DOMContentLoaded",function(){Pv()});function qo(i){return qo.viteFileDeps||(qo.viteFileDeps=["assets/ol-CSy_vbSQ.css"]),i.map(e=>qo.viteFileDeps[e])}var Av=Object.defineProperty,Mv=(i,e,t)=>e in i?Av(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Es=(i,e,t)=>(Mv(i,typeof e!="symbol"?e+"":e,t),t),pm=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},yi=(i,e,t)=>(pm(i,e,"read from private field"),t?t.call(i):e.get(i)),ch=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Fn=(i,e,t,n)=>(pm(i,e,"write to private field"),e.set(i,t),t),Tg=(i,e,t,n)=>({set _(r){Fn(i,e,r)},get _(){return yi(i,e,n)}});function Ov(){return Math.min(Math.max(navigator?.hardwareConcurrency||4,4),8)}let Dv=class{constructor(i){Es(this,"value"),Es(this,"next"),this.value=i}};var cn,ur,dr;let Nv=class{constructor(){ch(this,cn,void 0),ch(this,ur,void 0),ch(this,dr,void 0),this.clear()}enqueue(i){const e=new Dv(i);yi(this,cn)?(yi(this,ur).next=e,Fn(this,ur,e)):(Fn(this,cn,e),Fn(this,ur,e)),Tg(this,dr)._++}dequeue(){const i=yi(this,cn);if(i)return Fn(this,cn,yi(this,cn).next),Tg(this,dr)._--,i.value}clear(){Fn(this,cn,void 0),Fn(this,ur,void 0),Fn(this,dr,0)}get size(){return yi(this,dr)}*[Symbol.iterator](){let i=yi(this,cn);for(;i;)yield i.value,i=i.next}};cn=new WeakMap,ur=new WeakMap,dr=new WeakMap;const Fv={bind(i,e,t){return i.bind(t)}};function Uv(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Nv;let t=0;const n=()=>{t--,e.size>0&&e.dequeue()()},r=async(a,l,h)=>{t++;const c=(async()=>a(...h))();l(c);try{await c}catch{}n()},s=(a,l,h)=>{e.enqueue(Fv.bind(r.bind(void 0,a,l,h))),(async()=>(await Promise.resolve(),t<i&&e.size>0&&e.dequeue()()))()},o=(a,...l)=>new Promise(h=>{s(a,h,l)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}}}),o}let Gv=class{constructor(i){Es(this,"_api"),Es(this,"_threadPoolSize"),Es(this,"_limit"),this._api=i,this._threadPoolSize=Ov(),this._limit=Uv(this._threadPoolSize)}runLimited(i){return this._limit(i)}renderImage(i,e,t,n,r=window?.devicePixelRatio||1){return this.runLimited(()=>new Promise(s=>{this._api.renderImage(i,e,t,n,r,o=>{const a=new Uint8ClampedArray(o),l=new ImageData(a,t,n);s(l)})}))}renderXYZTile(i,e,t,n=256,r=window?.devicePixelRatio||1,s=0){return this.runLimited(()=>new Promise(o=>{this._api.renderXYZTile(i,e,t,n,r,s,a=>{const l=new Uint8ClampedArray(a),h=new ImageData(l,n,n);o(h)})}))}mapLayers(){const i=this._api.mapLayers(),e=new Array(i.size());for(let t=0;t<i.size();t++)e[t]=i.get(t);return e}mapThemes(){const i=this._api.mapThemes(),e=new Array(i.size());for(let t=0;t<i.size();t++)e[t]=i.get(t);return e}};function jv(i){const e=new Gv(i);return new Proxy({},{has(t,n){return n in e||n in i},get(t,n){if(n in e)return e[n];if(n in i)return i[n]}})}function kv(i){return new Promise(async(e,t)=>{try{const n=(await new Function(`return import("${i}")`)()).default;e({createQtAppInstance:n})}catch(n){t(n)}})}async function Xv(i={}){return new Promise(async(e,t)=>{let n;if(i.prefix)n=i.prefix;else{const l=import.meta.url;/.*\/src\/loader\.[ts|js]\?*[^/]*$/.test(l)?(console.warn(['qgis-js loader is running in development mode and no "prefix" seems to be configured.'," - Consider adding the QgisRuntimePlugin when bundling with Vite."," - For more information see: https://github.com/qgis/qgis-js/blob/main/docs/bundling.md"].join(`
`)),typeof window<"u"&&(n=new URL("assets/wasm",window.location.href).pathname)):n=new URL("assets/wasm",import.meta.url).href}n?n=n.replace(/\/$/,""):n="assets/wasm";let r;try{const l=`${n}/qgis-js.js`;r=await kv(l)}catch(l){t(new Error("Unable to load the qgis-js.js script",{cause:l}));return}const{createQtAppInstance:s}=r;let o;typeof document<"u"&&(o=document?.querySelector("#screen"));const a=s({locateFile:l=>`${n}/`+l,preRun:[function(l){l.qtContainerElements=o?[o]:[],l.qtFontDpi=96}],postRun:[async function(){const l=await a;e({api:jv(l),module:l,fs:l.FS})}],...i.onStatus?{setStatus:i.onStatus}:{}})})}const zv="0.0.3";var Bv=Object.defineProperty,$v=(i,e,t)=>e in i?Bv(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,St=(i,e,t)=>($v(i,typeof e!="symbol"?e+"":e,t),t);const Pi="/upload/projects";let mu=class{constructor(i,e){St(this,"FS"),St(this,"type"),St(this,"name"),this.FS=i,this.type=e}isValid(){return this.getFiles().length>0&&this.getProjectFile()!==void 0}getProjectFile(){const i=this.getFiles().filter(e=>e.endsWith(".qgs")||e.endsWith(".qgz"));return i.length==1?i[0]:i.length>1?(console.warn("Found multiple project file candiates"),i[0]):void 0}getDirectoriesToCreate(){const i=new Set;for(const e of this.getDirectories()){let t=e.split("/");for(let n=0;n<t.length;n++){const r=t.slice(0,n+1).join("/");i.add(r)}}return Array.from(i).sort()}ensureDirectories(){for(const i of this.getDirectoriesToCreate()){const e=Pi+"/"+i,t=this.FS.analyzePath(e,!1);(!t||!t.exists)&&this.FS.mkdir(e)}}isProjectUploaded(){return this.FS.readdir(Pi).includes(this.name)}};const pu=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();pu?Promise.resolve().then(function(){return Wv}):Promise.resolve().then(function(){return tR});const Kv=pu?Promise.resolve().then(function(){return qv}):Promise.resolve().then(function(){return iR});async function Vv(...i){return(await Kv).default(...i)}pu?Promise.resolve().then(function(){return Jv}):Promise.resolve().then(function(){return sR});const Zv=async i=>{const e=await i.getFile();return e.handle=i,e};var Hv=async(i=[{}])=>{Array.isArray(i)||(i=[i]);const e=[];i.forEach((r,s)=>{e[s]={description:r.description||"Files",accept:{}},r.mimeTypes?r.mimeTypes.map(o=>{e[s].accept[o]=r.extensions||[]}):e[s].accept["*/*"]=r.extensions||[]});const t=await window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:e,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await Promise.all(t.map(Zv));return i[0].multiple?n:n[0]},Wv={__proto__:null,default:Hv};function Qo(i){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:n}})}return Qo=function(t){this.s=t,this.n=t.next},Qo.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?Promise.reject(t):e(n.apply(this.s,arguments))}},new Qo(i)}const Em=async(i,e,t=i.name,n)=>{const r=[],s=[];var o,a=!1,l=!1;try{for(var h,c=function(u){var d,g,f,_=2;for(typeof Symbol<"u"&&(g=Symbol.asyncIterator,f=Symbol.iterator);_--;){if(g&&(d=u[g])!=null)return d.call(u);if(f&&(d=u[f])!=null)return new Qo(d.call(u));g="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());a=!(h=await c.next()).done;a=!1){const u=h.value,d=`${t}/${u.name}`;u.kind==="file"?s.push(u.getFile().then(g=>(g.directoryHandle=i,g.handle=u,Object.defineProperty(g,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):u.kind!=="directory"||!e||n&&n(u)||r.push(Em(u,e,d,n))}}catch(u){l=!0,o=u}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]};var Yv=async(i={})=>{i.recursive=i.recursive||!1,i.mode=i.mode||"read";const e=await window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return(await(await e.values()).next()).done?[e]:Em(e,i.recursive,void 0,i.skipDirectory)},qv={__proto__:null,default:Yv},Qv=async(i,e=[{}],t=null,n=!1,r=null)=>{Array.isArray(e)||(e=[e]),e[0].fileName=e[0].fileName||"Untitled";const s=[];let o=null;if(i instanceof Blob&&i.type?o=i.type:i.headers&&i.headers.get("content-type")&&(o=i.headers.get("content-type")),e.forEach((h,c)=>{s[c]={description:h.description||"Files",accept:{}},h.mimeTypes?(c===0&&o&&h.mimeTypes.push(o),h.mimeTypes.map(u=>{s[c].accept[u]=h.extensions||[]})):o?s[c].accept[o]=h.extensions||[]:s[c].accept["*/*"]=h.extensions||[]}),t)try{await t.getFile()}catch(h){if(t=null,n)throw h}const a=t||await window.showSaveFilePicker({suggestedName:e[0].fileName,id:e[0].id,startIn:e[0].startIn,types:s,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1});!t&&r&&r(a);const l=await a.createWritable();return"stream"in i?(await i.stream().pipeTo(l),a):"body"in i?(await i.body.pipeTo(l),a):(await l.write(await i),await l.close(),a)},Jv={__proto__:null,default:Qv},eR=async(i=[{}])=>(Array.isArray(i)||(i=[i]),new Promise((e,t)=>{const n=document.createElement("input");n.type="file";const r=[...i.map(l=>l.mimeTypes||[]),...i.map(l=>l.extensions||[])].join();n.multiple=i[0].multiple||!1,n.accept=r||"",n.style.display="none",document.body.append(n);const s=l=>{typeof o=="function"&&o(),e(l)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(t),n),a=()=>{window.removeEventListener("focus",a),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",a)}),n.addEventListener("change",()=>{window.removeEventListener("focus",a),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),tR={__proto__:null,default:eR},nR=async(i=[{}])=>(Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((e,t)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=o=>{typeof s=="function"&&s(),e(o)},s=i[0].legacySetup&&i[0].legacySetup(r,()=>s(t),n);n.addEventListener("change",()=>{let o=Array.from(n.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!i[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),r(o)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),iR={__proto__:null,default:nR},rR=async(i,e={})=>{Array.isArray(e)&&(e=e[0]);const t=document.createElement("a");let n=i;"body"in i&&(n=await async function(o,a){const l=o.getReader(),h=new ReadableStream({start:d=>async function g(){return l.read().then(({done:f,value:_})=>{if(!f)return d.enqueue(_),g();d.close()})}()}),c=new Response(h),u=await c.blob();return l.releaseLock(),new Blob([u],{type:a})}(i.body,i.headers.get("content-type"))),t.download=e.fileName||"Untitled",t.href=URL.createObjectURL(await n);const r=()=>{typeof s=="function"&&s()},s=e.legacySetup&&e.legacySetup(r,()=>s(),t);return t.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(t.href),3e4),r()}),t.click(),null},sR={__proto__:null,default:rR};class oR extends mu{constructor(e,t){super(e,"Local"),St(this,"entries"),this.entries=t;const n=t.map(r=>r.webkitRelativePath).filter(r=>r&&r.length>0&&r.includes("/")).map(r=>r.split("/",1)[0]);if(n.length<1)throw new Error("Could not determine project name");this.name=n[0]}getDirectories(){const e=new Set;e.add(this.name);for(const t of this.entries){const n=t.webkitRelativePath;e.add(n.substring(0,n.lastIndexOf("/")))}return Array.from(e)}getFiles(){return this.entries.map(e=>e.webkitRelativePath)}async uploadProject(){this.ensureDirectories();for(const e of this.entries)this.FS.writeFile(Pi+"/"+e.webkitRelativePath,new Uint8Array(await e.arrayBuffer()))}}function Eu(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat([e+"/"+n.name,...Eu(n.entries,e+"/"+n.name)]):t,[])}function yu(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat(yu(n.entries,e+"/"+n.name)):t.concat(e+"/"+n.name),[])}class aR extends mu{constructor(e,t,n){super(e,"Remote"),St(this,"folder"),St(this,"path"),St(this,"baseUrl"),this.baseUrl=new URL(t),this.folder=n;const r=this.baseUrl.pathname.split("/").pop();this.name=n.name,this.path=n.path.replace(new RegExp(`^${r}/`),"")}getDirectories(){return[this.path,...Eu(this.folder.entries,this.path)]}getFiles(){return yu(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise((n,r)=>{const s=new URL(`${this.baseUrl.href}/${t}`);fetch(s).then(o=>o.arrayBuffer().then(a=>{n(a)}))})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Pi+"/"+t,n)}}}const ym="main";async function lR(i,e,t="/",n=ym){const r=`https://api.github.com/repos/${i}/${e}/contents${t}?ref=${n}`;return await(await fetch(r)).json()}async function hR(i,e,t){const n=`https://api.github.com/repos/${i}/${e}/git/trees/${t}?recursive=1`;return(await(await fetch(n)).json()).tree.filter(r=>r.type==="blob").map(r=>r.path)}function cR(i,e,t){const n={name:i,path:e,type:"Folder",entries:[]};return t.sort().forEach(r=>{const s=r.split("/");let o=n;for(let a=0;a<s.length-1;a++){const l=s[a],h=o.entries.find(c=>c.name===l);if(h)o=h;else{const c={name:l,path:o.path+"/"+l,type:"Folder",entries:[]};o.entries.push(c),o=c}}o.entries.push({name:s[s.length-1],path:r,type:"File"})}),n}class uR extends mu{constructor(e,t,n,r,s=ym){super(e,"Github"),St(this,"folder"),St(this,"path"),St(this,"owner"),St(this,"repo"),St(this,"branch"),this.folder=t,this.name=t.name,this.path=t.path,this.owner=n,this.repo=r,this.branch=s}getDirectories(){return[this.path,...Eu(this.folder.entries,this.path)]}getFiles(){return yu(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise(async(n,r)=>{const s=`https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${t}`,o=await fetch(s);n(o.arrayBuffer())})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Pi+"/"+t,n)}}}function dR(i,e){let t=Pi.split("/");for(let s=1;s<t.length;s++)i.mkdir(t.slice(0,s+1).join("/"));const n=async s=>{if(s){if(s instanceof Promise&&(s=await s),!s.isValid())throw new Error(`Project "${s.name}" is not valid`);s.isProjectUploaded()||await s.uploadProject(),r(s)}else return},r=s=>{const o=Pi+"/"+s.getProjectFile();e(o)};return{openProject:n,loadLocalProject:()=>new Promise(async(s,o)=>{try{const a=await Vv({recursive:!0,mode:"read"}),l=new oR(i,a);s(l)}catch(a){o(a)}}),loadRemoteProjects:(s="./projects/directory-listing.json")=>new Promise(async(o,a)=>{try{const l=new URL(s,window.location.href).href.split("/").slice(0,-1).join("/"),h=await(await fetch(s)).json();if(!h.type||h.type!=="Folder"){a(new Error("Remote projects response seems not a folder"));return}o(h.entries.filter(c=>c.type==="Folder").map(c=>new aR(i,l,c)))}catch(l){a(l)}}),loadGithubProjects:(s,o,a="/",l="main")=>new Promise(async(h,c)=>{try{const u=await lR(s,o,a,l);if(u instanceof Array)h(Object.fromEntries(u.filter(d=>d.type==="dir").map(d=>[d.name,()=>new Promise(async g=>{const f=await hR(s,o,d.sha);g(new uR(i,cR(d.name,d.path,f),s,o,l))})])));else{console.warn(u),h({});return}}catch(u){c(u)}})}}const vg=1.5,Io=.1;function gR(i,e){let t=null;new ResizeObserver(s=>{const o=s.find(a=>a.target===i);o&&(i.width=o.devicePixelContentBoxSize[0].inlineSize,i.height=o.devicePixelContentBoxSize[0].blockSize),n()}).observe(i,{box:"device-pixel-content-box"});async function n(){var s=window.devicePixelRatio||1,o=i.getBoundingClientRect();const a=o.width*s,l=o.height*s;if(a&&l){const h=await e.renderImage(e.srid(),t,a,l,window.devicePixelRatio),c=i.getContext("2d");i.width=a,i.height=l,c.scale(s,s),c.putImageData(h,0,0)}}document.getElementById("zoomin").onclick=function(){t.scale(1/vg),n()},document.getElementById("zoomout").onclick=function(){t.scale(vg),n()},document.getElementById("panleft").onclick=function(){t.move((t.xMaximum-t.xMinimum)*Io,0),n()},document.getElementById("panright").onclick=function(){t.move(-(t.xMaximum-t.xMinimum)*Io,0),n()},document.getElementById("panup").onclick=function(){t.move(0,-(t.yMaximum-t.yMinimum)*Io),n()},document.getElementById("pandown").onclick=function(){t.move(0,(t.yMaximum-t.yMinimum)*Io),n()};function r(){t=e.fullExtent(),n()}return r(),{update:()=>{r()},render:()=>{n()}}}const fR="modulepreload",_R=function(i){return"/"+i},Rg={},mR=function(i,e,t){let n=Promise.resolve();return e&&e.length>0&&(document.getElementsByTagName("link"),n=Promise.all(e.map(r=>{if(r=_R(r),r in Rg)return;Rg[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":fR,s||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),s)return new Promise((l,h)=>{a.addEventListener("load",l),a.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})}))),n.then(()=>i()).catch(r=>{const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r})},k={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class pl{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}class Rn{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function Tu(i,e){return i>e?1:i<e?-1:0}function pR(i,e){return i<e?1:i>e?-1:0}function El(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===e)return r;if(s<e)return t(e,i[r-1],s)>0?r-1:r}return n-1}if(t>0){for(let r=1;r<n;++r)if(i[r]<e)return r-1;return n-1}if(t<0){for(let r=1;r<n;++r)if(i[r]<=e)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==e)return r;if(i[r]<e)return i[r-1]-e<e-i[r]?r-1:r}return n-1}function ER(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let r=0;r<n;r++)i[i.length]=t[r]}function yl(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function yR(i,e,t){const n=e||Tu;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||o===0)})}function xa(){return!0}function Tl(){return!1}function wa(){}function TR(i){let e=!1,t,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!yl(s,n))&&(e=!0,r=this,n=s,t=i.apply(this,arguments)),t}}function vR(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function Ys(i){for(const e in i)delete i[e]}function RR(i){let e;for(e in i)return!1;return!e}class qs extends pl{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),r=n[e]||(n[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=t?new Rn(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,wa);delete o[n]}return l}disposeInternal(){this.listeners_&&Ys(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const r=n.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[r]=wa,++this.pendingRemovals_[e]):(n.splice(r,1),n.length===0&&delete this.listeners_[e]))}}const A={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function be(){throw new Error("Unimplemented abstract method.")}let xR=0;function Qe(i){return i.ol_uid||(i.ol_uid=String(++xR))}function Tm(i){return Math.pow(i,3)}function Kr(i){return 1-Tm(1-i)}function wR(i){return 3*i*i-2*i*i*i}function CR(i){return i}class vu extends qs{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(k.CHANGE)}release(){this.state===A.ERROR&&this.setState(A.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==A.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==A.LOADED){e.interimTile=null;break}e.getState()==A.LOADING?t=e:e.getState()==A.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==A.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){be()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const r=t-n+1e3/60;return r>=this.transition_?1:Tm(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const ai=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",bR=ai.includes("firefox"),IR=ai.includes("safari")&&!ai.includes("chrom"),SR=IR&&(ai.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ai)),LR=ai.includes("webkit")&&!ai.includes("edge"),vm=ai.includes("macintosh"),Rm=typeof devicePixelRatio<"u"?devicePixelRatio:1,xm=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,PR=typeof Image<"u"&&Image.prototype.decode,wm=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}();function on(i,e,t,n){let r;return t&&t.length?r=t.shift():xm?r=new OffscreenCanvas(i||300,e||300):r=document.createElement("canvas"),i&&(r.width=i),e&&(r.height=e),r.getContext("2d",n)}function Ss(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function Ca(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function oc(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function AR(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function MR(i,e){const t=i.childNodes;for(let n=0;;++n){const r=t[n],s=e[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}const Te={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function re(i,e,t,n,r){if(n&&n!==i&&(t=t.bind(n)),r){const o=t;t=function(){i.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:i,type:e,listener:t};return i.addEventListener(e,t),s}function ba(i,e,t,n){return re(i,e,t,n,!0)}function xe(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Ys(i))}class OR extends qs{constructor(e,t,n,r){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=typeof r=="function"?Te.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(k.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==Te.IDLE&&this.loader){this.state=Te.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;vR(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=Te.LOADED}).catch(n=>{this.state=Te.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function DR(i,e,t){const n=i;let r=!0,s=!1,o=!1;const a=[ba(n,k.LOAD,function(){o=!0,s||e()})];return n.src&&PR?(s=!0,n.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(ba(n,k.ERROR,t)),function(){r=!1,a.forEach(xe)}}const Cm=OR;class vl extends vu{constructor(e,t,n,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=A.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=A.ERROR,this.unlistenImage_(),this.image_=NR(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=A.LOADED:this.state=A.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==A.ERROR&&(this.state=A.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==A.IDLE&&(this.state=A.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=DR(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function NR(){const i=on(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const Ru=.5,We={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function ac(i){const e=Vr();for(let t=0,n=i.length;t<n;++t)Jo(e,i[t]);return e}function FR(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function bm(i,e,t){let n,r;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?r=i[1]-t:i[3]<t?r=t-i[3]:r=0,n*n+r*r}function Ls(i,e){return Im(i,e[0],e[1])}function Ia(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function Im(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function xg(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=e[0],a=e[1];let l=We.UNKNOWN;return o<t?l=l|We.LEFT:o>r&&(l=l|We.RIGHT),a<n?l=l|We.BELOW:a>s&&(l=l|We.ABOVE),l===We.UNKNOWN&&(l=We.INTERSECTING),l}function Vr(){return[1/0,1/0,-1/0,-1/0]}function Qs(i,e,t,n,r){return r?(r[0]=i,r[1]=e,r[2]=t,r[3]=n,r):[i,e,t,n]}function Rl(i){return Qs(1/0,1/0,-1/0,-1/0,i)}function UR(i,e){const t=i[0],n=i[1];return Qs(t,n,t,n,e)}function GR(i,e,t,n,r){const s=Rl(r);return Sm(s,i,e,t,n)}function lc(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function jR(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function Jo(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function Sm(i,e,t,n,r){for(;t<n;t+=r)kR(i,e[t],e[t+1]);return i}function kR(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function Lm(i,e){let t;return t=e(xl(i)),t||(t=e(wl(i)),t)||(t=e(Cl(i)),t)||(t=e(Zr(i)),t)?t:!1}function Ps(i){let e=0;return Gi(i)||(e=Pe(i)*ct(i)),e}function xl(i){return[i[0],i[1]]}function wl(i){return[i[2],i[1]]}function Ai(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function XR(i,e){let t;if(e==="bottom-left")t=xl(i);else if(e==="bottom-right")t=wl(i);else if(e==="top-left")t=Zr(i);else if(e==="top-right")t=Cl(i);else throw new Error("Invalid corner");return t}function Sa(i,e,t,n,r){const[s,o,a,l,h,c,u,d]=zR(i,e,t,n);return Qs(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function zR(i,e,t,n){const r=e*n[0]/2,s=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,h=r*a,c=s*o,u=s*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function ct(i){return i[3]-i[1]}function At(i,e,t){const n=t||Vr();return Js(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):Rl(n),n}function Zr(i){return[i[0],i[3]]}function Cl(i){return[i[2],i[3]]}function Pe(i){return i[2]-i[0]}function Js(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function Gi(i){return i[2]<i[0]||i[3]<i[1]}function BR(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function $R(i,e,t){let n=!1;const r=xg(i,e),s=xg(i,t);if(r===We.INTERSECTING||s===We.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],d=t[0],g=t[1],f=(g-u)/(d-c);let _,m;s&We.ABOVE&&!(r&We.ABOVE)&&(_=d-(g-h)/f,n=_>=o&&_<=l),!n&&s&We.RIGHT&&!(r&We.RIGHT)&&(m=g-(d-l)*f,n=m>=a&&m<=h),!n&&s&We.BELOW&&!(r&We.BELOW)&&(_=d-(g-a)/f,n=_>=o&&_<=l),!n&&s&We.LEFT&&!(r&We.LEFT)&&(m=g-(d-o)*f,n=m>=a&&m<=h)}return n}const Nr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class La{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Nr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const eo=6378137,Rr=Math.PI*eo,KR=[-Rr,-Rr,Rr,Rr],VR=[-180,-85,180,85],So=eo*Math.log(Math.tan(Math.PI/2));class Hi extends La{constructor(e){super({code:e,units:"m",extent:KR,global:!0,worldExtent:VR,getPointResolution:function(t,n){return t/Math.cosh(n[1]/eo)}})}}const wg=[new Hi("EPSG:3857"),new Hi("EPSG:102100"),new Hi("EPSG:102113"),new Hi("EPSG:900913"),new Hi("http://www.opengis.net/def/crs/EPSG/0/3857"),new Hi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ZR(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t){e[r]=Rr*i[r]/180;let s=eo*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>So?s=So:s<-So&&(s=-So),e[r+1]=s}return e}function HR(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t)e[r]=180*i[r]/Rr,e[r+1]=360*Math.atan(Math.exp(i[r+1]/eo))/Math.PI-90;return e}const WR=6378137,Cg=[-180,-90,180,90],YR=Math.PI*WR/180;class di extends La{constructor(e,t){super({code:e,units:"degrees",extent:Cg,axisOrientation:t,global:!0,metersPerUnit:YR,worldExtent:Cg})}}const bg=[new di("CRS:84"),new di("EPSG:4326","neu"),new di("urn:ogc:def:crs:OGC:1.3:CRS84"),new di("urn:ogc:def:crs:OGC:2:84"),new di("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new di("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new di("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let hc={};function qR(i){return hc[i]||hc[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function QR(i,e){hc[i]=e}let Ir={};function Pa(i,e,t){const n=i.getCode(),r=e.getCode();n in Ir||(Ir[n]={}),Ir[n][r]=t}function JR(i,e){let t;return i in Ir&&e in Ir[i]&&(t=Ir[i][e]),t}function ke(i,e,t){return Math.min(Math.max(i,e),t)}function ex(i,e,t,n,r,s){const o=r-t,a=s-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=r,n=s):l>0&&(t+=o*l,n+=a*l)}return Sr(i,e,t,n)}function Sr(i,e,t,n){const r=t-i,s=n-e;return r*r+s*s}function tx(i){const e=i.length;for(let n=0;n<e;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let r=n-1;r>=0;r--)i[r][e]-=i[r][n]*t[n]}return t}function ea(i){return i*Math.PI/180}function Lr(i,e){const t=i%e;return t*e<0?t+e:t}function nx(i,e,t){return i+t*(e-i)}function Pm(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function Lo(i,e){return Math.floor(Pm(i,e))}function Jn(i,e){return Math.ceil(Pm(i,e))}function ix(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function Aa(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function xu(i,e){const t=Math.cos(e),n=Math.sin(e),r=i[0]*t-i[1]*n,s=i[1]*t+i[0]*n;return i[0]=r,i[1]=s,i}function rx(i,e){return i[0]*=e,i[1]*=e,i}function sx(i,e){if(e.canWrapX()){const t=Pe(e.getExtent()),n=ox(i,e,t);n&&(i[0]-=n*t)}return i}function ox(i,e,t){const n=e.getExtent();let r=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Pe(n),r=Math.floor((i[0]-n[0])/t)),r}const ax=63710088e-1;function Ig(i,e,t){t=t||ax;const n=ea(i[1]),r=ea(e[1]),s=(r-n)/2,o=ea(e[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Am(...i){console.warn(...i)}let cc=!0;function lx(i){cc=!1}function wu(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function Mm(i,e){if(e!==void 0&&i!==e){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];i=e}return i}function hx(i){QR(i.getCode(),i),Pa(i,i,wu)}function cx(i){i.forEach(hx)}function Wt(i){return typeof i=="string"?qR(i):i||null}function Ma(i,e,t,n){i=Wt(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/Nr[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=e;else{const a=bu(i,Wt("EPSG:4326"));if(a===Mm&&o!=="degrees")r=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Ig(h.slice(0,2),h.slice(2,4)),u=Ig(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?Nr[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Sg(i){cx(i),i.forEach(function(e){i.forEach(function(t){e!==t&&Pa(e,t,wu)})})}function ux(i,e,t,n){i.forEach(function(r){e.forEach(function(s){Pa(r,s,t),Pa(s,r,n)})})}function Cu(i,e){return i?typeof i=="string"?Wt(i):i:Wt(e)}function Zn(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||bu(i,e)===wu)&&t}function bu(i,e){const t=i.getCode(),n=e.getCode();let r=JR(t,n);return r||(r=Mm),r}function Oa(i,e){const t=Wt(i),n=Wt(e);return bu(t,n)}function dx(i,e,t){return Oa(e,t)(i,void 0,i.length)}function uc(i,e){return i}function un(i,e){return cc&&!Aa(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(cc=!1,Am("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function gx(i,e){return i}function ei(i,e){return i}function fx(){Sg(wg),Sg(bg),ux(bg,wg,ZR,HR)}fx();const _x=10,Lg=.25;class Iu{constructor(e,t,n,r,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=Oa(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const T=p[0]+"/"+p[1];return a[T]||(a[T]=l(p)),a[T]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Pe(r)>=Pe(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Pe(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Pe(this.targetProj_.getExtent()):null;const h=Zr(n),c=Cl(n),u=wl(n),d=xl(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),E=_x+(o?Math.max(0,Math.ceil(Math.log2(Ps(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,m,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(T,y,v){p=Math.min(p,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-p>this.sourceWorldWidth_/2){const y=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];y[0][0]-p>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-p>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-p>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const v=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-v<this.sourceWorldWidth_/2&&(T.source=y)}})}a={}}addTriangle_(e,t,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,n]})}addQuad_(e,t,n,r,s,o,a,l,h){const c=ac([s,o,a,l]),u=this.sourceWorldWidth_?Pe(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=ac([e,t,n,r]);f=Pe(m)/this.targetWorldWidth_>Lg||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Lg||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Js(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(m);let p;g?p=(Lr(s[0],d)+Lr(a[0],d))/2-Lr(E[0],d):p=(s[0]+a[0])/2-E[0];const T=(s[1]+a[1])/2-E[1];f=p*p+T*T>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(m),p=[(r[0]+e[0])/2,(r[1]+e[1])/2],T=this.transformInv_(p);this.addQuad_(e,t,m,p,s,o,E,T,h-1),this.addQuad_(p,m,n,r,T,E,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(m),p=[(n[0]+r[0])/2,(n[1]+r[1])/2],T=this.transformInv_(p);this.addQuad_(e,m,p,r,s,E,T,l,h-1),this.addQuad_(m,t,n,p,E,o,a,T,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,n,r,s,a,l),_&14||this.addTriangle_(e,n,t,s,a,o),_&&(_&13||this.addTriangle_(t,r,e,o,l,s),_&7||this.addTriangle_(t,r,n,o,l,a))}calculateSourceExtent(){const e=Vr();return this.triangles_.forEach(function(t,n,r){const s=t.source;Jo(e,s[0]),Jo(e,s[1]),Jo(e,s[2])}),e}getTriangles(){return this.triangles_}}let uh;const En=[];function Pg(i,e,t,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,r)),i.restore()}function dh(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function mx(){if(uh===void 0){const i=on(6,6,En);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Pg(i,4,5,4,0),Pg(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;uh=dh(e,0)||dh(e,4)||dh(e,8),Ss(i),En.push(i.canvas)}return uh}function dc(i,e,t,n){const r=dx(t,e,i);let s=Ma(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||Ls(l,r)){const h=Ma(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Om(i,e,t,n){const r=Ai(t);let s=dc(i,e,r,n);return(!isFinite(s)||s<=0)&&Lm(t,function(o){return s=dc(i,e,o,n),isFinite(s)&&s>0}),s}function Su(i,e,t,n,r,s,o,a,l,h,c,u,d){const g=on(Math.round(t*i),Math.round(t*e),En);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function f(p){return Math.round(p*t)/t}g.globalCompositeOperation="lighter";const _=Vr();l.forEach(function(p,T,y){jR(_,p.extent)});let m;if(!d||l.length!==1||h!==0){const p=Pe(_),T=ct(_);m=on(Math.round(t*p/n),Math.round(t*T/n),En),u||(m.imageSmoothingEnabled=!1);const y=t/n;l.forEach(function(v,x,R){const w=v.extent[0]-_[0],C=-(v.extent[3]-_[3]),b=Pe(v.extent),O=ct(v.extent);v.image.width>0&&v.image.height>0&&m.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,w*y,C*y,b*y,O*y)})}const E=Zr(o);return a.getTriangles().forEach(function(p,T,y){const v=p.source,x=p.target;let R=v[0][0],w=v[0][1],C=v[1][0],b=v[1][1],O=v[2][0],J=v[2][1];const z=f((x[0][0]-E[0])/s),U=f(-(x[0][1]-E[1])/s),G=f((x[1][0]-E[0])/s),W=f(-(x[1][1]-E[1])/s),Ne=f((x[2][0]-E[0])/s),Ot=f(-(x[2][1]-E[1])/s),Dt=R,Nt=w;R=0,w=0,C-=Dt,b-=Nt,O-=Dt,J-=Nt;const is=[[C,b,0,0,G-z],[O,J,0,0,Ne-z],[0,0,C,b,W-U],[0,0,O,J,Ot-U]],Ke=tx(is);if(!Ke)return;if(g.save(),g.beginPath(),mx()||!u){g.moveTo(G,W);const _e=4,Ze=z-G,bn=U-W;for(let Se=0;Se<_e;Se++)g.lineTo(G+f((Se+1)*Ze/_e),W+f(Se*bn/(_e-1))),Se!=_e-1&&g.lineTo(G+f((Se+1)*Ze/_e),W+f((Se+1)*bn/(_e-1)));g.lineTo(Ne,Ot)}else g.moveTo(G,W),g.lineTo(z,U),g.lineTo(Ne,Ot);g.clip(),g.transform(Ke[0],Ke[2],Ke[1],Ke[3],z,U),g.translate(_[0]-Dt,_[3]-Nt);let Ve;if(m)Ve=m.canvas,g.scale(n/t,-n/t);else{const _e=l[0],Ze=_e.extent;Ve=_e.image,g.scale(Pe(Ze)/Ve.width,-ct(Ze)/Ve.height)}g.drawImage(Ve,0,0),g.restore()}),m&&(Ss(m),En.push(m.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(p,T,y){const v=p.target,x=(v[0][0]-E[0])/s,R=-(v[0][1]-E[1])/s,w=(v[1][0]-E[0])/s,C=-(v[1][1]-E[1])/s,b=(v[2][0]-E[0])/s,O=-(v[2][1]-E[1])/s;g.beginPath(),g.moveTo(w,C),g.lineTo(x,R),g.lineTo(b,O),g.closePath(),g.stroke()}),g.restore()),g.canvas}class bl extends vu{constructor(e,t,n,r,s,o,a,l,h,c,u,d){super(s,A.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=f?At(g,f):g;if(Ps(m)===0){this.state=A.EMPTY;return}const E=e.getExtent();E&&(_?_=At(_,E):_=E);const p=r.getResolution(this.wrappedTileCoord_[0]),T=Om(e,n,m,p);if(!isFinite(T)||T<=0){this.state=A.EMPTY;return}const y=c!==void 0?c:Ru;if(this.triangulation_=new Iu(e,n,m,_,T*y,p),this.triangulation_.getTriangles().length===0){this.state=A.EMPTY;return}this.sourceZ_=t.getZForResolution(T);let v=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(v[1]=ke(v[1],_[1],_[3]),v[3]=ke(v[3],_[1],_[3])):v=At(v,_)),!Ps(v))this.state=A.EMPTY;else{const x=t.getTileRangeForExtentAndZ(v,this.sourceZ_);for(let R=x.minX;R<=x.maxX;R++)for(let w=x.minY;w<=x.maxY;w++){const C=h(this.sourceZ_,R,w,a);C&&this.sourceTiles_.push(C)}this.sourceTiles_.length===0&&(this.state=A.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==A.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=A.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Su(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=A.LOADED}this.changed()}load(){if(this.state==A.IDLE){this.state=A.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==A.IDLE||n==A.LOADING){e++;const r=re(t,k.CHANGE,function(s){const o=t.getState();(o==A.LOADED||o==A.ERROR||o==A.EMPTY)&&(xe(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,r){t.getState()==A.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ss(this.canvas_.getContext("2d")),En.push(this.canvas_),this.canvas_=null),super.release()}}function pe(i,e){if(!i)throw new Error(e)}class Dm{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return pe(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return pe(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){pe(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function Da(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function Il(i,e,t){return i+"/"+e+"/"+t}function Hn(i){return Il(i[0],i[1],i[2])}function px(i){return i.split("/").map(Number)}function Ex(i){return(i[1]<<i[0])+i[2]}function yx(i,e){const t=i[0],n=i[1],r=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(n,r):!0}class Nm extends Dm{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),t=px(e)[0];this.forEach(n=>{n.tileCoord[0]!==t&&(this.remove(Hn(n.tileCoord)),n.release())})}}const gh={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},As={PROPERTYCHANGE:"propertychange"};class to extends qs{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(k.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=re(this,e[s],t);return r}return re(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const r=e.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=ba(this,e[s],t)}else n=ba(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)Tx(n);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}to.prototype.on;to.prototype.once;to.prototype.un;function Tx(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)xe(i[e]);else xe(i)}class Ag extends Rn{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class xn extends to{constructor(e){super(),this.on,this.once,this.un,Qe(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new Ag(n,e,t)),n=As.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Ag(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const r=this.values_||(this.values_={});if(n)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],RR(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}class Fm extends xn{constructor(e){super(),this.projection=Wt(e.projection),this.attributions_=Mg(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,r){t.viewResolver=n,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Mg(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Mg(i){return i?Array.isArray(i)?function(e){return i}:typeof i=="function"?i:function(e){return[i]}:null}class Lu{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Wi(i,e,t,n,r){return r!==void 0?(r.minX=i,r.maxX=e,r.minY=t,r.maxY=n,r):new Lu(i,e,t,n)}const vx=42,Pu=256;function Rx(i,e,t,n,r){let s;for(e+=n;e<t;e+=n)if(s=r(i.slice(e-n,e),i.slice(e,e+n)),s)return s;return!1}function xx(i,e,t,n,r){return!Lm(r,function(s){return!xi(i,e,t,n,s[0],s[1])})}function xi(i,e,t,n,r,s){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Um(i,e,t,n,r,s){if(t.length===0||!xi(i,e,t[0],n,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(xi(i,t[o-1],t[o],n,r,s))return!1;return!0}function Gm(i,e,t,n,r){const s=Sm(Vr(),i,e,t,n);return Js(r,s)?Ia(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:Rx(i,e,t,n,function(o,a){return $R(r,o,a)}):!1}function jm(i,e,t,n,r){return!!(Gm(i,e,t,n,r)||xi(i,e,t,n,r[0],r[1])||xi(i,e,t,n,r[0],r[3])||xi(i,e,t,n,r[2],r[1])||xi(i,e,t,n,r[2],r[3]))}function wx(i,e,t,n,r){if(!jm(i,e,t[0],n,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(xx(i,t[s-1],t[s],n,r)&&!Gm(i,t[s-1],t[s],n,r))return!1;return!0}function Og(i){return i[0]>0&&i[1]>0}function Cx(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function $t(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}const Yi=[0,0,0],Ln=5;class km{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,pe(yR(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,pe(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Zr(n)),pe(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,pe(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Pu,pe(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,s)=>{const o=new Lu(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([t,s,a])}forEachTileCoordParentTileRange(e,t,n,r){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=Wi(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return Wi(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return Wi(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),h=Math.floor(s*l),c=Math.floor(o*l);if(t<r)return Wi(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return Wi(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Yi);const r=Yi[1],s=Yi[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Yi);const o=Yi[1],a=Yi[2];return Wi(r,o,s,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=$t(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=$t(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*s[0]*r,a=n[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return Qs(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=$t(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return r?(c=Jn(c,Ln)-1,u=Jn(u,Ln)-1):(c=Lo(c,Ln),u=Lo(u,Ln)),Da(o,c,u,s)}getTileCoordForXYAndZ_(e,t,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=$t(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return r?(h=Jn(h,Ln)-1,c=Jn(c,Ln)-1):(h=Lo(h,Ln),c=Lo(c,Ln)),Da(n,h,c,s)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=El(this.resolutions_,e,t||0);return ke(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return jm(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}}function Xm(i){let e=i.getDefaultTileGrid();return e||(e=Lx(i),i.setDefaultTileGrid(e)),e}function bx(i,e,t){const n=e[0],r=i.getTileCoordCenter(e),s=Au(t);if(!Ls(s,r)){const o=Pe(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return e}function Ix(i,e,t,n){n=n!==void 0?n:"top-left";const r=zm(i,e,t);return new km({extent:i,origin:XR(i,n),resolutions:r,tileSize:t})}function Sx(i){const e=i||{},t=e.extent||Wt("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:zm(t,e.maxZoom,e.tileSize,e.maxResolution)};return new km(n)}function zm(i,e,t,n){e=e!==void 0?e:vx,t=$t(t!==void 0?t:Pu);const r=ct(i),s=Pe(i);n=n>0?n:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function Lx(i,e,t,n){const r=Au(i);return Ix(r,e,t,n)}function Au(i){i=Wt(i);let e=i.getExtent();if(!e){const t=180*Nr.degrees/i.getMetersPerUnit();e=Qs(-t,-t,t,t)}return e}class Px extends Fm{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&$t(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Nm(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=Il(t,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===A.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,s){return be()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Xm(e)}getTileCacheForProjection(e){const t=this.getProjection();return pe(t===null||Zn(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=$t(r.getTileSize(e),this.tmpSize);return s==1?o:Cx(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=bx(n,e,t)),yx(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(e,t,n,r){}}class Ax extends Rn{constructor(e,t){super(e),this.tile=t}}function Mx(i,e){const t=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(t,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=e.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function Ox(i,e){const t=i.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=Mx(i[r],e);return Dx(n)}function Dx(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const r=Ex(e),s=Lr(r,i.length);return i[s](e,t,n)}}function Nx(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=n;s<=r;++s)e.push(i.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=n;r++)e.push(i.replace(t[0],r.toString()));return e}return e.push(i),e}class Mu extends Px{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Mu.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=Qe(t),r=t.getState();let s;r==A.LOADING?(this.tileLoadingKeys_[n]=!0,s=gh.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==A.ERROR?gh.TILELOADERROR:r==A.LOADED?gh.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Ax(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Nx(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Ox(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const r=Il(e,t,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class Fx extends Mu{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Ux,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:vl,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Zn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Zn(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Zn(t,e)))return this.tileGrid;const n=Qe(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Xm(e)),this.tileGridForProjection[n]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Zn(t,e))return this.tileCache;const n=Qe(e);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Nm(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(e,t,n,r,s,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?A.IDLE:A.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(k.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,r,s){const o=this.getProjection();if(!o||!s||Zn(o,s))return this.getTileInternal(e,t,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,n];let h;const c=Hn(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new bl(o,d,s,g,l,f,this.getTilePixelRatio(r),this.getGutter(),(m,E,p,T)=>this.getTileInternal(m,E,p,T,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(e,t,n,r,s){let o=null;const a=Il(e,t,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,n,r,s,l),h.getState()==A.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const n=Wt(e);if(n){const r=Qe(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function Ux(i,e){i.getImage().src=e}class Bm extends Fx{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:Sx({extent:Au(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}function gc(i){return Array.isArray(i)?Math.min(...i):i}class Gx extends Cm{constructor(e,t,n,r,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?At(n,h):n,u=Ai(c),d=dc(e,t,u,r),g=Ru,f=new Iu(e,t,c,l,d*g,r),_=f.calculateSourceExtent(),m=Gi(_)?null:o(_,d,s),E=m?Te.IDLE:Te.EMPTY,p=m?m.getPixelRatio():1;super(n,r,p,E),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Te.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==Te.LOADED){const t=Pe(this.targetExtent_)/this.targetResolution_,n=ct(this.targetExtent_)/this.targetResolution_;this.canvas_=Su(t,n,this.sourcePixelRatio_,gc(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==Te.IDLE){this.state=Te.LOADING,this.changed();const e=this.sourceImage_.getState();e==Te.LOADED||e==Te.ERROR?this.reproject_():(this.sourceListenerKey_=re(this.sourceImage_,k.CHANGE,function(t){const n=this.sourceImage_.getState();(n==Te.LOADED||n==Te.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){xe(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Po=4,fh={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class jx extends Rn{constructor(e,t){super(e),this.image=t}}class kx extends Fm{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const n=El(t,e,0);e=t[n]}return e}getImage(e,t,n,r){const s=this.getProjection();if(!s||!r||Zn(s,r))return s&&(r=s),this.getImageInternal(e,t,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Zn(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&lc(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Gx(s,r,e,t,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,r){if(this.loader){const s=Xx(e,t,n,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&Ia(this.wantedExtent_,s)||Ia(this.image.getExtent(),s))&&(this.wantedResolution_&&gc(this.wantedResolution_)===o||gc(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Cm(s,o,n,this.loader),this.image.addEventListener(k.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case Te.LOADING:this.loading=!0,n=fh.IMAGELOADSTART;break;case Te.LOADED:this.loading=!1,n=fh.IMAGELOADEND;break;case Te.ERROR:this.loading=!1,n=fh.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new jx(n,t))}}function Xx(i,e,t,n){const r=e/t,s=Ai(i),o=Jn(Pe(i)/r,Po),a=Jn(ct(i)/r,Po),l=Jn((n-1)*o/2,Po),h=o+2*l,c=Jn((n-1)*a/2,Po),u=a+2*c;return Sa(s,r,0,[h,u])}var zx=Object.defineProperty,Bx=(i,e,t)=>e in i?zx(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ri=(i,e,t)=>(Bx(i,typeof e!="symbol"?e+"":e,t),t);const fc=class _c extends Bm{constructor(e,t={}){super({tileUrlFunction:(n,r)=>`${$t(this.tileGrid.getTileSize(n[0]))[0]*(r||1)}`,tileLoadFunction:async(n,r)=>{const s=this.getrenderFunction();if(this.tileGrid&&s){console.assert(n instanceof vl);const o=n,a=parseInt(r),l=Math.round(a/256),h=on(a,a),c=await s(this.api,n.getTileCoord(),a,l,this.getextentBufferFactor());h.putImageData(c,0,0),t.debug&&(h.strokeStyle="grey",h.strokeRect(.5,.5,a+.5,a+.5),h.fillStyle="darkgrey",h.strokeStyle="black",h.textAlign="center",h.textBaseline="middle",h.font="20px sans-serif",h.lineWidth=2,h.strokeText(r,a/2,a/2,a),h.fillText(r,a/2,a/2,a)),o.setImage(h.canvas)}},...t}),ri(this,"api"),ri(this,"renderFunction"),ri(this,"extentBufferFactor"),this.api=e,this.renderFunction=t.renderFunction,this.extentBufferFactor=t.extentBufferFactor}getrenderFunction(){return this.renderFunction||_c.DEFAULT_RENDERFUNCTION}getextentBufferFactor(){return typeof this.extentBufferFactor=="function"?this.extentBufferFactor():this.extentBufferFactor||_c.DEFAULT_EXTENTBUFFERFACTOR}};ri(fc,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r)=>i.renderXYZTile(e[1],e[2],e[0],t,n,r)),ri(fc,"DEFAULT_EXTENTBUFFERFACTOR",0);let $x=fc;const $m=class Km extends kx{constructor(e,t={}){super({loader:(n,r,s)=>new Promise(async o=>{var a;const l=s||window?.devicePixelRatio||1,h=r/l,c=Math.round(Pe(n)/h),u=Math.round(ct(n)/h),d=await this.getrenderFunction()(this.api,((a=this.getProjection())==null?void 0:a.getCode())||"EPSG:3857",n[0],n[1],n[2],n[3],c,u,l);o(createImageBitmap(d))}),...t}),ri(this,"api"),ri(this,"renderFunction"),this.api=e,this.renderFunction=t.renderFunction}getrenderFunction(){return this.renderFunction||Km.DEFAULT_RENDERFUNCTION}};ri($m,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r,s,o,a,l)=>i.renderImage(e,new i.Rectangle(t,n,r,s),o,a,l));let Dg=$m;const Ct={ADD:"add",REMOVE:"remove"},Ng={LENGTH:"length"};class Ao extends Rn{constructor(e,t,n){super(e),this.element=t,this.index=n}}class _n extends xn{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Ng.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Ao(Ct.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Ao(Ct.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Ao(Ct.REMOVE,r,e)),this.dispatchEvent(new Ao(Ct.ADD,t,e))}updateLength_(){this.set(Ng.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const Ou=new Array(6);function en(){return[1,0,0,1,0,0]}function Kx(i){return Sl(i,1,0,0,1,0,0)}function Du(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],g=e[5];return i[0]=t*l+r*h,i[1]=n*l+s*h,i[2]=t*c+r*u,i[3]=n*c+s*u,i[4]=t*d+r*g+o,i[5]=n*d+s*g+a,i}function Sl(i,e,t,n,r,s,o){return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function Rt(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function Vx(i,e){const t=Math.cos(e),n=Math.sin(e);return Du(i,Sl(Ou,t,n,-n,t,0,0))}function Fg(i,e,t){return Du(i,Sl(Ou,e,0,0,t,0,0))}function Zx(i,e,t){return Du(i,Sl(Ou,1,0,0,1,e,t))}function Mi(i,e,t,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+e,i[5]=o*r*l+a*r*h+t,i}function Vm(i,e){const t=Hx(e);pe(t!==0,"Transformation matrix cannot be inverted");const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-r/t,i[2]=-s/t,i[3]=n/t,i[4]=(s*l-o*a)/t,i[5]=-(n*l-r*a)/t,i}function Hx(i){return i[0]*i[3]-i[1]*i[2]}let Ug;function Wx(i){const e="matrix("+i.join(", ")+")";if(xm)return e;const t=Ug||(Ug=document.createElement("div"));return t.style.transform=e,t.style.transform}const Na={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var at={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};at.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};at.max=at.whitepoint[2].D65;at.rgb=function(i,e){e=e||at.whitepoint[2].E;var t=i[0]/e[0],n=i[1]/e[1],r=i[2]/e[2],s,o,a;return s=t*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=t*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Na.xyz=function(i,e){var t=i[0]/255,n=i[1]/255,r=i[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.41239079926595+n*.35758433938387+r*.18048078840183,o=t*.21263900587151+n*.71516867876775+r*.072192315360733,a=t*.019330818715591+n*.11919477979462+r*.95053215224966;return e=e||at.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const Zm={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var m=.0011070564598794539;return e=e||"D65",t=t||2,u=at.whitepoint[t][e][0],d=at.whitepoint[t][e][1],g=at.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,r=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*m,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};at.luv=function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_,m=.008856451679035631,E=903.2962962962961;e=e||"D65",t=t||2,u=at.whitepoint[t][e][0],d=at.whitepoint[t][e][1],g=at.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/d;return s=p<=m?E*p:116*Math.pow(p,1/3)-16,o=13*s*(n-f),a=13*s*(r-_),[s,o,a]};Zm.lchuv=function(i){var e=i[0],t=i[1],n=i[2],r=Math.sqrt(t*t+n*n),s=Math.atan2(n,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,r,o]};at.lchuv=function(i){return Zm.lchuv(at.luv(i))};const Gg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var jg={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Yx(i){var e,t=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Gg[i])t=Gg[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",t=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),r="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=e[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=t.shift()),t=t.map(function(c,u){if(c[c.length-1]==="%")return c=parseFloat(c)/100,u===3?c:r==="rgb"?c*255:r[0]==="h"||r[0]==="l"&&!u?c*100:r==="lab"?c*125:r==="lch"?u<2?c*150:c*360:r[0]==="o"&&!u?c:r==="oklab"?c*.4:r==="oklch"?u<2?c*.4:c*360:c;if(r[u]==="h"||u===2&&r[r.length-1]==="h"){if(jg[c]!==void 0)return jg[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return parseFloat(c)*360;if(c.endsWith("grad"))return parseFloat(c)*360/400;if(c.endsWith("rad"))return parseFloat(c)*180/Math.PI}return c==="none"?0:parseFloat(c)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=i.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:t,alpha:n}}const _h={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+t):n+t-n*t,r=2*n-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};Na.hsl=function(i){var e=i[0]/255,t=i[1]/255,n=i[2]/255,r=Math.min(e,t,n),s=Math.max(e,t,n),o=s-r,a,l,h;return s===r?a=0:e===s?a=(t-n)/o:t===s?a=2+(n-e)/o:n===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function qx(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var e,t=Yx(i);if(!t.space)return[];const n=t.space[0]==="h"?_h.min:Na.min,r=t.space[0]==="h"?_h.max:Na.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),r[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),r[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),r[2]),t.space[0]==="h"&&(e=_h.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function Qx(i){return typeof i=="string"?i:tw(i)}const Jx=1024,as={};let mh=0;function Hm(i){if(as.hasOwnProperty(i))return as[i];if(mh>=Jx){let t=0;for(const n in as)t++&3||(delete as[n],--mh)}const e=qx(i);if(e.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+i+'" as color');return ew(e),as[i]=e,++mh,e}function Fa(i){return Array.isArray(i)?i:Hm(i)}function ew(i){return i[0]=ke(i[0]+.5|0,0,255),i[1]=ke(i[1]+.5|0,0,255),i[2]=ke(i[2]+.5|0,0,255),i[3]=ke(i[3],0,1),i}function tw(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+e+","+t+","+n+","+r+")"}function nw(i){try{return Hm(i),!0}catch{return!1}}class iw{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const r=kg(e,t,n);return r in this.cache_?this.cache_[r]:null}set(e,t,n,r){const s=kg(e,t,n);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function kg(i,e,t){const n=t?Qx(t):"null";return e+":"+i+":"+n}const Wm=new iw,ce={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Ym extends xn{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[ce.OPACITY]=e.opacity!==void 0?e.opacity:1,pe(typeof t[ce.OPACITY]=="number","Layer opacity must be a number"),t[ce.VISIBLE]=e.visible!==void 0?e.visible:!0,t[ce.Z_INDEX]=e.zIndex,t[ce.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[ce.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[ce.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[ce.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=ke(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return be()}getLayerStatesArray(e){return be()}getExtent(){return this.get(ce.EXTENT)}getMaxResolution(){return this.get(ce.MAX_RESOLUTION)}getMinResolution(){return this.get(ce.MIN_RESOLUTION)}getMinZoom(){return this.get(ce.MIN_ZOOM)}getMaxZoom(){return this.get(ce.MAX_ZOOM)}getOpacity(){return this.get(ce.OPACITY)}getSourceState(){return be()}getVisible(){return this.get(ce.VISIBLE)}getZIndex(){return this.get(ce.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(ce.EXTENT,e)}setMaxResolution(e){this.set(ce.MAX_RESOLUTION,e)}setMinResolution(e){this.set(ce.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(ce.MAX_ZOOM,e)}setMinZoom(e){this.set(ce.MIN_ZOOM,e)}setOpacity(e){pe(typeof e=="number","Layer opacity must be a number"),this.set(ce.OPACITY,e)}setVisible(e){this.set(ce.VISIBLE,e)}setZIndex(e){this.set(ce.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const yt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},mt={ANIMATING:0,INTERACTING:1},Ut={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Xg(i,e,t){return function(n,r,s,o,a){if(!n)return;if(!r&&!e)return n;const l=e?0:s[0]*r,h=e?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,_=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=ke(n[0],d,g),E=ke(n[1],f,_);if(o&&t&&r){const p=30*r;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,E]}}function rw(i){return i}function Nu(i,e,t,n){const r=Pe(e)/t[0],s=ct(e)/t[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function Fu(i,e,t){let n=Math.min(i,e);const r=50;return n*=Math.log(1+r*Math.max(0,i/e-1))/r+1,t&&(n=Math.max(n,t),n/=Math.log(1+r*Math.max(0,t/i-1))/r+1),ke(n,t/2,e*2)}function sw(i,e,t,n){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=t?Nu(l,t,o,n):l;if(a)return e?Fu(r,c,h):ke(r,h,c);const u=Math.min(c,r),d=Math.floor(El(i,u,s));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function ow(i,e,t,n,r,s){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=r?Nu(e,r,l,s):e;if(h)return n?Fu(o,c,t):ke(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(e/f)/Math.log(i)+g),m=Math.max(d,_),E=e/Math.pow(i,m);return ke(E,t,c)}}}function zg(i,e,t,n,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=n?Nu(i,n,a,r):i;return!t||!l?ke(s,e,h):Fu(s,h,e)}}}function Uu(i){if(i!==void 0)return 0}function Bg(i){if(i!==void 0)return i}function aw(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function lw(i){const e=ea(5);return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function hw(i,e,t,n,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function cw(i,e,t,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=e;d<t;d+=n){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function uw(i,e,t,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function dw(i,e,t,n,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const $g=en();class gw extends xn{constructor(){super(),this.extent_=Vr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=TR((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return be()}closestPointXY(e,t,n,r){return be()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return be()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Rl(t),this.extentRevision_=this.getRevision()}return BR(this.extent_,e)}rotate(e,t){be()}scale(e,t,n){be()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return be()}getType(){return be()}applyTransform(e){be()}intersectsExtent(e){return be()}translate(e,t){be()}transform(e,t){const n=Wt(e),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=ct(h)/ct(l);return Mi($g,h[0],h[3],c,-c,0,0,0),hw(s,0,s.length,a,$g,o),Oa(n,t)(s,o,a)}:Oa(n,t);return this.applyTransform(r),this}}class Gu extends gw{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return GR(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return be()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Kg(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){be()}setLayout(e,t,n){let r;if(e)r=Kg(e);else{for(let s=0;s<n;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=fw(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();cw(n,0,n.length,r,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=Ai(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();uw(r,0,r.length,s,e,t,n,r),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();dw(n,0,n.length,r,e,t,n),this.changed()}}}function fw(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function Kg(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function Vg(i,e,t,n,r,s,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let g=0;g<n;++g)o[g]=nx(i[e+g],i[t+g],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function qm(i,e,t,n,r){let s=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=Sr(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function _w(i,e,t,n,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=qm(i,e,a,n,r),e=a}return r}function Qm(i,e,t,n,r,s,o,a,l,h,c){if(e==t)return h;let u,d;if(r===0){if(d=Sr(o,a,i[e],i[e+1]),d<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=e+n;for(;g<t;)if(Vg(i,g-n,g,n,o,a,c),d=Sr(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(Vg(i,t-n,e,n,o,a,c),d=Sr(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function mw(i,e,t,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];h=Qm(i,e,g,n,r,s,o,a,l,h,c),e=g}return h}function pw(i,e,t,n){for(let r=0,s=t.length;r<s;++r)i[e++]=t[r];return e}function Jm(i,e,t,n){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function Ew(i,e,t,n,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Jm(i,e,t[o],n);r[s++]=l,e=l}return r.length=s,r}function yw(i,e,t,n,r,s,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)s[o++]=i[e],s[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],_=i[d+1],m=i[u],E=i[u+1];for(let p=d+n;p<u;p+=n){const T=i[p],y=i[p+1],v=ex(T,y,f,_,m,E);v>g&&(c=p,g=v)}g>r&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[e+u*n],s[o++]=i[e+u*n+1]);return o}function qi(i,e){return e*Math.round(i/e)}function Tw(i,e,t,n,r,s,o){if(e==t)return o;let a=qi(i[e],r),l=qi(i[e+1],r);e+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=qi(i[e],r),c=qi(i[e+1],r),e+=n,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=qi(i[e],r),d=qi(i[e+1],r);if(e+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,m=d-l;if(g*m==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function vw(i,e,t,n,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Tw(i,e,c,n,r,s,o),a.push(o),e=c}return o}function ep(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function Rw(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=ep(i,e,l,n,r[s]),e=l}return r.length=s,r}function tp(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function xw(i,e,t,n){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=tp(i,e,a,n),e=a}return r}class Ms extends Gu{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Ms(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,r){return r<bm(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(qm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qm(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,r))}getArea(){return tp(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ep(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=yw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Ms(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jm(this.flatCoordinates,0,e,this.stride),this.changed()}}class ju extends Gu{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new ju(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const s=this.flatCoordinates,o=Sr(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return UR(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Im(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=pw(this.flatCoordinates,0,e,this.stride),this.changed()}}function ww(i,e,t,n,r,s,o){let a,l,h,c,u,d,g;const f=r[s+1],_=[];for(let p=0,T=t.length;p<T;++p){const y=t[p];for(c=i[y-n],d=i[y-n+1],a=e;a<y;a+=n)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let m=NaN,E=-1/0;for(_.sort(Tu),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>E&&(h=(c+u)/2,Um(i,e,t,n,h,f)&&(m=h,E=p)),c=u}return isNaN(m)&&(m=r[s]),[m,f,E]}function Cw(i,e,t,n){for(;e<t-n;){for(let r=0;r<n;++r){const s=i[e+r];i[e+r]=i[t-n+r],i[t-n+r]=s}e+=n,t-=n}}function np(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function bw(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=np(i,e,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function Zg(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=np(i,e,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&Cw(i,e,a,n),e=a}return e}class Os extends Gu{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?ER(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Os(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<bm(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_w(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),mw(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,r))}containsXY(e,t){return Um(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return xw(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Zg(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Rw(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Ai(this.getExtent());this.flatInteriorPoint_=ww(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ju(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Ms(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Ms(t.slice(s,l),e);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;bw(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Zg(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=vw(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new Os(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return wx(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Ew(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Hg(i){if(Gi(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],r=i[3],s=[e,t,e,r,n,r,n,t,e,t];return new Os(s,"XY",[s.length])}const ph=0;class kt extends xn{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Cu(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&lx(),e.center&&(e.center=un(e.center,this.projection_)),e.extent&&(e.extent=ei(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Ut)delete t[a];this.setProperties(t,!0);const n=Sw(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const r=Iw(e),s=n.constraint,o=Lw(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=un(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=un(r.anchor,this.getProjection())),t[n]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===t){n&&Mo(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<t;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||wR,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Lr(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}Pw(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(mt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[mt.ANIMATING]>0}getInteracting(){return this.hints_[mt.INTERACTING]>0}cancelAnimations(){this.setHint(mt.ANIMATING,-this.hints_[mt.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const r=this.animations_[t];if(r[0].callback&&Mo(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[m,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Lr(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(mt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&Mo(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-t[0],r[1]-t[1]],xu(n,e-this.getRotation()),ix(n,t)),n}calculateCenterZoom(e,t){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],r=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&uc(e,this.getProjection())}getCenterInternal(){return this.get(Ut.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return gx(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();pe(t,"The view center is not defined");const n=this.getResolution();pe(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return pe(r!==void 0,"The view rotation is not defined"),Sa(t,n,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Ut.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ei(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Pe(e)/t[0],r=ct(e)/t[1];return Math.max(n,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(t/n)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(Ut.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/t;return function(o){return Math.log(n/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=Eh(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,n)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,r;if(this.resolutions_){const s=El(this.resolutions_,e,1);t=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(n/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=ke(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,ke(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(pe(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){pe(!Gi(e),"Cannot fit empty extent provided as `geometry`");const r=ei(e,this.getProjection());n=Hg(r)}else if(e.getType()==="Circle"){const r=ei(e.getExtent(),this.getProjection());n=Hg(r),n.rotate(this.getRotation(),Ai(r))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*r,f=s[u]*r+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Ai(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),m=t.callback?t.callback:wa;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),Mo(m,!0))}centerOn(e,t,n){this.centerOnInternal(un(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(Eh(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=Eh(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,n);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=uc(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&un(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,n);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=un(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&un(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Ut.ROTATION)!==r&&this.set(Ut.ROTATION,r),this.get(Ut.RESOLUTION)!==o&&(this.set(Ut.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ut.CENTER)||!Aa(this.get(Ut.CENTER),a))&&this.set(Ut.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Aa(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:Kr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(mt.INTERACTING,1)}endInteraction(e,t,n){n=n&&un(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(mt.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function Mo(i,e){setTimeout(function(){i(e)},0)}function Iw(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Xg(i.extent,i.constrainOnlyCenter,t)}const e=Cu(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Xg(t,!1,!1)}return rw}function Sw(i){let e,t,n,r=i.minZoom!==void 0?i.minZoom:ph,s=i.maxZoom!==void 0?i.maxZoom:28;const o=i.zoomFactor!==void 0?i.zoomFactor:2,a=i.multiWorld!==void 0?i.multiWorld:!1,l=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,h=i.showFullExtent!==void 0?i.showFullExtent:!1,c=Cu(i.projection,"EPSG:3857"),u=c.getExtent();let d=i.constrainOnlyCenter,g=i.extent;if(!a&&!g&&c.isGlobal()&&(d=!1,g=u),i.resolutions!==void 0){const f=i.resolutions;t=f[r],n=f[s]!==void 0?f[s]:f[f.length-1],i.constrainResolution?e=sw(f,l,!d&&g,h):e=zg(t,n,l,!d&&g,h)}else{const f=(u?Math.max(Pe(u),ct(u)):360*Nr.degrees/c.getMetersPerUnit())/Pu/Math.pow(2,ph),_=f/Math.pow(2,28-ph);t=i.maxResolution,t!==void 0?r=0:t=f/Math.pow(o,r),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(o,s):n=f/Math.pow(o,s):n=_),s=r+Math.floor(Math.log(t/n)/Math.log(o)),n=t/Math.pow(o,s-r),i.constrainResolution?e=ow(o,t,n,l,!d&&g,h):e=zg(t,n,l,!d&&g,h)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:r,zoomFactor:o}}function Lw(i){if(i.enableRotation===void 0||i.enableRotation){const e=i.constrainRotation;return e===void 0||e===!0?lw():e===!1?Bg:typeof e=="number"?aw(e):Bg}return Uu}function Pw(i){return!(i.sourceCenter&&i.targetCenter&&!Aa(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Eh(i,e,t,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class Aw extends Ym{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(ce.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(ce.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(xe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=re(e,k.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof kt?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return ku(r,t.viewState)&&(!s||Js(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const r=e instanceof kt?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(ce.MAP,e)}getMapInternal(){return this.get(ce.MAP)}setMap(e){this.mapPrecomposeKey_&&(xe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(xe(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=re(e,yt.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,r=this.getLayerState(!1);pe(!n.some(function(s){return s.layer===r.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),n.push(r)},this),this.mapRenderKey_=re(this,k.CHANGE,e.render,e),this.changed())}setSource(e){this.set(ce.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function ku(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}const Ll=Aw;class Mw extends pl{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){be()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Mi(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Vm(r,n)}forEachFeatureAtCoordinate(e,t,n,r,s,o,a,l){let h;const c=t.viewState;function u(y,v,x,R){return s.call(o,v,y?x:null,R)}const d=c.projection,g=sx(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const y=d.getExtent(),v=Pe(y);f.push([-v,0],[v,0])}const _=t.layerStatesArray,m=_.length,E=[],p=[];for(let y=0;y<f.length;y++)for(let v=m-1;v>=0;--v){const x=_[v],R=x.layer;if(R.hasRenderer()&&ku(x,c)&&a.call(l,R)){const w=R.getRenderer(),C=R.getSource();if(w&&C){const b=C.getWrapX()?g:e,O=u.bind(null,x.managed);p[0]=b[0]+f[y][0],p[1]=b[1]+f[y][1],h=w.forEachFeatureAtCoordinate(p,t,n,O,E)}if(h)return h}}if(E.length===0)return;const T=1/E.length;return E.forEach((y,v)=>y.distanceSq+=v*T),E.sort((y,v)=>y.distanceSq-v.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(e,t,n,r,s,o){return this.forEachFeatureAtCoordinate(e,t,n,r,xa,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){be()}flushDeclutterItems(e){}scheduleExpireIconCache(e){Wm.canExpireCache()&&e.postRenderFunctions.push(Ow)}}function Ow(i,e){Wm.expire()}class ys extends Rn{constructor(e,t,n,r){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=r}}const Oo="ol-hidden",Hr="ol-unselectable",Wg="ol-unsupported",Pl="ol-control",Yg="ol-collapsed",Dw=new xn;class Nw extends Mw{constructor(e){super(e),this.fontChangeListenerKey_=re(Dw,As.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Hr+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new ys(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){xe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(yt.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!ku(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(e),MR(this.element_,this.children_),this.dispatchRenderEvent(yt.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}class Bn extends Rn{constructor(e,t){super(e),this.layer=t}}const yh={LAYERS:"layers"};class Wr extends Ym{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(yh.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new _n(n.slice(),{unique:!0}):pe(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new _n(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(xe),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(re(e,Ct.ADD,this.handleLayersAdd_,this),re(e,Ct.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(xe);Ys(this.listenerKeys_);const t=e.getArray();for(let n=0,r=t.length;n<r;n++){const s=t[n];this.registerLayerListeners_(s),this.dispatchEvent(new Bn("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[re(e,As.PROPERTYCHANGE,this.handleLayerChange_,this),re(e,k.CHANGE,this.handleLayerChange_,this)];e instanceof Wr&&t.push(re(e,"addlayer",this.handleLayerGroupAdd_,this),re(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Qe(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Bn("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Bn("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Bn("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=Qe(t);this.listenerKeys_[n].forEach(xe),delete this.listenerKeys_[n],this.dispatchEvent(new Bn("removelayer",t)),this.changed()}getLayers(){return this.get(yh.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new Bn("removelayer",n[r]))}this.set(yh.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=At(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class gr extends Rn{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}class Un extends gr{constructor(e,t,n,r,s,o){super(e,t,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Oe={SINGLECLICK:"singleclick",CLICK:k.CLICK,DBLCLICK:k.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},mc={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class Fw extends qs{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=re(n,mc.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=re(n,mc.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(k.TOUCHMOVE,this.boundHandleTouchMove_,wm?{passive:!1}:!1)}emulateClick_(e){let t=new Un(Oe.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Un(Oe.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Un(Oe.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==Oe.POINTERUP||t.type==Oe.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Oe.POINTERDOWN||t.type==Oe.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Un(Oe.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(xe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Un(Oe.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(re(n,Oe.POINTERMOVE,this.handlePointerMove_,this),re(n,Oe.POINTERUP,this.handlePointerUp_,this),re(this.element_,Oe.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(re(this.element_.getRootNode(),Oe.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Un(Oe.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Un(Oe.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(xe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(k.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(xe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(xe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Gn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Be={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},pc=1/0;class Uw{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Ys(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){pe(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=pc?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,r=t.length,s=t[e],o=n[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<r&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=s,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,r=this.priorities_,s=n[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)n[t]=n[a],r[t]=r[a],t=a;else break}n[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==pc?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,t[r++]=o);t.length=r,n.length=r,this.heapify_()}}class Gw extends Uw{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(k.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===A.LOADED||n===A.ERROR||n===A.EMPTY){n!==A.ERROR&&t.removeEventListener(k.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,r,s,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===A.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function jw(i,e,t,n,r){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return pc;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class no extends xn{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){oc(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&oc(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)xe(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==wa&&this.listenerKeys.push(re(e,Gn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class kw extends no{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(k.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Hr+" "+Pl+(this.collapsed_&&this.collapsible_?" "+Yg:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!yl(t,this.renderedAttributions_)){AR(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Yg),this.collapsed_?Ca(this.collapseLabel_,this.label_):Ca(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Xw extends no{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(k.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Hr+" "+Pl,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Oo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();t!==void 0&&(this.duration_>0&&t%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Kr}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Oo);!s&&n===0?this.element.classList.add(Oo):s&&n!==0&&this.element.classList.remove(Oo)}this.label_.style.transform=r}this.rotation_=n}}class zw extends no{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(k.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(k.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+Hr+" "+Pl,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const n=t.getZoom();if(n!==void 0){const r=t.getConstrainedZoom(n+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:r,duration:this.duration_,easing:Kr})):t.setZoom(r)}}}function Xu(i){i=i||{};const e=new _n;return(i.zoom===void 0||i.zoom)&&e.push(new zw(i.zoomOptions)),(i.rotate===void 0||i.rotate)&&e.push(new Xw(i.rotateOptions)),(i.attribution===void 0||i.attribution)&&e.push(new kw(i.attributionOptions)),e}const qg={ACTIVE:"active"};class io extends xn{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(qg.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(qg.ACTIVE,e)}setMap(e){this.map_=e}}function Bw(i,e,t){const n=i.getCenterInternal();if(n){const r=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:CR,center:i.getConstrainedCenter(r)})}}function zu(i,e,t,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+e),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:Kr})}class $w extends io{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Oe.DBLCLICK){const n=e.originalEvent,r=e.map,s=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();zu(a,o,s,this.duration_),n.preventDefault(),t=!0}return!t}}class ro extends io{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Oe.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Oe.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==Oe.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Oe.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Bu(i){const e=i.length;let t=0,n=0;for(let r=0;r<e;r++)t+=i[r].clientX,n+=i[r].clientY;return{clientX:t/e,clientY:n/e}}function Ec(i){const e=arguments;return function(t){let n=!0;for(let r=0,s=e.length;r<s&&(n=n&&e[r](t),!!n);++r);return n}}const Kw=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Vw=function(i){const e=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return e.contains(t)},ip=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?Vw(i):!0},Zw=xa,rp=function(i){const e=i.originalEvent;return e.button==0&&!(LR&&vm&&e.ctrlKey)},sp=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Hw=function(i){const e=i.originalEvent;return vm?e.metaKey:e.ctrlKey},Ww=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},op=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Th=function(i){const e=i.originalEvent;return pe(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},Yw=function(i){const e=i.originalEvent;return pe(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class qw extends ro{constructor(e){super({stopDown:Tl}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Ec(sp,Yw);this.condition_=e.onFocusOnly?Ec(ip,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,r=t.getEventPixel(Bu(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=e.map.getView();rx(s,o.getResolution()),xu(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Kr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Qw extends ro{constructor(e){e=e||{},super({stopDown:Tl}),this.condition_=e.condition?e.condition:Kw,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Th(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===Uu)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Th(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Th(e)&&rp(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Jw extends pl{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+n,r.top=Math.min(e[1],t[1])+n,r.width=Math.abs(t[0]-e[0])+n,r.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Os([n])}getGeometry(){return this.geometry_}}const Do={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class vh extends Rn{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class eC extends ro{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Jw(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:rp,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new vh(Do.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new vh(t?Do.BOXEND:Do.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new vh(Do.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class tC extends eC{constructor(e){e=e||{};const t=e.condition?e.condition:Ww;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const t=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=t.rotatedExtentForGeometry(n),s=t.getResolutionForExtentInternal(r),o=t.getResolution()/s;n=n.clone(),n.scale(o*o)}t.fitInternal(n,{duration:this.duration_,easing:Kr})}}const gi={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class nC extends io{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return sp(t)&&op(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==k.KEYDOWN){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==gi.DOWN||r==gi.LEFT||r==gi.RIGHT||r==gi.UP)){const s=e.map.getView(),o=s.getResolution()*this.pixelDelta_;let a=0,l=0;r==gi.DOWN?l=-o:r==gi.LEFT?a=-o:r==gi.RIGHT?a=o:l=o;const h=[a,l];xu(h,s.getRotation()),Bw(s,h,this.duration_),n.preventDefault(),t=!0}}return!t}}class iC extends io{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!Hw(t)&&op(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==k.KEYDOWN||e.type==k.KEYPRESS){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();zu(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}class rC{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class sC extends io{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Zw;this.condition_=e.onFocusOnly?Ec(ip,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==k.WHEEL)return!0;const t=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==k.WHEEL&&(r=n.deltaY,bR&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Rm),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const s=Date.now();this.startTime_===void 0&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=t.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=r;const a=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-ke(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),zu(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class oC extends ro{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Tl),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==Uu&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Bu(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class aC extends ro{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Tl),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Bu(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function lC(i){i=i||{};const e=new _n,t=new rC(-.005,.05,100);return(i.altShiftDragRotate===void 0||i.altShiftDragRotate)&&e.push(new Qw),(i.doubleClickZoom===void 0||i.doubleClickZoom)&&e.push(new $w({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan===void 0||i.dragPan)&&e.push(new qw({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate===void 0||i.pinchRotate)&&e.push(new oC),(i.pinchZoom===void 0||i.pinchZoom)&&e.push(new aC({duration:i.zoomDuration})),(i.keyboard===void 0||i.keyboard)&&(e.push(new nC),e.push(new iC({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom===void 0||i.mouseWheelZoom)&&e.push(new sC({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom===void 0||i.shiftDragZoom)&&e.push(new tC({duration:i.zoomDuration})),e}function ap(i){if(i instanceof Ll){i.setMapInternal(null);return}i instanceof Wr&&i.getLayers().forEach(ap)}function lp(i,e){if(i instanceof Ll){i.setMapInternal(e);return}if(i instanceof Wr){const t=i.getLayers().getArray();for(let n=0,r=t.length;n<r;++n)lp(t[n],e)}}let hp=class extends xn{constructor(i){super(),i=i||{},this.on,this.once,this.un;const e=hC(i);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:Rm,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=en(),this.pixelToCoordinateTransform_=en(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||Xu(),this.interactions=e.interactions||lC({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new Gw(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Be.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Be.VIEW,this.handleViewChanged_),this.addChangeListener(Be.SIZE,this.handleSizeChanged_),this.addChangeListener(Be.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const t=this;i.view&&!(i.view instanceof kt)&&i.view.then(function(n){t.setView(new kt(n))}),this.controls.addEventListener(Ct.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(Ct.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(Ct.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(Ct.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(Ct.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(Ct.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){lp(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){const e=i.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,e,t){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(i);t=t!==void 0?t:{};const r=t.hitTolerance!==void 0?t.hitTolerance:0,s=t.layerFilter!==void 0?t.layerFilter:xa,o=t.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,o,e,null,s,null)}getFeaturesAtPixel(i,e){const t=[];return this.forEachFeatureAtPixel(i,function(n){t.push(n)},e),t}getAllLayers(){const i=[];function e(t){t.forEach(function(n){n instanceof Wr?e(n.getLayers()):i.push(n)})}return e(this.getLayers()),i}hasFeatureAtPixel(i,e){if(!this.frameState_||!this.renderer_)return!1;const t=this.getCoordinateFromPixelInternal(i);e=e!==void 0?e:{};const n=e.layerFilter!==void 0?e.layerFilter:xa,r=e.hitTolerance!==void 0?e.hitTolerance:0,s=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(t,this.frameState_,r,s,n,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){const e=this.viewport_.getBoundingClientRect(),t=this.getSize(),n=e.width/t[0],r=e.height/t[1],s="changedTouches"in i?i.changedTouches[0]:i;return[(s.clientX-e.left)/n,(s.clientY-e.top)/r]}getTarget(){return this.get(Be.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(i){return uc(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){const e=this.frameState_;return e?Rt(e.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){const e=this.overlayIdIndex_[i.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Be.LAYERGROUP)}setLayers(i){const e=this.getLayerGroup();if(i instanceof _n){e.setLayers(i);return}const t=e.getLayers();t.clear(),t.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const i=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=i.length;e<t;++e){const n=i[e];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const s=n.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(i){const e=un(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(i){const e=this.frameState_;return e?Rt(e.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Be.SIZE)}getView(){return this.get(Be.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,e,t,n){return jw(this.frameState_,i,e,t,n)}handleBrowserEvent(i,e){e=e||i.type;const t=new Un(e,this,i);this.handleMapBrowserEvent(t)}handleMapBrowserEvent(i){if(!this.frameState_)return;const e=i.originalEvent,t=e.type;if(t===mc.POINTERDOWN||t===k.WHEEL||t===k.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,s=e.target;if(this.overlayContainerStopEvent_.contains(s)||!(r===n?n.documentElement:r).contains(s))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const s=n[r];if(!(s.getMap()!==this||!s.getActive()||!this.getTargetElement())&&(!s.handleEvent(i)||i.propagationStopped))break}}}handlePostRender(){const i=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,r=n;if(i){const s=i.viewHints;if(s[mt.ANIMATING]||s[mt.INTERACTING]){const o=Date.now()-i.time>8;n=o?0:8,r=o?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,r))}i&&this.renderer_&&!i.animate&&(this.renderComplete_===!0?(this.hasListener(yt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(yt.RENDERCOMPLETE,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new gr(Gn.LOADEND,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new gr(Gn.LOADSTART,this,i))));const t=this.postRenderFunctions_;for(let n=0,r=t.length;n<r;++n)t[n](this,i);t.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,n=this.targetChangeHandlerKeys_.length;t<n;++t)xe(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(k.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(k.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,oc(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const t=this.targetElement_.getRootNode();t instanceof ShadowRoot&&this.resizeObserver_.unobserve(t.host),this.setSize(void 0)}const i=this.getTarget(),e=typeof i=="string"?document.getElementById(i):i;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Nw(this)),this.mapBrowserEventHandler_=new Fw(this,this.moveTolerance_);for(const r in Oe)this.mapBrowserEventHandler_.addEventListener(Oe[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(k.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(k.WHEEL,this.boundHandleBrowserEvent_,wm?{passive:!1}:!1);const t=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[re(t,k.KEYDOWN,this.handleBrowserEvent,this),re(t,k.KEYPRESS,this.handleBrowserEvent,this)];const n=e.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(xe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(xe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const i=this.getView();i&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=re(i,As.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=re(i,k.CHANGE,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(xe),this.layerGroupPropertyListenerKeys_=null);const i=this.getLayerGroup();i&&(this.handleLayerAdd_(new Bn("addlayer",i)),this.layerGroupPropertyListenerKeys_=[re(i,As.PROPERTYCHANGE,this.render,this),re(i,k.CHANGE,this.render,this),re(i,"addlayer",this.handleLayerAdd_,this),re(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const i=this.getLayerGroup().getLayerStatesArray();for(let e=0,t=i.length;e<t;++e){const n=i[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const i=this.frameState_;i&&this.renderer_.flushDeclutterItems(i)}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){ap(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){const e=this.getSize(),t=this.getView(),n=this.frameState_;let r=null;if(e!==void 0&&Og(e)&&t&&t.isDef()){const s=t.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=t.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Sa(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:o,viewHints:s,wantedTiles:{},mapId:Qe(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const a=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=Sa(o.nextCenter,o.nextResolution,a,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!Gi(this.previousExtent_)&&!lc(r.extent,this.previousExtent_))&&(this.dispatchEvent(new gr(Gn.MOVESTART,this,n)),this.previousExtent_=Rl(this.previousExtent_)),this.previousExtent_&&!r.viewHints[mt.ANIMATING]&&!r.viewHints[mt.INTERACTING]&&!lc(r.extent,this.previousExtent_)&&(this.dispatchEvent(new gr(Gn.MOVEEND,this,r)),FR(r.extent,this.previousExtent_))),this.dispatchEvent(new gr(Gn.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(Gn.LOADSTART)||this.hasListener(Gn.LOADEND)||this.hasListener(yt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Bn("removelayer",e)),this.set(Be.LAYERGROUP,i)}setSize(i){this.set(Be.SIZE,i)}setTarget(i){this.set(Be.TARGET,i)}setView(i){if(!i||i instanceof kt){this.set(Be.VIEW,i);return}this.set(Be.VIEW,new kt);const e=this;i.then(function(t){e.setView(new kt(t))})}updateSize(){const i=this.getTargetElement();let e;if(i){const n=getComputedStyle(i),r=i.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=i.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(s)&&(e=[r,s],!Og(e)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&Am("No map visible because the map container's width or height are 0."))}const t=this.getSize();e&&(!t||!yl(e,t))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(i){const e=this.getView();e&&e.setViewportSize(i)}};function hC(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Wr({layers:i.layers});t[Be.LAYERGROUP]=n,t[Be.TARGET]=i.target,t[Be.VIEW]=i.view instanceof kt?i.view:new kt;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new _n(i.controls.slice()):(pe(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new _n(i.interactions.slice()):(pe(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new _n(i.overlays.slice()):(pe(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new _n,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const No={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class cC extends Ll{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(No.PRELOAD)}setPreload(e){this.set(No.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(No.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(No.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}function Ua(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function yc(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let Qi=null;function uC(i){Qi||(Qi=on(i.width,i.height,void 0,{willReadFrequently:!0}));const e=Qi.canvas,t=i.width;e.width!==t&&(e.width=t);const n=i.height;return e.height!==n&&(e.height=n),Qi.clearRect(0,0,t,n),Qi.drawImage(i,0,0),Qi.getImageData(0,0,t,n).data}const dC=[256,256];class cp extends vu{constructor(e){const t=A.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=Ua(this.data_);return e?[e.width,e.height]:dC}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==A.IDLE&&this.state!==A.ERROR)return;this.state=A.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=A.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=A.ERROR,e.changed()})}}class up extends cp{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=n?At(t,n):t;if(Ps(s)===0){this.state=A.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(r?r=At(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=Om(o,h,s,l);if(!isFinite(c)||c<=0){this.state=A.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:Ru;if(this.triangulation_=new Iu(o,h,s,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=A.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=ke(d[1],r[1],r[3]),d[3]=ke(d[3],r[1],r[3])):d=At(d,r)),!Ps(d))this.state=A.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=e.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let m=g.minY;m<=g.maxY;m++){const E=f(this.sourceZ_,_,m,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=A.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==A.LOADED)return;const n=t.getSize(),r=this.gutter_;let s;const o=yc(t.getData());o?s=o:s=uC(Ua(t.getData()));const a=[n[0]+2*r,n[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),m=h*_;let E=u;if(u.length!==m){E=new c(m);let p=0,T=0;const y=a[0]*_;for(let v=0;v<a[1];++v){for(let x=0;x<y;++x)E[p++]=u[T+x];T+=f/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=A.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,v=e.length;y<v;++y){const x=e[y],R=x.data,w=x.pixelSize,C=w[0],b=w[1],O=on(C,b,En),J=O.createImageData(C,b),z=J.data;let U=g*3;for(let G=0,W=z.length;G<W;G+=4)z[G]=R[U],z[G+1]=R[U+1],z[G+2]=R[U+2],z[G+3]=255,U+=u;O.putImageData(J,0,0),f.push({extent:x.extent,image:O.canvas})}const _=Su(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,v=f.length;y<v;++y){const x=f[y].image.getContext("2d");Ss(x),En.push(x.canvas)}const m=_.getContext("2d"),E=m.getImageData(0,0,_.width,_.height);Ss(m),En.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new e[0].dataType(c.buffer));const p=E.data;let T=g*3;for(let y=0,v=p.length;y<v;y+=4)p[y+3]===255?(c[T]=p[y],c[T+1]=p[y+1],c[T+2]=p[y+2]):(c[T]=0,c[T+1]=0,c[T+2]=0),T+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=A.LOADED}this.changed()}load(){if(this.state!==A.IDLE&&this.state!==A.ERROR)return;this.state=A.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==A.IDLE&&n!==A.LOADING)return;e++;const r=re(t,k.CHANGE,function(){const s=t.getState();(s==A.LOADED||s==A.ERROR||s==A.EMPTY)&&(xe(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==A.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(xe),this.sourcesListenerKeys_=null}}class gC extends qs{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(k.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===A.LOADED,this.loaded)this.uploadTile();else{if(e instanceof vl){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(k.CHANGE,this.handleTileChange_)}}uploadTile(){be()}setReady(){this.ready=!0,this.dispatchEvent(k.CHANGE)}handleTileChange_(){this.tile.getState()===A.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(k.CHANGE,this.handleTileChange_)}}const $u=34962,Ku=34963,fC=35040,Vu=35044,_C=35048,mC=5121,pC=5123,EC=5125,dp=5126,Qg=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function yC(i,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!SR},e);const t=Qg.length;for(let n=0;n<t;++n)try{const r=i.getContext(Qg[n],e);if(r)return r}catch{}return null}const TC={STATIC_DRAW:Vu,STREAM_DRAW:fC,DYNAMIC_DRAW:_C};class gp{constructor(e,t){this.array_=null,this.type_=e,pe(e===$u||e===Ku,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:TC.STATIC_DRAW}ofSize(e){return this.array_=new(Rh(this.type_))(e),this}fromArray(e){return this.array_=Rh(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Rh(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Rh(i){switch(i){case $u:return Float32Array;case Ku:return Uint32Array;default:return Float32Array}}function fp(i,e,t){const n=t?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function vC(i,e,t,n){fp(i,e,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}function Jg(i,e,t,n,r,s){const o=i.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),fp(o,e,s&&l);const h=t.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let fr=null;function RC(){fr=on(1,1,void 0,{willReadFrequently:!0})}class xC extends gC{constructor(e){super(e),this.textures=[],this.renderSize_=$t(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new gp($u,Vu);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let r;n instanceof vl||n instanceof bl?r=n.getImage():r=n.getData();const s=Ua(r);if(s){const p=t.createTexture();this.textures.push(p),this.bandCount=4,vC(t,p,s,n.interpolate),this.setReady();return}r=yc(r);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const p=t.createTexture();this.textures.push(p),Jg(e,p,r,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let p=0;p<g;++p){const T=t.createTexture();this.textures.push(T);const y=p<g-1?4:(this.bandCount-1)%4+1;f[p]=new c(h*y)}let _=0,m=0;const E=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let T=0;T<E;++T){const y=r[m+T],v=Math.floor(_/this.bandCount),x=T%this.bandCount,R=Math.floor(x/4),w=f[R],C=w.length/h,b=x%4;w[v*C+b]=y,++_}m+=d/u}for(let p=0;p<g;++p){const T=this.textures[p],y=f[p],v=y.length/h;Jg(e,T,y,a,v,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(k.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];fr||RC(),fr.clearRect(0,0,1,1);const a=e.width,l=e.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(t/s)),d=r+Math.floor(c*(n/o));let g;try{fr.drawImage(e,u,d,1,1,0,0,1,1),g=fr.getImageData(0,0,1,1).data}catch{return fr=null,null}return g}getArrayPixelData_(e,t,n,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],h=t[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(r/a));if(e instanceof DataView){const _=e.byteLength/(c*u),m=_*(g*c+d),E=e.buffer.slice(m,m+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return e.slice(f,f+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof cp){const n=this.tile.getData(),r=yc(n);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,e,t)}return this.getImagePixelData_(Ua(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class _p extends to{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return be()}getData(e){return null}prepareFrame(e){return be()}renderFrame(e,t){return be()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return e.forEachLoadedTile(t,r,s,o)}}forEachFeatureAtCoordinate(e,t,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===Te.LOADED||t.getState()===Te.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Te.LOADED&&t!=Te.ERROR&&e.addEventListener(k.CHANGE,this.boundHandleImageChange_),t==Te.IDLE&&(e.load(),t=e.getState()),t==Te.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Fo={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},wC=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,CC=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class ef{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||wC),t.compileShader(n);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fragmentShader||CC),t.compileShader(r),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,r),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const r=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,r,s,n[0],n[1],o,a,l,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,r){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Qe(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,r=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,r++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}function mp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pp(i,e){return i[0]=e[0],i[1]=e[1],i[4]=e[2],i[5]=e[3],i[12]=e[4],i[13]=e[5],i}const Pn={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},fs={UNSIGNED_BYTE:mC,UNSIGNED_SHORT:pC,UNSIGNED_INT:EC,FLOAT:dp},Ga={};function tf(i){return"shared/"+i}let nf=0;function bC(){const i="unique/"+nf;return nf+=1,i}function IC(i){let e=Ga[i];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:yC(t)},Ga[i]=e}return e.users+=1,e.context}function SC(i){const e=Ga[i];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const r=t.canvas;r.width=1,r.height=1,delete Ga[i]}class LC extends pl{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?tf(e.canvasCacheKey):bC(),this.gl_=IC(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Fo.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Fo.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=en(),this.offsetScaleMatrix_=en(),this.tmpMat4_=mp(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new ef({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new ef({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===tf(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Qe(e);let r=this.bufferCache_[n];if(!r){const s=t.createBuffer();r={buffer:e,webGlBuffer:s},this.bufferCache_[n]=r}t.bindBuffer(e.getType(),r.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=Qe(e),r=this.bufferCache_[n];r&&!t.isContextLost()&&t.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Fo.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Fo.RESTORED,this.boundHandleWebGLContextRestored_),SC(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const r=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(e,t,n){const r=this.gl_;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,r){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const r=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,r,a)}finalizeDraw(e,t,n){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(e,null,t,n):this.postProcessPasses_[r].apply(e,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,r=e.pixelRatio;this.setUniformFloatValue(Pn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Pn.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Pn.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Pn.PIXEL_RATIO,r),this.setUniformFloatVec2(Pn.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(Pn.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(Pn.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(Pn.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,r=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,r,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),r++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,pp(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r}getProgram(e,t){const n=this.gl_,r=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Qe(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Qe(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,r=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Mi(t,0,0,2/(s*n[0]),2/(s*n[1]),-r,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,r,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,r,s))}enableAttributes(e){const t=PC(e);let n=0;for(let r=0;r<e.length;r++){const s=e[r];this.enableAttributeArray_(s.name,s.size,s.type||dp,t,n),n+=s.size*Ep(s.type)}}handleWebGLContextLost(e){Ys(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const r=this.gl_;n=n||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,n),t?r.texImage2D(r.TEXTURE_2D,s,o,l,h,t):r.texImage2D(r.TEXTURE_2D,s,o,e[0],e[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n}}function PC(i){let e=0;for(let t=0;t<i.length;t++){const n=i[t];e+=n.size*Ep(n.type)}return e}function Ep(i){switch(i){case fs.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case fs.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case fs.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case fs.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class Zu extends _p{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=en(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(ce.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(yt.PRECOMPOSE)){const r=new ys(yt.PRECOMPOSE,void 0,t,e);n.dispatchEvent(r)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(yt.POSTCOMPOSE)){const r=new ys(yt.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(r)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,r;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof Zu)){t=!0;continue}const c=l.getClassName();if((t||c!==r)&&(n+=1,t=!1),r=c,h===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new LC({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){Mi(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new ys(e,this.inversePixelTransform_,n,t);r.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(yt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(yt.POSTRENDER,e,t)}}const AC={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},MC={};function rf(i){return 1/(i+2)}function OC(){return{tileIds:new Set,representationsByZ:{}}}function sf(i,e){return i.tileIds.has(Qe(e))}function of(i,e,t){const n=i.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),i.tileIds.add(Qe(e.tile))}function xh(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=At(e,ei(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(e=At(e,r))}return e}function Tc(i,e){return`${i.getKey()},${Hn(e)}`}class DC extends Zu{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=en(),this.tempMat4=mp(),this.tempTileRange_=new Lu(0,0,0,0),this.tempTileCoord_=Da(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Dm(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),r=t.getUseInterimTilesOnError();return n==A.LOADED||n==A.EMPTY||n==A.ERROR&&!r}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const t=this.getLayer().getRenderSource();return!t||Gi(xh(e,e.extent))?!1:t.getState()==="ready"}createTileRepresentation(e){return be()}enqueueTiles(e,t,n,r,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=Qe(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=n;m>=_;--m){const E=h.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),p=h.getResolution(m);for(let T=E.minX;T<=E.maxX;++T)for(let y=E.minY;y<=E.maxY;++y){const v=Da(m,T,y,this.tempTileCoord_),x=Tc(l,v);let R,w;if(g.containsKey(x)&&(R=g.get(x),w=R.tile),(!R||R.tile.key!==l.getKey())&&(w=l.getTile(m,T,y,e.pixelRatio,o.projection)),sf(r,w))continue;if(!R)R=this.createTileRepresentation({tile:w,grid:h,helper:this.helper,gutter:c}),g.set(x,R);else if(this.isDrawableTile_(w))R.setTile(w);else{const b=w.getInterimTile();R.setTile(b)}of(r,R,m);const C=w.getKey();d[C]=!0,w.getState()===A.IDLE&&(e.tileQueue.isKeyQueued(C)||e.tileQueue.enqueue([w,u,h.getTileCoordCenter(v),p]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,r,s,o,a,l,h,c,u){}renderTileMask(e,t,n,r){}drawTile_(e,t,n,r,s,o,a){if(!t.ready)return;const l=t.tile.tileCoord,h=Hn(l),c=h in o?o[h]:1,u=a.getResolution(n),d=$t(a.getTileSize(n),this.tempSize_),g=a.getOrigin(n),f=a.getTileCoordExtent(l),_=c<1?-1:rf(n);c<1&&(e.animate=!0);const m=e.viewState,E=m.center[0],p=m.center[1],T=d[0]+2*r,y=d[1]+2*r,v=T/y,x=(E-g[0])/(d[0]*u),R=(g[1]-p)/(d[1]*u),w=m.resolution/u,C=l[1],b=l[2];Kx(this.tileTransform_),Fg(this.tileTransform_,2/(e.size[0]*w/T),-2/(e.size[1]*w/T)),Vx(this.tileTransform_,m.rotation),Fg(this.tileTransform_,1,1/v),Zx(this.tileTransform_,(d[0]*(C-x)-r)/T,(d[1]*(b-R)-r)/y),this.renderTile(t,this.tileTransform_,e,s,u,d,g,f,_,r,c)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=xh(e,e.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=OC(),u=r.getPreload();if(e.nextExtent){const v=o.getZForResolution(n.nextResolution,s.zDirection),x=xh(e,e.nextExtent);this.enqueueTiles(e,x,v,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},g=Qe(this),f=e.time;let _=!1;for(const v of c.representationsByZ[h]){const x=v.tile;if((x instanceof bl||x instanceof up)&&x.getState()===A.EMPTY)continue;const R=x.tileCoord;if(v.ready){const C=x.getAlpha(g,f);if(C===1){x.endTransition(g);continue}_=!0;const b=Hn(R);d[b]=C}if(this.renderComplete=!1,this.findAltTiles_(o,R,h+1,c))continue;const w=o.getMinZoom();for(let C=h-1;C>=w&&!this.findAltTiles_(o,R,C,c);--C);}const m=c.representationsByZ,E=Object.keys(m).map(Number).sort(pR);if(this.beforeTilesMaskRender(e))for(let v=0,x=E.length;v<x;++v){const R=E[v];for(const w of m[R]){const C=w.tile.tileCoord;if(Hn(C)in d)continue;const b=o.getTileCoordExtent(C);this.renderTileMask(w,R,b,rf(R))}}this.beforeTilesRender(e,_);for(let v=0,x=E.length;v<x;++v){const R=E[v];for(const w of m[R]){const C=w.tile.tileCoord;Hn(C)in d||this.drawTile_(e,w,R,a,l,d,o)}}for(const v of m[h]){const x=v.tile.tileCoord;Hn(x)in d&&this.drawTile_(e,v,h,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const p=this.helper.getCanvas(),T=this.tileRepresentationCache;for(;T.canExpireCache();)T.pop().dispose();const y=function(v,x){s.updateCacheSize(.1,x.viewState.projection),s.expireCache(x.viewState.projection,MC)};return e.postRenderFunctions.push(y),this.postRender(t,e),p}findAltTiles_(e,t,n,r){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=Tc(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!sf(r,g.tile)&&(of(r,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const Z={...AC,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},ta={TEXTURE_COORD:"a_textureCoord"},NC=[{name:ta.TEXTURE_COORD,size:2,type:fs.FLOAT}];class FC extends DC{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new gp(Ku,Vu),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new xC(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,r,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(NC);let g=0;for(;g<e.textures.length;){const v=`${Z.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,v),++g}for(let v=0;v<this.paletteTextures_.length;++v){const x=this.paletteTextures_[v],R=x.getTexture(d);this.helper.bindTexture(R,g,x.name),++g}const f=n.viewState,_=o[0]+2*c,m=o[1]+2*c,E=e.tile.tileCoord,p=E[1],T=E[2];this.helper.setUniformMatrixValue(Z.TILE_TRANSFORM,pp(this.tempMat4,t)),this.helper.setUniformFloatValue(Z.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(Z.DEPTH,h);let y=r;c>0&&(y=l,At(y,r,y)),this.helper.setUniformFloatVec4(Z.RENDER_EXTENT,y),this.helper.setUniformFloatValue(Z.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(Z.ZOOM,f.zoom),this.helper.setUniformFloatValue(Z.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(Z.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(Z.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(Z.TEXTURE_ORIGIN_X,a[0]+p*o[0]*s-c*s),this.helper.setUniformFloatValue(Z.TEXTURE_ORIGIN_Y,a[1]-T*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=Rt(t.pixelToCoordinateTransform,e.slice()),s=t.viewState,o=n.getExtent();if(o&&!Ls(ei(o,s.projection),r))return null;const a=n.getSources(ac([r]),s.resolution);let l,h,c;for(l=a.length-1;l>=0;--l)if(h=a[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(s.projection),h.getWrapX())break;const d=c.getExtent();if(!d||Ls(d,r))break}if(l<0)return null;const u=this.tileRepresentationCache;for(let d=c.getZForResolution(s.resolution);d>=c.getMinZoom();--d){const g=c.getTileCoordForCoordAndZ(r,d),f=Tc(h,g);if(!u.containsKey(f))continue;const _=u.get(f),m=_.tile;if((m instanceof bl||m instanceof up)&&m.getState()===A.EMPTY)return null;if(!_.loaded)continue;const E=c.getOrigin(d),p=$t(c.getTileSize(d)),T=c.getResolution(d),y=(r[0]-E[0])/T-g[1]*p[0],v=(E[1]-r[1])/T-g[2]*p[1];return _.getPixelData(y,v)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}let Yr=0;const ji=0,Ue=1<<Yr++,N=1<<Yr++,Kt=1<<Yr++,rt=1<<Yr++,Fr=1<<Yr++,gt=Math.pow(2,Yr)-1,yp={[Ue]:"boolean",[N]:"number",[Kt]:"string",[rt]:"color",[Fr]:"number[]"},UC=Object.keys(yp).map(Number).sort(Tu);function tt(i){const e=[];for(const t of UC)GC(i,t)&&e.push(yp[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function GC(i,e){return(i&e)===e}function tn(i,e){return!!(i&e)}function so(i,e){return i===e}class wi{constructor(e,t){this.type=e,this.value=t}}class Tp{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function jC(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function kC(i){switch(i){case"string":return Kt;case"color":return rt;case"number":return N;case"boolean":return Ue;case"number[]":return Fr;default:throw new Error(`Unrecognized type hint: ${i}`)}}function ge(i,e,t){switch(typeof i){case"boolean":return new wi(Ue,i);case"number":return new wi(N,i);case"string":{let r=Kt;return nw(i)&&(r|=rt),so(r&t,ji)||(r&=t),new wi(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return qC(i,e,t);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=Fr;return(i.length===3||i.length===4)&&(n|=rt),t&&(n&=t),new wi(n,i)}const S={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},XC={[S.Get]:$(([i,e])=>e!==void 0?kC(e.value):gt,q(1,2),zC),[S.Var]:$(([i])=>i.type,q(1,1),BC),[S.Id]:$(N|Kt,ls,$C),[S.Concat]:$(Kt,q(2,1/0),ae(gt)),[S.GeometryType]:$(Kt,ls),[S.Resolution]:$(N,ls),[S.Zoom]:$(N,ls),[S.Time]:$(N,ls),[S.Any]:$(Ue,q(2,1/0),ae(Ue)),[S.All]:$(Ue,q(2,1/0),ae(Ue)),[S.Not]:$(Ue,q(1,1),ae(Ue)),[S.Equal]:$(Ue,q(2,2),ae(gt),fi),[S.NotEqual]:$(Ue,q(2,2),ae(gt),fi),[S.GreaterThan]:$(Ue,q(2,2),ae(gt),fi),[S.GreaterThanOrEqualTo]:$(Ue,q(2,2),ae(gt),fi),[S.LessThan]:$(Ue,q(2,2),ae(gt),fi),[S.LessThanOrEqualTo]:$(Ue,q(2,2),ae(gt),fi),[S.Multiply]:$(i=>{let e=N|rt;for(let t=0;t<i.length;t++)e&=i[t].type;return e},q(2,1/0),ae(N|rt),fi),[S.Divide]:$(N,q(2,2),ae(N)),[S.Add]:$(N,q(2,1/0),ae(N)),[S.Subtract]:$(N,q(2,2),ae(N)),[S.Clamp]:$(N,q(3,3),ae(N)),[S.Mod]:$(N,q(2,2),ae(N)),[S.Pow]:$(N,q(2,2),ae(N)),[S.Abs]:$(N,q(1,1),ae(N)),[S.Floor]:$(N,q(1,1),ae(N)),[S.Ceil]:$(N,q(1,1),ae(N)),[S.Round]:$(N,q(1,1),ae(N)),[S.Sin]:$(N,q(1,1),ae(N)),[S.Cos]:$(N,q(1,1),ae(N)),[S.Atan]:$(N,q(1,2),ae(N)),[S.Sqrt]:$(N,q(1,1),ae(N)),[S.Match]:$(i=>{let e=gt;for(let t=2;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},q(4,1/0),af,VC),[S.Between]:$(Ue,q(3,3),ae(N)),[S.Interpolate]:$(i=>{let e=rt|N;for(let t=3;t<i.length;t+=2)e&=i[t].type;return e},q(6,1/0),af,ZC),[S.Case]:$(i=>{let e=gt;for(let t=1;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},q(3,1/0),KC,HC),[S.In]:$(Ue,q(2,2),WC),[S.Number]:$(N,q(1,1/0),ae(gt)),[S.String]:$(Kt,q(1,1/0),ae(gt)),[S.Array]:$(i=>i.length===3||i.length===4?Fr|rt:Fr,q(1,1/0),ae(N)),[S.Color]:$(rt,q(3,4),ae(N)),[S.Band]:$(N,q(1,3),ae(N)),[S.Palette]:$(rt,q(2,2),YC)};function zC(i,e){const t=ge(i[1],e);if(!(t instanceof wi))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),i.length===3){const n=ge(i[2],e);return[t,n]}return[t]}function BC(i,e,t,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(r),!("variables"in e.style)||e.style.variables[r]===void 0)return[new wi(gt,r)];const s=e.style.variables[r],o=ge(s,e);if(o.value=r,n&&!tn(n,o.type))throw new Error(`The variable ${r} has type ${tt(o.type)} but the following type was expected: ${tt(n)}`);return[o]}function $C(i,e){e.featureId=!0}function ls(i,e){const t=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function q(i,e){return function(t,n){const r=t[0],s=t.length-1;if(i===e){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>e){const o=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function ae(i){return function(e,t){const n=e[0],r=e.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=ge(e[o+1],t);if(!tn(i,a.type)){const l=tt(i),h=tt(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function fi(i,e,t){const n=i[0],r=i.length-1;let s=gt;for(let a=0;a<t.length;++a)s&=t[a].type;if(s===ji)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=ge(i[a+1],e,s);return o}function KC(i,e){const t=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function af(i,e){const t=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function VC(i,e,t,n){const r=i.length-1;let s=ge(i[1],e).type;const o=ge(i[i.length-1],e);let a=n!==void 0?n&o.type:o.type;const l=new Array(r-2);for(let c=0;c<r-2;c+=2){const u=ge(i[c+2],e),d=ge(i[c+3],e);s&=u.type,a&=d.type,l[c]=u,l[c+1]=d}const h=Kt|N|Ue;if(!tn(h,s))throw new Error(`Expected an input of type ${tt(h)} for the interpolate operation, got ${tt(s)} instead`);if(so(a,ji))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let c=0;c<r-2;c+=2){const u=ge(i[c+2],e,s),d=ge(i[c+3],e,a);l[c]=u,l[c+1]=d}return[ge(i[1],e,s),...l,ge(i[i.length-1],e,a)]}function ZC(i,e,t,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=ge(s,e);let o=ge(i[2],e);if(!tn(N,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${tt(o.type)} instead`);o=ge(i[2],e,N);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=ge(i[l+3],e);if(!tn(N,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${tt(h.type)} at position ${l+2} instead`);let c=ge(i[l+4],e);if(!tn(N|rt,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${tt(c.type)} at position ${l+3} instead`);h=ge(i[l+3],e,N),c=ge(i[l+4],e,N|rt),a[l]=h,a[l+1]=c}return[s,o,...a]}function HC(i,e,t,n){const r=ge(i[i.length-1],e);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=ge(i[a+1],e),h=ge(i[a+2],e);if(!tn(Ue,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${tt(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(so(s,ji))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=ge(i[a+2],e,s);return o[o.length-1]=ge(i[i.length-1],e,s),o}function WC(i,e){let t=i[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let n=Kt|N;const r=new Array(t.length);for(let s=0;s<r.length;s++){const o=ge(t[s],e);n&=o.type,r[s]=o}if(so(n,ji))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[ge(i[1],e,n),...r]}function YC(i,e){const t=ge(i[1],e,N);if(t.type!==N)throw new Error(`The first argument of palette must be an number, got ${tt(t.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=ge(n[s],e,rt);if(!(o instanceof wi))throw new Error(`The palette color at index ${s} must be a literal value`);if(!tn(o.type,rt))throw new Error(`The palette color at index ${s} should be of type color, got ${tt(o.type)} instead`);r[s]=o}return[t,...r]}function $(i,...e){return function(t,n,r){const s=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!tn(a,r))throw new Error(`The following expression was expected to return ${tt(r)}, but returns ${tt(a)} instead: ${JSON.stringify(t)}`);a&=r}if(a===ji)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new Tp(a,s,...o)}}function qC(i,e,t){const n=i[0],r=XC[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,e,t)}class QC{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}function JC(i,e){return`operator_${i}_${Object.keys(e.functions).length}`}function Al(i){const e=i.toString();return e.includes(".")?e:e+".0"}function vp(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Al).join(", ")})`}function eb(i){const e=Fa(i),t=e.length>3?e[3]:1;return vp([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const wh={};let tb=0;function Rp(i){return i in wh||(wh[i]=tb++),wh[i]}function nb(i){return Al(Rp(i))}function xp(i){return"u_var_"+i}function ib(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const Ch="getBandValue",wp="u_paletteTextures";function rb(i,e,t,n){const r=ge(i,t,e);if(so(r.type,ji))throw new Error("No matching type was found");if(!tn(e,r.type)){const s=tt(e),o=tt(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Hu(r,e,n)}function te(i){return(e,t,n)=>{const r=t.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=Hu(t.args[o],n,e);return i(s,e)}}const sb={[S.Get]:(i,e)=>{const t=e.args[0].value;return t in i.properties||(i.properties[t]={name:t,type:e.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+t},[S.GeometryType]:(i,e,t)=>{const n="geometryType",r=s=>{const o=s.getType();switch(o){case"Point":case"LineString":case"Polygon":return o;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return o.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(s.getGeometries()[0])}};return n in i.properties||(i.properties[n]={name:n,type:Kt,evaluator:s=>r(s.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[S.Var]:(i,e)=>{const t=e.args[0].value;return t in i.variables||(i.variables[t]={name:t,type:e.type}),xp(t)},[S.Resolution]:()=>"u_resolution",[S.Zoom]:()=>"u_zoom",[S.Time]:()=>"u_time",[S.Any]:te(i=>`(${i.join(" || ")})`),[S.All]:te(i=>`(${i.join(" && ")})`),[S.Not]:te(([i])=>`(!${i})`),[S.Equal]:te(([i,e])=>`(${i} == ${e})`),[S.NotEqual]:te(([i,e])=>`(${i} != ${e})`),[S.GreaterThan]:te(([i,e])=>`(${i} > ${e})`),[S.GreaterThanOrEqualTo]:te(([i,e])=>`(${i} >= ${e})`),[S.LessThan]:te(([i,e])=>`(${i} < ${e})`),[S.LessThanOrEqualTo]:te(([i,e])=>`(${i} <= ${e})`),[S.Multiply]:te(i=>`(${i.join(" * ")})`),[S.Divide]:te(([i,e])=>`(${i} / ${e})`),[S.Add]:te(i=>`(${i.join(" + ")})`),[S.Subtract]:te(([i,e])=>`(${i} - ${e})`),[S.Clamp]:te(([i,e,t])=>`clamp(${i}, ${e}, ${t})`),[S.Mod]:te(([i,e])=>`mod(${i}, ${e})`),[S.Pow]:te(([i,e])=>`pow(${i}, ${e})`),[S.Abs]:te(([i])=>`abs(${i})`),[S.Floor]:te(([i])=>`floor(${i})`),[S.Ceil]:te(([i])=>`ceil(${i})`),[S.Round]:te(([i])=>`floor(${i} + 0.5)`),[S.Sin]:te(([i])=>`sin(${i})`),[S.Cos]:te(([i])=>`cos(${i})`),[S.Atan]:te(([i,e])=>e!==void 0?`atan(${i}, ${e})`:`atan(${i})`),[S.Sqrt]:te(([i])=>`sqrt(${i})`),[S.Match]:te(i=>{const e=i[0],t=i[i.length-1];let n=null;for(let r=i.length-3;r>=1;r-=2){const s=i[r],o=i[r+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[S.Between]:te(([i,e,t])=>`(${i} >= ${e} && ${i} <= ${t})`),[S.Interpolate]:te(([i,e,...t])=>{let n="";for(let r=0;r<t.length-2;r+=2){const s=t[r],o=n||t[r+1],a=t[r+2],l=t[r+3];let h;i===Al(1)?h=`(${e} - ${s}) / (${a} - ${s})`:h=`(pow(${i}, (${e} - ${s})) - 1.0) / (pow(${i}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[S.Case]:te(i=>{const e=i[i.length-1];let t=null;for(let n=i.length-3;n>=0;n-=2){const r=i[n],s=i[n+1];t=`(${r} ? ${s} : ${t||e})`}return t}),[S.In]:te(([i,...e],t)=>{const n=JC("in",t),r=[];for(let s=0;s<e.length;s+=1)r.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${i})`}),[S.Array]:te(i=>`vec${i.length}(${i.join(", ")})`),[S.Color]:te(i=>{const e=i.slice(0,3).map(t=>`${t} / 255.0`);return i.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${i[3]} * vec4(${e.join(", ")}, 1.0))`}),[S.Band]:te(([i,e,t],n)=>{if(!(Ch in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${Z.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[Ch]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${Z.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${Z.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${Ch}(${i}, ${e??"0.0"}, ${t??"0.0"})`}),[S.Palette]:(i,e)=>{const[t,...n]=e.args,r=n.length,s=new Uint8Array(r*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Fa(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${wp}[${i.paletteTextures.length}]`,a=new QC(o,s);i.paletteTextures.push(a);const l=Hu(t,N,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function Hu(i,e,t){if(i instanceof Tp){const n=sb[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(t,i,e)}if((i.type&N)>0)return Al(i.value);if((i.type&Ue)>0)return i.value.toString();if((i.type&Kt)>0)return nb(i.value.toString());if((i.type&rt)>0)return eb(i.value);if((i.type&Fr)>0)return vp(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${tt(e)})`)}function Ji(i,e,t){const n=jC();return n.style=i.style,rb(e,t,n,i)}function lf(i,e){const t=`
    attribute vec2 ${ta.TEXTURE_COORD};
    uniform mat4 ${Z.TILE_TRANSFORM};
    uniform float ${Z.TEXTURE_PIXEL_WIDTH};
    uniform float ${Z.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Z.TEXTURE_RESOLUTION};
    uniform float ${Z.TEXTURE_ORIGIN_X};
    uniform float ${Z.TEXTURE_ORIGIN_Y};
    uniform float ${Z.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${ta.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Z.TEXTURE_ORIGIN_X} + ${Z.TEXTURE_RESOLUTION} * ${Z.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Z.TEXTURE_ORIGIN_Y} - ${Z.TEXTURE_RESOLUTION} * ${Z.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Z.TILE_TRANSFORM} * vec4(${ta.TEXTURE_COORD}, ${Z.DEPTH}, 1.0);
    }
  `,n={...ib(),inFragmentShader:!0,bandCount:e,style:i},r=[];if(i.color!==void 0){const u=Ji(n,i.color,rt);r.push(`color = ${u};`)}if(i.contrast!==void 0){const u=Ji(n,i.contrast,N);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=Ji(n,i.exposure,N);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=Ji(n,i.saturation,N);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=Ji(n,i.gamma,N);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=Ji(n,i.brightness,N);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=xp(d.name);s[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=Rp(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${Z.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${wp}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Z.RENDER_EXTENT};
    uniform float ${Z.TRANSITION_ALPHA};
    uniform float ${Z.TEXTURE_PIXEL_WIDTH};
    uniform float ${Z.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Z.RESOLUTION};
    uniform float ${Z.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Z.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Z.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Z.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Z.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Z.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Z.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class vc extends cC{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(ce.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=lf(this.style_,this.getSourceBandCount_());return new FC(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let r;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(r=n.renderFrame(e));return r}render(e,t){this.rendered=!0;const n=e.viewState,r=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(e,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=lf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}vc.prototype.dispose;class ob extends Ll{constructor(e){e=e||{},super(e)}}let _r=null;function ab(){_r=on(1,1,void 0,{willReadFrequently:!0})}class lb extends _p{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=en(),this.pixelTransform=en(),this.inversePixelTransform=en(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){_r||ab(),_r.clearRect(0,0,1,1);let r;try{_r.drawImage(e,t,n,1,1,0,0,1,1),r=_r.getImageData(0,0,1,1).data}catch{return _r=null,null}return r}getBackground(e){let t=this.getLayer().getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,n){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!n||e&&e.style.backgroundColor&&yl(Fa(e.style.backgroundColor),Fa(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=on();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const r=Zr(n),s=Cl(n),o=wl(n),a=xl(n);Rt(t.coordinateToPixelTransform,r),Rt(t.coordinateToPixelTransform,s),Rt(t.coordinateToPixelTransform,o),Rt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Rt(l,r),Rt(l,s),Rt(l,o),Rt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){const s=new ys(e,this.inversePixelTransform,n,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(yt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(yt.POSTRENDER,e,t)}getRenderTransform(e,t,n,r,s,o,a){const l=s/2,h=o/2,c=r/t,u=-c,d=-e[0]+a,g=-e[1];return Mi(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class hb extends lb{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,r=e.viewState,s=r.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=At(l,ei(t.extent,r.projection))),!a[mt.ANIMATING]&&!a[mt.INTERACTING]&&!Gi(l))if(o){const h=r.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===Te.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=Rt(t.pixelToCoordinateTransform,e.slice()),s=n.getExtent();if(s&&!Ls(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Pe(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=ct(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(e,t){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),_=c*a/(g*l),m=e.extent,E=u.resolution,p=u.rotation,T=Math.round(Pe(m)/E*c),y=Math.round(ct(m)/E*c);Mi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,p,-T/2,-y/2),Vm(this.inversePixelTransform,this.pixelTransform);const v=Wx(this.pixelTransform);this.useContainer(t,v,this.getBackground(e));const x=this.context,R=x.canvas;R.width!=T||R.height!=y?(R.width=T,R.height=y):this.containerReused||x.clearRect(0,0,T,y);let w=!1,C=!0;if(h.extent){const U=ei(h.extent,u.projection);C=Js(U,e.extent),w=C&&!Ia(U,e.extent),w&&this.clipUnrotated(x,e,U)}const b=n.getImage(),O=Mi(this.tempTransform,T/2,y/2,f,_,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const J=b.width*O[0],z=b.height*O[3];if(this.getLayer().getSource().getInterpolate()||(x.imageSmoothingEnabled=!1),this.preRender(x,e),C&&J>=.5&&z>=.5){const U=O[4],G=O[5],W=h.opacity;let Ne;W!==1&&(Ne=x.globalAlpha,x.globalAlpha=W),x.drawImage(b,0,0,+b.width,+b.height,U,G,J,z),W!==1&&(x.globalAlpha=Ne)}return this.postRender(x,e),w&&x.restore(),x.imageSmoothingEnabled=!0,v!==R.style.transform&&(R.style.transform=v),this.container}}class cb extends ob{constructor(e){super(e)}createRenderer(){return new hb(this)}getData(e){return super.getData(e)}}const hf=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],cf={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class Cp extends no{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const n=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(k.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Hr} ${Pl}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(uf(t))if(df(t))db(t);else{let n;this.source_?n=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:n=e.getTargetElement(),this.keys_?ub(n):bp(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=df(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Ca(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(cf.ENTERFULLSCREEN)):(Ca(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(cf.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Be.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Be.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let n=0,r=e.length;n<r;++n)xe(e[n]);e.length=0;const t=this.getMap();if(t){const n=t.getOwnerDocument();uf(n)?this.element.classList.remove(Wg):this.element.classList.add(Wg);for(let r=0,s=hf.length;r<s;++r)e.push(re(n,hf[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function uf(i){const e=i.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&i.fullscreenEnabled)}function df(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function bp(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function ub(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():bp(i)}function db(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}const bh="units",gb=[1,2,5],hs=25.4/.28;class Ip extends no{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+Hr,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(bh,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(bh)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(bh,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=Ma(n,e.resolution,t,s);const a=this.minWidth_*(this.dpi_||hs)/hs,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||hs)/hs:void 0;let h=a*o,c="";if(r=="degrees"){const T=Nr.degrees;h*=T,h<T/60?(c="",o*=3600):h<T?(c="",o*=60):c=""}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,g,f,_,m,E;for(;;){f=Math.floor(u/3);const T=Math.pow(10,f);if(d=gb[(u%3+3)%3]*T,g=Math.round(d/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=_,g=m,f=E;break}else if(g>=a)break;_=d,m=g,E=f,++u}const p=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const c=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${c}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,e,!1,t,n):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+s+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,r,s){const o=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+s),a=e===0?-3:t/this.scaleBarSteps_*-1,l=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${a}px;text-align: ${e===0?"left":"center"};min-width: ${l}px;left: ${n?t+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const e=Ma(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||hs,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}mR(()=>Promise.resolve({}),na([0]));const Sp=500,fb=!0;function _b(i,e){let t,n,r,s;const o=()=>{const u=e.srid(),d=e.fullExtent();return u==="EPSG:3857"?d:e.transformRectangle(d,u,"EPSG:3857")},a=()=>{i.innerHTML="";const u=o().center();t=new kt({center:[u.x,u.y],zoom:10}),s=new $x(e,{debug:!1,extentBufferFactor:()=>document.getElementById("extentBufferFactor").valueAsNumber}),r=new vc({source:s}),n=new hp({target:i,view:t,controls:Xu().extend([new Ip,new Cp]),layers:[r,new vc({visible:fb,source:new Bm({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),style:{saturation:["var","saturation"],variables:{saturation:-.75}}})].reverse()}),n.once("precompose",function(d){l()})},l=()=>{const u=o();t.fit([u.xMinimum,u.yMinimum,u.xMaximum,u.yMaximum],{duration:Sp}),setTimeout(()=>{h()},0)},h=()=>{s?.clear(),r?.getRenderer()?.clearCache(),r?.changed()},c=document.getElementById("xyzBaseMap");return c&&c.addEventListener("change",()=>{n&&n.getLayers().getArray()[0].setVisible(c.checked)}),a(),{init:a,update:l,render:h}}function mb(i,e){let t,n,r,s,o;const a=()=>{i.innerHTML="",n=e.srid();const c=new La({code:n,units:"m"}),u=e.fullExtent().center();t=new kt({projection:c,center:[u.x,u.y],zoom:10}),o=new Dg(e,{projection:c}),s=new cb({source:o}),r=new hp({target:i,view:t,controls:Xu().extend([new Ip,new Cp]),layers:[s]}),r.once("precompose",function(d){const g=e.fullExtent();t.fit([g.xMinimum,g.yMinimum,g.xMaximum,g.yMaximum],{duration:Sp})})},l=()=>{a()},h=()=>{setTimeout(()=>{o=new Dg(e,{projection:new La({code:n,units:"m"})}),s?.setSource(o)},0)};return a(),{init:a,update:l,render:h}}function pb(i,e){const t=()=>{i.innerHTML="";const n=document.createElement("div");n.className="layers",i.appendChild(n);const r=e.mapLayers();for(const s of r){const o=document.createElement("div");o.className="layer";const a=document.createElement("input");a.type="checkbox",s.visible&&(a.checked=!0),a.addEventListener("change",()=>{s.visible=a.checked,redraw(),t()}),o.appendChild(a);const l=document.createTextNode(s.name);o.appendChild(l);const h=document.createElement("input");s.visible||(h.style.visibility="hidden"),h.type="range",h.min="0",h.max="100",h.value=""+s.opacity*100,h.step="1",h.addEventListener("change",()=>{s.opacity=parseInt(h.value)/100,redraw()}),o.appendChild(h),n.appendChild(o)}if(e.mapThemes().length>0){const s=document.createElement("div");s.className="themes",i.appendChild(s);const o=document.createElement("select");o.addEventListener("change",()=>{o.value&&(e.setMapTheme(o.value),redraw(),t())}),s.appendChild(o);const a=e.getMapTheme(),l=document.createElement("option");l.value="",l.text="",a||(l.selected=!0),o.appendChild(l);for(const h of e.mapThemes()){const c=document.createElement("option");c.value=h,c.text=h,h===a&&(c.selected=!0),o.appendChild(c)}}};return t(),t}const Eb=i=>({owner:"boardend",repo:"qgis-js-projects",path:"/"+i,branch:"main",prefix:`${i[0].toUpperCase()}${i.slice(1)}: `}),yb=[Eb("demo")];async function Tb(){console.log(`qgis-js (${zv})`);const i=document.getElementById("status"),e=document.getElementById("project");let t=!1;const n=o=>{t||(i.firstElementChild.innerHTML=o)},r=o=>{t=!0,console.error(o);const a=""+o&&o.message?o.message:"Runtime error";e.style.visibility="none",i.style.display="auto",i.innerHTML=`<div class="alert alert-danger" role="alert">
      <b style="color: red">Error:&nbsp;</b>
      ${a}
    </div>`},s=()=>{i.style.display="none",e.style.visibility="visible"};try{const{api:o,fs:a}=await Xv({prefix:"dist/assets/wasm",onStatus:R=>n(R)});n("Loading projects...");const l=[],h=[],{openProject:c,loadLocalProject:u,loadRemoteProjects:d,loadGithubProjects:g}=dR(a,R=>{o.loadProject(R),setTimeout(()=>{l.forEach(w=>w())},0)}),f=async function(){const R=await u();await c(R),E(R.name,()=>R),m.value=R.name},_=new Map,m=document.getElementById("projects");m.addEventListener("change",()=>{const R=_.get(m.value);R&&c(R())});const E=(R,w)=>{_.set(R,w);const C=document.createElement("option");C.value=R,C.text=R,m.add(C,null)};document.getElementById("local-project").onclick=f;const p=await d();p.forEach(R=>E(R.name,()=>R));for(const R of yb)try{const w=await g(R.owner,R.repo,R.path,R.branch);Object.entries(w).forEach(([C,b])=>{E((R.prefix||"")+C,b)})}catch(w){console.warn(`Unable to load GitHub project "${R.owner}/${R.repo}"`,w)}n("Opening first project..."),await c(p[0]),n("Rendering first frame..."),await o.renderImage(o.srid(),o.fullExtent(),42,42,1),s();const T=document.getElementById("layers-control");T&&l.push(pb(T,o,()=>{setTimeout(()=>{h.forEach(R=>R())},0)}));const y=document.getElementById("js-demo-canvas");if(y){const{update:R,render:w}=gR(y,o);l.push(R),h.push(w);const C=document.getElementById("tab1");C.addEventListener("change",()=>{C.checked&&R()})}const v=document.getElementById("ol-demo-xyz");if(v){const{update:R,render:w}=_b(v,o);l.push(R),h.push(w)}const x=document.getElementById("ol-demo-canvas");if(x){const{update:R,render:w}=mb(x,o);l.push(R),h.push(w)}}catch(o){r(o)}}document.addEventListener("DOMContentLoaded",function(){Tb()});function na(i){return na.viteFileDeps||(na.viteFileDeps=["assets/ol-CSy_vbSQ.css"]),i.map(e=>na.viteFileDeps[e])}var vb=Object.defineProperty,Rb=(i,e,t)=>e in i?vb(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ts=(i,e,t)=>(Rb(i,typeof e!="symbol"?e+"":e,t),t),Lp=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},Ti=(i,e,t)=>(Lp(i,e,"read from private field"),t?t.call(i):e.get(i)),Ih=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},jn=(i,e,t,n)=>(Lp(i,e,"write to private field"),e.set(i,t),t),gf=(i,e,t,n)=>({set _(r){jn(i,e,r)},get _(){return Ti(i,e,n)}});function xb(){return Math.min(Math.max(navigator?.hardwareConcurrency||4,4),8)}let wb=class{constructor(e){Ts(this,"value"),Ts(this,"next"),this.value=e}};var dn,mr,pr;let Cb=class{constructor(){Ih(this,dn,void 0),Ih(this,mr,void 0),Ih(this,pr,void 0),this.clear()}enqueue(e){const t=new wb(e);Ti(this,dn)?(Ti(this,mr).next=t,jn(this,mr,t)):(jn(this,dn,t),jn(this,mr,t)),gf(this,pr)._++}dequeue(){const e=Ti(this,dn);if(e)return jn(this,dn,Ti(this,dn).next),gf(this,pr)._--,e.value}clear(){jn(this,dn,void 0),jn(this,mr,void 0),jn(this,pr,0)}get size(){return Ti(this,pr)}*[Symbol.iterator](){let e=Ti(this,dn);for(;e;)yield e.value,e=e.next}};dn=new WeakMap,mr=new WeakMap,pr=new WeakMap;const bb={bind(i,e,t){return i.bind(t)}};function Ib(i){if(!((Number.isInteger(i)||i===Number.POSITIVE_INFINITY)&&i>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new Cb;let t=0;const n=()=>{t--,e.size>0&&e.dequeue()()},r=async(a,l,h)=>{t++;const c=(async()=>a(...h))();l(c);try{await c}catch{}n()},s=(a,l,h)=>{e.enqueue(bb.bind(r.bind(void 0,a,l,h))),(async()=>(await Promise.resolve(),t<i&&e.size>0&&e.dequeue()()))()},o=(a,...l)=>new Promise(h=>{s(a,h,l)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value(){e.clear()}}}),o}let Sb=class{constructor(e){Ts(this,"_api"),Ts(this,"_threadPoolSize"),Ts(this,"_limit"),this._api=e,this._threadPoolSize=xb(),this._limit=Ib(this._threadPoolSize)}runLimited(e){return this._limit(e)}renderImage(e,t,n,r,s=window?.devicePixelRatio||1){return this.runLimited(()=>new Promise(o=>{this._api.renderImage(e,t,n,r,s,a=>{const l=new Uint8ClampedArray(a),h=new ImageData(l,n,r);o(h)})}))}renderXYZTile(e,t,n,r=256,s=window?.devicePixelRatio||1,o=0){return this.runLimited(()=>new Promise(a=>{this._api.renderXYZTile(e,t,n,r,s,o,l=>{const h=new Uint8ClampedArray(l),c=new ImageData(h,r,r);a(c)})}))}mapLayers(){const e=this._api.mapLayers(),t=new Array(e.size());for(let n=0;n<e.size();n++)t[n]=e.get(n);return t}mapThemes(){const e=this._api.mapThemes(),t=new Array(e.size());for(let n=0;n<e.size();n++)t[n]=e.get(n);return t}};function Lb(i){const e=new Sb(i);return new Proxy({},{has(t,n){return n in e||n in i},get(t,n){if(n in e)return e[n];if(n in i)return i[n]}})}function Pb(i){return new Promise(async(e,t)=>{try{const n=(await new Function(`return import("${i}")`)()).default;e({createQtAppInstance:n})}catch(n){t(n)}})}async function Ab(i={}){return new Promise(async(e,t)=>{let n;if(i.prefix)n=i.prefix;else{const l=import.meta.url;/.*\/src\/loader\.[ts|js]\?*[^/]*$/.test(l)?(console.warn(['qgis-js loader is running in development mode and no "prefix" seems to be configured.'," - Consider adding the QgisRuntimePlugin when bundling with Vite."," - For more information see: https://github.com/qgis/qgis-js/blob/main/docs/bundling.md"].join(`
`)),typeof window<"u"&&(n=new URL("assets/wasm",window.location.href).pathname)):n=new URL("assets/wasm",import.meta.url).href}n?n=n.replace(/\/$/,""):n="assets/wasm";let r;try{const l=`${n}/qgis-js.js`;r=await Pb(l)}catch(l){t(new Error("Unable to load the qgis-js.js script",{cause:l}));return}const{createQtAppInstance:s}=r;let o;typeof document<"u"&&(o=document?.querySelector("#screen"));const a=s({locateFile:l=>`${n}/`+l,preRun:[function(l){l.qtContainerElements=o?[o]:[],l.qtFontDpi=96}],postRun:[async function(){const l=await a;e({api:Lb(l),module:l,fs:l.FS})}],...i.onStatus?{setStatus:i.onStatus}:{}})})}const Mb="0.0.3";var Ob=Object.defineProperty,Db=(i,e,t)=>e in i?Ob(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Lt=(i,e,t)=>(Db(i,typeof e!="symbol"?e+"":e,t),t);const Oi="/upload/projects";let Wu=class{constructor(e,t){Lt(this,"FS"),Lt(this,"type"),Lt(this,"name"),this.FS=e,this.type=t}isValid(){return this.getFiles().length>0&&this.getProjectFile()!==void 0}getProjectFile(){const e=this.getFiles().filter(t=>t.endsWith(".qgs")||t.endsWith(".qgz"));return e.length==1?e[0]:e.length>1?(console.warn("Found multiple project file candiates"),e[0]):void 0}getDirectoriesToCreate(){const e=new Set;for(const t of this.getDirectories()){let n=t.split("/");for(let r=0;r<n.length;r++){const s=n.slice(0,r+1).join("/");e.add(s)}}return Array.from(e).sort()}ensureDirectories(){for(const e of this.getDirectoriesToCreate()){const t=Oi+"/"+e,n=this.FS.analyzePath(t,!1);(!n||!n.exists)&&this.FS.mkdir(t)}}isProjectUploaded(){return this.FS.readdir(Oi).includes(this.name)}};const Yu=(()=>{if(typeof self>"u")return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch{return!1}return"showOpenFilePicker"in self})();Yu?Promise.resolve().then(function(){return jb}):Promise.resolve().then(function(){return Kb});const Nb=Yu?Promise.resolve().then(function(){return Xb}):Promise.resolve().then(function(){return Zb});async function Fb(...i){return(await Nb).default(...i)}Yu?Promise.resolve().then(function(){return Bb}):Promise.resolve().then(function(){return Wb});const Ub=async i=>{const e=await i.getFile();return e.handle=i,e};var Gb=async(i=[{}])=>{Array.isArray(i)||(i=[i]);const e=[];i.forEach((r,s)=>{e[s]={description:r.description||"Files",accept:{}},r.mimeTypes?r.mimeTypes.map(o=>{e[s].accept[o]=r.extensions||[]}):e[s].accept["*/*"]=r.extensions||[]});const t=await window.showOpenFilePicker({id:i[0].id,startIn:i[0].startIn,types:e,multiple:i[0].multiple||!1,excludeAcceptAllOption:i[0].excludeAcceptAllOption||!1}),n=await Promise.all(t.map(Ub));return i[0].multiple?n:n[0]},jb={__proto__:null,default:Gb};function ia(i){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(r){return{value:r,done:n}})}return ia=function(t){this.s=t,this.n=t.next},ia.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?Promise.reject(t):e(n.apply(this.s,arguments))}},new ia(i)}const Pp=async(i,e,t=i.name,n)=>{const r=[],s=[];var o,a=!1,l=!1;try{for(var h,c=function(u){var d,g,f,_=2;for(typeof Symbol<"u"&&(g=Symbol.asyncIterator,f=Symbol.iterator);_--;){if(g&&(d=u[g])!=null)return d.call(u);if(f&&(d=u[f])!=null)return new ia(d.call(u));g="@@asyncIterator",f="@@iterator"}throw new TypeError("Object is not async iterable")}(i.values());a=!(h=await c.next()).done;a=!1){const u=h.value,d=`${t}/${u.name}`;u.kind==="file"?s.push(u.getFile().then(g=>(g.directoryHandle=i,g.handle=u,Object.defineProperty(g,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>d})))):u.kind!=="directory"||!e||n&&n(u)||r.push(Pp(u,e,d,n))}}catch(u){l=!0,o=u}finally{try{a&&c.return!=null&&await c.return()}finally{if(l)throw o}}return[...(await Promise.all(r)).flat(),...await Promise.all(s)]};var kb=async(i={})=>{i.recursive=i.recursive||!1,i.mode=i.mode||"read";const e=await window.showDirectoryPicker({id:i.id,startIn:i.startIn,mode:i.mode});return(await(await e.values()).next()).done?[e]:Pp(e,i.recursive,void 0,i.skipDirectory)},Xb={__proto__:null,default:kb},zb=async(i,e=[{}],t=null,n=!1,r=null)=>{Array.isArray(e)||(e=[e]),e[0].fileName=e[0].fileName||"Untitled";const s=[];let o=null;if(i instanceof Blob&&i.type?o=i.type:i.headers&&i.headers.get("content-type")&&(o=i.headers.get("content-type")),e.forEach((h,c)=>{s[c]={description:h.description||"Files",accept:{}},h.mimeTypes?(c===0&&o&&h.mimeTypes.push(o),h.mimeTypes.map(u=>{s[c].accept[u]=h.extensions||[]})):o?s[c].accept[o]=h.extensions||[]:s[c].accept["*/*"]=h.extensions||[]}),t)try{await t.getFile()}catch(h){if(t=null,n)throw h}const a=t||await window.showSaveFilePicker({suggestedName:e[0].fileName,id:e[0].id,startIn:e[0].startIn,types:s,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1});!t&&r&&r(a);const l=await a.createWritable();return"stream"in i?(await i.stream().pipeTo(l),a):"body"in i?(await i.body.pipeTo(l),a):(await l.write(await i),await l.close(),a)},Bb={__proto__:null,default:zb},$b=async(i=[{}])=>(Array.isArray(i)||(i=[i]),new Promise((e,t)=>{const n=document.createElement("input");n.type="file";const r=[...i.map(l=>l.mimeTypes||[]),...i.map(l=>l.extensions||[])].join();n.multiple=i[0].multiple||!1,n.accept=r||"",n.style.display="none",document.body.append(n);const s=l=>{typeof o=="function"&&o(),e(l)},o=i[0].legacySetup&&i[0].legacySetup(s,()=>o(t),n),a=()=>{window.removeEventListener("focus",a),n.remove()};n.addEventListener("click",()=>{window.addEventListener("focus",a)}),n.addEventListener("change",()=>{window.removeEventListener("focus",a),n.remove(),s(n.multiple?Array.from(n.files):n.files[0])}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),Kb={__proto__:null,default:$b},Vb=async(i=[{}])=>(Array.isArray(i)||(i=[i]),i[0].recursive=i[0].recursive||!1,new Promise((e,t)=>{const n=document.createElement("input");n.type="file",n.webkitdirectory=!0;const r=o=>{typeof s=="function"&&s(),e(o)},s=i[0].legacySetup&&i[0].legacySetup(r,()=>s(t),n);n.addEventListener("change",()=>{let o=Array.from(n.files);i[0].recursive?i[0].recursive&&i[0].skipDirectory&&(o=o.filter(a=>a.webkitRelativePath.split("/").every(l=>!i[0].skipDirectory({name:l,kind:"directory"})))):o=o.filter(a=>a.webkitRelativePath.split("/").length===2),r(o)}),"showPicker"in HTMLInputElement.prototype?n.showPicker():n.click()})),Zb={__proto__:null,default:Vb},Hb=async(i,e={})=>{Array.isArray(e)&&(e=e[0]);const t=document.createElement("a");let n=i;"body"in i&&(n=await async function(o,a){const l=o.getReader(),h=new ReadableStream({start:d=>async function g(){return l.read().then(({done:f,value:_})=>{if(!f)return d.enqueue(_),g();d.close()})}()}),c=new Response(h),u=await c.blob();return l.releaseLock(),new Blob([u],{type:a})}(i.body,i.headers.get("content-type"))),t.download=e.fileName||"Untitled",t.href=URL.createObjectURL(await n);const r=()=>{typeof s=="function"&&s()},s=e.legacySetup&&e.legacySetup(r,()=>s(),t);return t.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(t.href),3e4),r()}),t.click(),null},Wb={__proto__:null,default:Hb};class Yb extends Wu{constructor(e,t){super(e,"Local"),Lt(this,"entries"),this.entries=t;const n=t.map(r=>r.webkitRelativePath).filter(r=>r&&r.length>0&&r.includes("/")).map(r=>r.split("/",1)[0]);if(n.length<1)throw new Error("Could not determine project name");this.name=n[0]}getDirectories(){const e=new Set;e.add(this.name);for(const t of this.entries){const n=t.webkitRelativePath;e.add(n.substring(0,n.lastIndexOf("/")))}return Array.from(e)}getFiles(){return this.entries.map(e=>e.webkitRelativePath)}async uploadProject(){this.ensureDirectories();for(const e of this.entries)this.FS.writeFile(Oi+"/"+e.webkitRelativePath,new Uint8Array(await e.arrayBuffer()))}}function qu(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat([e+"/"+n.name,...qu(n.entries,e+"/"+n.name)]):t,[])}function Qu(i,e){return i.reduce((t,n)=>n.type==="Folder"?t.concat(Qu(n.entries,e+"/"+n.name)):t.concat(e+"/"+n.name),[])}class qb extends Wu{constructor(e,t,n){super(e,"Remote"),Lt(this,"folder"),Lt(this,"path"),Lt(this,"baseUrl"),this.baseUrl=new URL(t),this.folder=n;const r=this.baseUrl.pathname.split("/").pop();this.name=n.name,this.path=n.path.replace(new RegExp(`^${r}/`),"")}getDirectories(){return[this.path,...qu(this.folder.entries,this.path)]}getFiles(){return Qu(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise((n,r)=>{const s=new URL(`${this.baseUrl.href}/${t}`);fetch(s).then(o=>o.arrayBuffer().then(a=>{n(a)}))})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Oi+"/"+t,n)}}}const Ap="main";async function Qb(i,e,t="/",n=Ap){const r=`https://api.github.com/repos/${i}/${e}/contents${t}?ref=${n}`;return await(await fetch(r)).json()}async function Jb(i,e,t){const n=`https://api.github.com/repos/${i}/${e}/git/trees/${t}?recursive=1`;return(await(await fetch(n)).json()).tree.filter(r=>r.type==="blob").map(r=>r.path)}function e2(i,e,t){const n={name:i,path:e,type:"Folder",entries:[]};return t.sort().forEach(r=>{const s=r.split("/");let o=n;for(let a=0;a<s.length-1;a++){const l=s[a],h=o.entries.find(c=>c.name===l);if(h)o=h;else{const c={name:l,path:o.path+"/"+l,type:"Folder",entries:[]};o.entries.push(c),o=c}}o.entries.push({name:s[s.length-1],path:r,type:"File"})}),n}class t2 extends Wu{constructor(e,t,n,r,s=Ap){super(e,"Github"),Lt(this,"folder"),Lt(this,"path"),Lt(this,"owner"),Lt(this,"repo"),Lt(this,"branch"),this.folder=t,this.name=t.name,this.path=t.path,this.owner=n,this.repo=r,this.branch=s}getDirectories(){return[this.path,...qu(this.folder.entries,this.path)]}getFiles(){return Qu(this.folder.entries,this.path)}async uploadProject(){const e=Object.fromEntries(this.getFiles().map(t=>[t,new Promise(async(n,r)=>{const s=`https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${t}`,o=await fetch(s);n(o.arrayBuffer())})]));await Promise.all([Object.values(e)]),this.ensureDirectories();for(const t of this.getFiles()){const n=new Uint8Array(await e[t]);this.FS.writeFile(Oi+"/"+t,n)}}}function n2(i,e){let t=Oi.split("/");for(let s=1;s<t.length;s++)i.mkdir(t.slice(0,s+1).join("/"));const n=async s=>{if(s){if(s instanceof Promise&&(s=await s),!s.isValid())throw new Error(`Project "${s.name}" is not valid`);s.isProjectUploaded()||await s.uploadProject(),r(s)}else return},r=s=>{const o=Oi+"/"+s.getProjectFile();e(o)};return{openProject:n,loadLocalProject:()=>new Promise(async(s,o)=>{try{const a=await Fb({recursive:!0,mode:"read"}),l=new Yb(i,a);s(l)}catch(a){o(a)}}),loadRemoteProjects:(s="./projects/directory-listing.json")=>new Promise(async(o,a)=>{try{const l=new URL(s,window.location.href).href.split("/").slice(0,-1).join("/"),h=await(await fetch(s)).json();if(!h.type||h.type!=="Folder"){a(new Error("Remote projects response seems not a folder"));return}o(h.entries.filter(c=>c.type==="Folder").map(c=>new qb(i,l,c)))}catch(l){a(l)}}),loadGithubProjects:(s,o,a="/",l="main")=>new Promise(async(h,c)=>{try{const u=await Qb(s,o,a,l);if(u instanceof Array)h(Object.fromEntries(u.filter(d=>d.type==="dir").map(d=>[d.name,()=>new Promise(async g=>{const f=await Jb(s,o,d.sha);g(new t2(i,e2(d.name,d.path,f),s,o,l))})])));else{console.warn(u),h({});return}}catch(u){c(u)}})}}const ff=1.5,Uo=.1;function i2(i,e){let t=null;new ResizeObserver(o=>{const a=o.find(l=>l.target===i);a&&(i.width=a.devicePixelContentBoxSize[0].inlineSize,i.height=a.devicePixelContentBoxSize[0].blockSize),r()}).observe(i,{box:"device-pixel-content-box"});async function r(){var o=window.devicePixelRatio||1,a=i.getBoundingClientRect();const l=a.width*o,h=a.height*o;if(l&&h){const c=await e.renderImage(e.srid(),t,l,h,window.devicePixelRatio),u=i.getContext("2d");i.width=l,i.height=h,u.scale(o,o),u.putImageData(c,0,0)}}document.getElementById("zoomin").onclick=function(){t.scale(1/ff),r()},document.getElementById("zoomout").onclick=function(){t.scale(ff),r()},document.getElementById("panleft").onclick=function(){t.move((t.xMaximum-t.xMinimum)*Uo,0),r()},document.getElementById("panright").onclick=function(){t.move(-(t.xMaximum-t.xMinimum)*Uo,0),r()},document.getElementById("panup").onclick=function(){t.move(0,-(t.yMaximum-t.yMinimum)*Uo),r()},document.getElementById("pandown").onclick=function(){t.move(0,(t.yMaximum-t.yMinimum)*Uo),r()};function s(){t=e.fullExtent(),r()}return s(),{update:()=>{s()},render:()=>{r()}}}const r2="modulepreload",s2=function(i){return"/"+i},_f={},o2=function(e,t,n){let r=Promise.resolve();return t&&t.length>0&&(document.getElementsByTagName("link"),r=Promise.all(t.map(s=>{if(s=s2(s),s in _f)return;_f[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${a}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":r2,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((h,c)=>{l.addEventListener("load",h),l.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})}))),r.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},X={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Ml{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}class wn{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}function Ju(i,e){return i>e?1:i<e?-1:0}function a2(i,e){return i<e?1:i>e?-1:0}function Ol(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===e)return r;if(s<e)return t(e,i[r-1],s)>0?r-1:r}return n-1}if(t>0){for(let r=1;r<n;++r)if(i[r]<e)return r-1;return n-1}if(t<0){for(let r=1;r<n;++r)if(i[r]<=e)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==e)return r;if(i[r]<e)return i[r-1]-e<e-i[r]?r-1:r}return n-1}function l2(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let r=0;r<n;r++)i[i.length]=t[r]}function Dl(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function h2(i,e,t){const n=e||Ju;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||o===0)})}function ja(){return!0}function Nl(){return!1}function ka(){}function c2(i){let e=!1,t,n,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!Dl(s,n))&&(e=!0,r=this,n=s,t=i.apply(this,arguments)),t}}function u2(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function oo(i){for(const e in i)delete i[e]}function d2(i){let e;for(e in i)return!1;return!e}class ao extends Ml{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),r=n[e]||(n[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=t?new wn(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,ka);delete o[n]}return l}disposeInternal(){this.listeners_&&oo(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const r=n.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[r]=ka,++this.pendingRemovals_[e]):(n.splice(r,1),n.length===0&&delete this.listeners_[e]))}}const M={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Ie(){throw new Error("Unimplemented abstract method.")}let g2=0;function Je(i){return i.ol_uid||(i.ol_uid=String(++g2))}function Mp(i){return Math.pow(i,3)}function qr(i){return 1-Mp(1-i)}function f2(i){return 3*i*i-2*i*i*i}function _2(i){return i}class ed extends ao{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(X.CHANGE)}release(){this.state===M.ERROR&&this.setState(M.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==M.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==M.LOADED){e.interimTile=null;break}e.getState()==M.LOADING?t=e:e.getState()==M.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==M.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Ie()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const r=t-n+1e3/60;return r>=this.transition_?1:Mp(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const li=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",m2=li.includes("firefox"),p2=li.includes("safari")&&!li.includes("chrom"),E2=p2&&(li.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(li)),y2=li.includes("webkit")&&!li.includes("edge"),Op=li.includes("macintosh"),Dp=typeof devicePixelRatio<"u"?devicePixelRatio:1,Np=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,T2=typeof Image<"u"&&Image.prototype.decode,Fp=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}();function an(i,e,t,n){let r;return t&&t.length?r=t.shift():Np?r=new OffscreenCanvas(i||300,e||300):r=document.createElement("canvas"),i&&(r.width=i),e&&(r.height=e),r.getContext("2d",n)}function Ds(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function Xa(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function Rc(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function v2(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function R2(i,e){const t=i.childNodes;for(let n=0;;++n){const r=t[n],s=e[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}const ve={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function se(i,e,t,n,r){if(n&&n!==i&&(t=t.bind(n)),r){const o=t;t=function(){i.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:i,type:e,listener:t};return i.addEventListener(e,t),s}function za(i,e,t,n){return se(i,e,t,n,!0)}function we(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),oo(i))}class x2 extends ao{constructor(e,t,n,r){super(),this.extent=e,this.pixelRatio_=n,this.resolution=t,this.state=typeof r=="function"?ve.IDLE:r,this.image_=null,this.loader=typeof r=="function"?r:null}changed(){this.dispatchEvent(X.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ve.IDLE&&this.loader){this.state=ve.LOADING,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;u2(()=>this.loader(this.getExtent(),t,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=ve.LOADED}).catch(n=>{this.state=ve.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function w2(i,e,t){const n=i;let r=!0,s=!1,o=!1;const a=[za(n,X.LOAD,function(){o=!0,s||e()})];return n.src&&T2?(s=!0,n.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(za(n,X.ERROR,t)),function(){r=!1,a.forEach(we)}}const Up=x2;class Fl extends ed{constructor(e,t,n,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=M.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=M.ERROR,this.unlistenImage_(),this.image_=C2(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=M.LOADED:this.state=M.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==M.ERROR&&(this.state=M.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==M.IDLE&&(this.state=M.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=w2(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function C2(){const i=an(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const td=.5,Ye={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function xc(i){const e=Qr();for(let t=0,n=i.length;t<n;++t)ra(e,i[t]);return e}function b2(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function Gp(i,e,t){let n,r;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?r=i[1]-t:i[3]<t?r=t-i[3]:r=0,n*n+r*r}function Ns(i,e){return jp(i,e[0],e[1])}function Ba(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function jp(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function mf(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=e[0],a=e[1];let l=Ye.UNKNOWN;return o<t?l=l|Ye.LEFT:o>r&&(l=l|Ye.RIGHT),a<n?l=l|Ye.BELOW:a>s&&(l=l|Ye.ABOVE),l===Ye.UNKNOWN&&(l=Ye.INTERSECTING),l}function Qr(){return[1/0,1/0,-1/0,-1/0]}function lo(i,e,t,n,r){return r?(r[0]=i,r[1]=e,r[2]=t,r[3]=n,r):[i,e,t,n]}function Ul(i){return lo(1/0,1/0,-1/0,-1/0,i)}function I2(i,e){const t=i[0],n=i[1];return lo(t,n,t,n,e)}function S2(i,e,t,n,r){const s=Ul(r);return kp(s,i,e,t,n)}function wc(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function L2(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function ra(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function kp(i,e,t,n,r){for(;t<n;t+=r)P2(i,e[t],e[t+1]);return i}function P2(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function Xp(i,e){let t;return t=e(Gl(i)),t||(t=e(jl(i)),t)||(t=e(kl(i)),t)||(t=e(Jr(i)),t)?t:!1}function Fs(i){let e=0;return ki(i)||(e=Ae(i)*ut(i)),e}function Gl(i){return[i[0],i[1]]}function jl(i){return[i[2],i[1]]}function Di(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function A2(i,e){let t;if(e==="bottom-left")t=Gl(i);else if(e==="bottom-right")t=jl(i);else if(e==="top-left")t=Jr(i);else if(e==="top-right")t=kl(i);else throw new Error("Invalid corner");return t}function $a(i,e,t,n,r){const[s,o,a,l,h,c,u,d]=M2(i,e,t,n);return lo(Math.min(s,a,h,u),Math.min(o,l,c,d),Math.max(s,a,h,u),Math.max(o,l,c,d),r)}function M2(i,e,t,n){const r=e*n[0]/2,s=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,h=r*a,c=s*o,u=s*a,d=i[0],g=i[1];return[d-l+u,g-h-c,d-l-u,g-h+c,d+l-u,g+h+c,d+l+u,g+h-c,d-l+u,g-h-c]}function ut(i){return i[3]-i[1]}function Mt(i,e,t){const n=t||Qr();return ho(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):Ul(n),n}function Jr(i){return[i[0],i[3]]}function kl(i){return[i[2],i[3]]}function Ae(i){return i[2]-i[0]}function ho(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function ki(i){return i[2]<i[0]||i[3]<i[1]}function O2(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function D2(i,e,t){let n=!1;const r=mf(i,e),s=mf(i,t);if(r===Ye.INTERSECTING||s===Ye.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],d=t[0],g=t[1],f=(g-u)/(d-c);let _,m;s&Ye.ABOVE&&!(r&Ye.ABOVE)&&(_=d-(g-h)/f,n=_>=o&&_<=l),!n&&s&Ye.RIGHT&&!(r&Ye.RIGHT)&&(m=g-(d-l)*f,n=m>=a&&m<=h),!n&&s&Ye.BELOW&&!(r&Ye.BELOW)&&(_=d-(g-a)/f,n=_>=o&&_<=l),!n&&s&Ye.LEFT&&!(r&Ye.LEFT)&&(m=g-(d-o)*f,n=m>=a&&m<=h)}return n}const Ur={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Ka{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ur[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const co=6378137,xr=Math.PI*co,N2=[-xr,-xr,xr,xr],F2=[-180,-85,180,85],Go=co*Math.log(Math.tan(Math.PI/2));class er extends Ka{constructor(e){super({code:e,units:"m",extent:N2,global:!0,worldExtent:F2,getPointResolution:function(t,n){return t/Math.cosh(n[1]/co)}})}}const pf=[new er("EPSG:3857"),new er("EPSG:102100"),new er("EPSG:102113"),new er("EPSG:900913"),new er("http://www.opengis.net/def/crs/EPSG/0/3857"),new er("http://www.opengis.net/gml/srs/epsg.xml#3857")];function U2(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t){e[r]=xr*i[r]/180;let s=co*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));s>Go?s=Go:s<-Go&&(s=-Go),e[r+1]=s}return e}function G2(i,e,t){const n=i.length;t=t>1?t:2,e===void 0&&(t>2?e=i.slice():e=new Array(n));for(let r=0;r<n;r+=t)e[r]=180*i[r]/xr,e[r+1]=360*Math.atan(Math.exp(i[r+1]/co))/Math.PI-90;return e}const j2=6378137,Ef=[-180,-90,180,90],k2=Math.PI*j2/180;class _i extends Ka{constructor(e,t){super({code:e,units:"degrees",extent:Ef,axisOrientation:t,global:!0,metersPerUnit:k2,worldExtent:Ef})}}const yf=[new _i("CRS:84"),new _i("EPSG:4326","neu"),new _i("urn:ogc:def:crs:OGC:1.3:CRS84"),new _i("urn:ogc:def:crs:OGC:2:84"),new _i("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new _i("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new _i("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Cc={};function X2(i){return Cc[i]||Cc[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function z2(i,e){Cc[i]=e}let Pr={};function Va(i,e,t){const n=i.getCode(),r=e.getCode();n in Pr||(Pr[n]={}),Pr[n][r]=t}function B2(i,e){let t;return i in Pr&&e in Pr[i]&&(t=Pr[i][e]),t}function Xe(i,e,t){return Math.min(Math.max(i,e),t)}function $2(i,e,t,n,r,s){const o=r-t,a=s-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=r,n=s):l>0&&(t+=o*l,n+=a*l)}return Ar(i,e,t,n)}function Ar(i,e,t,n){const r=t-i,s=n-e;return r*r+s*s}function K2(i){const e=i.length;for(let n=0;n<e;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let r=n-1;r>=0;r--)i[r][e]-=i[r][n]*t[n]}return t}function sa(i){return i*Math.PI/180}function Mr(i,e){const t=i%e;return t*e<0?t+e:t}function V2(i,e,t){return i+t*(e-i)}function zp(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function jo(i,e){return Math.floor(zp(i,e))}function ti(i,e){return Math.ceil(zp(i,e))}function Z2(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function Za(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function nd(i,e){const t=Math.cos(e),n=Math.sin(e),r=i[0]*t-i[1]*n,s=i[1]*t+i[0]*n;return i[0]=r,i[1]=s,i}function H2(i,e){return i[0]*=e,i[1]*=e,i}function W2(i,e){if(e.canWrapX()){const t=Ae(e.getExtent()),n=Y2(i,e,t);n&&(i[0]-=n*t)}return i}function Y2(i,e,t){const n=e.getExtent();let r=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Ae(n),r=Math.floor((i[0]-n[0])/t)),r}const q2=63710088e-1;function Tf(i,e,t){t=t||q2;const n=sa(i[1]),r=sa(e[1]),s=(r-n)/2,o=sa(e[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Bp(...i){console.warn(...i)}let bc=!0;function Q2(i){bc=!1}function id(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function $p(i,e){if(e!==void 0&&i!==e){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];i=e}return i}function J2(i){z2(i.getCode(),i),Va(i,i,id)}function eI(i){i.forEach(J2)}function Yt(i){return typeof i=="string"?X2(i):i||null}function Ha(i,e,t,n){i=Yt(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/Ur[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=e;else{const a=sd(i,Yt("EPSG:4326"));if(a===$p&&o!=="degrees")r=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=Tf(h.slice(0,2),h.slice(2,4)),u=Tf(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?Ur[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function vf(i){eI(i),i.forEach(function(e){i.forEach(function(t){e!==t&&Va(e,t,id)})})}function tI(i,e,t,n){i.forEach(function(r){e.forEach(function(s){Va(r,s,t),Va(s,r,n)})})}function rd(i,e){return i?typeof i=="string"?Yt(i):i:Yt(e)}function Wn(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||sd(i,e)===id)&&t}function sd(i,e){const t=i.getCode(),n=e.getCode();let r=B2(t,n);return r||(r=$p),r}function Wa(i,e){const t=Yt(i),n=Yt(e);return sd(t,n)}function nI(i,e,t){return Wa(e,t)(i,void 0,i.length)}function Ic(i,e){return i}function gn(i,e){return bc&&!Za(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(bc=!1,Bp("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function iI(i,e){return i}function ni(i,e){return i}function rI(){vf(pf),vf(yf),tI(yf,pf,U2,G2)}rI();const sI=10,Rf=.25;class od{constructor(e,t,n,r,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=Wa(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const T=p[0]+"/"+p[1];return a[T]||(a[T]=l(p)),a[T]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Ae(r)>=Ae(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ae(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ae(this.targetProj_.getExtent()):null;const h=Jr(n),c=kl(n),u=jl(n),d=Gl(n),g=this.transformInv_(h),f=this.transformInv_(c),_=this.transformInv_(u),m=this.transformInv_(d),E=sI+(o?Math.max(0,Math.ceil(Math.log2(Fs(n)/(o*o*256*256)))):0);if(this.addQuad_(h,c,u,d,g,f,_,m,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(T,y,v){p=Math.min(p,T.source[0][0],T.source[1][0],T.source[2][0])}),this.triangles_.forEach(T=>{if(Math.max(T.source[0][0],T.source[1][0],T.source[2][0])-p>this.sourceWorldWidth_/2){const y=[[T.source[0][0],T.source[0][1]],[T.source[1][0],T.source[1][1]],[T.source[2][0],T.source[2][1]]];y[0][0]-p>this.sourceWorldWidth_/2&&(y[0][0]-=this.sourceWorldWidth_),y[1][0]-p>this.sourceWorldWidth_/2&&(y[1][0]-=this.sourceWorldWidth_),y[2][0]-p>this.sourceWorldWidth_/2&&(y[2][0]-=this.sourceWorldWidth_);const v=Math.min(y[0][0],y[1][0],y[2][0]);Math.max(y[0][0],y[1][0],y[2][0])-v<this.sourceWorldWidth_/2&&(T.source=y)}})}a={}}addTriangle_(e,t,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,n]})}addQuad_(e,t,n,r,s,o,a,l,h){const c=xc([s,o,a,l]),u=this.sourceWorldWidth_?Ae(c)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const m=xc([e,t,n,r]);f=Ae(m)/this.targetWorldWidth_>Rf||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>Rf||f)}if(!f&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!ho(c,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(_=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(h>0){if(!f){const m=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(m);let p;g?p=(Mr(s[0],d)+Mr(a[0],d))/2-Mr(E[0],d):p=(s[0]+a[0])/2-E[0];const T=(s[1]+a[1])/2-E[1];f=p*p+T*T>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const m=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(m),p=[(r[0]+e[0])/2,(r[1]+e[1])/2],T=this.transformInv_(p);this.addQuad_(e,t,m,p,s,o,E,T,h-1),this.addQuad_(p,m,n,r,T,E,a,l,h-1)}else{const m=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(m),p=[(n[0]+r[0])/2,(n[1]+r[1])/2],T=this.transformInv_(p);this.addQuad_(e,m,p,r,s,E,T,l,h-1),this.addQuad_(m,t,n,p,E,o,a,T,h-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,n,r,s,a,l),_&14||this.addTriangle_(e,n,t,s,a,o),_&&(_&13||this.addTriangle_(t,r,e,o,l,s),_&7||this.addTriangle_(t,r,n,o,l,a))}calculateSourceExtent(){const e=Qr();return this.triangles_.forEach(function(t,n,r){const s=t.source;ra(e,s[0]),ra(e,s[1]),ra(e,s[2])}),e}getTriangles(){return this.triangles_}}let Sh;const yn=[];function xf(i,e,t,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,r)),i.restore()}function Lh(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function oI(){if(Sh===void 0){const i=an(6,6,yn);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",xf(i,4,5,4,0),xf(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;Sh=Lh(e,0)||Lh(e,4)||Lh(e,8),Ds(i),yn.push(i.canvas)}return Sh}function Sc(i,e,t,n){const r=nI(t,e,i);let s=Ha(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||Ns(l,r)){const h=Ha(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Kp(i,e,t,n){const r=Di(t);let s=Sc(i,e,r,n);return(!isFinite(s)||s<=0)&&Xp(t,function(o){return s=Sc(i,e,o,n),isFinite(s)&&s>0}),s}function ad(i,e,t,n,r,s,o,a,l,h,c,u,d){const g=an(Math.round(t*i),Math.round(t*e),yn);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function f(p){return Math.round(p*t)/t}g.globalCompositeOperation="lighter";const _=Qr();l.forEach(function(p,T,y){L2(_,p.extent)});let m;if(!d||l.length!==1||h!==0){const p=Ae(_),T=ut(_);m=an(Math.round(t*p/n),Math.round(t*T/n),yn),u||(m.imageSmoothingEnabled=!1);const y=t/n;l.forEach(function(v,x,R){const w=v.extent[0]-_[0],C=-(v.extent[3]-_[3]),b=Ae(v.extent),O=ut(v.extent);v.image.width>0&&v.image.height>0&&m.drawImage(v.image,h,h,v.image.width-2*h,v.image.height-2*h,w*y,C*y,b*y,O*y)})}const E=Jr(o);return a.getTriangles().forEach(function(p,T,y){const v=p.source,x=p.target;let R=v[0][0],w=v[0][1],C=v[1][0],b=v[1][1],O=v[2][0],J=v[2][1];const z=f((x[0][0]-E[0])/s),U=f(-(x[0][1]-E[1])/s),G=f((x[1][0]-E[0])/s),W=f(-(x[1][1]-E[1])/s),Ne=f((x[2][0]-E[0])/s),Ot=f(-(x[2][1]-E[1])/s),Dt=R,Nt=w;R=0,w=0,C-=Dt,b-=Nt,O-=Dt,J-=Nt;const is=[[C,b,0,0,G-z],[O,J,0,0,Ne-z],[0,0,C,b,W-U],[0,0,O,J,Ot-U]],Ke=K2(is);if(!Ke)return;if(g.save(),g.beginPath(),oI()||!u){g.moveTo(G,W);const _e=4,Ze=z-G,bn=U-W;for(let Se=0;Se<_e;Se++)g.lineTo(G+f((Se+1)*Ze/_e),W+f(Se*bn/(_e-1))),Se!=_e-1&&g.lineTo(G+f((Se+1)*Ze/_e),W+f((Se+1)*bn/(_e-1)));g.lineTo(Ne,Ot)}else g.moveTo(G,W),g.lineTo(z,U),g.lineTo(Ne,Ot);g.clip(),g.transform(Ke[0],Ke[2],Ke[1],Ke[3],z,U),g.translate(_[0]-Dt,_[3]-Nt);let Ve;if(m)Ve=m.canvas,g.scale(n/t,-n/t);else{const _e=l[0],Ze=_e.extent;Ve=_e.image,g.scale(Ae(Ze)/Ve.width,-ut(Ze)/Ve.height)}g.drawImage(Ve,0,0),g.restore()}),m&&(Ds(m),yn.push(m.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(p,T,y){const v=p.target,x=(v[0][0]-E[0])/s,R=-(v[0][1]-E[1])/s,w=(v[1][0]-E[0])/s,C=-(v[1][1]-E[1])/s,b=(v[2][0]-E[0])/s,O=-(v[2][1]-E[1])/s;g.beginPath(),g.moveTo(w,C),g.lineTo(x,R),g.lineTo(b,O),g.closePath(),g.stroke()}),g.restore()),g.canvas}class Xl extends ed{constructor(e,t,n,r,s,o,a,l,h,c,u,d){super(s,M.IDLE,d),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=r.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const m=f?Mt(g,f):g;if(Fs(m)===0){this.state=M.EMPTY;return}const E=e.getExtent();E&&(_?_=Mt(_,E):_=E);const p=r.getResolution(this.wrappedTileCoord_[0]),T=Kp(e,n,m,p);if(!isFinite(T)||T<=0){this.state=M.EMPTY;return}const y=c!==void 0?c:td;if(this.triangulation_=new od(e,n,m,_,T*y,p),this.triangulation_.getTriangles().length===0){this.state=M.EMPTY;return}this.sourceZ_=t.getZForResolution(T);let v=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(v[1]=Xe(v[1],_[1],_[3]),v[3]=Xe(v[3],_[1],_[3])):v=Mt(v,_)),!Fs(v))this.state=M.EMPTY;else{const x=t.getTileRangeForExtentAndZ(v,this.sourceZ_);for(let R=x.minX;R<=x.maxX;R++)for(let w=x.minY;w<=x.maxY;w++){const C=h(this.sourceZ_,R,w,a);C&&this.sourceTiles_.push(C)}this.sourceTiles_.length===0&&(this.state=M.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==M.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=M.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ad(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=M.LOADED}this.changed()}load(){if(this.state==M.IDLE){this.state=M.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n==M.IDLE||n==M.LOADING){e++;const r=se(t,X.CHANGE,function(s){const o=t.getState();(o==M.LOADED||o==M.ERROR||o==M.EMPTY)&&(we(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,n,r){t.getState()==M.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(we),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ds(this.canvas_.getContext("2d")),yn.push(this.canvas_),this.canvas_=null),super.release()}}function Ee(i,e){if(!i)throw new Error(e)}class Vp{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return Ee(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return Ee(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Ee(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}function Ya(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function zl(i,e,t){return i+"/"+e+"/"+t}function Yn(i){return zl(i[0],i[1],i[2])}function aI(i){return i.split("/").map(Number)}function lI(i){return(i[1]<<i[0])+i[2]}function hI(i,e){const t=i[0],n=i[1],r=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(n,r):!0}class Zp extends Vp{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),n=aI(e)[0];this.forEach(r=>{r.tileCoord[0]!==n&&(this.remove(Yn(r.tileCoord)),r.release())})}}const Ph={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Us={PROPERTYCHANGE:"propertychange"};class uo extends ao{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(X.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=se(this,e[s],t);return r}return se(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const r=e.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=za(this,e[s],t)}else n=za(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)cI(n);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}uo.prototype.on;uo.prototype.once;uo.prototype.un;function cI(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)we(i[e]);else we(i)}class wf extends wn{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class Cn extends uo{constructor(e){super(),this.on,this.once,this.un,Je(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new wf(n,e,t)),n=Us.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new wf(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const r=this.values_||(this.values_={});if(n)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],d2(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}class Hp extends Cn{constructor(e){super(),this.projection=Yt(e.projection),this.attributions_=Cf(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,r){t.viewResolver=n,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Cf(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Cf(i){return i?Array.isArray(i)?function(e){return i}:typeof i=="function"?i:function(e){return[i]}:null}class ld{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function tr(i,e,t,n,r){return r!==void 0?(r.minX=i,r.maxX=e,r.minY=t,r.maxY=n,r):new ld(i,e,t,n)}const uI=42,hd=256;function dI(i,e,t,n,r){let s;for(e+=n;e<t;e+=n)if(s=r(i.slice(e-n,e),i.slice(e,e+n)),s)return s;return!1}function gI(i,e,t,n,r){return!Xp(r,function(o){return!Ci(i,e,t,n,o[0],o[1])})}function Ci(i,e,t,n,r,s){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Wp(i,e,t,n,r,s){if(t.length===0||!Ci(i,e,t[0],n,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(Ci(i,t[o-1],t[o],n,r,s))return!1;return!0}function Yp(i,e,t,n,r){const s=kp(Qr(),i,e,t,n);return ho(r,s)?Ba(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:dI(i,e,t,n,function(o,a){return D2(r,o,a)}):!1}function qp(i,e,t,n,r){return!!(Yp(i,e,t,n,r)||Ci(i,e,t,n,r[0],r[1])||Ci(i,e,t,n,r[0],r[3])||Ci(i,e,t,n,r[2],r[1])||Ci(i,e,t,n,r[2],r[3]))}function fI(i,e,t,n,r){if(!qp(i,e,t[0],n,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(gI(i,t[s-1],t[s],n,r)&&!Yp(i,t[s-1],t[s],n,r))return!1;return!0}function bf(i){return i[0]>0&&i[1]>0}function _I(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function Vt(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}const nr=[0,0,0],An=5;class Qp{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Ee(h2(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Ee(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Jr(n)),Ee(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Ee(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:hd,Ee(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,s)=>{const o=new ld(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([t,s,a])}forEachTileCoordParentTileRange(e,t,n,r){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=tr(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return tr(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return tr(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),h=Math.floor(s*l),c=Math.floor(o*l);if(t<r)return tr(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return tr(h,u,c,d,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,nr);const r=nr[1],s=nr[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,nr);const o=nr[1],a=nr[2];return tr(r,o,s,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=Vt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=Vt(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*s[0]*r,a=n[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return lo(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=Vt(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return r?(c=ti(c,An)-1,u=ti(u,An)-1):(c=jo(c,An),u=jo(u,An)),Ya(o,c,u,s)}getTileCoordForXYAndZ_(e,t,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=Vt(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return r?(h=ti(h,An)-1,c=ti(c,An)-1):(h=jo(h,An),c=jo(c,An)),Ya(n,h,c,s)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=Ol(this.resolutions_,e,t||0);return Xe(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return qp(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}}function Jp(i){let e=i.getDefaultTileGrid();return e||(e=yI(i),i.setDefaultTileGrid(e)),e}function mI(i,e,t){const n=e[0],r=i.getTileCoordCenter(e),s=cd(t);if(!Ns(s,r)){const o=Ae(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return e}function pI(i,e,t,n){n=n!==void 0?n:"top-left";const r=e0(i,e,t);return new Qp({extent:i,origin:A2(i,n),resolutions:r,tileSize:t})}function EI(i){const e=i||{},t=e.extent||Yt("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:e0(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Qp(n)}function e0(i,e,t,n){e=e!==void 0?e:uI,t=Vt(t!==void 0?t:hd);const r=ut(i),s=Ae(i);n=n>0?n:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function yI(i,e,t,n){const r=cd(i);return pI(r,e,t,n)}function cd(i){i=Yt(i);let e=i.getExtent();if(!e){const t=180*Ur.degrees/i.getMetersPerUnit();e=lo(-t,-t,t,t)}return e}class TI extends Hp{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Vt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new Zp(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const n=this.getTileCacheForProjection(e);n&&n.expireCache(t)}forEachLoadedTile(e,t,n,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,h;for(let c=n.minX;c<=n.maxX;++c)for(let u=n.minY;u<=n.maxY;++u)l=zl(t,c,u),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===M.LOADED,h&&(h=r(a)!==!1)),h||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,s){return Ie()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Jp(e)}getTileCacheForProjection(e){const t=this.getProjection();return Ee(t===null||Wn(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=Vt(r.getTileSize(e),this.tmpSize);return s==1?o:_I(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const n=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=mI(n,e,t)),hI(e,n)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const n=this.getTileCacheForProjection(t);e>n.highWaterMark&&(n.highWaterMark=e)}useTile(e,t,n,r){}}class vI extends wn{constructor(e,t){super(e),this.tile=t}}function RI(i,e){const t=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return i.replace(t,o[0].toString()).replace(n,o[1].toString()).replace(r,o[2].toString()).replace(s,function(){const h=o[0],c=e.getFullTileRange(h);if(!c)throw new Error("The {-y} placeholder requires a tile grid with extent");return(c.getHeight()-o[2]-1).toString()})}}function xI(i,e){const t=i.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=RI(i[r],e);return wI(n)}function wI(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const r=lI(e),s=Mr(r,i.length);return i[s](e,t,n)}}function CI(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=n;s<=r;++s)e.push(i.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=n;r++)e.push(i.replace(t[0],r.toString()));return e}return e.push(i),e}class ud extends TI{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ud.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=Je(t),r=t.getState();let s;r==M.LOADING?(this.tileLoadingKeys_[n]=!0,s=Ph.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==M.ERROR?Ph.TILELOADERROR:r==M.LOADED?Ph.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new vI(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=CI(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(xI(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const r=zl(e,t,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class bI extends ud{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:II,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Fl,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const n=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==n?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==n?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Wn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Wn(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Wn(t,e)))return this.tileGrid;const n=Je(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Jp(e)),this.tileGridForProjection[n]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Wn(t,e))return this.tileCache;const n=Je(e);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Zp(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(e,t,n,r,s,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?M.IDLE:M.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(X.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,r,s){const o=this.getProjection();if(!o||!s||Wn(o,s))return this.getTileInternal(e,t,n,r,o||s);const a=this.getTileCacheForProjection(s),l=[e,t,n];let h;const c=Yn(l);a.containsKey(c)&&(h=a.get(c));const u=this.getKey();if(h&&h.key==u)return h;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(s),f=this.getTileCoordForTileUrlFunction(l,s),_=new Xl(o,d,s,g,l,f,this.getTilePixelRatio(r),this.getGutter(),(m,E,p,T)=>this.getTileInternal(m,E,p,T,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=u,h?(_.interimTile=h,_.refreshInterimChain(),a.replace(c,_)):a.set(c,_),_}getTileInternal(e,t,n,r,s){let o=null;const a=zl(e,t,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,n,r,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(e,t,n,r,s,l),h.getState()==M.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const n=Yt(e);if(n){const r=Je(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function II(i,e){i.getImage().src=e}class t0 extends bI{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:EI({extent:cd(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}function Lc(i){return Array.isArray(i)?Math.min(...i):i}class SI extends Up{constructor(e,t,n,r,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=t.getExtent();h&&t.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Mt(n,h):n,u=Di(c),d=Sc(e,t,u,r),g=td,f=new od(e,t,c,l,d*g,r),_=f.calculateSourceExtent(),m=ki(_)?null:o(_,d,s),E=m?ve.IDLE:ve.EMPTY,p=m?m.getPixelRatio():1;super(n,r,p,E),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=f,this.targetResolution_=r,this.targetExtent_=n,this.sourceImage_=m,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ve.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==ve.LOADED){const t=Ae(this.targetExtent_)/this.targetResolution_,n=ut(this.targetExtent_)/this.targetResolution_;this.canvas_=ad(t,n,this.sourcePixelRatio_,Lc(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==ve.IDLE){this.state=ve.LOADING,this.changed();const e=this.sourceImage_.getState();e==ve.LOADED||e==ve.ERROR?this.reproject_():(this.sourceListenerKey_=se(this.sourceImage_,X.CHANGE,function(t){const n=this.sourceImage_.getState();(n==ve.LOADED||n==ve.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){we(this.sourceListenerKey_),this.sourceListenerKey_=null}}const ko=4,Ah={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class LI extends wn{constructor(e,t){super(e),this.image=t}}class PI extends Hp{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const n=Ol(t,e,0);e=t[n]}return e}getImage(e,t,n,r){const s=this.getProjection();if(!s||!r||Wn(s,r))return s&&(r=s),this.getImageInternal(e,t,n,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Wn(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&wc(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new SI(s,r,e,t,n,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,n,r){if(this.loader){const s=AI(e,t,n,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&Ba(this.wantedExtent_,s)||Ba(this.image.getExtent(),s))&&(this.wantedResolution_&&Lc(this.wantedResolution_)===o||Lc(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Up(s,o,n,this.loader),this.image.addEventListener(X.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let n;switch(t.getState()){case ve.LOADING:this.loading=!0,n=Ah.IMAGELOADSTART;break;case ve.LOADED:this.loading=!1,n=Ah.IMAGELOADEND;break;case ve.ERROR:this.loading=!1,n=Ah.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new LI(n,t))}}function AI(i,e,t,n){const r=e/t,s=Di(i),o=ti(Ae(i)/r,ko),a=ti(ut(i)/r,ko),l=ti((n-1)*o/2,ko),h=o+2*l,c=ti((n-1)*a/2,ko),u=a+2*c;return $a(s,r,0,[h,u])}var MI=Object.defineProperty,OI=(i,e,t)=>e in i?MI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,si=(i,e,t)=>(OI(i,typeof e!="symbol"?e+"":e,t),t);const Pc=class Ac extends t0{constructor(e,t={}){super({tileUrlFunction:(n,r)=>`${Vt(this.tileGrid.getTileSize(n[0]))[0]*(r||1)}`,tileLoadFunction:async(n,r)=>{const s=this.getrenderFunction();if(this.tileGrid&&s){console.assert(n instanceof Fl);const o=n,a=parseInt(r),l=Math.round(a/256),h=an(a,a),c=await s(this.api,n.getTileCoord(),a,l,this.getextentBufferFactor());h.putImageData(c,0,0),t.debug&&(h.strokeStyle="grey",h.strokeRect(.5,.5,a+.5,a+.5),h.fillStyle="darkgrey",h.strokeStyle="black",h.textAlign="center",h.textBaseline="middle",h.font="20px sans-serif",h.lineWidth=2,h.strokeText(r,a/2,a/2,a),h.fillText(r,a/2,a/2,a)),o.setImage(h.canvas)}},...t}),si(this,"api"),si(this,"renderFunction"),si(this,"extentBufferFactor"),this.api=e,this.renderFunction=t.renderFunction,this.extentBufferFactor=t.extentBufferFactor}getrenderFunction(){return this.renderFunction||Ac.DEFAULT_RENDERFUNCTION}getextentBufferFactor(){return typeof this.extentBufferFactor=="function"?this.extentBufferFactor():this.extentBufferFactor||Ac.DEFAULT_EXTENTBUFFERFACTOR}};si(Pc,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r)=>i.renderXYZTile(e[1],e[2],e[0],t,n,r)),si(Pc,"DEFAULT_EXTENTBUFFERFACTOR",0);let DI=Pc;const n0=class i0 extends PI{constructor(e,t={}){super({loader:(n,r,s)=>new Promise(async o=>{var a;const l=s||window?.devicePixelRatio||1,h=r/l,c=Math.round(Ae(n)/h),u=Math.round(ut(n)/h),d=await this.getrenderFunction()(this.api,((a=this.getProjection())==null?void 0:a.getCode())||"EPSG:3857",n[0],n[1],n[2],n[3],c,u,l);o(createImageBitmap(d))}),...t}),si(this,"api"),si(this,"renderFunction"),this.api=e,this.renderFunction=t.renderFunction}getrenderFunction(){return this.renderFunction||i0.DEFAULT_RENDERFUNCTION}};si(n0,"DEFAULT_RENDERFUNCTION",(i,e,t,n,r,s,o,a,l)=>i.renderImage(e,new i.Rectangle(t,n,r,s),o,a,l));let If=n0;const bt={ADD:"add",REMOVE:"remove"},Sf={LENGTH:"length"};class Xo extends wn{constructor(e,t,n){super(e),this.element=t,this.index=n}}class mn extends Cn{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Sf.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Xo(bt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Xo(bt.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Xo(bt.REMOVE,r,e)),this.dispatchEvent(new Xo(bt.ADD,t,e))}updateLength_(){this.set(Sf.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const dd=new Array(6);function nn(){return[1,0,0,1,0,0]}function NI(i){return Bl(i,1,0,0,1,0,0)}function gd(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=e[0],h=e[1],c=e[2],u=e[3],d=e[4],g=e[5];return i[0]=t*l+r*h,i[1]=n*l+s*h,i[2]=t*c+r*u,i[3]=n*c+s*u,i[4]=t*d+r*g+o,i[5]=n*d+s*g+a,i}function Bl(i,e,t,n,r,s,o){return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i[4]=s,i[5]=o,i}function xt(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function FI(i,e){const t=Math.cos(e),n=Math.sin(e);return gd(i,Bl(dd,t,n,-n,t,0,0))}function Lf(i,e,t){return gd(i,Bl(dd,e,0,0,t,0,0))}function UI(i,e,t){return gd(i,Bl(dd,1,0,0,1,e,t))}function Ni(i,e,t,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+e,i[5]=o*r*l+a*r*h+t,i}function r0(i,e){const t=GI(e);Ee(t!==0,"Transformation matrix cannot be inverted");const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-r/t,i[2]=-s/t,i[3]=n/t,i[4]=(s*l-o*a)/t,i[5]=-(n*l-r*a)/t,i}function GI(i){return i[0]*i[3]-i[1]*i[2]}let Pf;function jI(i){const e="matrix("+i.join(", ")+")";if(Np)return e;const t=Pf||(Pf=document.createElement("div"));return t.style.transform=e,t.style.transform}const qa={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var lt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};lt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};lt.max=lt.whitepoint[2].D65;lt.rgb=function(i,e){e=e||lt.whitepoint[2].E;var t=i[0]/e[0],n=i[1]/e[1],r=i[2]/e[2],s,o,a;return s=t*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=t*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};qa.xyz=function(i,e){var t=i[0]/255,n=i[1]/255,r=i[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.41239079926595+n*.35758433938387+r*.18048078840183,o=t*.21263900587151+n*.71516867876775+r*.072192315360733,a=t*.019330818715591+n*.11919477979462+r*.95053215224966;return e=e||lt.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const s0={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var m=.0011070564598794539;return e=e||"D65",t=t||2,u=lt.whitepoint[t][e][0],d=lt.whitepoint[t][e][1],g=lt.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),n=o/(13*s)+f||0,r=a/(13*s)+_||0,h=s>8?d*Math.pow((s+16)/116,3):d*s*m,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};lt.luv=function(i,e,t){var n,r,s,o,a,l,h,c,u,d,g,f,_,m=.008856451679035631,E=903.2962962962961;e=e||"D65",t=t||2,u=lt.whitepoint[t][e][0],d=lt.whitepoint[t][e][1],g=lt.whitepoint[t][e][2],f=4*u/(u+15*d+3*g),_=9*d/(u+15*d+3*g),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var p=h/d;return s=p<=m?E*p:116*Math.pow(p,1/3)-16,o=13*s*(n-f),a=13*s*(r-_),[s,o,a]};s0.lchuv=function(i){var e=i[0],t=i[1],n=i[2],r=Math.sqrt(t*t+n*n),s=Math.atan2(n,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,r,o]};lt.lchuv=function(i){return s0.lchuv(lt.luv(i))};const Af={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Mf={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function kI(i){var e,t=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Af[i])t=Af[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",t=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),r="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=e[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=t.shift()),t=t.map(function(c,u){if(c[c.length-1]==="%")return c=parseFloat(c)/100,u===3?c:r==="rgb"?c*255:r[0]==="h"||r[0]==="l"&&!u?c*100:r==="lab"?c*125:r==="lch"?u<2?c*150:c*360:r[0]==="o"&&!u?c:r==="oklab"?c*.4:r==="oklch"?u<2?c*.4:c*360:c;if(r[u]==="h"||u===2&&r[r.length-1]==="h"){if(Mf[c]!==void 0)return Mf[c];if(c.endsWith("deg"))return parseFloat(c);if(c.endsWith("turn"))return parseFloat(c)*360;if(c.endsWith("grad"))return parseFloat(c)*360/400;if(c.endsWith("rad"))return parseFloat(c)*180/Math.PI}return c==="none"?0:parseFloat(c)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(c){return parseFloat(c)}),r=i.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:t,alpha:n}}const Mh={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+t):n+t-n*t,r=2*n-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};qa.hsl=function(i){var e=i[0]/255,t=i[1]/255,n=i[2]/255,r=Math.min(e,t,n),s=Math.max(e,t,n),o=s-r,a,l,h;return s===r?a=0:e===s?a=(t-n)/o:t===s?a=2+(n-e)/o:n===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function XI(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var e,t=kI(i);if(!t.space)return[];const n=t.space[0]==="h"?Mh.min:qa.min,r=t.space[0]==="h"?Mh.max:qa.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),r[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),r[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),r[2]),t.space[0]==="h"&&(e=Mh.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function zI(i){return typeof i=="string"?i:KI(i)}const BI=1024,cs={};let Oh=0;function o0(i){if(cs.hasOwnProperty(i))return cs[i];if(Oh>=BI){let t=0;for(const n in cs)t++&3||(delete cs[n],--Oh)}const e=XI(i);if(e.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+i+'" as color');return $I(e),cs[i]=e,++Oh,e}function Qa(i){return Array.isArray(i)?i:o0(i)}function $I(i){return i[0]=Xe(i[0]+.5|0,0,255),i[1]=Xe(i[1]+.5|0,0,255),i[2]=Xe(i[2]+.5|0,0,255),i[3]=Xe(i[3],0,1),i}function KI(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+e+","+t+","+n+","+r+")"}function VI(i){try{return o0(i),!0}catch{return!1}}class ZI{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,n){const r=Of(e,t,n);return r in this.cache_?this.cache_[r]:null}set(e,t,n,r){const s=Of(e,t,n);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function Of(i,e,t){const n=t?zI(t):"null";return e+":"+i+":"+n}const a0=new ZI,ue={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class l0 extends Cn{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[ue.OPACITY]=e.opacity!==void 0?e.opacity:1,Ee(typeof t[ue.OPACITY]=="number","Layer opacity must be a number"),t[ue.VISIBLE]=e.visible!==void 0?e.visible:!0,t[ue.Z_INDEX]=e.zIndex,t[ue.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[ue.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[ue.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[ue.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=Xe(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Ie()}getLayerStatesArray(e){return Ie()}getExtent(){return this.get(ue.EXTENT)}getMaxResolution(){return this.get(ue.MAX_RESOLUTION)}getMinResolution(){return this.get(ue.MIN_RESOLUTION)}getMinZoom(){return this.get(ue.MIN_ZOOM)}getMaxZoom(){return this.get(ue.MAX_ZOOM)}getOpacity(){return this.get(ue.OPACITY)}getSourceState(){return Ie()}getVisible(){return this.get(ue.VISIBLE)}getZIndex(){return this.get(ue.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(ue.EXTENT,e)}setMaxResolution(e){this.set(ue.MAX_RESOLUTION,e)}setMinResolution(e){this.set(ue.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(ue.MAX_ZOOM,e)}setMinZoom(e){this.set(ue.MIN_ZOOM,e)}setOpacity(e){Ee(typeof e=="number","Layer opacity must be a number"),this.set(ue.OPACITY,e)}setVisible(e){this.set(ue.VISIBLE,e)}setZIndex(e){this.set(ue.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Tt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},pt={ANIMATING:0,INTERACTING:1},Gt={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Df(i,e,t){return function(n,r,s,o,a){if(!n)return;if(!r&&!e)return n;const l=e?0:s[0]*r,h=e?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let d=i[0]+l/2+c,g=i[2]-l/2+c,f=i[1]+h/2+u,_=i[3]-h/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let m=Xe(n[0],d,g),E=Xe(n[1],f,_);if(o&&t&&r){const p=30*r;m+=-p*Math.log(1+Math.max(0,d-n[0])/p)+p*Math.log(1+Math.max(0,n[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-n[1])/p)+p*Math.log(1+Math.max(0,n[1]-_)/p)}return[m,E]}}function HI(i){return i}function fd(i,e,t,n){const r=Ae(e)/t[0],s=ut(e)/t[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function _d(i,e,t){let n=Math.min(i,e);const r=50;return n*=Math.log(1+r*Math.max(0,i/e-1))/r+1,t&&(n=Math.max(n,t),n/=Math.log(1+r*Math.max(0,t/i-1))/r+1),Xe(n,t/2,e*2)}function WI(i,e,t,n){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=t?fd(l,t,o,n):l;if(a)return e?_d(r,c,h):Xe(r,h,c);const u=Math.min(c,r),d=Math.floor(Ol(i,u,s));return i[d]>c&&d<i.length-1?i[d+1]:i[d]}}}function YI(i,e,t,n,r,s){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=r?fd(e,r,l,s):e;if(h)return n?_d(o,c,t):Xe(o,t,c);const u=1e-9,d=Math.ceil(Math.log(e/c)/Math.log(i)-u),g=-a*(.5-u)+.5,f=Math.min(c,o),_=Math.floor(Math.log(e/f)/Math.log(i)+g),m=Math.max(d,_),E=e/Math.pow(i,m);return Xe(E,t,c)}}}function Nf(i,e,t,n,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=n?fd(i,n,a,r):i;return!t||!l?Xe(s,e,h):_d(s,h,e)}}}function md(i){if(i!==void 0)return 0}function Ff(i){if(i!==void 0)return i}function qI(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function QI(i){const e=sa(5);return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function JI(i,e,t,n,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=n){const l=i[a],h=i[a+1];s[o++]=r[0]*l+r[2]*h+r[4],s[o++]=r[1]*l+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function eS(i,e,t,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let d=e;d<t;d+=n){const g=i[d]-h,f=i[d+1]-c;o[u++]=h+g*a-f*l,o[u++]=c+g*l+f*a;for(let _=d+2;_<d+n;++_)o[u++]=i[_]}return o&&o.length!=u&&(o.length=u),o}function tS(i,e,t,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const d=i[u]-l,g=i[u+1]-h;a[c++]=l+r*d,a[c++]=h+s*g;for(let f=u+2;f<u+n;++f)a[c++]=i[f]}return a&&a.length!=c&&(a.length=c),a}function nS(i,e,t,n,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Uf=nn();class iS extends Cn{constructor(){super(),this.extent_=Qr(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=c2((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Ie()}closestPointXY(e,t,n,r){return Ie()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Ie()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Ul(t),this.extentRevision_=this.getRevision()}return O2(this.extent_,e)}rotate(e,t){Ie()}scale(e,t,n){Ie()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Ie()}getType(){return Ie()}applyTransform(e){Ie()}intersectsExtent(e){return Ie()}translate(e,t){Ie()}transform(e,t){const n=Yt(e),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=ut(h)/ut(l);return Ni(Uf,h[0],h[3],c,-c,0,0,0),JI(s,0,s.length,a,Uf,o),Wa(n,t)(s,o,a)}:Wa(n,t);return this.applyTransform(r),this}}class pd extends iS{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return S2(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Ie()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Gf(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Ie()}setLayout(e,t,n){let r;if(e)r=Gf(e);else{for(let s=0;s<n;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=rS(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();eS(n,0,n.length,r,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=Di(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();tS(r,0,r.length,s,e,t,n,r),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();nS(n,0,n.length,r,e,t,n),this.changed()}}}function rS(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function Gf(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function jf(i,e,t,n,r,s,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const d=((r-a)*h+(s-l)*c)/(h*h+c*c);if(d>1)u=t;else if(d>0){for(let g=0;g<n;++g)o[g]=V2(i[e+g],i[t+g],d);o.length=n;return}else u=e}for(let d=0;d<n;++d)o[d]=i[u+d];o.length=n}function h0(i,e,t,n,r){let s=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=Ar(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function sS(i,e,t,n,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=h0(i,e,a,n,r),e=a}return r}function c0(i,e,t,n,r,s,o,a,l,h,c){if(e==t)return h;let u,d;if(r===0){if(d=Ar(o,a,i[e],i[e+1]),d<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,d}return h}c=c||[NaN,NaN];let g=e+n;for(;g<t;)if(jf(i,g-n,g,n,o,a,c),d=Ar(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n,g+=n}else g+=n*Math.max((Math.sqrt(d)-Math.sqrt(h))/r|0,1);if(jf(i,t-n,e,n,o,a,c),d=Ar(o,a,c[0],c[1]),d<h){for(h=d,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function oS(i,e,t,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,d=t.length;u<d;++u){const g=t[u];h=c0(i,e,g,n,r,s,o,a,l,h,c),e=g}return h}function aS(i,e,t,n){for(let r=0,s=t.length;r<s;++r)i[e++]=t[r];return e}function u0(i,e,t,n){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function lS(i,e,t,n,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=u0(i,e,t[o],n);r[s++]=l,e=l}return r.length=s,r}function hS(i,e,t,n,r,s,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)s[o++]=i[e],s[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),d=h.pop();let g=0;const f=i[d],_=i[d+1],m=i[u],E=i[u+1];for(let p=d+n;p<u;p+=n){const T=i[p],y=i[p+1],v=$2(T,y,f,_,m,E);v>g&&(c=p,g=v)}g>r&&(l[(c-e)/n]=1,d+n<c&&h.push(d,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[e+u*n],s[o++]=i[e+u*n+1]);return o}function ir(i,e){return e*Math.round(i/e)}function cS(i,e,t,n,r,s,o){if(e==t)return o;let a=ir(i[e],r),l=ir(i[e+1],r);e+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=ir(i[e],r),c=ir(i[e+1],r),e+=n,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=ir(i[e],r),d=ir(i[e+1],r);if(e+=n,u==h&&d==c)continue;const g=h-a,f=c-l,_=u-a,m=d-l;if(g*m==f*_&&(g<0&&_<g||g==_||g>0&&_>g)&&(f<0&&m<f||f==m||f>0&&m>f)){h=u,c=d;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=d}return s[o++]=h,s[o++]=c,o}function uS(i,e,t,n,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=cS(i,e,c,n,r,s,o),a.push(o),e=c}return o}function d0(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function dS(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=d0(i,e,l,n,r[s]),e=l}return r.length=s,r}function g0(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=o*a-s*l,s=a,o=l}return r/2}function gS(i,e,t,n){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=g0(i,e,a,n),e=a}return r}class Gs extends pd{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Gs(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,r){return r<Gp(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(h0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),c0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,r))}getArea(){return g0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return d0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=hS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Gs(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=u0(this.flatCoordinates,0,e,this.stride),this.changed()}}class Ed extends pd{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Ed(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const s=this.flatCoordinates,o=Ar(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return I2(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return jp(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=aS(this.flatCoordinates,0,e,this.stride),this.changed()}}function fS(i,e,t,n,r,s,o){let a,l,h,c,u,d,g;const f=r[s+1],_=[];for(let p=0,T=t.length;p<T;++p){const y=t[p];for(c=i[y-n],d=i[y-n+1],a=e;a<y;a+=n)u=i[a],g=i[a+1],(f<=d&&g<=f||d<=f&&f<=g)&&(h=(f-d)/(g-d)*(u-c)+c,_.push(h)),c=u,d=g}let m=NaN,E=-1/0;for(_.sort(Ju),c=_[0],a=1,l=_.length;a<l;++a){u=_[a];const p=Math.abs(u-c);p>E&&(h=(c+u)/2,Wp(i,e,t,n,h,f)&&(m=h,E=p)),c=u}return isNaN(m)&&(m=r[s]),[m,f,E]}function _S(i,e,t,n){for(;e<t-n;){for(let r=0;r<n;++r){const s=i[e+r];i[e+r]=i[t-n+r],i[t-n+r]=s}e+=n,t-=n}}function f0(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function mS(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=f0(i,e,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function kf(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=f0(i,e,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&_S(i,e,a,n),e=a}return e}class js extends pd{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?l2(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new js(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<Gp(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(sS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),oS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,r))}containsXY(e,t){return Wp(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return gS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),kf(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,dS(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=Di(this.getExtent());this.flatInteriorPoint_=fS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ed(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Gs(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new Gs(t.slice(s,l),e);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;mS(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=kf(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=uS(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new js(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return fI(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=lS(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Xf(i){if(ki(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],r=i[3],s=[e,t,e,r,n,r,n,t,e,t];return new js(s,"XY",[s.length])}const Dh=0;class Xt extends Cn{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=rd(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Q2(),e.center&&(e.center=gn(e.center,this.projection_)),e.extent&&(e.extent=ni(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in Gt)delete t[a];this.setProperties(t,!0);const n=ES(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const r=pS(e),s=n.constraint,o=yS(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=gn(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=gn(r.anchor,this.getProjection())),t[n]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===t){n&&zo(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<t;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||f2,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const d=Mr(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}TS(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(pt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[pt.ANIMATING]>0}getInteracting(){return this.hints_[pt.INTERACTING]>0}cancelAnimations(){this.setHint(pt.ANIMATING,-this.hints_[pt.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const r=this.animations_[t];if(r[0].callback&&zo(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const m=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[m,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Mr(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(pt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&zo(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-t[0],r[1]-t[1]],nd(n,e-this.getRotation()),Z2(n,t)),n}calculateCenterZoom(e,t){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],r=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Ic(e,this.getProjection())}getCenterInternal(){return this.get(Gt.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return iI(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Ee(t,"The view center is not defined");const n=this.getResolution();Ee(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return Ee(r!==void 0,"The view rotation is not defined"),$a(t,n,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(Gt.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(ni(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Ae(e)/t[0],r=ut(e)/t[1];return Math.max(n,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(t/n)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(Gt.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/t;return function(o){return Math.log(n/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=Nh(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,n)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,r;if(this.resolutions_){const s=Ol(this.resolutions_,e,1);t=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(n/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=Xe(Math.floor(e),0,this.resolutions_.length-2),n=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(n,Xe(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(Ee(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Ee(!ki(e),"Cannot fit empty extent provided as `geometry`");const r=ni(e,this.getProjection());n=Xf(r)}else if(e.getType()==="Circle"){const r=ni(e.getExtent(),this.getProjection());n=Xf(r),n.rotate(this.getRotation(),Di(r))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,d=s.length;u<d;u+=o){const g=s[u]*n-s[u+1]*r,f=s[u]*r+s[u+1]*n;a=Math.min(a,g),l=Math.min(l,f),h=Math.max(h,g),c=Math.max(c,f)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),d=Di(a);d[0]+=(r[1]-r[3])/2*l,d[1]+=(r[0]-r[2])/2*l;const g=d[0]*u-d[1]*c,f=d[1]*u+d[0]*c,_=this.getConstrainedCenter([g,f],l),m=t.callback?t.callback:ka;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},m):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),zo(m,!0))}centerOn(e,t,n){this.centerOnInternal(gn(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(Nh(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=Nh(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,n);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Ic(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&gn(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,n);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=gn(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&gn(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(Gt.ROTATION)!==r&&this.set(Gt.ROTATION,r),this.get(Gt.RESOLUTION)!==o&&(this.set(Gt.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Gt.CENTER)||!Za(this.get(Gt.CENTER),a))&&this.set(Gt.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Za(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:qr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(pt.INTERACTING,1)}endInteraction(e,t,n){n=n&&gn(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(pt.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function zo(i,e){setTimeout(function(){i(e)},0)}function pS(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Df(i.extent,i.constrainOnlyCenter,t)}const e=rd(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Df(t,!1,!1)}return HI}function ES(i){let e,t,n,o=i.minZoom!==void 0?i.minZoom:Dh,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,d=rd(i.projection,"EPSG:3857"),g=d.getExtent();let f=i.constrainOnlyCenter,_=i.extent;if(!h&&!_&&d.isGlobal()&&(f=!1,_=g),i.resolutions!==void 0){const m=i.resolutions;t=m[o],n=m[a]!==void 0?m[a]:m[m.length-1],i.constrainResolution?e=WI(m,c,!f&&_,u):e=Nf(t,n,c,!f&&_,u)}else{const E=(g?Math.max(Ae(g),ut(g)):360*Ur.degrees/d.getMetersPerUnit())/hd/Math.pow(2,Dh),p=E/Math.pow(2,28-Dh);t=i.maxResolution,t!==void 0?o=0:t=E/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(l,a):n=E/Math.pow(l,a):n=p),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),i.constrainResolution?e=YI(l,t,n,c,!f&&_,u):e=Nf(t,n,c,!f&&_,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function yS(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const t=i.constrainRotation;return t===void 0||t===!0?QI():t===!1?Ff:typeof t=="number"?qI(t):Ff}return md}function TS(i){return!(i.sourceCenter&&i.targetCenter&&!Za(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Nh(i,e,t,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}class vS extends l0{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(ue.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(ue.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(we(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=se(e,X.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof Xt?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(o=>o.layer===this):r=this.getLayerState();const s=this.getExtent();return yd(r,t.viewState)&&(!s||ho(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const n=this.getSource();if(n&&(t=n.getAttributions()),!t)return[];const r=e instanceof Xt?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(ue.MAP,e)}getMapInternal(){return this.get(ue.MAP)}setMap(e){this.mapPrecomposeKey_&&(we(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(we(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=se(e,Tt.PRECOMPOSE,function(t){const r=t.frameState.layerStatesArray,s=this.getLayerState(!1);Ee(!r.some(function(o){return o.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=se(this,X.CHANGE,e.render,e),this.changed())}setSource(e){this.set(ue.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function yd(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}const $l=vS;class RS extends Ml{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Ie()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Ni(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),r0(r,n)}forEachFeatureAtCoordinate(e,t,n,r,s,o,a,l){let h;const c=t.viewState;function u(y,v,x,R){return s.call(o,v,y?x:null,R)}const d=c.projection,g=W2(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&r){const y=d.getExtent(),v=Ae(y);f.push([-v,0],[v,0])}const _=t.layerStatesArray,m=_.length,E=[],p=[];for(let y=0;y<f.length;y++)for(let v=m-1;v>=0;--v){const x=_[v],R=x.layer;if(R.hasRenderer()&&yd(x,c)&&a.call(l,R)){const w=R.getRenderer(),C=R.getSource();if(w&&C){const b=C.getWrapX()?g:e,O=u.bind(null,x.managed);p[0]=b[0]+f[y][0],p[1]=b[1]+f[y][1],h=w.forEachFeatureAtCoordinate(p,t,n,O,E)}if(h)return h}}if(E.length===0)return;const T=1/E.length;return E.forEach((y,v)=>y.distanceSq+=v*T),E.sort((y,v)=>y.distanceSq-v.distanceSq),E.some(y=>h=y.callback(y.feature,y.layer,y.geometry)),h}hasFeatureAtCoordinate(e,t,n,r,s,o){return this.forEachFeatureAtCoordinate(e,t,n,r,ja,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){Ie()}flushDeclutterItems(e){}scheduleExpireIconCache(e){a0.canExpireCache()&&e.postRenderFunctions.push(xS)}}function xS(i,e){a0.expire()}class vs extends wn{constructor(e,t,n,r){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=r}}const Bo="ol-hidden",es="ol-unselectable",zf="ol-unsupported",Kl="ol-control",Bf="ol-collapsed",wS=new Cn;class CS extends RS{constructor(e){super(e),this.fontChangeListenerKey_=se(wS,Us.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=es+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new vs(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){we(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Tt.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=e.viewState;this.children_.length=0;const r=this.declutterLayers_;r.length=0;let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const h=l.layer,c=h.getSourceState();if(!yd(l,n)||c!="ready"&&c!="undefined"){h.unrender();continue}const u=h.render(e,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in h&&r.push(h))}this.flushDeclutterItems(e),R2(this.element_,this.children_),this.dispatchRenderEvent(Tt.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}flushDeclutterItems(e){const t=this.declutterLayers_;for(let n=t.length-1;n>=0;--n)t[n].renderDeclutter(e);t.length=0}}class $n extends wn{constructor(e,t){super(e),this.layer=t}}const Fh={LAYERS:"layers"};class ts extends l0{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Fh.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new mn(n.slice(),{unique:!0}):Ee(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new mn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(we),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(se(e,bt.ADD,this.handleLayersAdd_,this),se(e,bt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(we);oo(this.listenerKeys_);const t=e.getArray();for(let n=0,r=t.length;n<r;n++){const s=t[n];this.registerLayerListeners_(s),this.dispatchEvent(new $n("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[se(e,Us.PROPERTYCHANGE,this.handleLayerChange_,this),se(e,X.CHANGE,this.handleLayerChange_,this)];e instanceof ts&&t.push(se(e,"addlayer",this.handleLayerGroupAdd_,this),se(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Je(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new $n("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new $n("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new $n("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=Je(t);this.listenerKeys_[n].forEach(we),delete this.listenerKeys_[n],this.dispatchEvent(new $n("removelayer",t)),this.changed()}getLayers(){return this.get(Fh.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new $n("removelayer",n[r]))}this.set(Fh.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=Mt(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}class Er extends wn{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}class kn extends Er{constructor(e,t,n,r,s,o){super(e,t,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const De={SINGLECLICK:"singleclick",CLICK:X.CLICK,DBLCLICK:X.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Mc={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class bS extends ao{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=se(n,Mc.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=se(n,Mc.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(X.TOUCHMOVE,this.boundHandleTouchMove_,Fp?{passive:!1}:!1)}emulateClick_(e){let t=new kn(De.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new kn(De.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new kn(De.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==De.POINTERUP||t.type==De.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==De.POINTERDOWN||t.type==De.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new kn(De.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(we),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new kn(De.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(se(n,De.POINTERMOVE,this.handlePointerMove_,this),se(n,De.POINTERUP,this.handlePointerUp_,this),se(this.element_,De.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(se(this.element_.getRootNode(),De.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new kn(De.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new kn(De.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(we(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(X.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(we(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(we),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Xn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},$e={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Ja=1/0;class IS{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,oo(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){Ee(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Ja?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,r=t.length,s=t[e],o=n[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<r&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=s,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,r=this.priorities_,s=n[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)n[t]=n[a],r[t]=r[a],t=a;else break}n[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==Ja?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,t[r++]=o);t.length=r,n.length=r,this.heapify_()}}class SS extends IS{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(X.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===M.LOADED||n===M.ERROR||n===M.EMPTY){n!==M.ERROR&&t.removeEventListener(X.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0,r,s,o;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),r=s.getState(),r===M.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}function LS(i,e,t,n,r){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return Ja;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class go extends Cn{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Rc(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Rc(this.element);for(let t=0,n=this.listenerKeys.length;t<n;++t)we(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ka&&this.listenerKeys.push(se(e,Xn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class PS extends go{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(X.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+es+" "+Kl+(this.collapsed_&&this.collapsible_?" "+Bf:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Dl(t,this.renderedAttributions_)){v2(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Bf),this.collapsed_?Xa(this.collapseLabel_,this.label_):Xa(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class AS extends go{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(X.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+es+" "+Kl,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Bo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:qr}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Bo);!s&&n===0?this.element.classList.add(Bo):s&&n!==0&&this.element.classList.remove(Bo)}this.label_.style.transform=r}this.rotation_=n}}class MS extends go{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(X.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(X.CLICK,this.handleClick_.bind(this,-n),!1);const d=t+" "+es+" "+Kl,g=this.element;g.className=d,g.appendChild(c),g.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const r=n.getZoom();if(r!==void 0){const s=n.getConstrainedZoom(r+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:qr})):n.setZoom(s)}}}function Td(i){i=i||{};const e=new mn;return(i.zoom!==void 0?i.zoom:!0)&&e.push(new MS(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&e.push(new AS(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&e.push(new PS(i.attributionOptions)),e}const $f={ACTIVE:"active"};class fo extends Cn{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get($f.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set($f.ACTIVE,e)}setMap(e){this.map_=e}}function OS(i,e,t){const n=i.getCenterInternal();if(n){const r=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:_2,center:i.getConstrainedCenter(r)})}}function vd(i,e,t,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+e),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:qr})}class DS extends fo{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==De.DBLCLICK){const n=e.originalEvent,r=e.map,s=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();vd(a,o,s,this.duration_),n.preventDefault(),t=!0}return!t}}class _o extends fo{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==De.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==De.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==De.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==De.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Rd(i){const e=i.length;let t=0,n=0;for(let r=0;r<e;r++)t+=i[r].clientX,n+=i[r].clientY;return{clientX:t/e,clientY:n/e}}function Oc(i){const e=arguments;return function(t){let n=!0;for(let r=0,s=e.length;r<s&&(n=n&&e[r](t),!!n);++r);return n}}const NS=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},FS=function(i){const e=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return e.contains(t)},_0=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?FS(i):!0},US=ja,m0=function(i){const e=i.originalEvent;return e.button==0&&!(y2&&Op&&e.ctrlKey)},p0=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},GS=function(i){const e=i.originalEvent;return Op?e.metaKey:e.ctrlKey},jS=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},E0=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Uh=function(i){const e=i.originalEvent;return Ee(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},kS=function(i){const e=i.originalEvent;return Ee(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class XS extends _o{constructor(e){super({stopDown:Nl}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Oc(p0,kS);this.condition_=e.onFocusOnly?Oc(_0,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,r=t.getEventPixel(Rd(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=e.map.getView();H2(s,a.getResolution()),nd(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:qr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class zS extends _o{constructor(e){e=e||{},super({stopDown:Nl}),this.condition_=e.condition?e.condition:NS,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Uh(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===md)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Uh(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Uh(e)&&m0(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class BS extends Ml{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+n,r.top=Math.min(e[1],t[1])+n,r.width=Math.abs(t[0]-e[0])+n,r.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new js([r])}getGeometry(){return this.geometry_}}const $o={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Gh extends wn{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class $S extends _o{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new BS(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:m0,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Gh($o.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Gh(t?$o.BOXEND:$o.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Gh($o.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class KS extends $S{constructor(e){e=e||{};const t=e.condition?e.condition:jS;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(r),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;r=r.clone(),r.scale(a*a)}n.fitInternal(r,{duration:this.duration_,easing:qr})}}const mi={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class VS extends fo{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return p0(t)&&E0(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==X.KEYDOWN){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==mi.DOWN||r==mi.LEFT||r==mi.RIGHT||r==mi.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;r==mi.DOWN?h=-a:r==mi.LEFT?l=-a:r==mi.RIGHT?l=a:h=a;const c=[l,h];nd(c,o.getRotation()),OS(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}class ZS extends fo{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!GS(t)&&E0(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==X.KEYDOWN||e.type==X.KEYPRESS){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();vd(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}class HS{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class WS extends fo{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:US;this.condition_=e.onFocusOnly?Oc(_0,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==X.WHEEL)return!0;const n=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==X.WHEEL&&(s=r.deltaY,m2&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Dp),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-Xe(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),vd(t,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class YS extends _o{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Nl),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==md&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Rd(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class qS extends _o{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Nl),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Rd(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function QS(i){i=i||{};const e=new mn,t=new HS(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&e.push(new zS),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&e.push(new DS({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&e.push(new XS({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&e.push(new YS),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&e.push(new qS({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(e.push(new VS),e.push(new ZS({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&e.push(new WS({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&e.push(new KS({duration:i.zoomDuration})),e}function y0(i){if(i instanceof $l){i.setMapInternal(null);return}i instanceof ts&&i.getLayers().forEach(y0)}function T0(i,e){if(i instanceof $l){i.setMapInternal(e);return}if(i instanceof ts){const t=i.getLayers().getArray();for(let n=0,r=t.length;n<r;++n)T0(t[n],e)}}let v0=class extends Cn{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=JS(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Dp,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=nn(),this.pixelToCoordinateTransform_=nn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||Td(),this.interactions=t.interactions||QS({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new SS(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener($e.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener($e.VIEW,this.handleViewChanged_),this.addChangeListener($e.SIZE,this.handleSizeChanged_),this.addChangeListener($e.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof Xt)&&e.view.then(function(r){n.setView(new Xt(r))}),this.controls.addEventListener(bt.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(bt.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(bt.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(bt.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(bt.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(bt.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){T0(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:ja,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(r){n.push(r)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(r){r instanceof ts?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:ja,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=n.width/r[0],o=n.height/r[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/s,(a.clientY-n.top)/o]}getTarget(){return this.get($e.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Ic(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?xt(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get($e.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof mn){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const r=e[t];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=gn(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?xt(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get($e.SIZE)}getView(){return this.get($e.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,r){return LS(this.frameState_,e,t,n,r)}handleBrowserEvent(e,t){t=t||e.type;const n=new kn(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===Mc.POINTERDOWN||n===X.WHEEL||n===X.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===r?r.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,s=r;if(e){const o=e.viewHints;if(o[pt.ANIMATING]||o[pt.INTERACTING]){const a=Date.now()-e.time>8;r=a?0:8,s=a?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(Tt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Tt.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Er(Xn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Er(Xn.LOADSTART,this,e))));const n=this.postRenderFunctions_;for(let r=0,s=n.length;r<s;++r)n[r](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,r=this.targetChangeHandlerKeys_.length;n<r;++n)we(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(X.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(X.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Rc(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CS(this)),this.mapBrowserEventHandler_=new bS(this,this.moveTolerance_);for(const s in De)this.mapBrowserEventHandler_.addEventListener(De[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(X.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(X.WHEEL,this.boundHandleBrowserEvent_,Fp?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[se(n,X.KEYDOWN,this.handleBrowserEvent,this),se(n,X.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(we(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(we(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=se(e,Us.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=se(e,X.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(we),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new $n("addlayer",e)),this.layerGroupPropertyListenerKeys_=[se(e,Us.PROPERTYCHANGE,this.render,this),se(e,X.CHANGE,this.render,this),se(e,"addlayer",this.handleLayerAdd_,this),se(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const e=this.frameState_;e&&this.renderer_.flushDeclutterItems(e)}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){y0(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),r=this.frameState_;let s=null;if(t!==void 0&&bf(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:$a(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Je(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=$a(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!ki(this.previousExtent_)&&!wc(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Er(Xn.MOVESTART,this,r)),this.previousExtent_=Ul(this.previousExtent_)),this.previousExtent_&&!s.viewHints[pt.ANIMATING]&&!s.viewHints[pt.INTERACTING]&&!wc(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Er(Xn.MOVEEND,this,s)),b2(s.extent,this.previousExtent_))),this.dispatchEvent(new Er(Xn.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Xn.LOADSTART)||this.hasListener(Xn.LOADEND)||this.hasListener(Tt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new $n("removelayer",t)),this.set($e.LAYERGROUP,e)}setSize(e){this.set($e.SIZE,e)}setTarget(e){this.set($e.TARGET,e)}setView(e){if(!e||e instanceof Xt){this.set($e.VIEW,e);return}this.set($e.VIEW,new Xt);const t=this;e.then(function(n){t.setView(new Xt(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),s=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[s,o],!bf(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Bp("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!Dl(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function JS(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new ts({layers:i.layers});t[$e.LAYERGROUP]=n,t[$e.TARGET]=i.target,t[$e.VIEW]=i.view instanceof Xt?i.view:new Xt;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new mn(i.controls.slice()):(Ee(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new mn(i.interactions.slice()):(Ee(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new mn(i.overlays.slice()):(Ee(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new mn,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const Ko={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class eL extends $l{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(Ko.PRELOAD)}setPreload(e){this.set(Ko.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Ko.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Ko.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}function el(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Dc(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}let rr=null;function tL(i){rr||(rr=an(i.width,i.height,void 0,{willReadFrequently:!0}));const e=rr.canvas,t=i.width;e.width!==t&&(e.width=t);const n=i.height;return e.height!==n&&(e.height=n),rr.clearRect(0,0,t,n),rr.drawImage(i,0,0),rr.getImageData(0,0,t,n).data}const nL=[256,256];class R0 extends ed{constructor(e){const t=M.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null}getSize(){if(this.size_)return this.size_;const e=el(this.data_);return e?[e.width,e.height]:nL}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==M.IDLE&&this.state!==M.ERROR)return;this.state=M.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=M.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=M.ERROR,e.changed()})}}class x0 extends R0{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8Array(4)),interpolate:e.interpolate,transition:e.transition}),this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),n=this.targetTileGrid_.getExtent();let r=this.sourceTileGrid_.getExtent();const s=n?Mt(t,n):t;if(Fs(s)===0){this.state=M.EMPTY;return}const o=e.sourceProj,a=o.getExtent();a&&(r?r=Mt(r,a):r=a);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),h=e.targetProj,c=Kp(o,h,s,l);if(!isFinite(c)||c<=0){this.state=M.EMPTY;return}const u=e.errorThreshold!==void 0?e.errorThreshold:td;if(this.triangulation_=new od(o,h,s,r,c*u,l),this.triangulation_.getTriangles().length===0){this.state=M.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(c);let d=this.triangulation_.calculateSourceExtent();if(r&&(o.canWrapX()?(d[1]=Xe(d[1],r[1],r[3]),d[3]=Xe(d[3],r[1],r[3])):d=Mt(d,r)),!Fs(d))this.state=M.EMPTY;else{const g=this.sourceTileGrid_.getTileRangeForExtentAndZ(d,this.sourceZ_),f=e.getTileFunction;for(let _=g.minX;_<=g.maxX;_++)for(let m=g.minY;m<=g.maxY;m++){const E=f(this.sourceZ_,_,m,this.pixelRatio_);E&&this.sourceTiles_.push(E)}this.sourceTiles_.length===0&&(this.state=M.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{if(!t||t.getState()!==M.LOADED)return;const n=t.getSize(),r=this.gutter_;let s;const o=Dc(t.getData());o?s=o:s=tL(el(t.getData()));const a=[n[0]+2*r,n[1]+2*r],l=s instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=new c(s.buffer),d=c.BYTES_PER_ELEMENT,g=d*u.length/h,f=u.byteLength/a[1],_=Math.floor(f/d/a[0]),m=h*_;let E=u;if(u.length!==m){E=new c(m);let p=0,T=0;const y=a[0]*_;for(let v=0;v<a[1];++v){for(let x=0;x<y;++x)E[p++]=u[T+x];T+=f/d}}e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),data:new Uint8Array(E.buffer),dataType:c,bytesPerPixel:g,pixelSize:a})}),this.sourceTiles_.length=0,e.length===0)this.state=M.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);let h,c;const u=e[0].bytesPerPixel,d=Math.ceil(u/3);for(let g=d-1;g>=0;--g){const f=[];for(let y=0,v=e.length;y<v;++y){const x=e[y],R=x.data,w=x.pixelSize,C=w[0],b=w[1],O=an(C,b,yn),J=O.createImageData(C,b),z=J.data;let U=g*3;for(let G=0,W=z.length;G<W;G+=4)z[G]=R[U],z[G+1]=R[U+1],z[G+2]=R[U+2],z[G+3]=255,U+=u;O.putImageData(J,0,0),f.push({extent:x.extent,image:O.canvas})}const _=ad(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,f,this.gutter_,!1,!1);for(let y=0,v=f.length;y<v;++y){const R=f[y].image.getContext("2d");Ds(R),yn.push(R.canvas)}const m=_.getContext("2d"),E=m.getImageData(0,0,_.width,_.height);Ds(m),yn.push(_),h||(c=new Uint8Array(u*E.width*E.height),h=new e[0].dataType(c.buffer));const p=E.data;let T=g*3;for(let y=0,v=p.length;y<v;y+=4)p[y+3]===255?(c[T]=p[y],c[T+1]=p[y+1],c[T+2]=p[y+2]):(c[T]=0,c[T+1]=0,c[T+2]=0),T+=u}this.reprojData_=h,this.reprojSize_=[Math.round(r*this.pixelRatio_),Math.round(s*this.pixelRatio_)],this.state=M.LOADED}this.changed()}load(){if(this.state!==M.IDLE&&this.state!==M.ERROR)return;this.state=M.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const n=t.getState();if(n!==M.IDLE&&n!==M.LOADING)return;e++;const r=se(t,X.CHANGE,function(){const s=t.getState();(s==M.LOADED||s==M.ERROR||s==M.EMPTY)&&(we(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t){t.getState()==M.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(we),this.sourcesListenerKeys_=null}}class iL extends ao{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter_=e.gutter||0,this.helper_=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(X.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===M.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Fl){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(X.CHANGE,this.handleTileChange_)}}uploadTile(){Ie()}setReady(){this.ready=!0,this.dispatchEvent(X.CHANGE)}handleTileChange_(){this.tile.getState()===M.LOADED&&(this.loaded=!0,this.uploadTile())}disposeInternal(){this.tile.removeEventListener(X.CHANGE,this.handleTileChange_)}}const xd=34962,wd=34963,rL=35040,Cd=35044,sL=35048,oL=5121,aL=5123,lL=5125,w0=5126,Kf=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function hL(i,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!E2},e);const t=Kf.length;for(let n=0;n<t;++n)try{const r=i.getContext(Kf[n],e);if(r)return r}catch{}return null}const cL={STATIC_DRAW:Cd,STREAM_DRAW:rL,DYNAMIC_DRAW:sL};class C0{constructor(e,t){this.array_=null,this.type_=e,Ee(e===xd||e===wd,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:cL.STATIC_DRAW}ofSize(e){return this.array_=new(jh(this.type_))(e),this}fromArray(e){return this.array_=jh(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(jh(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function jh(i){switch(i){case xd:return Float32Array;case wd:return Uint32Array;default:return Float32Array}}function b0(i,e,t){const n=t?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function uL(i,e,t,n){b0(i,e,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)}function Vf(i,e,t,n,r,s){const o=i.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),b0(o,e,s&&l);const h=t.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(r){case 1:{u=o.LUMINANCE;break}case 2:{u=o.LUMINANCE_ALPHA;break}case 3:{u=o.RGB;break}case 4:{u=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${r}`)}const d=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,c),o.texImage2D(o.TEXTURE_2D,0,u,n[0],n[1],0,u,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,d)}let yr=null;function dL(){yr=an(1,1,void 0,{willReadFrequently:!0})}class gL extends iL{constructor(e){super(e),this.textures=[],this.renderSize_=Vt(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new C0(xd,Cd);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}uploadTile(){const e=this.helper_,t=e.getGL(),n=this.tile;this.textures.length=0;let r;n instanceof Fl||n instanceof Xl?r=n.getImage():r=n.getData();const s=el(r);if(s){const p=t.createTexture();this.textures.push(p),this.bandCount=4,uL(t,p,s,n.interpolate),this.setReady();return}r=Dc(r);const o=n.getSize(),a=[o[0]+2*this.gutter_,o[1]+2*this.gutter_],l=r instanceof Float32Array,h=a[0]*a[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,d=r.byteLength/a[1];this.bandCount=Math.floor(d/u/a[0]);const g=Math.ceil(this.bandCount/4);if(g===1){const p=t.createTexture();this.textures.push(p),Vf(e,p,r,a,this.bandCount,n.interpolate),this.setReady();return}const f=new Array(g);for(let p=0;p<g;++p){const T=t.createTexture();this.textures.push(T);const y=p<g-1?4:(this.bandCount-1)%4+1;f[p]=new c(h*y)}let _=0,m=0;const E=a[0]*this.bandCount;for(let p=0;p<a[1];++p){for(let T=0;T<E;++T){const y=r[m+T],v=Math.floor(_/this.bandCount),x=T%this.bandCount,R=Math.floor(x/4),w=f[R],C=w.length/h,b=x%4;w[v*C+b]=y,++_}m+=d/u}for(let p=0;p<g;++p){const T=this.textures[p],y=f[p],v=y.length/h;Vf(e,T,y,a,v,n.interpolate)}this.setReady()}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(X.CHANGE,this.handleTileChange_)}getImagePixelData_(e,t,n){const r=this.gutter_,s=this.renderSize_[0],o=this.renderSize_[1];yr||dL(),yr.clearRect(0,0,1,1);const a=e.width,l=e.height,h=a-2*r,c=l-2*r,u=r+Math.floor(h*(t/s)),d=r+Math.floor(c*(n/o));let g;try{yr.drawImage(e,u,d,1,1,0,0,1,1),g=yr.getImageData(0,0,1,1).data}catch{return yr=null,null}return g}getArrayPixelData_(e,t,n,r){const s=this.gutter_,o=this.renderSize_[0],a=this.renderSize_[1],l=t[0],h=t[1],c=l+2*s,u=h+2*s,d=s+Math.floor(l*(n/o)),g=s+Math.floor(h*(r/a));if(e instanceof DataView){const _=e.byteLength/(c*u),m=_*(g*c+d),E=e.buffer.slice(m,m+_);return new DataView(E)}const f=this.bandCount*(g*c+d);return e.slice(f,f+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof R0){const n=this.tile.getData(),r=Dc(n);if(r){const s=this.tile.getSize();return this.getArrayPixelData_(r,s,e,t)}return this.getImagePixelData_(el(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}class I0 extends uo{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return Ie()}getData(e){return null}prepareFrame(e){return Ie()}renderFrame(e,t){return Ie()}loadedTileCallback(e,t,n){e[t]||(e[t]={}),e[t][n.tileCoord.toString()]=n}createLoadedTileFinder(e,t,n){return(r,s)=>{const o=this.loadedTileCallback.bind(this,n,r);return e.forEachLoadedTile(t,r,s,o)}}forEachFeatureAtCoordinate(e,t,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===ve.LOADED||t.getState()===ve.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=ve.LOADED&&t!=ve.ERROR&&e.addEventListener(X.CHANGE,this.boundHandleImageChange_),t==ve.IDLE&&(e.load(),t=e.getState()),t==ve.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Vo={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},fL=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,_L=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Zf{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||fL),t.compileShader(n);const r=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,e.fragmentShader||_L),t.compileShader(r),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,r),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const r=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,h=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,r,s,n[0],n[1],o,a,l,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,r){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Je(s.canvas);if(!e.renderTargets[l]){const h=s.getContextAttributes();h&&h.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[l]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),r&&r(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,r=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${r}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,r++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}function S0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function L0(i,e){return i[0]=e[0],i[1]=e[1],i[4]=e[2],i[5]=e[3],i[12]=e[4],i[13]=e[5],i}const Mn={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},_s={UNSIGNED_BYTE:oL,UNSIGNED_SHORT:aL,UNSIGNED_INT:lL,FLOAT:w0},tl={};function Hf(i){return"shared/"+i}let Wf=0;function mL(){const i="unique/"+Wf;return Wf+=1,i}function pL(i){let e=tl[i];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:hL(t)},tl[i]=e}return e.users+=1,e.context}function EL(i){const e=tl[i];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const r=t.canvas;r.width=1,r.height=1,delete tl[i]}class yL extends Ml{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Hf(e.canvasCacheKey):mL(),this.gl_=pL(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Vo.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Vo.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=nn(),this.offsetScaleMatrix_=nn(),this.tmpMat4_=S0(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new Zf({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Zf({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Hf(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=Je(e);let r=this.bufferCache_[n];if(!r){const s=t.createBuffer();r={buffer:e,webGlBuffer:s},this.bufferCache_[n]=r}t.bindBuffer(e.getType(),r.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.gl_,n=Je(e),r=this.bufferCache_[n];r&&!t.isContextLost()&&t.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Vo.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Vo.RESTORED,this.boundHandleWebGLContextRestored_),EL(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const r=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),n?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}bindTexture(e,t,n){const r=this.gl_;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.uniform1i(this.getUniformLocation(n),t)}prepareDrawToRenderTarget(e,t,n,r){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),r?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const r=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,r,a)}finalizeDraw(e,t,n){for(let r=0,s=this.postProcessPasses_.length;r<s;r++)r===s-1?this.postProcessPasses_[r].apply(e,null,t,n):this.postProcessPasses_[r].apply(e,this.postProcessPasses_[r+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,r=e.pixelRatio;this.setUniformFloatValue(Mn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Mn.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Mn.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Mn.PIXEL_RATIO,r),this.setUniformFloatVec2(Mn.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(Mn.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(Mn.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(Mn.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,r=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,r,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(n instanceof HTMLImageElement)||n.complete)&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),r++;else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,L0(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const n=this.gl_,r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r}getProgram(e,t){const n=this.gl_,r=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(r,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=Je(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=Je(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,r=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Ni(t,0,0,2/(s*n[0]),2/(s*n[1]),-r,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,r,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,r,s))}enableAttributes(e){const t=TL(e);let n=0;for(let r=0;r<e.length;r++){const s=e[r];this.enableAttributeArray_(s.name,s.size,s.type||w0,t,n),n+=s.size*P0(s.type)}}handleWebGLContextLost(e){oo(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n){const r=this.gl_;n=n||r.createTexture();const s=0,o=r.RGBA,a=0,l=r.RGBA,h=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,n),t?r.texImage2D(r.TEXTURE_2D,s,o,l,h,t):r.texImage2D(r.TEXTURE_2D,s,o,e[0],e[1],a,l,h,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),n}}function TL(i){let e=0;for(let t=0;t<i.length;t++){const n=i[t];e+=n.size*P0(n.type)}return e}function P0(i){switch(i){case _s.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case _s.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case _s.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case _s.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class bd extends I0{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=nn(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(ue.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Tt.PRECOMPOSE)){const r=new vs(Tt.PRECOMPOSE,void 0,t,e);n.dispatchEvent(r)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(Tt.POSTCOMPOSE)){const r=new vs(Tt.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(r)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,r;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,h=l.getRenderer();if(!(h instanceof bd)){t=!0;continue}const c=l.getClassName();if((t||c!==r)&&(n+=1,t=!1),r=c,h===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new yL({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),r&&(this.helper.getCanvas().className=r),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){Ni(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new vs(e,this.inversePixelTransform_,n,t);r.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(Tt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Tt.POSTRENDER,e,t)}}const vL={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"},RL={};function Yf(i){return 1/(i+2)}function xL(){return{tileIds:new Set,representationsByZ:{}}}function qf(i,e){return i.tileIds.has(Je(e))}function Qf(i,e,t){const n=i.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),i.tileIds.add(Je(e.tile))}function kh(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=Mt(e,ni(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(e=Mt(e,r))}return e}function Nc(i,e){return`${i.getKey()},${Yn(e)}`}class wL extends bd{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=nn(),this.tempMat4=S0(),this.tempTileRange_=new ld(0,0,0,0),this.tempTileCoord_=Ya(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Vp(n),this.frameState=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}isDrawableTile_(e){const t=this.getLayer(),n=e.getState(),r=t.getUseInterimTilesOnError();return n==M.LOADED||n==M.EMPTY||n==M.ERROR&&!r}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||ki(kh(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return Ie()}enqueueTiles(e,t,n,r,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=l.getGutterForProjection(o.projection),u=Je(l);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],g=this.tileRepresentationCache,f=a.getMapInternal(),_=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let m=n;m>=_;--m){const E=h.getTileRangeForExtentAndZ(t,m,this.tempTileRange_),p=h.getResolution(m);for(let T=E.minX;T<=E.maxX;++T)for(let y=E.minY;y<=E.maxY;++y){const v=Ya(m,T,y,this.tempTileCoord_),x=Nc(l,v);let R,w;if(g.containsKey(x)&&(R=g.get(x),w=R.tile),(!R||R.tile.key!==l.getKey())&&(w=l.getTile(m,T,y,e.pixelRatio,o.projection)),qf(r,w))continue;if(!R)R=this.createTileRepresentation({tile:w,grid:h,helper:this.helper,gutter:c}),g.set(x,R);else if(this.isDrawableTile_(w))R.setTile(w);else{const b=w.getInterimTile();R.setTile(b)}Qf(r,R,m);const C=w.getKey();d[C]=!0,w.getState()===M.IDLE&&(e.tileQueue.isKeyQueued(C)||e.tileQueue.enqueue([w,u,h.getTileCoordCenter(v),p]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,r,s,o,a,l,h,c,u){}renderTileMask(e,t,n,r){}drawTile_(e,t,n,r,s,o,a){if(!t.ready)return;const h=t.tile.tileCoord,c=Yn(h),u=c in o?o[c]:1,d=a.getResolution(n),g=Vt(a.getTileSize(n),this.tempSize_),f=a.getOrigin(n),_=a.getTileCoordExtent(h),m=u<1?-1:Yf(n);u<1&&(e.animate=!0);const E=e.viewState,p=E.center[0],T=E.center[1],y=g[0]+2*r,v=g[1]+2*r,x=y/v,R=(p-f[0])/(g[0]*d),w=(f[1]-T)/(g[1]*d),C=E.resolution/d,b=h[1],O=h[2];NI(this.tileTransform_),Lf(this.tileTransform_,2/(e.size[0]*C/y),-2/(e.size[1]*C/y)),FI(this.tileTransform_,E.rotation),Lf(this.tileTransform_,1,1/x),UI(this.tileTransform_,(g[0]*(b-R)-r)/y,(g[1]*(O-w)-r)/v),this.renderTile(t,this.tileTransform_,e,s,d,g,f,_,m,r,u)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,r=this.getLayer(),s=r.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),l=kh(e,e.extent),h=o.getZForResolution(n.resolution,s.zDirection),c=xL(),u=r.getPreload();if(e.nextExtent){const x=o.getZForResolution(n.nextResolution,s.zDirection),R=kh(e,e.nextExtent);this.enqueueTiles(e,R,x,c,u)}this.enqueueTiles(e,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(e,l,h-1,c,u-1)},0);const d={},g=Je(this),f=e.time;let _=!1;for(const x of c.representationsByZ[h]){const R=x.tile;if((R instanceof Xl||R instanceof x0)&&R.getState()===M.EMPTY)continue;const w=R.tileCoord;if(x.ready){const O=R.getAlpha(g,f);if(O===1){R.endTransition(g);continue}_=!0;const J=Yn(w);d[J]=O}if(this.renderComplete=!1,this.findAltTiles_(o,w,h+1,c))continue;const b=o.getMinZoom();for(let O=h-1;O>=b&&!this.findAltTiles_(o,w,O,c);--O);}const m=c.representationsByZ,E=Object.keys(m).map(Number).sort(a2);if(this.beforeTilesMaskRender(e))for(let x=0,R=E.length;x<R;++x){const w=E[x];for(const C of m[w]){const b=C.tile.tileCoord;if(Yn(b)in d)continue;const J=o.getTileCoordExtent(b);this.renderTileMask(C,w,J,Yf(w))}}this.beforeTilesRender(e,_);for(let x=0,R=E.length;x<R;++x){const w=E[x];for(const C of m[w]){const b=C.tile.tileCoord;Yn(b)in d||this.drawTile_(e,C,w,a,l,d,o)}}for(const x of m[h]){const R=x.tile.tileCoord;Yn(R)in d&&this.drawTile_(e,x,h,a,l,d,o)}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const T=this.helper.getCanvas(),y=this.tileRepresentationCache;for(;y.canExpireCache();)y.pop().dispose();const v=function(x,R){s.updateCacheSize(.1,R.viewState.projection),s.expireCache(R.viewState.projection,RL)};return e.postRenderFunctions.push(v),this.postRender(t,e),T}findAltTiles_(e,t,n,r){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=s.minX;h<=s.maxX;++h)for(let c=s.minY;c<=s.maxY;++c){const u=Nc(l,[n,h,c]);let d=!1;if(a.containsKey(u)){const g=a.get(u);g.ready&&!qf(r,g.tile)&&(Qf(r,g,n),d=!0)}d||(o=!1)}return o}clearCache(){const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){super.disposeInternal(),delete this.frameState}}const H={...vL,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},oa={TEXTURE_COORD:"a_textureCoord"},CL=[{name:oa.TEXTURE_COORD,size:2,type:_s.FLOAT}];class bL extends wL{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new C0(wd,Cd),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){super.reset(e),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}createTileRepresentation(e){return new gL(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,r,s,o,a,l,h,c,u){const d=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(CL);let g=0;for(;g<e.textures.length;){const x=`${H.TILE_TEXTURE_ARRAY}[${g}]`;this.helper.bindTexture(e.textures[g],g,x),++g}for(let x=0;x<this.paletteTextures_.length;++x){const R=this.paletteTextures_[x],w=R.getTexture(d);this.helper.bindTexture(w,g,R.name),++g}const f=n.viewState,_=o[0]+2*c,m=o[1]+2*c,p=e.tile.tileCoord,T=p[1],y=p[2];this.helper.setUniformMatrixValue(H.TILE_TRANSFORM,L0(this.tempMat4,t)),this.helper.setUniformFloatValue(H.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(H.DEPTH,h);let v=r;c>0&&(v=l,Mt(v,r,v)),this.helper.setUniformFloatVec4(H.RENDER_EXTENT,v),this.helper.setUniformFloatValue(H.RESOLUTION,f.resolution),this.helper.setUniformFloatValue(H.ZOOM,f.zoom),this.helper.setUniformFloatValue(H.TEXTURE_PIXEL_WIDTH,_),this.helper.setUniformFloatValue(H.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(H.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(H.TEXTURE_ORIGIN_X,a[0]+T*o[0]*s-c*s),this.helper.setUniformFloatValue(H.TEXTURE_ORIGIN_Y,a[1]-y*o[1]*s+c*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const r=this.getLayer(),s=xt(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=r.getExtent();if(a&&!Ns(ni(a,o.projection),s))return null;const l=r.getSources(xc([s]),o.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(o.projection),c.getWrapX())break;const g=u.getExtent();if(!g||Ns(g,s))break}if(h<0)return null;const d=this.tileRepresentationCache;for(let g=u.getZForResolution(o.resolution);g>=u.getMinZoom();--g){const f=u.getTileCoordForCoordAndZ(s,g),_=Nc(c,f);if(!d.containsKey(_))continue;const m=d.get(_),E=m.tile;if((E instanceof Xl||E instanceof x0)&&E.getState()===M.EMPTY)return null;if(!m.loaded)continue;const p=u.getOrigin(g),T=Vt(u.getTileSize(g)),y=u.getResolution(g),v=(s[0]-p[0])/y-f[1]*T[0],x=(p[1]-s[1])/y-f[2]*T[1];return m.getPixelData(v,x)}return null}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_}}let ns=0;const Xi=0,Ge=1<<ns++,F=1<<ns++,Zt=1<<ns++,st=1<<ns++,Gr=1<<ns++,ft=Math.pow(2,ns)-1,A0={[Ge]:"boolean",[F]:"number",[Zt]:"string",[st]:"color",[Gr]:"number[]"},IL=Object.keys(A0).map(Number).sort(Ju);function nt(i){const e=[];for(const t of IL)SL(i,t)&&e.push(A0[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function SL(i,e){return(i&e)===e}function rn(i,e){return!!(i&e)}function mo(i,e){return i===e}class bi{constructor(e,t){this.type=e,this.value=t}}class M0{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function LL(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function PL(i){switch(i){case"string":return Zt;case"color":return st;case"number":return F;case"boolean":return Ge;case"number[]":return Gr;default:throw new Error(`Unrecognized type hint: ${i}`)}}function fe(i,e,t){switch(typeof i){case"boolean":return new bi(Ge,i);case"number":return new bi(F,i);case"string":{let r=Zt;return VI(i)&&(r|=st),mo(r&t,Xi)||(r&=t),new bi(r,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return XL(i,e,t);for(const r of i)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=Gr;return(i.length===3||i.length===4)&&(n|=st),t&&(n&=t),new bi(n,i)}const L={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette"},AL={[L.Get]:K(([i,e])=>e!==void 0?PL(e.value):ft,Q(1,2),ML),[L.Var]:K(([i])=>i.type,Q(1,1),OL),[L.Id]:K(F|Zt,us,DL),[L.Concat]:K(Zt,Q(2,1/0),le(ft)),[L.GeometryType]:K(Zt,us),[L.Resolution]:K(F,us),[L.Zoom]:K(F,us),[L.Time]:K(F,us),[L.Any]:K(Ge,Q(2,1/0),le(Ge)),[L.All]:K(Ge,Q(2,1/0),le(Ge)),[L.Not]:K(Ge,Q(1,1),le(Ge)),[L.Equal]:K(Ge,Q(2,2),le(ft),pi),[L.NotEqual]:K(Ge,Q(2,2),le(ft),pi),[L.GreaterThan]:K(Ge,Q(2,2),le(ft),pi),[L.GreaterThanOrEqualTo]:K(Ge,Q(2,2),le(ft),pi),[L.LessThan]:K(Ge,Q(2,2),le(ft),pi),[L.LessThanOrEqualTo]:K(Ge,Q(2,2),le(ft),pi),[L.Multiply]:K(i=>{let e=F|st;for(let t=0;t<i.length;t++)e&=i[t].type;return e},Q(2,1/0),le(F|st),pi),[L.Divide]:K(F,Q(2,2),le(F)),[L.Add]:K(F,Q(2,1/0),le(F)),[L.Subtract]:K(F,Q(2,2),le(F)),[L.Clamp]:K(F,Q(3,3),le(F)),[L.Mod]:K(F,Q(2,2),le(F)),[L.Pow]:K(F,Q(2,2),le(F)),[L.Abs]:K(F,Q(1,1),le(F)),[L.Floor]:K(F,Q(1,1),le(F)),[L.Ceil]:K(F,Q(1,1),le(F)),[L.Round]:K(F,Q(1,1),le(F)),[L.Sin]:K(F,Q(1,1),le(F)),[L.Cos]:K(F,Q(1,1),le(F)),[L.Atan]:K(F,Q(1,2),le(F)),[L.Sqrt]:K(F,Q(1,1),le(F)),[L.Match]:K(i=>{let e=ft;for(let t=2;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},Q(4,1/0),Jf,FL),[L.Between]:K(Ge,Q(3,3),le(F)),[L.Interpolate]:K(i=>{let e=st|F;for(let t=3;t<i.length;t+=2)e&=i[t].type;return e},Q(6,1/0),Jf,UL),[L.Case]:K(i=>{let e=ft;for(let t=1;t<i.length;t+=2)e&=i[t].type;return e&=i[i.length-1].type,e},Q(3,1/0),NL,GL),[L.In]:K(Ge,Q(2,2),jL),[L.Number]:K(F,Q(1,1/0),le(ft)),[L.String]:K(Zt,Q(1,1/0),le(ft)),[L.Array]:K(i=>i.length===3||i.length===4?Gr|st:Gr,Q(1,1/0),le(F)),[L.Color]:K(st,Q(3,4),le(F)),[L.Band]:K(F,Q(1,3),le(F)),[L.Palette]:K(st,Q(2,2),kL)};function ML(i,e){const t=fe(i[1],e);if(!(t instanceof bi))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),i.length===3){const n=fe(i[2],e);return[t,n]}return[t]}function OL(i,e,t,n){const r=i[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(r),!("variables"in e.style)||e.style.variables[r]===void 0)return[new bi(ft,r)];const s=e.style.variables[r],o=fe(s,e);if(o.value=r,n&&!rn(n,o.type))throw new Error(`The variable ${r} has type ${nt(o.type)} but the following type was expected: ${nt(n)}`);return[o]}function DL(i,e){e.featureId=!0}function us(i,e){const t=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function Q(i,e){return function(t,n){const r=t[0],s=t.length-1;if(i===e){if(s!==i){const o=i===1?"":"s";throw new Error(`Expected ${i} argument${o} for ${r}, got ${s}`)}}else if(s<i||s>e){const o=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`Expected ${o} arguments for ${r}, got ${s}`)}}}function le(i){return function(e,t){const n=e[0],r=e.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=fe(e[o+1],t);if(!rn(i,a.type)){const l=nt(i),h=nt(a.type);throw new Error(`Unexpected type for argument ${o} of ${n} operation, got ${l} but expected ${h}`)}a.type&=i,s[o]=a}return s}}function pi(i,e,t){const n=i[0],r=i.length-1;let s=ft;for(let a=0;a<t.length;++a)s&=t[a].type;if(s===Xi)throw new Error(`No common type could be found for arguments of ${n} operation`);const o=new Array(r);for(let a=0;a<r;++a)o[a]=fe(i[a+1],e,s);return o}function NL(i,e){const t=i[0],n=i.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function Jf(i,e){const t=i[0],n=i.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(n)} instead`)}function FL(i,e,t,n){const r=i.length-1;let o=fe(i[1],e).type;const a=fe(i[i.length-1],e);let l=n!==void 0?n&a.type:a.type;const h=new Array(r-2);for(let u=0;u<r-2;u+=2){const d=fe(i[u+2],e),g=fe(i[u+3],e);o&=d.type,l&=g.type,h[u]=d,h[u+1]=g}const c=Zt|F|Ge;if(!rn(c,o))throw new Error(`Expected an input of type ${nt(c)} for the interpolate operation, got ${nt(o)} instead`);if(mo(l,Xi))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let u=0;u<r-2;u+=2){const d=fe(i[u+2],e,o),g=fe(i[u+3],e,l);h[u]=d,h[u+1]=g}return[fe(i[1],e,o),...h,fe(i[i.length-1],e,l)]}function UL(i,e,t,n){const r=i[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=fe(s,e);let o=fe(i[2],e);if(!rn(F,o.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${nt(o.type)} instead`);o=fe(i[2],e,F);const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){let h=fe(i[l+3],e);if(!rn(F,h.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${nt(h.type)} at position ${l+2} instead`);let c=fe(i[l+4],e);if(!rn(F|st,c.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${nt(c.type)} at position ${l+3} instead`);h=fe(i[l+3],e,F),c=fe(i[l+4],e,F|st),a[l]=h,a[l+1]=c}return[s,o,...a]}function GL(i,e,t,n){const r=fe(i[i.length-1],e);let s=n!==void 0?n&r.type:r.type;const o=new Array(i.length-1);for(let a=0;a<o.length-1;a+=2){const l=fe(i[a+1],e),h=fe(i[a+2],e);if(!rn(Ge,l.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${nt(l.type)} at position ${a} instead`);s&=h.type,o[a]=l,o[a+1]=h}if(mo(s,Xi))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let a=0;a<o.length-1;a+=2)o[a+1]=fe(i[a+2],e,s);return o[o.length-1]=fe(i[i.length-1],e,s),o}function jL(i,e){let t=i[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let n=Zt|F;const r=new Array(t.length);for(let o=0;o<r.length;o++){const a=fe(t[o],e);n&=a.type,r[o]=a}if(mo(n,Xi))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[fe(i[1],e,n),...r]}function kL(i,e){const t=fe(i[1],e,F);if(t.type!==F)throw new Error(`The first argument of palette must be an number, got ${nt(t.type)} instead`);const n=i[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let s=0;s<r.length;s++){const o=fe(n[s],e,st);if(!(o instanceof bi))throw new Error(`The palette color at index ${s} must be a literal value`);if(!rn(o.type,st))throw new Error(`The palette color at index ${s} should be of type color, got ${nt(o.type)} instead`);r[s]=o}return[t,...r]}function K(i,...e){return function(t,n,r){const s=t[0];let o=[];for(let l=0;l<e.length;l++)o=e[l](t,n,o,r)||o;let a=typeof i=="function"?i(o):i;if(r!==void 0){if(!rn(a,r))throw new Error(`The following expression was expected to return ${nt(r)}, but returns ${nt(a)} instead: ${JSON.stringify(t)}`);a&=r}if(a===Xi)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new M0(a,s,...o)}}function XL(i,e,t){const n=i[0],r=AL[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(i,e,t)}class zL{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}function BL(i,e){return`operator_${i}_${Object.keys(e.functions).length}`}function Vl(i){const e=i.toString();return e.includes(".")?e:e+".0"}function O0(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Vl).join(", ")})`}function $L(i){const e=Qa(i),t=e.length>3?e[3]:1;return O0([e[0]/255*t,e[1]/255*t,e[2]/255*t,t])}const Xh={};let KL=0;function D0(i){return i in Xh||(Xh[i]=KL++),Xh[i]}function VL(i){return Vl(D0(i))}function N0(i){return"u_var_"+i}function ZL(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,style:{}}}const zh="getBandValue",F0="u_paletteTextures";function HL(i,e,t,n){const r=fe(i,t,e);if(mo(r.type,Xi))throw new Error("No matching type was found");if(!rn(e,r.type)){const s=nt(e),o=nt(r.type);throw new Error(`Expected expression to be of type ${s}, got ${o}`)}return Id(r,e,n)}function ne(i){return(e,t,n)=>{const r=t.args.length,s=new Array(r);for(let o=0;o<r;++o)s[o]=Id(t.args[o],n,e);return i(s,e)}}const WL={[L.Get]:(i,e)=>{const n=e.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:e.type}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[L.GeometryType]:(i,e,t)=>{const n="geometryType",r=a=>{const l=a.getType();switch(l){case"Point":case"LineString":case"Polygon":return l;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return l.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return r(a.getGeometries()[0])}};return n in i.properties||(i.properties[n]={name:n,type:Zt,evaluator:a=>r(a.getGeometry())}),(i.inFragmentShader?"v_prop_":"a_prop_")+n},[L.Var]:(i,e)=>{const n=e.args[0].value;return n in i.variables||(i.variables[n]={name:n,type:e.type}),N0(n)},[L.Resolution]:()=>"u_resolution",[L.Zoom]:()=>"u_zoom",[L.Time]:()=>"u_time",[L.Any]:ne(i=>`(${i.join(" || ")})`),[L.All]:ne(i=>`(${i.join(" && ")})`),[L.Not]:ne(([i])=>`(!${i})`),[L.Equal]:ne(([i,e])=>`(${i} == ${e})`),[L.NotEqual]:ne(([i,e])=>`(${i} != ${e})`),[L.GreaterThan]:ne(([i,e])=>`(${i} > ${e})`),[L.GreaterThanOrEqualTo]:ne(([i,e])=>`(${i} >= ${e})`),[L.LessThan]:ne(([i,e])=>`(${i} < ${e})`),[L.LessThanOrEqualTo]:ne(([i,e])=>`(${i} <= ${e})`),[L.Multiply]:ne(i=>`(${i.join(" * ")})`),[L.Divide]:ne(([i,e])=>`(${i} / ${e})`),[L.Add]:ne(i=>`(${i.join(" + ")})`),[L.Subtract]:ne(([i,e])=>`(${i} - ${e})`),[L.Clamp]:ne(([i,e,t])=>`clamp(${i}, ${e}, ${t})`),[L.Mod]:ne(([i,e])=>`mod(${i}, ${e})`),[L.Pow]:ne(([i,e])=>`pow(${i}, ${e})`),[L.Abs]:ne(([i])=>`abs(${i})`),[L.Floor]:ne(([i])=>`floor(${i})`),[L.Ceil]:ne(([i])=>`ceil(${i})`),[L.Round]:ne(([i])=>`floor(${i} + 0.5)`),[L.Sin]:ne(([i])=>`sin(${i})`),[L.Cos]:ne(([i])=>`cos(${i})`),[L.Atan]:ne(([i,e])=>e!==void 0?`atan(${i}, ${e})`:`atan(${i})`),[L.Sqrt]:ne(([i])=>`sqrt(${i})`),[L.Match]:ne(i=>{const e=i[0],t=i[i.length-1];let n=null;for(let r=i.length-3;r>=1;r-=2){const s=i[r],o=i[r+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[L.Between]:ne(([i,e,t])=>`(${i} >= ${e} && ${i} <= ${t})`),[L.Interpolate]:ne(([i,e,...t])=>{let n="";for(let r=0;r<t.length-2;r+=2){const s=t[r],o=n||t[r+1],a=t[r+2],l=t[r+3];let h;i===Vl(1)?h=`(${e} - ${s}) / (${a} - ${s})`:h=`(pow(${i}, (${e} - ${s})) - 1.0) / (pow(${i}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[L.Case]:ne(i=>{const e=i[i.length-1];let t=null;for(let n=i.length-3;n>=0;n-=2){const r=i[n],s=i[n+1];t=`(${r} ? ${s} : ${t||e})`}return t}),[L.In]:ne(([i,...e],t)=>{const n=BL("in",t),r=[];for(let s=0;s<e.length;s+=1)r.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${r.join(`
`)}
  return false;
}`,`${n}(${i})`}),[L.Array]:ne(i=>`vec${i.length}(${i.join(", ")})`),[L.Color]:ne(i=>{const e=i.slice(0,3).map(n=>`${n} / 255.0`);return i.length===3?`vec4(${e.join(", ")}, 1.0)`:`(${i[3]} * vec4(${e.join(", ")}, 1.0))`}),[L.Band]:ne(([i,e,t],n)=>{if(!(zh in n.functions)){let r="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let l=o%4;o===s-1&&l===1&&(l=3);const h=`${H.TILE_TEXTURE_ARRAY}[${a}]`;r+=`  if (band == ${o+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[zh]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${H.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${H.TEXTURE_PIXEL_HEIGHT};
${r}
}`}return`${zh}(${i}, ${e??"0.0"}, ${t??"0.0"})`}),[L.Palette]:(i,e)=>{const[t,...n]=e.args,r=n.length,s=new Uint8Array(r*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Qa(c),d=h*4;s[d]=u[0],s[d+1]=u[1],s[d+2]=u[2],s[d+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const o=`${F0}[${i.paletteTextures.length}]`,a=new zL(o,s);i.paletteTextures.push(a);const l=Id(t,F,i);return`texture2D(${o}, vec2((${l} + 0.5) / ${r}.0, 0.5))`}};function Id(i,e,t){if(i instanceof M0){const n=WL[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(t,i,e)}if((i.type&F)>0)return Vl(i.value);if((i.type&Ge)>0)return i.value.toString();if((i.type&Zt)>0)return VL(i.value.toString());if((i.type&st)>0)return $L(i.value);if((i.type&Gr)>0)return O0(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${nt(e)})`)}function sr(i,e,t){const n=LL();return n.style=i.style,HL(e,t,n,i)}function e_(i,e){const t=`
    attribute vec2 ${oa.TEXTURE_COORD};
    uniform mat4 ${H.TILE_TRANSFORM};
    uniform float ${H.TEXTURE_PIXEL_WIDTH};
    uniform float ${H.TEXTURE_PIXEL_HEIGHT};
    uniform float ${H.TEXTURE_RESOLUTION};
    uniform float ${H.TEXTURE_ORIGIN_X};
    uniform float ${H.TEXTURE_ORIGIN_Y};
    uniform float ${H.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${oa.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${H.TEXTURE_ORIGIN_X} + ${H.TEXTURE_RESOLUTION} * ${H.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${H.TEXTURE_ORIGIN_Y} - ${H.TEXTURE_RESOLUTION} * ${H.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${H.TILE_TRANSFORM} * vec4(${oa.TEXTURE_COORD}, ${H.DEPTH}, 1.0);
    }
  `,n={...ZL(),inFragmentShader:!0,bandCount:e,style:i},r=[];if(i.color!==void 0){const u=sr(n,i.color,st);r.push(`color = ${u};`)}if(i.contrast!==void 0){const u=sr(n,i.contrast,F);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=sr(n,i.exposure,F);r.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=sr(n,i.saturation,F);r.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=sr(n,i.gamma,F);r.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=sr(n,i.brightness,F);r.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<o;++u){const d=n.variables[Object.keys(n.variables)[u]];if(!(d.name in i.variables))throw new Error(`Missing '${d.name}' in style variables`);const g=N0(d.name);s[g]=function(){let f=i.variables[d.name];return typeof f=="string"&&(f=D0(f)),f!==void 0?f:-9999999}}const a=Object.keys(s).map(function(u){return`uniform float ${u};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${H.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&a.push(`uniform sampler2D ${F0}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${H.RENDER_EXTENT};
    uniform float ${H.TRANSITION_ALPHA};
    uniform float ${H.TEXTURE_PIXEL_WIDTH};
    uniform float ${H.TEXTURE_PIXEL_HEIGHT};
    uniform float ${H.RESOLUTION};
    uniform float ${H.ZOOM};

    ${a.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${H.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${H.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${H.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${H.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${H.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${r.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${H.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:c,uniforms:s,paletteTextures:n.paletteTextures}}class Fc extends eL{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const n=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=n,this.styleVariables_=this.style_.variables||{},this.addChangeListener(ue.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=e_(this.style_,this.getSourceBandCount_());return new bL(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let r;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(r=n.renderFrame(e));return r}render(e,t){this.rendered=!0;const n=e.viewState,r=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,l=r.length;a<l;++a){const h=r[a],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}s=s&&c=="ready"}const o=this.renderSources(e,r);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!r.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=e_(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}Fc.prototype.dispose;class YL extends $l{constructor(e){e=e||{},super(e)}}let Tr=null;function qL(){Tr=an(1,1,void 0,{willReadFrequently:!0})}class QL extends I0{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=nn(),this.pixelTransform=nn(),this.inversePixelTransform=nn(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,n){Tr||qL(),Tr.clearRect(0,0,1,1);let r;try{Tr.drawImage(e,t,n,1,1,0,0,1,1),r=Tr.getImageData(0,0,1,1).data}catch{return Tr=null,null}return r}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,t,n){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!n||e&&e.style.backgroundColor&&Dl(Qa(e.style.backgroundColor),Qa(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=an();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const r=Jr(n),s=kl(n),o=jl(n),a=Gl(n);xt(t.coordinateToPixelTransform,r),xt(t.coordinateToPixelTransform,s),xt(t.coordinateToPixelTransform,o),xt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;xt(l,r),xt(l,s),xt(l,o),xt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){const s=new vs(e,this.inversePixelTransform,n,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(Tt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Tt.POSTRENDER,e,t)}getRenderTransform(e,t,n,r,s,o,a){const l=s/2,h=o/2,c=r/t,u=-c,d=-e[0]+a,g=-e[1];return Ni(this.tempTransform,l,h,c,u,-n,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class JL extends QL{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],n=e.pixelRatio,r=e.viewState,s=r.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Mt(l,ni(t.extent,r.projection))),!a[pt.ANIMATING]&&!a[pt.INTERACTING]&&!ki(l))if(o){const h=r.projection,c=o.getImage(l,s,n,h);c&&(this.loadImage(c)?this.image_=c:c.getState()===ve.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=xt(t.pixelToCoordinateTransform,e.slice()),s=n.getExtent();if(s&&!Ns(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Ae(o),h=Math.floor(a.width*((r[0]-o[0])/l));if(h<0||h>=a.width)return null;const c=ut(o),u=Math.floor(a.height*((o[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,h,u)}renderFrame(e,t){const n=this.image_,r=n.getExtent(),s=n.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=n.getPixelRatio(),h=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,d=u.center,g=u.resolution,f=c*o/(g*l),_=c*a/(g*l),m=e.extent,E=u.resolution,p=u.rotation,T=Math.round(Ae(m)/E*c),y=Math.round(ut(m)/E*c);Ni(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,p,-T/2,-y/2),r0(this.inversePixelTransform,this.pixelTransform);const v=jI(this.pixelTransform);this.useContainer(t,v,this.getBackground(e));const x=this.context,R=x.canvas;R.width!=T||R.height!=y?(R.width=T,R.height=y):this.containerReused||x.clearRect(0,0,T,y);let w=!1,C=!0;if(h.extent){const U=ni(h.extent,u.projection);C=ho(U,e.extent),w=C&&!Ba(U,e.extent),w&&this.clipUnrotated(x,e,U)}const b=n.getImage(),O=Ni(this.tempTransform,T/2,y/2,f,_,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const J=b.width*O[0],z=b.height*O[3];if(this.getLayer().getSource().getInterpolate()||(x.imageSmoothingEnabled=!1),this.preRender(x,e),C&&J>=.5&&z>=.5){const U=O[4],G=O[5],W=h.opacity;let Ne;W!==1&&(Ne=x.globalAlpha,x.globalAlpha=W),x.drawImage(b,0,0,+b.width,+b.height,U,G,J,z),W!==1&&(x.globalAlpha=Ne)}return this.postRender(x,e),w&&x.restore(),x.imageSmoothingEnabled=!0,v!==R.style.transform&&(R.style.transform=v),this.container}}class eP extends YL{constructor(e){super(e)}createRenderer(){return new JL(this)}getData(e){return super.getData(e)}}const t_=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],n_={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class U0 extends go{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const n=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof n=="string"?document.createTextNode(n):n;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(X.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${es} ${Kl}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(i_(t))if(r_(t))nP(t);else{let n;this.source_?n=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:n=e.getTargetElement(),this.keys_?tP(n):G0(n)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=r_(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(Xa(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(n_.ENTERFULLSCREEN)):(Xa(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(n_.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener($e.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener($e.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let n=0,r=e.length;n<r;++n)we(e[n]);e.length=0;const t=this.getMap();if(t){const n=t.getOwnerDocument();i_(n)?this.element.classList.remove(zf):this.element.classList.add(zf);for(let r=0,s=t_.length;r<s;++r)e.push(se(n,t_[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function i_(i){const e=i.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&i.fullscreenEnabled)}function r_(i){return!!(i.webkitIsFullScreen||i.fullscreenElement)}function G0(i){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen()}function tP(i){i.webkitRequestFullscreen?i.webkitRequestFullscreen():G0(i)}function nP(i){i.exitFullscreen?i.exitFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()}const Bh="units",iP=[1,2,5],ds=25.4/.28;class j0 extends go{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+es,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Bh,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Bh)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Bh,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,n=e.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let o=Ha(n,e.resolution,t,s);const a=this.minWidth_*(this.dpi_||ds)/ds,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||ds)/ds:void 0;let h=a*o,c="";if(r=="degrees"){const T=Ur.degrees;h*=T,h<T/60?(c="",o*=3600):h<T?(c="",o*=60):c=""}else if(r=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(r=="nautical")o/=1852,c="NM";else if(r=="metric")h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(r=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(a*o)/Math.log(10)),d,g,f,_,m,E;for(;;){f=Math.floor(u/3);const T=Math.pow(10,f);if(d=iP[(u%3+3)%3]*T,g=Math.round(d/o),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&g>=l){d=_,g=m,f=E;break}else if(g>=a)break;_=d,m=g,E=f,++u}const p=this.scaleBar_?this.createScaleBar(g,d,c):d.toFixed(f<0?-f:0)+" "+c;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const u=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,e,!1,t,n):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+s+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,r,s){const a=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+s),l=e===0?-3:t/this.scaleBarSteps_*-1,h=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${h}px;left: ${n?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=Ha(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||ds,n=1e3/25.4;return e*n*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}o2(()=>Promise.resolve({}),__vite__mapDeps([0]));const k0=500,rP=!0;function sP(i,e){let t,n,r,s;const o=()=>{const u=e.srid(),d=e.fullExtent();return u==="EPSG:3857"?d:e.transformRectangle(d,u,"EPSG:3857")},a=()=>{i.innerHTML="";const u=o().center();t=new Xt({center:[u.x,u.y],zoom:10}),s=new DI(e,{debug:!1,extentBufferFactor:()=>document.getElementById("extentBufferFactor").valueAsNumber}),r=new Fc({source:s}),n=new v0({target:i,view:t,controls:Td().extend([new j0,new U0]),layers:[r,new Fc({visible:rP,source:new t0({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"}),style:{saturation:["var","saturation"],variables:{saturation:-.75}}})].reverse()}),n.once("precompose",function(d){l()})},l=()=>{const u=o();t.fit([u.xMinimum,u.yMinimum,u.xMaximum,u.yMaximum],{duration:k0}),setTimeout(()=>{h()},0)},h=()=>{s?.clear(),r?.getRenderer()?.clearCache(),r?.changed()},c=document.getElementById("xyzBaseMap");return c&&c.addEventListener("change",()=>{n&&n.getLayers().getArray()[0].setVisible(c.checked)}),a(),{init:a,update:l,render:h}}function oP(i,e){let t,n,r,s,o;const a=()=>{i.innerHTML="",n=e.srid();const c=new Ka({code:n,units:"m"}),d=e.fullExtent().center();t=new Xt({projection:c,center:[d.x,d.y],zoom:10}),o=new If(e,{projection:c}),s=new eP({source:o}),r=new v0({target:i,view:t,controls:Td().extend([new j0,new U0]),layers:[s]}),r.once("precompose",function(g){const f=e.fullExtent();t.fit([f.xMinimum,f.yMinimum,f.xMaximum,f.yMaximum],{duration:k0})})},l=()=>{a()},h=()=>{setTimeout(()=>{o=new If(e,{projection:new Ka({code:n,units:"m"})}),s?.setSource(o)},0)};return a(),{init:a,update:l,render:h}}function aP(i,e){const t=()=>{i.innerHTML="";const n=document.createElement("div");n.className="layers",i.appendChild(n);const r=e.mapLayers();for(const s of r){const o=document.createElement("div");o.className="layer";const a=document.createElement("input");a.type="checkbox",s.visible&&(a.checked=!0),a.addEventListener("change",()=>{s.visible=a.checked,redraw(),t()}),o.appendChild(a);const l=document.createTextNode(s.name);o.appendChild(l);const h=document.createElement("input");s.visible||(h.style.visibility="hidden"),h.type="range",h.min="0",h.max="100",h.value=""+s.opacity*100,h.step="1",h.addEventListener("change",()=>{s.opacity=parseInt(h.value)/100,redraw()}),o.appendChild(h),n.appendChild(o)}if(e.mapThemes().length>0){const s=document.createElement("div");s.className="themes",i.appendChild(s);const o=document.createElement("select");o.addEventListener("change",()=>{o.value&&(e.setMapTheme(o.value),redraw(),t())}),s.appendChild(o);const a=e.getMapTheme(),l=document.createElement("option");l.value="",l.text="",a||(l.selected=!0),o.appendChild(l);for(const h of e.mapThemes()){const c=document.createElement("option");c.value=h,c.text=h,h===a&&(c.selected=!0),o.appendChild(c)}}};return t(),t}const qt=!1,lP=i=>({owner:"boardend",repo:"qgis-js-projects",path:"/"+i,branch:"main",prefix:`${i[0].toUpperCase()}${i.slice(1)}: `}),hP=[lP("demo")];async function cP(){console.log(`qgis-js (${Mb})`);const i=document.getElementById("status"),e=document.getElementById("project");let t=!1;const n=o=>{t||(i.firstElementChild.innerHTML=o)},r=o=>{t=!0,console.error(o);const a=""+o&&o.message?o.message:"Runtime error";e.style.visibility="none",i.style.display="auto",i.innerHTML=`<div class="alert alert-danger" role="alert">
      <b style="color: red">Error:&nbsp;</b>
      ${a}
    </div>`},s=()=>{i.style.display="none",e.style.visibility="visible"};try{const{api:o,fs:a}=await Ab({prefix:"assets/wasm",onStatus:R=>n(R)});n("Loading projects...");const l=[],h=[],{openProject:c,loadLocalProject:u,loadRemoteProjects:d,loadGithubProjects:g}=n2(a,R=>{o.loadProject(R),setTimeout(()=>{l.forEach(w=>w())},0)}),f=async function(){const R=await u();await c(R),E(R.name,()=>R),m.value=R.name},_=new Map,m=document.getElementById("projects");m.addEventListener("change",()=>{const R=_.get(m.value);R&&c(R())});const E=(R,w)=>{_.set(R,w);const C=document.createElement("option");C.value=R,C.text=R,m.add(C,null)};document.getElementById("local-project").onclick=f;const p=await d();p.forEach(R=>E(R.name,()=>R));for(const R of hP)try{const w=await g(R.owner,R.repo,R.path,R.branch);Object.entries(w).forEach(([C,b])=>{E((R.prefix||"")+C,b)})}catch(w){console.warn(`Unable to load GitHub project "${R.owner}/${R.repo}"`,w)}n("Opening first project..."),await c(p[0]),n("Rendering first frame..."),await o.renderImage(o.srid(),o.fullExtent(),42,42,1),s();const T=document.getElementById("layers-control");T&&l.push(aP(T,o,()=>{setTimeout(()=>{h.forEach(R=>R())},0)}));const y=document.getElementById("js-demo-canvas");if(y){const{update:R,render:w}=i2(y,o);l.push(R),h.push(w);const C=document.getElementById("tab1");C.addEventListener("change",()=>{C.checked&&R()})}const v=document.getElementById("ol-demo-xyz");if(v){const{update:R,render:w}=sP(v,o);l.push(R),h.push(w)}const x=document.getElementById("ol-demo-canvas");if(x){const{update:R,render:w}=oP(x,o);l.push(R),h.push(w)}}catch(o){r(o)}}document.addEventListener("DOMContentLoaded",function(){cP()});
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ol-CSy_vbSQ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
